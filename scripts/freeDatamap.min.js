function dm_tools_NameIdList(){this.listByName={},this.listById={};var a=this;this.resyncId=function(){var b=0;for(var c in a.listById)b=Math.max(b,c);dm_Tools.counter<=b&&(dm_Tools.counter=b)},this.updateName=function(b){var c=a.listByName[b.name];c||(c=[],a.listByName[b.name]=c),c.push(b)},this.addObject=function(b){!b.id||dm_tools_NameIdList.forceId?b.id=dm_Tools.getId():dm_Tools.counter<=b.id&&(dm_Tools.counter=b.id+1),a.listById[b.id]&&(b.id=dm_Tools.getId()),a.listById[b.id]=b,a.updateName(b)},this.updateNames=function(){a.listByName={};var b;for(var c in a.listById)b=a.listById[c],a.updateName(b)},this.removeObject=function(b){var c;if(b.id&&delete a.listById[b.id],b.name){var d=a.listByName[b.name];d&&(c=d.indexOf(b.name),c>=0&&d.splice(c,1))}},this.getObject=function(b){return a.listById[b]},this.getObjects=function(b){return a.listByName[b]},this.getFirstObject=function(b){var c,d=a.listByName[b];return d&&d.length>0&&(c=d[0]),c},this.updateAndGetNames=function(){return a.updateNames(),a.getNames()},this.getNames=function(){var b=[];for(var c in a.listByName)b.push(c);return b},this.setAll=function(b){var c;for(var d in a.listById){c=a.listById[d];for(var e in b)c[e]=b[e]}},this.getAll=function(){var b=[];for(var c in a.listById)b.push(a.listById[c]);return b},this.concat=function(b){for(id in b.listById)a.addObject(b.listById[id]);return a}}function dm_Tools(){}function dm_ToolsUI(){}function dm_Json2tree(a,b){this.nodes=new dm_tools_NameIdList;var c=this,d=function(a){var e,f;dm_Tools.bestEffortLevel(a);for(e in a)dm_Json2tree.reservedProps.indexOf(e)<0&&(a.rawNode||(a.rawNode={}),a.rawNode[e]=a[e]);if(a.rawNode)for(e in a.rawNode)f=a.rawNode[e],listValue=b[e],listValue&&listValue.indexOf(f)<0&&listValue.push(f);c.nodes.addObject(a),a.children&&a.children.forEach(function(b){b&&(b.parent=a,d(b))})};d(a)}function dm_Datamap(a,b,c,d,e,f,g,h,i,j){var k=this;this.root,this.table2graph,this.nodes,this.graph=h,this.globalQuery,this.globalQueryNames,this.props2query={},this.noSelect=f,this.parentNode=j,this.config=c,this.input=a,this.loadWithAjax=b,this.postInit=e,this.name,this.adminConfigTree,this.data,this.aggregate=function(a,b){var c=b||k.root;dm_BeforeAll.noaggreg?null!=a&&a(c,c):(dm_Tools.getDelay(),dm_Attributes.aggregate(c,function(b,c){b&&(k.root=b,k.setNodes(dm_Tools.getNodesFromRoot(k.root))),console.log("finished doing the aggregation "+dm_Tools.getDelay()),null!=a&&a(b,c)}))},this.setNodes=function(a){k.nodes=a,k.nodes.resyncId()},this.feedSearchQuery=function(a){var a=a||k.root,b=!1;console.log("feeding the search field in the navbar... with currentDatamap : "+k.name+" adding : "+k.nodes.getAll().length+" nodes    time : "+dm_Tools.getDelay()),b=!0,k.globalQuery=dm_Tools.getSearchList(a),k.globalQueryNames=[];for(var c in k.globalQuery)k.globalQueryNames.push(c);dm_Datamap.feedSearchQuery("top_search_query",k.globalQueryNames,function(a){k.globalQuery&&k.globalQuery[a]&&(a=k.globalQuery[a]),k.graph&&(dm_UI.resetMouseOverSelection(null),k.graph.init(a),dm_UI.resetMouseOverSelection(k.graph.center))}),b&&console.log("finished feeding the search field "+dm_Tools.getDelay())};var l=function(){k.noSelect||(dm_Datamap.currentDatamap=k)},m=function(a){k.noSelect||k.feedSearchQuery();var b=k.config.datamapName;k.name=b||k.config.dm_DatamapName||k.name||k.root.name,console.log("Register Datamap as name = "+k.name),dm_Datamap.maps[k.name]=k,k.root&&(k.root.dm_DatamapName=k.name),dm_UI.listOfEditingNodes=[],console.log("props to query : ",k.props2query),null!=a&&a(k),k.noSelect=!1},n=function(){var a;k.root&&(k.root[dm_Tools_dm_config_name]||(k.root[dm_Tools_dm_config_name]=k.config));var a,b=d||k.root,c=dm_Tools.getParentNode4Config(b);return c&&(a=c[dm_Tools_dm_config_name]),a?(null==a.styles&&(a.styles=dm_Tools.getConfigProp("styles",b,k.parentNode)),null==a.depth&&(a.depth=dm_Tools.getConfigProp("depth",b,k.parentNode)),null==a.setColumns2node&&(a.setColumns2node=dm_Tools.getConfigProp("setColumns2node",b,k.parentNode)),null==a.displayProps&&(a.displayProps=dm_Tools.getConfigProp("displayProps",b,k.parentNode)),null==a.sortDescendant&&(a.sortDescendant=dm_Tools.getConfigProp("sortDescendant",b,k.parentNode)),null==a.sort&&(a.sort=dm_Tools.getConfigProp("sort",b,k.parentNode)),null==a.props4globalSearch&&(a.props4globalSearch=dm_Tools.getConfigProp("props4globalSearch",b,k.parentNode))):a=k.config||dm_Tools.defaultConfig(),k.config||(k.config=a),a},o=function(a,b){if(k.noSelect)m(b);else{var c=100,d=n();g||k.graph?m(b):k.graph=new dm_graph_Force(k,a||d.center,d.depth,function(){m(b)},c,null,d.linkDistance,d.linkStrength,d.charge,d.friction,d.alpha,d.theta),g||dm_UI.autoResize()}};!function(a){l();var b=n(),d=function(){if(b.displayProps)for(var a,c,d=b.displayProps.length,e=0;d>e;e++){if(c=b.displayProps[e],!c.children)return;for(var f,g=c.children.length,h=0;g>h;h++)f=c[h],a=null,f.name&&(a=f.name),a&&(k.props2query[a]=[])}},e=function(){k.root||(k.root=dm_Datamap.createNode(),"string"==typeof k.input&&(k.root.name=k.input));var b=n();if(dm_Tools.setSpecificsFromConfig(b),(1==b.updateAllDmProps||"true"==b.updateAllDmProps)&&(console.log("before dm_Tools.prop2objAll",dm_Tools.getDelay()),dm_Tools.prop2objAll(k.root),console.log("after dm_Tools.prop2objAll",dm_Tools.getDelay())),1==b.updateAllImageSizes||"true"==b.updateAllImageSizes||1==b.inlineAllImages||"true"==b.inlineAllImages){var c=1!=b.inlineAllImages&&"true"!=b.inlineAllImages;console.log("before dm_Tools.inlineAndUpdateSizeOfAllImages",dm_Tools.getDelay("inlineAndUpdateSizeOfAllImages")),dm_Tools.inlineAndUpdateSizeOfAllImages(k.root,c)}k.aggregate(function(){var b=n();dm_Tools.sortTree(k.root,b),dm_Datamap.afterAggregateAndRootCopyInParentDm(k.root),o(a,k.postInit)})},f=function(){d();var a=new dm_Json2tree(k.root,k.props2query);k.setNodes(a.nodes),e(k.postInit)},g=function(){k.root.rawNode||(k.root.rawNode={}),k.root.rawNode.dm_sourceFile=k.input};if("string"==typeof k.input){var h="text/plain",j=function(){console.log('no appropriate file format, choose "csv", "ldif" or "json" instead of "'+m+'"')},m=(k.config?k.config.fileExtension:null)||dm_Tools.getFileExtension(k.input);k.name=k.input,m==dm_Csv.extension?j=function(a){var a=dm_IO.convertHtml2accented(a),d=function(){dm_Table2graph.init(a,k),b=n(),k.data&&(b.columnNames=k.data[0],dm_Csv.removeEmptyColumns(b.columnNames)),g(),e()};if(c)d();else{var f,h=k.input.lastIndexOf(".");h>0&&(f=k.input.substring(0,h));var i=function(a){k.config=dm_Tools.parseStringified(a).config,k.config.dm_DatamapName=k.config.dm_DatamapName||k.input,d()},j="data/"+f+".config.json";dm_Tools.testFileExist(j,function(){d3.text(j,"text/plain;charset=ISO-8859-15",i)},function(){j=j.toLowerCase(),dm_Tools.testFileExist(j,function(){d3.text(j,"text/plain;charset=ISO-8859-15",i)},function(){f=null,d3.text("config/default.config.json","text/plain;charset=ISO-8859-15",i)})})}}:m==dm_LDIF.extension?j=function(a){var a=dm_IO.convertHtml2accented(a),b=function(){console.log("before ldif file parsing",dm_Tools.getDelay()),dm_LDIF.parse(a,k),n(),g(),e()};c?b():d3.text("config/ldif.config.json","text/plain;charset=ISO-8859-15",function(a){k.config=dm_Tools.parseStringified(a).config,k.config.dm_DatamapName=k.config.dm_DatamapName||"config/ldif.config.json",b()})}:"json"==m&&(j=function(a){var b=dm_Tools.parseStringified(a),c=function(){g(),n(),f()};if("http://www.freedatamap.com/jsonSchema/schema#"==b.$schema)k.root=b.root,c();else if("http://www.freedatamap.com/jsonConfigSchema/schema#"==b.$schema){if(k.root=dm_Json2tree.obj2tree(b,!0,!0),!k.root.name){var d=dm_Tools.deepCopy(k.input),e=Math.max(d.lastIndexOf("/"),d.lastIndexOf("\\"));e>=0&&e+1<d.length&&(d=d.substring(e+1)),k.root.name=d.split(".json")[0]}d3.text("config/config.config.json","text/plain;charset=ISO-8859-15",function(a){k.config=dm_Tools.parseStringified(a).config,k.config.dm_DatamapName=k.config.dm_DatamapName||k.input||"config/config.config.json",c()})}else k.root=dm_Json2tree.obj2tree(b,!0,!0),k.root.name||(k.root.name=k.input.split(".json")[0]),c()}),k.loadWithAjax?(k.name=decodeURI(k.input),dm_IO.loadJson("data/"+k.input,j)):i?j(i):0==k.input.indexOf("http:/")?dm_Tools.loadFromUrl(k.input,j):d3.text("data/"+k.input,h+";charset=ISO-8859-15",function(a){if("json"==m){var b=dm_Tools.parseStringified(a),c=b.$charset;if(c)return d3.text("data/"+k.input,h+";charset="+c,j),void 0}j(a)})}else k.input?(k.root=k.input,f()):(k.root=dm_Datamap.createNode(),o(a,k.postInit))}(d),this.select=function(a,b){l(),m(b)},this.reload=function(){return new dm_Datamap(k.input,k.loadWithAjax,k.config,k.root,k.postInit,null,null,k.graph,k.parentNode)}}function dm_3D(){var a=this;dm_3D.currentRunning3Dobjs.push(a),console.log("adding 3D object : list length = ",dm_3D.currentRunning3Dobjs.length),this.transformation,this.delay=35,this.obj,this.obj_name,this.obj_drag,this.obj_rotate,this.svgOrCanvas,this.UIContainer,this.canvasContext,this.scaleValue,this.dontLoop,this.startRunning,this.timeout=6e4,this.refreshDraw=function(){dm_3D.drawObj(a.obj,a.UIContainer,"Object3D",a.svgOrCanvas,a.canvasContext,a.scaleValue)},this.loop=function(){var b=(new Date).getTime();a.startRunning&&(a.dontLoop=b-a.startRunning>a.timeout),a.transformation&&!a.dontLoop&&(a.obj=dm_3D.transformPoints(a.obj,function(b){return dm_3D.mat4xVec3(a.transformation,b)}),a.refreshDraw(),requestAnimationFrame(a.loop))},this.freeze=function(){a.dontLoop=!0,a.startRunning=null},this.unfreeze=function(){a.dontLoop=!1,a.startRunning=(new Date).getTime(),a.loop()},this.reset=function(){if(a.transformation=null,a.obj_rotate=null,a.obj_drag=null,a.obj=null,"svg"==a.svgOrCanvas)a.UIContainer.selectAll("#"+a.obj_name).remove();else if(a.UIContainer){var b=parseInt(a.UIContainer.attr("width")),c=parseInt(a.UIContainer.attr("height"));console.log("--------------------->clearCanvasContext",b,c),a.canvasContext.clearRect(0,0,b,c)}},this.draw=function(b,c,d){a.reset(),a.svgOrCanvas=c,a.UIContainer=b;var e=2;"canvas"==a.svgOrCanvas&&(a.canvasContext=dm_Tools.isArray(b)?a.UIContainer[0][0].getContext("2d"):a.UIContainer.getContext("2d")),a.scaleValue=Math.min(parseInt(a.UIContainer.attr("width")),parseInt(a.UIContainer.attr("height")));var f=dm_3D.centerAndNormalizeObj(d),g=dm_3D.rotateEuler(0,-e,0);a.transformation=dm_3D.mat4xMat4(dm_3D.scale(a.scaleValue),dm_3D.mat4xMat4(g,f)),a.obj=dm_3D.transformPoints(d,function(b){return dm_3D.mat4xVec3(a.transformation,b)}),g=dm_3D.rotateEuler(0,e,0),a.transformation=g;var h=function(){a.transformation||(a.transformation=dm_3D.identity(),a.unfreeze())},i=function(b){h();var c,d=3;c=dm_3D.rotateEuler((b.gesture.deltaY>0?-1:1)*e*Math.pow(b.gesture.velocityY,d),(b.gesture.deltaX>0?-1:1)*e*Math.pow(b.gesture.velocityX,d),0),a.transformation=dm_3D.mat4xMat4(a.transformation,c)},j=function(b){var c=.5;return b.gesture.velocityX+b.gesture.velocityY>c?(k(),i(b),void 0):(a.transformation=null,a.obj_drag=dm_3D.transformPoints(a.obj,function(a){return dm_3D.mat4xVec3(dm_3D.rotateEuler(-b.gesture.deltaY,-b.gesture.deltaX,0),a)}),a.obj_name="Object3D",dm_3D.drawObj(a.obj_drag,a.UIContainer,a.obj_name,a.svgOrCanvas,a.canvasContext,a.scaleValue),void 0)},k=function(){a.obj_rotate=null,a.obj_drag&&(a.obj=a.obj_drag,a.obj_drag=null)},l=function(){var b=!1;return a.obj_rotate&&(a.obj_drag=null,b=!0),!b&&a.obj_rotate&&(a.obj=a.obj_rotate,a.obj_rotate=null),b},m=function(b){a.transformation=null,a.obj_rotate||(a.obj_rotate=a.obj),a.obj=dm_3D.transformPoints(a.obj_rotate,function(a){return dm_3D.mat4xVec3(dm_3D.rotateEuler(0,0,-b.gesture.rotation),a)}),dm_3D.drawObj(a.obj,a.UIContainer,"Object3D",a.svgOrCanvas,a.canvasContext,a.scaleValue)},n=a.UIContainer[0][0];Hammer(n).off("touch"),Hammer(n).on("touch",function(a){a.gesture.preventDefault(),l()||j(a)}),Hammer(n).off("swipe"),Hammer(n).on("swipe",function(a){a.gesture.preventDefault(),l()||i(a)}),Hammer(n).off("drag"),Hammer(n).on("drag",function(a){a.gesture.preventDefault(),l()||j(a)}),Hammer(n).off("rotate"),Hammer(n).on("rotate",function(a){a.gesture.preventDefault(),m(a)}),Hammer(n).off("dragend"),Hammer(n).on("dragend",function(a){a.gesture.preventDefault(),k()}),Hammer(n).off("tap"),Hammer(n).on("tap",function(b){b.gesture.preventDefault(),a.transformation=null,a.freeze()}),a.unfreeze()}}function dm_Physics(){}function dm_UI(){}function dm_chart_Hist(a,b){this.colX=1,this.colY1=2,this.colY2=3,this.w=940,this.h=400,this.yScaleEdge=5,this.fontCharPixelLength=6,this.colorLayer1="gray",this.colorLayer2="blue",this.layer1name="layer1",this.layer2name="layer2",this.scalesName="scales",this.xScaleYoffset=2,this.xScaleAngle=35,this.initialized=!1,this.dataTable=b,this.dataOnly,this.chart,this.scales,this.width,this.height,this.nbItemsX,this.maxCharsX,this.widthBeforeChart,this.widthAfterChart,this.maxY1,this.maxY2,this.xFunction,this.y1Function,this.y2Function;var c=this;this.calculateXscaleX=function(a){return this.widthBeforeChart+a+this.barWidth-this.fontCharPixelLength/2},this.calculateYscaleX=function(){return this.h+this.fontCharPixelLength+this.xScaleYoffset},this.init=function(a){function b(a){for(var b=0;b<a.length;b++)for(var c=a[b],d=0;d<c.length;d++)c[d]=(""+c[d]).replace(/\s/g,"")}this.initialized?a&&a():(this.initialized=!0,c.dataOnly=dm_Tools.deepCopy(c.dataTable).slice(1),b(c.dataOnly),c.nbItemsX=d3.max(c.dataOnly,function(a,b){return b}),c.maxCharsX=d3.max(c.dataOnly,function(a){return(""+a[c.colX]).length}),c.widthBeforeChart=d3.max(c.dataOnly,function(a){return(""+a[c.colY1]).length*c.fontCharPixelLength}),c.maxY1=d3.max(c.dataOnly,function(a){return Number(a[c.colY1])}),c.maxY2=d3.max(c.dataOnly,function(a){return Number(a[c.colY2])}),c.widthAfterChart=c.yScaleEdge+1+(""+c.maxY2).length*c.fontCharPixelLength,c.xFunction=function(a,b){return b*c.w/(c.nbItemsX+1)},c.y1Function=function(a){return a[c.colY1].replace(/\s/g,"")*c.h/c.maxY1},c.y2Function=function(a){return a[c.colY2].replace(/\s/g,"")*c.h/c.maxY2},c.barWidth=(c.xFunction(null,1)-2)/2,c.width=c.widthBeforeChart+c.w+Math.max(c.widthAfterChart,-c.barWidth+c.maxCharsX*c.fontCharPixelLength*Math.cos(c.xScaleAngle*Math.PI/180)),c.height=c.calculateYscaleX()+c.maxCharsX*c.fontCharPixelLength*Math.sin(c.xScaleAngle*Math.PI/180),a&&a())},createTableDetails=function(){return d3.select("#html_details").append("table").style("border-collapse","collapse").style("border","2px black solid").selectAll("tr").data(c.dataTable).enter().append("tr").selectAll("td").data(function(a){return a}).enter().append("td").style("border","1px black solid").style("padding","5px").on("mouseover",function(){d3.select(this).style("background-color","aliceblue")}).on("mouseout",function(){d3.select(this).style("background-color","white")}).text(function(a){return a}).style("font-size","12px")},this.createTableDetails=function(){this.init(createTableDetails)},createChart=function(){this.chart||(this.chart=a.append("svg").attr("width",c.width).attr("height",c.height))},this.createChart=function(){this.init(createChart)},createScales=function(){createChart(),this.scales||(this.scales=this.chart.append("g").attr("class",c.scalesName))},this.createScales=function(){this.init(createScales)},createScaleX=function(){createScales(),this.scales.selectAll("g.text").data(c.dataOnly).enter().append("text").attr("class",c.scalesName+"_xLabel").attr("x",function(a,b){return c.calculateXscaleX(c.xFunction(a,b))}).attr("y",function(){return c.calculateYscaleX()}).attr("transform",function(a,b){return"rotate("+c.xScaleAngle+", "+c.calculateXscaleX(c.xFunction(a,b))+","+c.calculateYscaleX()+")"}).attr("dx","0").attr("dy","m3").style("fill","black").style("stroke","black").attr("text-anchor","left").text(function(a){return a[c.colX]})},this.createScaleX=function(){this.init(createScaleX)},computeScales=function(a){var b=(""+a).length,d=Math.round(Number(a)/Math.pow(10,b-1)),e=d-1;5>d&&(e=2*d-1);for(var f=new Array(e),g=0,h=0;d>h;h++)h>0&&(f[g++]={px:h*Math.pow(10,b-1)*c.h/a,value:h*Math.pow(10,b-1)}),5>d&&(f[g++]={px:(h+.5)*Math.pow(10,b-1)*c.h/a,value:(h+.5)*Math.pow(10,b-1)});return f},createScaleY1=function(){createScales(),this.scales.selectAll("g.line").data(computeScales(c.maxY1)).enter().append("line").attr("class",c.scalesName+"_y1label").attr("x1",c.widthBeforeChart-c.yScaleEdge).attr("y1",function(a){return Math.round(c.h-a.px)}).attr("x2",c.widthBeforeChart+c.w).attr("y2",function(a){return Math.round(c.h-a.px)}).style("stroke-width",1).style("stroke-opacity",.6).style("stroke",c.colorLayer1),this.scales.selectAll("g.text").data(computeScales(c.maxY1)).enter().append("text").attr("class",c.scalesName+"_y1label").attr("x",function(a){return c.widthBeforeChart-c.yScaleEdge-1-(""+a.value).length*c.fontCharPixelLength}).attr("y",function(a){return Math.round(c.h-a.px)}).attr("dx","0").attr("dy","m3").style("fill",c.colorLayer1).attr("text-anchor","left").text(function(a){return a.value})},this.createScaleY1=function(){this.init(createScaleY1)},createScaleY2=function(a){createScales(),this.scales.selectAll("g.line").data(computeScales(c.maxY2)).enter().append("line").attr("class",c.scalesName+"_y2label").attr("x1",c.widthBeforeChart).attr("y1",function(a){return Math.round(c.h-a.px)}).attr("x2",c.widthBeforeChart).attr("y2",function(a){return Math.round(c.h-a.px)}).style("stroke-width",1).style("stroke-opacity",.5).style("stroke",c.colorLayer2).transition().delay(a).attr("x2",c.widthBeforeChart+c.w+c.yScaleEdge),this.scales.selectAll("g.text").data(computeScales(c.maxY2)).enter().append("text").attr("class",c.scalesName+"_y2label").attr("x",function(){return c.widthBeforeChart+c.w+c.yScaleEdge+1}).attr("y",function(a){return Math.round(c.h-a.px)}).attr("dx","0").attr("dy","m3").style("fill",c.colorLayer2).attr("text-anchor","left").transition().delay(a).text(function(a){return a.value})},this.createScaleY2=function(){this.init(createScaleY2)},createLayer=function(a,b){return createChart(),this.chart.append("g").style("fill",b).attr("class",a)},calculateYlabel=function(a,b){var d=c.h-a-c.fontCharPixelLength,e=(""+b).length*c.fontCharPixelLength;return 0>d-e&&(d=c.h-a+c.fontCharPixelLength+e),d},calculateTextColor=function(a,b,d){var e=c.h-a-c.fontCharPixelLength,f=(""+b).length*c.fontCharPixelLength;return 0>e-f&&(d="white"),d},createHist1=function(){var a=createLayer(c.layer1name,c.colorLayer1);a.selectAll("g.bar").data(c.dataOnly).enter().append("g").attr("class",c.layer1name+"_bar").attr("transform",function(a,b){return"translate("+c.xFunction(a,b)+",0)"}).append("rect").attr("class",c.layer1name+"_rect").attr("width",2*c.barWidth).attr("x",c.widthBeforeChart).attr("y",function(){return c.h}).attr("height",0).transition().delay(function(a,b){return 2*b*c.nbItemsX}).attr("y",function(a){return c.h-c.y1Function(a)}).attr("height",function(a){return c.y1Function(a)}),a.selectAll("g.bar").data(c.dataOnly).enter().append("text").attr("class",c.layer1name+"_label").attr("x",function(a,b){return c.widthBeforeChart+c.xFunction(a,b)+c.barWidth-1}).attr("y",function(a){return calculateYlabel(c.y1Function(a),a[c.colY1])}).attr("transform",function(a,b){return"rotate(-90, "+(c.widthBeforeChart+c.xFunction(a,b)+c.barWidth-1)+","+calculateYlabel(c.y1Function(a),a[c.colY1])+")"}).attr("dx","0").attr("dy","3").style("fill",function(a){return calculateTextColor(c.y1Function(a),a[c.colY1],"black")}).attr("text-anchor","left").transition().delay(function(a,b){return 2*b*c.nbItemsX}).text(function(a){return a[c.colY1]})},this.createHist1=function(){this.init(createHist1)},createHist2=function(){var a=createLayer(c.layer2name,c.colorLayer2);a.selectAll("g.bar").data(c.dataOnly).enter().append("g").attr("class",c.layer2name+"_bar").attr("transform",function(a,b){return"translate("+(c.widthBeforeChart+c.xFunction(a,b)+c.barWidth)+",0)"}).append("rect").attr("class",c.layer2name+"_rect").attr("width",c.barWidth).attr("x",0).attr("y",function(){return c.h}).attr("height",0).transition().delay(function(a,b){return 2*b*c.nbItemsX}).attr("y",function(a){return c.h-c.y2Function(a)}).attr("height",function(a){return c.y2Function(a)}),a.selectAll("g.bar").data(c.dataOnly).enter().append("text").attr("class",c.layer2name+"_label").attr("x",function(a,b){return c.widthBeforeChart+c.xFunction(a,b)+2*c.barWidth}).attr("y",function(a){return calculateYlabel(c.y2Function(a),a[c.colY2])}).attr("transform",function(a,b){var d=0;return"white"==calculateTextColor(c.y2Function(a),a[c.colY2],"blue")&&(d=-1),"rotate(-90, "+(c.widthBeforeChart+c.xFunction(a,b)+2*c.barWidth+d)+","+calculateYlabel(c.y2Function(a),a[c.colY2])+")"}).attr("dx","0").attr("dy","3").style("fill",function(a){return calculateTextColor(c.y2Function(a),a[c.colY2],"blue")}).attr("text-anchor","left").transition().delay(function(a,b){return 2*b*c.nbItemsX}).text(function(a){return a[c.colY2]})},this.createHist2=function(){this.init(createHist2)},transition=function(){this.chart.selectAll("g.layer1").selectAll("rect").transition().duration(800).attr("width",c.barWidth),createHist2(),createScaleY2(1500)}}function dm_chart_Pie(a,b,c,d,e,f,g,h){function i(a){a.innerRadius=0;var b=d3.interpolate({startAngle:0,endAngle:0},a);return function(a){return k.arc(b(a))}}function j(a){a.innerRadius=.6*k.r*k.innerRadiusRatio;var b=d3.interpolate({innerRadius:0},a);return function(a){return k.arc(b(a))}}this.html_div=a,this.valuesObj=b,this.data=b.values,this.w=c,this.h=this.w,this.r=Math.min(this.w,this.h)/2,this.chart,this.arc=d3.svg.arc().outerRadius(this.r),this.arcTxt=d3.svg.arc().innerRadius(.6*this.r).outerRadius(this.r),this.donut=d3.layout.pie(),this.innerRadiusRatio=g||1,this.colors=h;var k=this;this.createChart=function(){this.chart||(this.chart=("string"==typeof a?d3.select("#"+k.html_div):a).append("svg").data([k.data]).attr("width",k.w).attr("height",k.h));var b=this.chart.selectAll("g.arc").data(k.donut).enter().append("g").attr("class","arc").attr("transform","translate("+k.r+","+k.r+")"),c=b.append("path").attr("fill",function(a,b){var c=k.valuesObj.elts[b].color||dm_Tools.colors[b];return c});(null==e||1==e)&&b.append("text").attr("transform",function(a){return"translate("+k.arcTxt.centroid(a)+")"}).attr("dy",".35em").attr("text-anchor",function(a){var b=(a.endAngle-a.startAngle)/2+a.startAngle;return b>7*Math.PI/4&&b<Math.PI/4||b>3*Math.PI/4&&b<5*Math.PI/4?"middle":b>=Math.PI/4&&b<=3*Math.PI/4?"end":b>=5*Math.PI/4&&b<=7*Math.PI/4?"start":"middle"}).attr("display",function(a){return a.value>.15?null:"none"}).transition().delay(d?2e3:0).text(function(a,b){var c="";return c=f?k.valuesObj.elts[b].name:k.valuesObj.elts[b].valueStr||dm_Tools.convertNumber(a.value)}),c.transition().ease("bounce").duration(d?2e3:0).attrTween("d",i),c.transition().ease("elastic").delay(function(a,b){return d?2e3+50*b:0}).duration(d?750:0).attrTween("d",j)}}function dm_Attributes(){}function dm_Csv(a,b,c){this.dataTable,this.root,this.nodes=new dm_tools_NameIdList;var d=b.columns,e=b.root,f=b.setColumns2node,g=b.styles,h=b.options;this.options=h||{};var i=this,j=function(){for(var c,e,f,g=[],h=1;h<a.length;h++){if(c=a[h],g.length<c.length)for(var i=g.length;i<c.length;i++)f={},f.dm_columnName=a[0][i],f.dm_columnIndex=i,g.push(f);for(var i=0;i<c.length;i++)e=c[i],e&&""!=e?(g[i][e]||(g[i][e]=0),g[i][e]++):(g[i].dm_numberOfEmpty||(g[i].dm_numberOfEmpty=2),g[i].dm_numberOfEmpty++)}var j=function(a){var b=Object.keys(a).length;return b-=2};g.sort(function(a,b){return j(a)==j(b)?0:j(a)<j(b)?-1:1});var k=b.maxNbOfColumns2tree||10;k=Math.min(k,g.length),b.columns=[];for(var h=0;k>h;h++)b.columns.push({columnIndex:g[h].dm_columnIndex,name:g[h].dm_columnName}),console.log(j(g[h]),g[h].dm_columnName,g[h]);d=b.columns},k=function(a,b){for(var c=0,d=0;d<b.length;d++){var e=b[d];a[e]&&(c=d)}return c},l=function(a,b){for(var c=-1,d=0;0>c&&d<b.length;d++){var e=b[d];a[e]||(c=d)}return c},m=function(){var b,c,h,m,p,r,s,t,u,v,w;for(d&&0!=d.length||j(),m=1;m<a.length;m++){b=a[m],c=e,h=null;var x=function(a){var b=a;return isNaN(a)&&(dm_Tools.isArray(a)||"object"==typeof a&&(b=a.columnIndex)),b};if(v=k(b,d),w=l(b,d),d){u=null;var y,z=!1;if("rejectHolesInRows"==i.options.readMode){var A=!1;for(p=0;!A&&p<d.length;p++)y=x(d[p]),b[y]||(A=!0);z=A}else"rejectHolesInBranch"==i.options.readMode&&w>=0&&v>w&&(z=!0);for(p=0;p<d.length;p++){if(y=x(d[p]),dm_Tools.isArray(y))for(t=y,s="",r=0;r<t.length;r++)r>0&&(s+=" "),s+=b[t[r]];else s=b[y];if(s)u=s,h=z?o(c,h,!0):n(c,s,b,g[p+1],h,f),c=s;else if(p==k(b,d)+1&&h){var B=o(u,h,!0);B&&q(B,b,f,!0)}}}}},n=function(a,b,c,d,e,f){var g,h,i;return g=p(e,a,c,f),h=p(g,b,c,f,d),i=g.children||(g.children=[]),i.indexOf(h)<0&&i.push(h),g},o=function(a,b,c){a=dm_Tools.decodeValue(a,i.options.decodeURI);var d,e=i.nodes.getObjects(a);if(e)if(!b&&e.length>0)d=e[0];else for(var f,g=dm_Tools.getNodePath(b),h=e.length-1;h>=0;h--)f=e[h],f.parent&&dm_Tools.getNodePath(f.parent)==g&&(d=f);return d||c||(d={name:a,parent:b},i.nodes.addObject(d)),d},p=function(a,b,c,d,e){var f;return f=o(b,a),e&&(f.level||(f.level=e.level,q(f,c,d))),i.root||(f.level=0,i.root=f),f},q=function(b,d,e,f){if(d){var g,h,j,k=a[0],l=function(a,b){c&&(j=c[b],j&&j.indexOf(a)<0&&j.push(a))};if(!b.rawNode||f)if(b.rawNode={},e&&e[b.level])for(var m,n=e[b.level].length,o=0;n>o;o++)m=e[b.level][o],isNaN(m)?(g=m,m=k.indexOf(m)):g=k[m],h=d[m],b.rawNode[g]=dm_Tools.decodeValue(h,i.options.decodeURI),l(h,g);else for(var g,n=k.length,o=0;n>o;o++)g=k[o],h=d[o],b.rawNode[g]=dm_Tools.decodeValue(h,i.options.decodeURI),l(h,g)}};m()}function dm_LDIF(){}function dm_Table2graph(){}function dm_graph_Force(a,b,c,d,e,f,g,h,i,j,k,l){this.datamap=a,this.center=b,this.defaultDepth=c,this.w=e||dm_UI_getGraphWidth()||960,this.h=f||dm_UI_getBodyHeight()||700,this.linkDistance=g?g:80,this.linkStrength=function(a){var b=h?h:5;return a&&a.style&&a.style.isParentLink&&(b=9),b},this.charge=i?i:-350,this.friction=j?j:.75,this.alpha=k?k:.07,this.gravity=0,this.theta=l?l:1,this.linkDistanceRatio=1,this.postGraphMade=d,this.links,this.nodes,this.allDisplayedNodes,this.force,this.connections,this.freeze=!1;var m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=this,B=2e3,C=!1,D=6,E=1.5,F=0,G=!0,H=1,I=1,J=20,K=d3.scale.category10().range();this.circleColor=function(a){dm_Tools.bestEffortLevel(a);var b=dm_Tools.getConfig(a).styles[a.level].color;return b},this.textColor=function(a){var b=dm_Tools.getConfig(a).styles[a.level].txtCol;return b||(b=A.circleColor(a)),b},this.markerEnd=function(a,b,c){var d=dm_Tools.getParentNode4Config(a),e=b||dm_Tools.getConfig(a).styles[a.level].arrow;return e?"url(#"+(c?c:"config_"+d.id+"_level_"+a.level)+")":""};var L=function(a,b,c){var d=1,e=dm_Tools.getImageFromNode(a,!0,null,b,c);if(e)if(e.scale)d=e.scale;else{var f=e.scaleFactor||1,g=dm_Tools.getConfig(a).styles[a.level].rNod;d=f*g/Math.max(e.width,e.height)}return d*A.linkDistanceRatio},M=function(a,b,c){var d={x:0,y:0},e=!1;if(a){Math.abs(a.scx-a.tcx)<.1&&(a.scx-=1,a.tcx+=1);var c=c||dm_Tools.distBetween2points(a.scx,a.scy,a.tcx,a.tcy),f=dm_Tools.arcCenter(a.scx,a.scy,a.tcx,a.tcy,c),g=dm_Tools.arcCenter(a.scx,a.scy,a.tcx,a.tcy,c,!1),h=A.w/2,i=A.h/2;A.center&&(h=A.center.x,i=A.center.y);var j=dm_Tools.distBetween2points(h,i,f.x,f.y),k=dm_Tools.distBetween2points(h,i,g.x,g.y);j>k&&Math.abs(k-j)>.1?d=g:(d=f,e=!0)}return{arcCenter:d,isFirst:e}},N=function(a){return a!=dm_UI.lastMouseOverNode?dm_graph_Force.anotherImageRep:null},O=function(a){var b=N(a),c=dm_Tools.getImageFromNode(a,!0,null,null,b);return rCircle=c?30:(dm_Tools.getConfig(a).styles[a.level].rNod||0)+F,rCircle*=A.linkDistanceRatio};this.getSegmentCoords=function(a){var b;if(a.source&&!isNaN(a.source.x)&&!isNaN(a.source.y)&&a.target&&!isNaN(a.target.x)&&!isNaN(a.target.y)){var c,d=a.source.x,e=a.source.y,f=a.target.x,g=a.target.y,h=a.source.x,i=a.source.y,j=a.target.x,k=a.target.y,l=Math.atan((g-e)/(f-d)),m=0>f-d?-1:1,n=0;A.firstTick?(n=O(a.source),A.setProp2cache(a.source,"rCircle",n)):n=A.getPropFromCache(a.source,"rCircle"),d+=m*n*Math.cos(l),e+=m*n*Math.sin(l),A.firstTick?(c=O(a.target),A.setProp2cache(a.target,"rCircle",c)):c=A.getPropFromCache(a.target,"rCircle"),f-=m*c*Math.cos(l),g-=m*c*Math.sin(l),b={scx:h,scy:i,tcx:j,tcy:k,sx:d,sy:e,tx:f,ty:g,isSegmentNegative:!1,isArcNegative:!1};var o=M(b,a),p=dm_Tools.distBetween2points(h,i,j,k),q=dm_Tools.circleIntersect(h,i,n,o.arcCenter.x,o.arcCenter.y,p),r=q.x1,s=q.y1;o.isFirst&&(r=q.x2,s=q.y2);var t=dm_Tools.circleIntersect(j,k,c,o.arcCenter.x,o.arcCenter.y,p),u=t.x2,v=t.y2;o.isFirst&&(u=t.x1,v=t.y1),b.sxArc=r&&!isNaN(r)?r:d&&!isNaN(d)?d:h,b.syArc=s&&!isNaN(s)?s:e&&!isNaN(e)?e:i,b.txArc=u&&!isNaN(u)?u:f&&!isNaN(f)?f:j,b.tyArc=v&&!isNaN(v)?v:g&&!isNaN(g)?g:k,(b.tx-b.sx)*(a.target.x-a.source.x)<0&&(b.ty-b.sy)*(a.target.y-a.source.y)<0&&(b.isSegmentNegative=!0),(b.txArc-b.sxArc)*(a.target.x-a.source.x)<0&&(b.tyArc-b.syArc)*(a.target.y-a.source.y)<0&&(b.isArcNegative=!0),b.arcType=o.isFirst?"0,0":"0,1"}return b},this.cache2accelerate={},this.firstTick=!1,this.getPropFromCache=function(a,b){var c=null,d=A.cache2accelerate[a.dm_uniqueId];return d&&(c=d[b]),c},this.setProp2cache=function(a,b,c){var d=A.cache2accelerate[a.dm_uniqueId];d||(d={},A.cache2accelerate[a.dm_uniqueId]=d),d[b]=c};var P=function(a){var b="M0,0",c=A.getSegmentCoords(a);if(c){var d;if(A.firstTick?(d=dm_Tools.getConfig(a.target).styles[a.target.level].arc,A.setProp2cache(a.target,"isArc",d)):d=A.getPropFromCache(a.target,"isArc"),d&&!c.isArcNegative){var e=c.tcx-c.scx,f=c.tcy-c.scy,g=Math.sqrt(e*e+f*f);b="M"+c.scx+","+c.scy+"A"+g+","+g+" 0 0,1 "+c.tcx+","+c.tcy}else if(!c.isSegmentNegative){var e=c.tx-c.sx,f=c.ty-c.sy,g=Math.sqrt(e*e+f*f);b="M"+c.sx+","+c.sy+"L"+c.tx+","+c.ty}}return b},Q=function(a){var b;return A.firstTick?(b=dm_Tools.getConfig(a.target).styles[a.target.level].color,A.setProp2cache(a.target,"arrowColor",b)):b=A.getPropFromCache(a.target,"arrowColor"),b},R=function(a){var b="M0,0";if(A.connections&&A.connections.length>0){var c=A.getSegmentCoords(a);if(c&&!c.isArcNegative){var d=c.tcx-c.scx,e=c.tcy-c.scy,f=Math.sqrt(d*d+e*e),g=1;b="M"+c.sxArc+","+c.syArc+"A"+g*f+","+g*f+" 0 "+c.arcType+" "+c.txArc+","+c.tyArc}}return b},S=function(a){return"translate("+a.x+","+a.y+")"},T=function(a){var b=$(this).data("offset");return"translate("+(a.x+b.x)+","+(a.y+b.y)+")"},U=function(a){return"translate("+(a.x+a.dm_graph_gauge_offset.x)+","+(a.y+a.dm_graph_gauge_offset.y)+")"},V=function(a){var b;return A.firstTick?(b=dm_Tools.getConfig(a).styles[a.level].rNod,A.setProp2cache(a,"rNode",b)):b=A.getPropFromCache(a,"rNode"),"translate("+(a.x+b)+","+a.y+")"},W=function(){return"translate("+dm_UI.lastMouseOverNode.x+","+dm_UI.lastMouseOverNode.y+")"};this.tick=function(){A.freeze||(o&&o.attr("d",P),p&&p.attr("d",R),s&&s.attr("transform",S),t&&t.selectAll("g").attr("transform",T),u&&u.selectAll("g").attr("transform",U),x&&x.attr("transform",V),dm_UI.lastMouseOverNode&&w.attr("transform",W),A.firstTick=!1)},this.init=function(a,b,c){console.log("------------------------> force init start",dm_Tools.getDelay("force init")),dm_UI.destroyPreviousTooltip(),dm_graph_Force.draggingNode=!0,A.force&&A.force.stop(),A.center=a||A.center||A.datamap.root;var d=z;b&&(G=!1);var e=Y(A.center,"dont draw attribute panel");if(e){var f=dm_Tools.getConfig(e);if(dm_BeforeAll.noBckgrnd)d3.selectAll("#graphImageBckgrd").remove();else{var g=dm_Tools.getImageFromNode(e,!1,"backgroundImage",null);if(g)if(0!=g.visible&&"false"!=g.visible){var h=dm_Tools.getImageSrc(g,"preferFileRatherInline");d3.selectAll("#graphImageBckgrd").attr("src",h)}else d3.selectAll("#graphImageBckgrd").attr("src",null)}if(c||dm_UI.clickOnNode&&d==e&&e.rawNode&&e.rawNode.dm_goto&&""!=e.rawNode.dm_goto)return dm_Datamap.gotoDatamap(e),void 0;dm_UI.isolateFromEvents("dm.graph.Force.init"),dm_Datamap.currentDatamap.feedSearchQuery(e),dm_UI.setTopSearchQuery(A.center.name);var i=d3.layout;i.onClick=function(a){dm_UI.testIfIsolateFromEvents()||(dm_UI.delayBetweenEvents("dm.graph.Force.init / d3.layout.onClick"),dm_UI.clickOnNode=a,A.init(a))},A.firstTick=!0,A.force=i.force(A.center.x,A.center.y).nodes(d3.values(A.nodes.listById)).links(A.links).size([A.w,A.h]).linkDistance(function(a){var b=A.linkDistance,c=dm_Tools.getConfig(a.target).styles[a.target.level].link;
return a.style&&a.style.isParentLink&&(c=1.3*a.style.link),c&&(b=c*Math.pow(A.linkDistanceRatio,1.7)),b}).linkStrength(A.linkStrength).charge(A.charge).friction(A.friction).theta(A.theta).gravity(0).on("tick",A.tick),A.force&&(A.force.dragRecord=dm_BeforeAll.recordStopAfterInactivity);var j=function(a){dm_graph_Force.draggingNode||d3_layout_forceDrag_dragEndCallback(),a&&d3.select("#circle_"+a.id).style("stroke-width",y).attr("r",function(a){var b=dm_Tools.getConfig(a).styles[a.level].rNod,c=N(a);return dm_Tools.getImageFromNode(a,!0,null,null,c)&&(b=0),b})},k=function(a,b){if(a=a||dm_Datamap.currentDatamap.graph.center,a!=dm_UI.lastMouseOverNode&&dm_UI.lastMouseOverNode){var c=d3.select("#graph_svg").select("#image_"+dm_UI.lastMouseOverNode.id+"_0"),d=$(c[0][0]).data("tintedSrc");d&&c.attr("xlink:href",d)}var c=d3.select("#graph_svg").select("#image_"+a.id+"_0"),e=$(c[0][0]).data("origSrc");if(c.attr("xlink:href",e),dm_UI.testIfIsolateFromEvents()&&!b)return a.fixed=!1,void 0;dm_UI.lastMouseOverNode!=a&&(dm_UI.destroyPreviousTooltip(),j(dm_UI.lastMouseOverNode),dm_UI.resetMouseOverSelection(a)),dm_UI.lastMouseOverNode&&(v.attr("r",function(){var a=dm_Tools.getConfig(dm_UI.lastMouseOverNode).styles[dm_UI.lastMouseOverNode.level].rNod;return a+20}),w.attr("transform",function(){return"translate("+dm_UI.lastMouseOverNode.x+","+dm_UI.lastMouseOverNode.y+")"}));var f=d3.select("#circle_"+a.id);f[0][0]&&(y="1.5px",f.style("stroke-width",2.5).attr("r",function(a){var b=dm_Tools.getConfig(a).styles[a.level].rNod+D,c=N(a);return dm_Tools.getImageFromNode(a,!0,null,null,c)&&(b=0),b})),d3_layout_forceDrag_dragEndCallback()};A.force.dragWithoutMovingDelay=B,A.force.dragStartCallback=function(a){if(dm_graph_Force.draggingNode=!0,dm_UI.destroyPreviousTooltip(!0),dm_Physics.drawRotatingTarget(null,null,null,!0),k(a),A.force&&A.force.dragRecord){console.log("RECORD STARTS");var b=(new Date).getTime();A.force.dragRecordResult.push({action:"drag",node:a,sleep:m?b-m:0}),m=null}},d3_layout_forceDrag_dragEndCallback=function(){dm_graph_Force.draggingNode=!1,A.force.dragRecord&&(m=(new Date).getTime(),setTimeout(function(){var a=(new Date).getTime();m&&a-m>=A.force.dragRecord&&(m=null,console.log("RECORD ENDS"),console.log(A.force.dragRecordResult))},A.force.dragRecord)),dm_UI.lastMouseOverNode!=dm_UI.lastAttrPanelUpdatedNode&&dm_Attributes.updateAttributesPanel(dm_UI.lastMouseOverNode)},dm_UI.clickOnNode=null,A.force.start(A.center).alpha(A.alpha).gravity(A.gravity),d3.select("#graph_svg").remove(),n=d3.select("#graph").append("svg").attr("id","graph_svg").attr("width",A.w).attr("height",A.h);for(var l,C=function(a){n.append("defs").selectAll("marker").data(a.config.styles).enter().append("marker").attr("id",function(b){return"config_"+a.parentNodeId+"_level_"+b.level}).attr("fill",function(a){return a.color||K[a.level]}).attr("viewBox",function(a){var b=a.rNod;return""+(F-b)+" "+(-5-E)+" 10 10"}).attr("refX",F).attr("refY",-1.5).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d",function(a){var b=a.rNod;return"M"+(F-b)+","+(-5-E)+"L"+(10+F-b)+","+-E+"L"+(F-b)+","+(5-E)})},H=[],I=A.allDisplayedNodes.length-1;I>=0;I--){l=A.allDisplayedNodes[I];for(var M,O=dm_Tools.getParentNode4Config(l),R=dm_Tools.getConfig(l),S=!0,T=H.length-1;T>=0;T--)M=H[T],S&&(S=M.config!=R);S&&H.push({parentNodeId:O.id,config:R})}I=H.length-1;for(var R;I>=0;I--)R=H[I],C(R);var U=function(a){var b=a.connectionObj.color||dm_Tools.getConfig(a.target).styles[a.target.level].color;return"#"==b.charAt(0)&&(b=b.substring(1)),b};A.connections&&A.connections.length>0&&0!=f.displayTransversalConnections&&n.append("defs").selectAll("marker").data(A.connections).enter().append("marker").attr("id",function(a){return"connectionTo_"+a.target.id+"_"+U(a)}).attr("fill",function(a){return"#"+U(a)}).attr("viewBox",function(a){var b=dm_Tools.getConfig(a.target).styles[a.target.level].rNod;return""+(F-b)+" "+(-5-E)+" 10 10"}).attr("refX",F).attr("refY",-1.5).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d",function(a){var b=dm_Tools.getConfig(a.target).styles[a.target.level].rNod;return"M"+(F-b)+","+(-5-E)+"L"+(10+F-b)+","+-E+"L"+(F-b)+","+(5-E)}),o=n.append("g").attr("id","paths").selectAll("path").data(A.force.links()).enter().append("path").attr("class",function(a){return"link level_"+a.target.level}).attr("id",function(a){return"link_"+a.target.id}).style("stroke",Q).attr("marker-end",function(a){return A.markerEnd(a.target)}).attr("d",P),A.connections&&A.connections.length>0&&0!=f.displayTransversalConnections&&(p=n.append("g").selectAll("path").data(A.connections).enter().append("path").attr("class",function(){return"connection"}).attr("id",function(a){return"connection_from_"+a.source.id+"_to_"+a.target.id}).style("stroke",function(a){return"#"+U(a)}).attr("marker-end",function(a){return A.markerEnd(a.target,!0,"connectionTo_"+a.target.id+"_"+U(a))}));var V=A.force.nodes();t=n.append("g").attr("id","icon stickers"),u=n.append("g").attr("id","gauge stickers"),s=n.append("g").attr("id","circle groups").selectAll("g").data(V).enter().append("g").attr("id","mouse and real circles").call(A.force.drag),q=s.append("circle").attr("class",function(a){return"circle level_"+a.level}).attr("id",function(a){return"circle_"+a.id}).style("fill",A.circleColor).attr("r",function(a){var b=dm_Tools.getConfig(a).styles[a.level].rNod,c=N(a);return dm_Tools.getImageFromNode(a,!0,null,null,c)&&(b=0),b}).style("stroke","#333").style("stroke-width","1.5px"),w=n.append("g").attr("id","target_lastSelectedCircle").style("position","absolute").style("z-index",-1).attr("pointer-events","none"),v=w.append("circle").attr("id","circle_lastSelectedCircle").attr("r","0").style("stroke","#333").style("stroke-width",1).style("fill","none").attr("pointer-events","none");for(var W,I=V.length-1,X=[],Z=[],_=[];I>=0;I--){W=V[I];for(var ab=0;10>ab;ab++){var bb,cb,db=W,eb=0==ab&&N(db),fb=dm_Tools.getImageFromNode(db,!0,null,ab,eb);if(fb){bb=L(db,ab,eb),cb={x:-fb.width*bb/2,y:-fb.height*bb/2};var gb=dm_Tools.getConfig(db).styles[db.level].rNod/dm_Tools.getConfig(db).styles[0].rNod;fb.x&&(cb.x+=gb*fb.x),fb.y&&(cb.y+=gb*fb.y);var hb=t.append("g").attr("transform","translate("+cb.x+", "+cb.y+")"),ib=hb.append("image").attr("id","image_"+db.id+"_"+ab).attr("width",fb.width).attr("height",fb.height).attr("transform","scale("+bb+")");0==ab?_.push({node:db,imageObj:fb}):ib.attr("xlink:href","data/images/"+fb.imageName),$(hb[0][0]).data("offset",cb),X.push(db)}var jb=dm_Tools.getGaugeFromNode(db,ab);if(jb){cb={x:jb.x+-jb.width*jb.scale/2,y:jb.y+-jb.height*jb.scale/2};var kb=u.append("g").attr("transform","translate("+cb.x+", "+cb.y+") scale("+jb.scale+")");kb.append("rect").attr("id","gauge_backgrd_"+db.id+"_"+ab).attr("x","0").attr("y","0").attr("width",jb.width).attr("height",jb.height).attr("stroke","none").attr("stroke-width","0").attr("fill","#FFFFFF").attr("opacity",jb.backgrdOpacity),kb.append("rect").attr("id","gauge_"+db.id+"_"+ab).attr("x","0").attr("y","0").attr("width",jb.width*jb.value/jb.max).attr("height",jb.height).attr("stroke","#606060").attr("stroke-width","1").attr("fill",dm_Tools.getColorInGradient(jb.colorMin,jb.colorMax,100*(jb.value/jb.max))),kb.append("rect").attr("id","gauge_stroke_"+db.id+"_"+ab).attr("x","0").attr("y","0").attr("width",jb.width).attr("height",jb.height).attr("stroke",jb.stroke).attr("stroke-width",jb["stroke-width"]).attr("fill","none"),db.dm_graph_gauge_offset=cb,Z.push(db)}}}t.selectAll("g").data(X).call(A.force.drag),u.selectAll("g").data(Z).call(A.force.drag);var lb=function(a){if(a){var b=a.node,c=a.imageObj,d=dm_Tools.getConfig(b);if(d.retintIcons||c.retintIcons||!c.tintedSrc)dm_graph_Force.tintIcon(b,c,function(){lb(_.pop())});else{var e=dm_graph_Force.syncIcon(b,c),f=c.tintedSrc;e.attr("xlink:href",f),lb(_.pop())}}else dm_Tools.resetNoShow()};if(lb(_.pop()),r=s.append("circle").attr("class",function(){return"circle mouse"}).attr("r",function(){return J}).on("mouseover",function(a){k(a)}).on("mouseout",function(a){j(a)}),d3_layout_forceDrag_dragWithoutMovingCallback=function(a){dm_graph_Force.draggingNode=!1,dm_UI.nodeOntoDisplayTooltip=a},!dm_BeforeAll.noNodeText){x=n.append("g").attr("id","nodes text").selectAll("g").data(V).enter().append("g");var mb=function(a){var b=3,c=dm_Tools.getConfig(a).styles[a.level].rNod,d=N(a),e=dm_Tools.getImageFromNode(a,!0,null,null,d);return e&&(b+=L(a,null,d)*Math.max(e.width,e.height)/2-c-2,b+=e.textX||0),b},nb=function(a){return dm_Tools.getConfig(a).styles[a.level].txtFontSize||dm_Tools.getConfig(a).txtFontSize};x.append("text").attr("x",mb).attr("y",".31em").attr("id",function(a){return"node_text_shadow_id_"+a.id}).attr("class","shadow").style("font-size",function(a){var b=nb(a);return b?""+b+"px":void 0}).text(function(a){return(a.rawNode?a.rawNode.displayName:null)||a.name}).style("pointer-events","none"),x.append("text").attr("id",function(a){return"node_text_id_"+a.id}).attr("class",function(a){return"text level_"+a.level}).attr("x",mb).attr("y",".31em").style("fill",function(a){return A.textColor(a)}).style("font-size",function(a){var b=nb(a);return b?""+b+"px":void 0}).text(function(a){return(a.rawNode?a.rawNode.displayName:null)||a.name}).style("pointer-events","none")}var ob=dm_UI.lastMouseOverNode||A.center;dm_UI.resetMouseOverSelection(ob),dm_Attributes.updateAttributesPanel(dm_UI.lastMouseOverNode,A.datamap.props2query),dm_graph_Force.draggingNode=!1,setTimeout(function(){dm_graph_Force.draggingNode=!1},200),setTimeout(function(){console.log("==============>",dm_UI.lastMouseOverNode),k(dm_UI.lastMouseOverNode,!0)},100),setTimeout(dm_UI.freeFromEvents,200),G=!0,null!=A.postGraphMade&&(A.postGraphMade(),A.postGraphMade=null),console.log("------------------------> force init end",dm_Tools.getDelay("force init"))}};var X=function(a){var a=a;return"string"==typeof a&&(a=dm_Tools.getNodeFromPath(a,null,A.datamap).node),a=a||A.datamap.root,A.center=a,a},Y=function(a,b){var c=A.datamap;dm_UI.isolateFromEvents("dm.graph.Force.select"),A.links=[],A.nodes=new dm_tools_NameIdList;var a=X(a),d=dm_Tools.getConfig(a),e=d.depth||A.defaultDepth,f=function(a){if(a.rawNode)for(var b in a.rawNode)"music"!=a.rawNode[""+b+".type"]||"true"!=a.rawNode[""+b+".visible"]&&1!=a.rawNode[""+b+".visible"]||"true"!=a.rawNode[""+b+".ifCenter"]&&1!=a.rawNode[""+b+".ifCenter"]||dm_UI.playZik(a.rawNode[b]);var c=dm_Tools.getConfig(a);if(c){var d=c.displayProps;if(d&&d.length>a.level&&(d=d[a.level].children))for(var b,e=d.length-1;e>=0;e--)b=d[e],"music"!=b.type||"true"!=b.ifCenter&&1!=b.ifCenter||dm_UI.playZik(b.value)}};f(A.center),dm_Datamap.currentDatamap=dm_Datamap.getCurrentDmFromNode(A.center),A.force=null,o=null,q=null,r=null,s=null,x=null,G&&c.nodes.setAll({x:0,y:0,px:0,py:0,weight:0}),bb(A.center,c),z&&(z.selected=!1),z=a,dm_Datamap.addNodeToNavigationList(A.center),document.getElementById("top_search_query")&&(document.getElementById("top_search_query").value=a.name),b||dm_Attributes.updateAttributesPanel(dm_UI.lastMouseOverNode,c.props2query);var g=A.w/2,h=A.h/2,i=d.shiftCenterToBottomAccording2Depth||.2;if(G){var j=dm_Tools.numberOfParents(a);if(j>=3){var k=i*(j-3);k=(1+k)/(2+k),h=A.h*k}Z(a,H*g,I*h)}A.nodes.addObject(a);var l,m=function(a){if(a&&C){var b=20;a.min_x=b,a.min_y=b,a.max_x=A.w-b,a.max_y=A.h-b}},n=d.linkDistanceAccording2DepthDomain||16,p=d.linkDistanceAccording2DepthRange||6,t=a,u=d3.scale.linear().domain([0,n]).range([1,p])(dm_Tools.getAbsoluteLevel(t));for(dm_Tools.getAbsoluteLevel(t);t.parent&&"null"!=t.parent;)l=dm_Tools.deepCopy(dm_Tools.getConfig(t).styles[t.level]),l.link=l.link/u,l.isParentLink=!0,A.links.push({source:t.parent,target:t,style:l}),A.nodes.addObject(t.parent),G&&Z(t.parent,t.x,t.y-l.link),m(t),t=t.parent;return m(t),_(a,e,!0),A.allDisplayedNodes=A.nodes.getAll(),console.log("-----------> select 4 before make connections",dm_Tools.getDelay("force init")),gb(),console.log("-----------> select 5 after make connections",dm_Tools.getDelay("force init")),dm_UI.freeFromEvents(),dm_BeforeAll.onNodeSelect&&dm_BeforeAll.onNodeSelect(a),a},Z=function(a,b,c){a.x=b,a.y=c,a.px=b,a.py=c},_=function(a,b,c){if(b>0&&(a.children||a.dm_children)){var d=[],e=[],f=function(a){if(a)for(var b,c=a.length,f=0;c>f;f++)if(b=a[f]){var g=dm_Tools.getConfig(b);dm_Tools.bestEffortLevel(b);var h=g.styles[b.level].link,i=A.linkDistance;b.level>0&&(i=g.styles[b.level-1].link),h>=2*i/3?e.push(b):d.push(b)}};f(a.children),f(a.dm_children);for(var g,h=function(d,e,f){A.nodes.addObject(d),A.links.push({source:a,target:d,style:d.style}),G&&ab(d,e,f,c),_(d,b-1)},i=d.length-1;i>=0;i--)g=d[i],h(g,i,d.length);for(i=e.length-1;i>=0;i--)parent=e[i],h(parent,i,e.length)}},ab=function(a,b,c,d){var e,f,g=60,h=a.parent;if(d?f=h&&h.parent?-90+(b+1)*(360/(c+1)):-90+b*(360/c):h&&h.parent&&(e=180/Math.PI*Math.atan2(h.y-h.parent.y,h.x-h.parent.x),f=1==c?e:-(g/2)+e+b*g/c),a.fixed=!1,h){var i=dm_Tools.getConfig(a).styles[a.level].link;Z(a,h.x+i*Math.cos(f*Math.PI/180),h.y+i*Math.sin(f*Math.PI/180))}a.weight=1},bb=function(a,b){var c;for(var d in b.nodes.listById)c=b.nodes.listById[d],a&&c!=a&&(c.fixed=!1)},cb=function(a,b,c){var d=!1;if(A.connections)for(var e,f=A.connections.length-1;f>=0;f--)e=A.connections[f],!d&&e&&(d=e.source==a&&e.target==b,!d&&c&&c.originalConnection&&(d=e.source==c.originalConnection.source&&e.target==c.originalConnection.target));return d},db=function(a,b,c){cb(a,b,c)||(A.connections||(A.connections=[]),A.connections.push({source:a,target:b,connectionObj:c}))};this.isNodeDisplayed=function(a){var b=!1;if(A.allDisplayedNodes)for(var c,d=A.allDisplayedNodes.length-1;d>=0&&!b;d--)c=A.allDisplayedNodes[d],b=a==c;return b};var eb=function(a){var b,c,d=allNodes.length-1;if(a.nodePath)for(;d>=0;d--)c=allNodes[d],!b&&dm_Tools.areNodePathEqual(a.nodePath,c)&&(b=c);else if(a.nodeId)for(;d>=0;d--)c=allNodes[d],b||c.id!=a.nodeId||(b=c);return b},fb=function(a,b){if(a.rawNode){var c=a.rawNode[dm_Tools_connected+b];if(c)for(var d,e=c.length-1;e>=0;e--)if(d=c[e]){var f=eb(d);f&&A.isNodeDisplayed(f)&&("To"==b?db(a,f,d):db(f,a,d))}var g=a.rawNode[dm_Tools_aggregatedConnected+b];if(g)for(var d,e=g.length-1;e>=0;e--)if(d=g[e],d&&(!A.isNodeDisplayed(d.originalConnection.source)||!A.isNodeDisplayed(d.originalConnection.target))){var f=eb(d);f&&A.isNodeDisplayed(f)&&("To"==b?db(a,f,d):db(f,a,d))}}},gb=function(){A.connections=[],allNodes=dm_Tools.getAllNodesFromNode(A.center);for(var a,b=A.allDisplayedNodes.length-1;b>=0;b--)a=A.allDisplayedNodes[b],a&&(fb(a,"To"),fb(a,"From"))}}function dm_graph_Tree(a,b,c,d,e){function f(b){var c=d3.event&&d3.event.altKey?5e3:500,d=h.nodes(a).reverse();d.forEach(function(a){a.y=a.depth*m});var e=j.selectAll("g.node").data(d,function(a){return a.id||(a.id=++i)}),l=e.enter().append("g").attr("class","node").attr("transform",function(){return"translate("+b.y0+","+b.x0+")"}).on("click",function(a){g(a),f(a)});l.append("circle").attr("r",1e-6).attr("class",function(a){return"circle "+a.style.id}),l.append("text").attr("x",function(a){return a.children||a._children?-10:10}).attr("dy",".35em").attr("text-anchor",function(a){return a.children||a._children?"end":"start"}).attr("class","shadow").text(function(a){return a.name}),l.append("text").attr("x",function(a){return a.children||a._children?-10:10}).attr("dy",".35em").attr("text-anchor",function(a){return a.children||a._children?"end":"start"}).attr("class",function(a){return"text "+a.style.id}).text(function(a){return a.name});var n=e.transition().duration(c).attr("transform",function(a){return"translate("+a.y+","+a.x+")"});n.select("circle").attr("r",function(a){return a.style.rNod}),n.select("text").style("fill-opacity",1);var o=e.exit().transition().duration(c).attr("transform",function(){return"translate("+b.y+","+b.x+")"}).remove();o.select("circle").attr("r",1e-6),o.select("text").style("fill-opacity",1e-6);var p=j.selectAll("path.link").data(h.links(d),function(a){return a.target.id});p.enter().insert("path","g").attr("class",function(a){return"link "+a.target.style.id}).attr("d",function(){var a={x:b.x0,y:b.y0};return k({source:a,target:a})}).transition().duration(c).attr("d",k),p.transition().duration(c).attr("d",k),p.exit().transition().duration(c).attr("d",function(){var a={x:b.x,y:b.y};return k({source:a,target:a})}).remove(),d.forEach(function(a){a.x0=a.x,a.y0=a.y})}function g(a){a.children?(a._children=a.children,a.children=null):(a.children=a._children,a._children=null)}this.root=a,this.styles=b,this.center=c,this.w=d?d:960,this.h=e?e:500;var h,j,k,l=this,m=180;this.init=function(a){function b(a){a.children&&(a.children.forEach(b),g(a))}l.center=a||l.center;var c=[0,100,0,100],d=l.w-c[1]-c[3],e=l.h-c[0]-c[2];h=d3.layout.tree().size([e,d]),k=d3.svg.diagonal().projection(function(a){return[a.y,a.x]}),d3.select("body").select("svg").remove(),j=d3.select("body").append("svg").attr("width",d+c[1]+c[3]).attr("height",e+c[0]+c[2]).append("svg:g").attr("transform","translate("+c[3]+","+c[0]+")"),l.root.x0=e/2,l.root.y0=0,l.root.children.forEach(b),f(l.root)}}function dm_Freemind(){}function dm_IO(){}function dm_3D_3dsLoader(){}function dm_Sheet(){}dm_tools_NameIdList.forceId=!1,dm_tools_NameIdList.idCounter=0,function(){try{Object.defineProperty(Object.prototype,"__dm_uniqueId",{writable:!0,enumerable:!1}),Object.defineProperty(Object.prototype,"dm_uniqueId",{get:function(){return void 0==this.__dm_uniqueId&&(this.__dm_uniqueId=++dm_tools_NameIdList.idCounter),this.__dm_uniqueId}})}catch(a){}}(),dm_Tools.fakeFranceLabs=!0,dm_Tools.FranceLabsIntegration=!0,dm_Tools.counter=0,dm_Tools.now=(new Date).getTime(),dm_Tools.timers={},dm_Tools_dm_config_name="dm_config",dm_Tools_constantDmConfigTreeRootName="_"+dm_Tools_dm_config_name,dm_Tools_connected="connected",dm_Tools_aggregatedConnected="aggregatedConnected",dm_Tools.delayTimeoutId,dm_Tools.delay=function(a,b){clearTimeout(dm_Tools.delayTimeoutId),dm_Tools.delayTimeoutId=setTimeout(a,b||300)},dm_Tools.getDelay=function(a){var b=(new Date).getTime(),c=b-dm_Tools.now;return a?(dm_Tools.timers[a]&&(c=b-dm_Tools.timers[a]),dm_Tools.timers[a]=b):dm_Tools.now=b,c},dm_Tools.getId=function(a){var b;return++dm_Tools.counter,b=a?""+a+"("+dm_Tools.counter+")":dm_Tools.counter},dm_Tools.isInAvoidProps=function(a,b){var c=!1;return b&&("string"==typeof b&&a==b?c=!0:b.indexOf(a)>=0&&(c=!0)),c},dm_Tools.setUniqueID=function(a){if(a){for(var a,b,c,d,e={},f={},g=[a],h=0,i=!1,j=function(a){a&&"object"==typeof a&&!e[a.dm_uniqueId]&&(e[a.dm_uniqueId]=a,g.push(a))};g.length>0;){a=g.pop(),i=!1,a.__dm_uniqueId||(i=!0);var k=e[a.dm_uniqueId];if(k&&(i?(d={},a.__dm_uniqueId=d.dm_uniqueId):f[k.dm_uniqueId]&&(d={},k.__dm_uniqueId=d.dm_uniqueId)),i&&(f[a.dm_uniqueId]=a),h=Math.max(h,a.dm_uniqueId),dm_Tools.isArray(a))for(b=a.length-1;b>=0;b--)j(a[b]);else for(c in a)j(a[c])}return h}},dm_Tools.deepCopyDmNode=function(a){return dm_Tools.deepCopy(a,["parent","aggregatedConnectedTo","aggregatedConnectedFrom"])},dm_Tools.deepCopy=function(a,b,c,d,e,f,g,h,i){var j=a;if(h||(h=a,dm_Tools.setUniqueID(h)),g===!0)g=dm_Tools.getDepth(a);else if((0===g||g>0)&&a!=h&&a.parent&&dm_Tools.getDepth(a)<=g)return;if(a&&"object"==typeof a){var k;if(d&&(k=d[a.dm_uniqueId]),d&&k){var l=e[a.dm_uniqueId];c?(j="$ref_"+l.dm_uniqueId,f||(f=[]),f.push(j)):j=k}else{var m;d||(d={}),d[a.dm_uniqueId]=a;var n,o=dm_Tools.isArray(a);if(o?(n=a.length,j=new Array(n)):j={},e||(e={}),e[a.dm_uniqueId]=j,o)for(var p=0;n>p;p++)m=a[p],j[p]=m&&"object"==typeof m?dm_Tools.deepCopy(m,b,c,d,e,f,g,h):m;else{a.prototype&&(j.prototype=a.prototype);for(var q in a)if("__dm_uniqueId"!=q){var r=!0;dm_Tools.isInAvoidProps(q,b)&&(r=!1),i&&dm_Tools.isInAvoidProps(q,i)&&(r=!1),m=a[q],r&&(j[q]=m&&"object"==typeof m?dm_Tools.deepCopy(m,b,c,d,e,f,g,h):m)}}}}return j},dm_Tools.cloneAndFixCircularRefs=function(a,b,c){var d=[],e=dm_Tools.deepCopy(a,b,!0,null,null,d,!0,c);return e&&d.length>0&&(e.$circularRefs=!0),e},dm_Tools.stringify=function(a,b,c){var d;try{d=JSON.stringify(a)}catch(e){var f=dm_Tools.cloneAndFixCircularRefs(a,b,c);d=JSON.stringify(f)}return d},dm_Tools.getMaxUniqueId=function(a){for(var b,c,d,e=[a],f=0;e.length>0;)if(b=e.pop(),b&&"object"==typeof b){d=b.__dm_uniqueId,d&&(f=Math.max(f,d));for(c in b)e.push(b[c])}return f},dm_Tools.removeProps=function(a,b){if(a&&"object"==typeof a){var c,d,e,f,g=[a],h={},i=0,j=[a];for(h[a.dm_uniqueId]=a;g.length>0;){c=g.pop(),h[c.dm_uniqueId]=c;for(var d in c)e=c[d],e&&"object"==typeof e&&!h[e.dm_uniqueId]&&(g.push(e),j.push(e))}for(;j.length>0;)if(c=j.pop(),"string"==typeof b)delete c[b];else for(f=b.length-1;f>=0;f--)delete c[b[f]];return i}},dm_Tools.allObj=function(a,b,c,d,e){dm_tools_NameIdList.idCounter=dm_Tools.getMaxUniqueId(a)+1,dm_Tools.setUniqueID(a);var b=b||{},c=c||[],d=d||[],e=e||[],f=!1,g=[];g.push(a);for(var h=function(h){f="string"==typeof i&&0==i.indexOf("$ref_"),i&&(f||"object"==typeof i&&!b[i.__dm_uniqueId])&&(f&&(c.push(i),d.push(a),e.push(h)),g.push(i))};g.length>0;)if(a=g.pop(),a&&"object"==typeof a){var i;if(dm_Tools.isArray(a))for(var j=a.length,k=0;j>k;k++)i=a[k],h(k);else{b[a.__dm_uniqueId]=a;for(var l in a)i=a[l],h(l)}}return{list:b,refs:{refsList:c,parents:d,keys:e}}},dm_Tools.replaceRef=function(a,b){var c;if(a&&"string"==typeof a&&0==a.indexOf("$ref_")){var d=a.substring("$ref_".length);c=b[d]}return c},dm_Tools.rebuildRefs=function(a){console.log("rebuildRefs start "+dm_Tools.getDelay());for(var b,c,d,e,f=dm_Tools.allObj(a),g=f.list,h=f.refs.refsList,i=f.refs.parents,j=f.refs.keys,k=h.length-1;k>=0;k--)b=h[k],e=dm_Tools.replaceRef(b,g),e&&(c=i[k],d=j[k],c[d]=e);return delete a.$circularRefs,dm_Tools.removeProps(a,"__dm_uniqueId"),console.log("rebuildRefs end "+dm_Tools.getDelay()),a},dm_Tools.changeNewLinesFromJSONStrings=function(a,b){for(var c=0,d=c,e=-1,f="";c>=0;)d=c,c=a.indexOf('"',c+1),c>=0?"\\"!=a[c-1]&&(e>=0?(f+='"',f+=b?a.substring(e+1,c).replace(/\\n/g,"\n"):a.substring(e+1,c).replace(/\r\n/g,"\\n").replace(/\n/g,"\\n").replace(/\r/g,"\\n").replace(/\t/g," "),f+='"',c++,e=-1):(f+=a.substring(d,c),e=c)):f+=a.substring(d,a.length);return f},dm_Tools.parseStringified=function(a,b){var c=a;if("string"==typeof a){var a=a.replace(/\/\*[\s\S]+?\*\//g,"");a=dm_Tools.changeNewLinesFromJSONStrings(a),c=JSON.parse(a),b===!1||1!=b&&!c.$circularRefs||(c=dm_Tools.rebuildRefs(c))}return c},dm_Tools.ARRAY_PROPS={length:"number",sort:"function",slice:"function",splice:"function"},dm_Tools.isArray=function(a){if(!a||"number"==typeof a||"string"==typeof a||"boolean"==typeof a)return!1;if(a instanceof Array)return!0;for(var b in dm_Tools.ARRAY_PROPS)if(!(b in a&&typeof a[b]==dm_Tools.ARRAY_PROPS[b]))return!1;return!0},dm_Tools.indent=function(a){var b="";for(i=0;a>i;i++)b+="  ";return b},dm_Tools.restoreParentsInTree=function(a,b){if(a.parent=b,a.children)for(var c,d=a.children.length,e=0;d>e;e++)c=a.children[e],dm_Tools.restoreParentsInTree(c,a);return a},dm_Tools.getNodesFromRoot=function(a,b){if(b||(b=new dm_tools_NameIdList),b.addObject(a),a.children)for(var c,d=a.children.length,e=0;d>e;e++)c=a.children[e],dm_Tools.getNodesFromRoot(c,b);return b},dm_Tools.isAdminConfigTreeNode=function(a){var b;return a&&a.name&&a.name.lastIndexOf(dm_Tools_constantDmConfigTreeRootName)>=0&&(b=a),b},dm_Tools.node2string=function(a,b,c,d,e,f,g){var h,i,j,k="",l=!0,m=!0;if(b=b||0,!a)return k;if(g&&dm_Tools.isAdminConfigTreeNode(a))return k;if(e>=b&&(a.children||!f))if("number"==typeof a||"string"==typeof a)k+=dm_Tools.indent(b+d),k+='"'+a+'"';else{k+=dm_Tools.indent(b+d),k+="{",l=!0;for(var n in a){i="";var o=!1;if(c)for(h=0;!o&&h<c.length;h++)c[h]==n&&(o=!0);"parent"==n?a.parent&&a.parent.name&&(i='"parent": '+(a.parent?'"'+a.parent.name+(a.parent.id?"("+a.parent.id+")":"")+'"':null)):"children"==n||o||(j=dm_Tools.stringify(a[n]),j||(j="null"),i='"'+n+'"'+": "+j),""!=i&&(l||(k+=","),k+="\n",k+=dm_Tools.indent(b+d),k+=i,l=!1)}if(a.children){for(l||(k+=","),k+="\n",k+=dm_Tools.indent(b+d),l=!1,k+='"children": [',m=!0,h=0;h<a.children.length;h++)m=!1,k+="\n",k+=dm_Tools.node2string(a.children[h],b+1,c,d,e,f),h<a.children.length-1&&(k+=",");m||(k+="\n"+dm_Tools.indent(b+d)),k+="]\n"}l||(a.children||(k+="\n"),k+=dm_Tools.indent(b+d)),k+="}"}return k},dm_Tools.nodes2string=function(a,b,c,d){var e="{\n";for(var f in a)e+=dm_Tools.indent(1)+f+":\n",e+=dm_Tools.node2string(a[f],1,b,1,c,d);return e+="}"},dm_Tools.get,dm_Tools.getAbsoluteLevel=function(a){return a.parent?dm_Tools.getAbsoluteLevel(a.parent)+1:0},dm_Tools.getLevelInternal=function(a,b){return!a.parent||a[dm_Tools_dm_config_name]&&!b?0:dm_Tools.getLevelInternal(a.parent)+1},dm_Tools.getLevel=function(a){return dm_Tools.getLevelInternal(a)},dm_Tools.bestEffortLevel=function(a){if(a){var b=a.level;if(!b){null==b&&a.style&&(b=a.style.level);var c=dm_Tools.getLevel(a);(null==b||c>b)&&!a[dm_Tools_dm_config_name]&&(b=c),null!=b||a.parent||(b=0),a.level=b||0}return b}},dm_Tools.links2string=function(a,b){for(var c,d="[\n",e=a.length,f=0;e>f;f++){c=a[f],d+=dm_Tools.indent(1);var g=!0,h=!1;for(var i in c)g||(d+=", "),"source"==i||"target"==i?(d+=i+":\n"+(b?c[i].name+"\n":dm_Tools.node2string(c[i],2)),d+=dm_Tools.indent(1),g=!0,h=!0):(d+=i+": "+dm_Tools.stringify(c[i]),g=!1);h&&f<a.length-1&&(d+="\n",h=!1),d+="\n"}return d+="]"},dm_Tools.removeSpaces=function(a){var b;return a&&(b=a.replace(/ /g,""),b=a.replace(/\./g,"_")),b},dm_Tools.compare=function(a,b){var c=!1;return a&&b&&(a=dm_Tools.removeSpaces(a.toLowerCase()),b=dm_Tools.removeSpaces(b.toLowerCase()),c=a==b),c},dm_Tools.saveFile=function(a,b,c,d,e){if(!e){for(var f=new Uint8Array(a.length),g=0;g<a.length;g++)f[g]=255&a.charCodeAt(g);a=f}try{saveAs(new Blob([a],{type:c+(d?";charset="+d:""),charset:d}),b)}catch(h){var i=new BlobBuilder;i.append(a),saveAs(i.getBlob("data:"+c+(d?";charset="+d:"")),b)}},dm_Tools.color2rgb=function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null},dm_Tools.rgbParse=function(a){var b=/^rgb\(?[ ]*([0-9]*),[ ]*([0-9]*),[ ]*([0-9]*)\)/i.exec(a);return b?{r:parseInt(b[1]),g:parseInt(b[2]),b:parseInt(b[3])}:null},dm_Tools.rgb2hex=function(a){var b=function(a){for(var b=a.toString(16);b.length<2;)b="0"+b;return b};return"#"+b(a.r)+b(a.g)+b(a.b)};var d3_scale_category20_range=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],d3_scale_category20b_range=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"];dm_Tools.colors=d3_scale_category20_range.concat(d3_scale_category20b_range).concat(d3_scale_category20b_range).concat(d3_scale_category20b_range),dm_Tools.colorsRGB=[];for(var i=0;i<dm_Tools.colors.length;i++)dm_Tools.colorsRGB.push(dm_Tools.color2rgb(dm_Tools.colors[i]));dm_Tools.colors2=dm_Tools.colors,dm_Tools.colorsRGB2=dm_Tools.colorsRGB,dm_Tools.convertNumber=function(a,b,c){var d,e,f=a;return b||(b=1),"number"==typeof a&&(f=""+f,c&&(a>=1e6&&(e="M",a/=1e6),a>=1e3&&(e="k",a/=1e3)),f=a,a!=Math.round(a)&&(f=""+a.toFixed(b),d=f.lastIndexOf("."),d>=0&&0==parseInt(f.substr(d+1,b))&&(f=f.substring(0,d))),f=(""+f).replace(/\,/g," "),f=(""+f).replace(/\./g,","),f=(""+f).replace(/\B(?=(\d{3})+(?!\d))/g," "),c&&e&&(f+=" "+e)),f},dm_Tools.sortChildren=function(a,b,c){if(b){var d=function(a,b){var c;return c=a.rawNode[b],c||(c=a.name),c},e=function(a){return!a.children||0==a.children.length};a.sort(function(a,f){var g=0,h=(e(a),e(f),d(a,b)),i=d(f,b),j=-1,k=1;return(1==c||"true"==c)&&(j=1,k=-1),g=h==i?0:i>h?j:k})}},dm_Tools.sortTree=function(a,b){if(a){var c,d,e,f=null;if(d=dm_Tools.bestEffortLevel(a),f=b.styles[d+1]&&null!=b.styles[d+1].sort?b.styles[d+1].sort:b.sort,f&&(e=b.styles[d+1]&&null!=b.styles[d+1].sortDescendant?b.styles[d+1].sortDescendant:b.sortDescendant,a.children&&a.children.length>0)){for(c=0;c<a.children.length;c++)dm_Tools.sortTree(a.children[c],b);dm_Tools.sortChildren(a.children,f,e)}}},dm_Tools.rtfFontSize=function(a){var b=[8,10,12,14,18,24],c=10;return a&&a>=1&&(c=a-1<b.length?b[a-1]:b[b.length-1]),c=2*c},dm_Tools.getIndexOfFirstPipe=function(a,b){var c=-1,d=a.indexOf("|",b),e=a.indexOf("%7C",b);return c=0>d&&e>=0?e:0>e&&d>=0?d:Math.min(d,e)},dm_Tools.getFileExtension=function(a){var b,c=a.lastIndexOf("."),d=dm_Tools.getIndexOfFirstPipe(a,c);return c>=0&&(b=d>=0?a.substring(c+1,d):a.substring(c+1)),b},dm_Tools.getDatamapNameAndPathFromFullPath=function(a){var b={name:null,path:null,url:null};if(0==a.indexOf("http:"))b.url=a,b.name=a;else{var c=dm_Tools.getIndexOfFirstPipe(a);0>c?b.name=a:(b.name=a.substring(0,c),a.length>c+1&&(b.path=a.substring(c+1)))}return b},dm_Tools.getGotoTarget=function(a){return a&&a.rawNode&&a.rawNode.dm_goto&&""!=a.rawNode.dm_goto?dm_Tools.getDatamapNameAndPathFromFullPath(a.rawNode.dm_goto):void 0},dm_Tools.getChildAt=function(a,b){var c;return a&&a.children&&b<a.children.length&&(c=a.children[b]),c},dm_Tools.getChildNameAt=function(a,b){var c,d=dm_Tools.getChildAt(a,b);return d&&(c=d.name),c},dm_Tools.getChildIndexAndObj=function(a,b,c){var d;if(null==c&&(c=!0),a){var e,f;if(a.children)for(e=0;!d&&e<a.children.length;e++)f=a.children[e],dm_Tools.equalsOrRexgexpMatch(b,f.name)&&(d={index:e,obj:f,isDmChild:!1});if(!d&&c&&a.dm_children)for(e=0;!d&&e<a.dm_children.length;e++)f=a.dm_children[e],dm_Tools.equalsOrRexgexpMatch(b,f.name)&&(d={index:e,obj:f,isDmChild:!0})}return d},dm_Tools.getChild=function(a,b,c){var d=dm_Tools.getChildIndexAndObj(a,b,c);return d&&(d=d.obj),d},dm_Tools.getChildIndex=function(a,b,c){var d=dm_Tools.getChildIndexAndObj(a,b,c);return d&&!d.isDmChild&&(d=d.index),d},dm_Tools.getParent=function(a,b){var c;return a&&(c=a.name==b?a:dm_Tools.getParent(a.parent,b)),c},dm_Tools.getNodePathNames=function(a){var b;return a.parent?(b=dm_Tools.getNodePathNames(a.parent),b.push(a.name)):b=[a.name],b},dm_Tools.getNodePathNamesRespectingLevels=function(a){var b;if(a.parent){b=dm_Tools.getNodePathNames(a.parent);var c=a.level;a.style&&a.style.level&&(c=a.level);for(var d=b.length;c>d;d++)b.push("");b.push(a.name)}else b=[a.name];return b},dm_Tools.getNodePath=function(a,b,c,d,e,f,g){var h,e=e?e:0,b=null==b?"|":b;if(a)if(d&&(h=a.rawNode[d]),h||(h=a.name),a.parent&&(0==e||a.level&&a.level>=e)){if(!c||!a.dm_config){var i=dm_Tools.getNodePath(a.parent,b,c,d,e,!0,g);h=i?i+b+h:h}}else!f||g&&!a.parent||(h=null);return h},dm_Tools.getNodeUrl=function(a,b,c,d){var c=c;if(!c){for(var e=a;e&&e.parent;)e=e.parent;var f;e&&(f=e.dm_DatamapName);var g=dm_Datamap.currentDatamap.name;c=f||g}return("noDatamapNameInURL"==c?"":c+"|")+dm_Tools.getNodePath(a,null,d,null,null,null,b)},dm_Tools.getNodeFromPath=function(a,b,c){c=c||dm_Datamap.currentDatamap;var d,e,f,g,h={found:null,lastFoundNode:b,dm:c,nextPath:a};return f=dm_Tools.getIndexOfFirstPipe(a),f>0?(d=a.substring(0,f),a.length>f+1&&(e=a.substring(f+1))):""!=a&&(d=a),d&&(g=b||d!=c.root.name?b||e?b?dm_Tools.getChild(b,d):c.nodes.getFirstObject(d):c.nodes.getFirstObject(d):c.root,e?(h=dm_Tools.getNodeFromPath(e,g,c),h.lastFoundNode=h.lastFoundNode||g||b,h.nextPath=h.nextPath||e):h={node:g,lastFoundNode:b,dm:c,nextPath:e}),h},dm_Tools.getNodeFromUrl=function(a){var b,c,d=a;if(c=d.indexOf("|"),c>0){var e=dm_Datamap.maps[a.substring(0,c)];e&&(d=d.substring(c+1),b=dm_Tools.getNodeFromPath(d,null,e).node)}return{datamap:e,node:b}},dm_Tools.escapeHtmlEntitiesTable={34:"quot",38:"amp",39:"apos",60:"lt",62:"gt",160:"nbsp",161:"iexcl",162:"cent",163:"pound",164:"curren",165:"yen",166:"brvbar",167:"sect",168:"uml",169:"copy",170:"ordf",171:"laquo",172:"not",173:"shy",174:"reg",175:"macr",176:"deg",177:"plusmn",178:"sup2",179:"sup3",180:"acute",181:"micro",182:"para",183:"middot",184:"cedil",185:"sup1",186:"ordm",187:"raquo",188:"frac14",189:"frac12",190:"frac34",191:"iquest",192:"Agrave",193:"Aacute",194:"Acirc",195:"Atilde",196:"Auml",197:"Aring",198:"AElig",199:"Ccedil",200:"Egrave",201:"Eacute",202:"Ecirc",203:"Euml",204:"Igrave",205:"Iacute",206:"Icirc",207:"Iuml",208:"ETH",209:"Ntilde",210:"Ograve",211:"Oacute",212:"Ocirc",213:"Otilde",214:"Ouml",215:"times",216:"Oslash",217:"Ugrave",218:"Uacute",219:"Ucirc",220:"Uuml",221:"Yacute",222:"THORN",223:"szlig",224:"agrave",225:"aacute",226:"acirc",227:"atilde",228:"auml",229:"aring",230:"aelig",231:"ccedil",232:"egrave",233:"eacute",234:"ecirc",235:"euml",236:"igrave",237:"iacute",238:"icirc",239:"iuml",240:"eth",241:"ntilde",242:"ograve",243:"oacute",244:"ocirc",245:"otilde",246:"ouml",247:"divide",248:"oslash",249:"ugrave",250:"uacute",251:"ucirc",252:"uuml",253:"yacute",254:"thorn",255:"yuml",402:"fnof",913:"Alpha",914:"Beta",915:"Gamma",916:"Delta",917:"Epsilon",918:"Zeta",919:"Eta",920:"Theta",921:"Iota",922:"Kappa",923:"Lambda",924:"Mu",925:"Nu",926:"Xi",927:"Omicron",928:"Pi",929:"Rho",931:"Sigma",932:"Tau",933:"Upsilon",934:"Phi",935:"Chi",936:"Psi",937:"Omega",945:"alpha",946:"beta",947:"gamma",948:"delta",949:"epsilon",950:"zeta",951:"eta",952:"theta",953:"iota",954:"kappa",955:"lambda",956:"mu",957:"nu",958:"xi",959:"omicron",960:"pi",961:"rho",962:"sigmaf",963:"sigma",964:"tau",965:"upsilon",966:"phi",967:"chi",968:"psi",969:"omega",977:"thetasym",978:"upsih",982:"piv",8226:"bull",8230:"hellip",8242:"prime",8243:"Prime",8254:"oline",8260:"frasl",8472:"weierp",8465:"image",8476:"real",8482:"trade",8501:"alefsym",8592:"larr",8593:"uarr",8594:"rarr",8595:"darr",8596:"harr",8629:"crarr",8656:"lArr",8657:"uArr",8658:"rArr",8659:"dArr",8660:"hArr",8704:"forall",8706:"part",8707:"exist",8709:"empty",8711:"nabla",8712:"isin",8713:"notin",8715:"ni",8719:"prod",8721:"sum",8722:"minus",8727:"lowast",8730:"radic",8733:"prop",8734:"infin",8736:"ang",8743:"and",8744:"or",8745:"cap",8746:"cup",8747:"int",8756:"there4",8764:"sim",8773:"cong",8776:"asymp",8800:"ne",8801:"equiv",8804:"le",8805:"ge",8834:"sub",8835:"sup",8836:"nsub",8838:"sube",8839:"supe",8853:"oplus",8855:"otimes",8869:"perp",8901:"sdot",8968:"lceil",8969:"rceil",8970:"lfloor",8971:"rfloor",9001:"lang",9002:"rang",9674:"loz",9824:"spades",9827:"clubs",9829:"hearts",9830:"diams",338:"OElig",339:"oelig",352:"Scaron",353:"scaron",376:"Yuml",710:"circ",732:"tilde",8194:"ensp",8195:"emsp",8201:"thinsp",8204:"zwnj",8205:"zwj",8206:"lrm",8207:"rlm",8211:"ndash",8212:"mdash",8216:"lsquo",8217:"rsquo",8218:"sbquo",8220:"ldquo",8221:"rdquo",8222:"bdquo",8224:"dagger",8225:"Dagger",8240:"permil",8249:"lsaquo",8250:"rsaquo",8364:"euro"},dm_Tools.convertAccent2html=function(a){return a.replace(/[\u00A0-\u2666<>\&]/g,function(a){return"&"+(dm_Tools.escapeHtmlEntitiesTable[a.charCodeAt(0)]||"#"+a.charCodeAt(0))+";"
})},dm_Tools.searchFirstDomNodeFromPath=function(a,b,c){if(a&&b){var d;if(c)for(var e=a.firstChild;e&&!d;e=e.nextSibling)d=dm_Tools.searchFirstDomNodeFromPath(e,b);else{var f=b.indexOf("/"),g=b;if(f>=0?(g=b.substring(0,f),b=b.substring(f+1)):b=null,g&&1==a.nodeType&&(a.nodeName.toUpperCase()==g.toUpperCase()&&(d=a),d&&b&&a.firstChild)){d=null;for(var e=a.firstChild;e&&!d;e=e.nextSibling)d=dm_Tools.searchFirstDomNodeFromPath(e,b)}}return d}},dm_Tools.getDomNodeAttribute=function(a,b){var c,d;if(a&&b){for(var e=0;!c&&e<a.attributes.length;e++)d=a.attributes[e],d.name==b&&(c=d);return c}},dm_Tools.setDomNodeAttribute=function(a,b,c){if(a&&b){var d=dm_Tools.getDomNodeAttribute(a,b);d?d.value=c:a.setAttribute(b,c)}},dm_Tools.finishXmlTags=function(a){for(var b,c,d,e,f,g=a,h=g.indexOf("/>");h>0;)b=g.substring(0,h),c=g.substring(h+2),d=b.lastIndexOf("<"),e=b.substring(d+1),f=e.indexOf(" "),0>f&&(f=e.length),e=e.substring(0,f),g=b+"></"+e+">"+c,h=g.indexOf("/>");return g},dm_Tools.getMaxDepth=function(a,b){var b=b||0,c=b;if(a.children)for(var d=0;d<a.children.length;d++){var e=dm_Tools.getMaxDepth(a.children[d],b+1);e>c&&(c=e)}return c},dm_Tools.convertValue=function(a){return a||(a=""),a=dm_Tools.convertNumber(a)},dm_Tools.prop2obj=function(a,b){if("__dm_uniqueId"==b)return{};var b=b,c=a.rawNode||a;b.indexOf(".")>0&&(b=b.substring(0,b.indexOf(".")));var d=c[b],e=c[b+".dm_props"];e||(e={});var f=!1;for(var g in c)g!=b+".dm_props"&&0==g.indexOf(b+".")&&g.length>b.length+1&&(f=!0,e[g.substring(b.length+1)]=e[g.substring(b.length+1)]||c[g],delete c[g]);return f&&(c[b+".dm_props"]=e),"object"==typeof e&&(e.name=b,"image"==e.type&&(e.imageName=d)),e},dm_Tools.scanAllProps=function(a,b){if(a){var c=a.rawNode||a;for(var d in c)b&&b(c,d);a[dm_Tools_dm_config_name]&&dm_Tools.scanAllProps(a[dm_Tools_dm_config_name],b),a.children&&a.children.forEach(function(a){dm_Tools.scanAllProps(a,b)}),a.styles&&a.styles.forEach(function(a){dm_Tools.scanAllProps(a,b)}),a.aggregate&&a.aggregate.forEach(function(a){dm_Tools.scanAllProps(a,b)}),a.displayProps&&a.displayProps.forEach(function(a){dm_Tools.scanAllProps(a,b)})}},dm_Tools.prop2objAll=function(a){dm_Tools.scanAllProps(a,dm_Tools.prop2obj)},dm_Tools.setSpecificsFromConfig=function(a){var b=a.specifics;if(b)for(var c=null,d=null,e=null,f=null,g=0;g<b.length;g++)if(c=b[g],d=c.name,e=dm_Tools.getNodeFromPath(d),e&&e.node){f=e.node,f.rawNode||(f.rawNode={});for(var h in c.rawNode)f.rawNode[h]=c.rawNode[h]}},dm_Tools.onDisplayableRawNodeProps=function(a,b,c,d,e,f,g){var g=g||dm_Tools.getConfig(a),h=g.displayProps;g.adminProps,c||(c="");var i,j=[],k=function(a){if(0!=a.label.indexOf("dm_hoTable_level_")){for(var b,c=null,d=0;d<j.length&&!c;d++)b=j[d],b.propObj.name==a.propObj.name&&(c=b.propObj);c||j.push(a)}};if(a.rawNode){var l=function(b){var c,d=!0;for(var e in a.rawNode)if(e.indexOf(".")<0&&(b&&(d=!1,dm_Tools.isArray(b)&&b.indexOf(e)>=0?d=!0:e==b&&(d=!0)),d)){var c=dm_Tools.prop2obj(a,e);("true"==c.visible||1==c.visible||"true"==c.edit||1==c.edit)&&(f&&1==c.dontExport||k({propObj:c,label:e,value:dm_Tools.convertValue(a.rawNode[e]),order:j.length+1}))}};l(["icon","image"]);var m=g.styles[a.level];for(var n in m){var o=dm_Tools.prop2obj(m,n);o.visible&&k({propObj:o,label:n,value:o[n],order:j.length+1})}if(h&&h[a.level]){if(1==h[a.level].visible||1==h[a.level].edit){var o;for(var p in a.rawNode)p.indexOf(".")<0&&(o=dm_Tools.prop2obj(a,p),h[a.level].edit&&null==o.edit&&(o.edit=h[a.level].edit),0!=o.visible&&"false"!=o.visible&&k({propObj:o,label:p,value:dm_Tools.convertValue(a.rawNode[p]),order:j.length+1}))}var q=null,r=h[a.level].children;if(h[a.level][h[a.level].name],r&&r.length>0&&(q=r),q)for(var s,t=q.length,u=0;t>u;u++){s=q[u];var o=dm_Tools.prop2obj(a,s.name);for(var v in s)o[v]||(o[v]=s[v]);"false"!=o.visible&&0!=o.visible&&(f&&1==s.dontExport||k({propObj:o,label:s.label||s.name,value:dm_Tools.convertValue(a.rawNode[s.name]),order:j.length+1}))}}l()}return j.sort(function(a,b){var c=0,d=a.propObj.order,e=b.propObj.order;return 0>d&&(d=j.length+100-a.propObj.order),0>e&&(e=j.length+100-b.propObj.order),void 0==d&&(d=a.order),void 0==e&&(e=b.order),void 0!=d&&void 0==e&&(c=d<j.length?-1:1),void 0!=e&&void 0==d&&(c=e<j.length?1:-1),void 0!=d&&void 0!=e&&(c=e>d?-1:1),c}),j.forEach(function(e){i=b(e.propObj,a,d,e.label,e.value),c+=i?i:""}),c},dm_Tools.cos=function(a){return Math.cos(a*Math.PI/180)},dm_Tools.sin=function(a){return Math.sin(a*Math.PI/180)},dm_Tools.circle=function(a,b,c,d,e,f,g,h){var i,j=1,k="",l=0;if(k+=g(c+e*dm_Tools.cos(a),d+e*dm_Tools.sin(a),h),l++,b-a>j)for(i=a+j,i=a+j;b>i;i+=j)k+=g(c+e*dm_Tools.cos(i),d+e*dm_Tools.sin(i),h),l++;return k+=g(c+e*dm_Tools.cos(b),d+e*dm_Tools.sin(b),h),l++,f[0]=l,k},dm_Tools.pie=function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n,o,p,q,r,s,t,u=0,v=0,w=-90,x="",y=[2],z="";for(e-=h,n=c+e,o=d+e,u=0;u<f.length;u++)v+=f[u];for(r=360/v,u=0;u<f.length;u++){z="";var A;l&&(A=j(a,b,y,z,k,g[u],u,!0)),s=w+f[u]*r,t=w+(s-w)/2,p=n+h*dm_Tools.cos(t),q=o+h*dm_Tools.sin(t),z+=i(p,q,A),z+=dm_Tools.circle(w,s,p,q,e,y,i,A),z+=i(p,q,A),w=s,m&&(z=j(a,b,y,z,A,g[u],u,!1,!0)),x+=z}return x},dm_Tools.getParentNode4Config=function(a){var b,c=a;for(a||(a=dm_Datamap.currentDatamap.root);!b&&a;)b=a[dm_Tools_dm_config_name],c=a,a=a.parent;return c},dm_Tools.getConfig=function(a){var b,c=dm_Tools.getParentNode4Config(a);return c&&(b=c[dm_Tools_dm_config_name]),b||(b=dm_Tools.defaultConfig(),c&&(c[dm_Tools_dm_config_name]=b)),b},dm_Tools.getChildrenAtLevel=function(a,b){var c;if(!b||a.level<b)if(a.children)for(var d,e=a.children.length,f=0;e>f;f++){d=a.children[f];var g=dm_Tools.getChildrenAtLevel(d,b);if(g)if(c)for(var h,i=g.length,j=0;i>j;j++)h=g[j],c.push(h);else c=g}else b||(c=[],c.push(a));else a.level==b&&(c=[],c.push(a));return c},dm_Tools.formatXml=function(a){var b="",c=/(>)(<)(\/*)/g;a=a.replace(c,"$1\r\n$2$3");var d=0;return jQuery.each(a.split("\r\n"),function(a,c){var e=0;c.match(/.+<\/\w[^>]*>$/)?e=0:c.match(/^<\/\w/)?0!=d&&(d-=1):e=c.match(/^<\w[^>]*[^\/]>.*$/)?1:0;for(var f="",g=0;d>g;g++)f+="  ";b+=f+c+"\r\n",d+=e}),b},dm_Tools.getColorInGradient=function(a,b,c){var d=parseInt(a.substring(1,3),16),e=parseInt(a.substring(3,5),16),f=parseInt(a.substring(5),16),g=parseInt(b.substring(1,3),16),h=parseInt(b.substring(3,5),16),i=parseInt(b.substring(5),16),j=Math.min(255,Math.round(d+(g-d)*c/100)),k=Math.min(255,Math.round(e+(h-e)*c/100)),l=Math.min(255,Math.round(f+(i-f)*c/100)),m=dm_Tools.hex2str(j);m.length<2&&(m="0"+m);var n=dm_Tools.hex2str(k);n.length<2&&(n="0"+n);var o=dm_Tools.hex2str(l);o.length<2&&(o="0"+o);var p="#"+m+n+o;return p},dm_Tools.getImageSrc=function(a,b){var c,d=a.imageName;return d.indexOf("data:image")<0&&(d="data/images/"+d),c=b?d||a.inlineSrc:a.inlineSrc||d},dm_Tools.getImageFromNode=function(a,b,c,d,e){var f,g,h,i=d?"_"+d:"",j=dm_Tools.getConfig(a);if(c)a.rawNode&&(f=a.rawNode[c+i],h=a.rawNode);else{var c="icon"+i;a.rawNode&&(h=a.rawNode,b?f=a.rawNode[c]:a.rawNode.image?(c="image"+i,f=a.rawNode[c]):f=a.rawNode[c])}if(!f&&h&&0!=h[c+".visible"]&&"false"!=h[c+".visible"]&&j&&j.styles&&j.styles.length>a.level&&(h=j.styles[a.level],c?f=h[c]:(c="image"+i,f=h[c],f||(c="icon"+i,f=h[c])),f&&(g=dm_Tools.prop2obj(h,c))),f){if(g||(g={},g=dm_Tools.prop2obj(a,c)),e){var k,l=f.lastIndexOf("/");l>0?k=f.substring(0,l+1):l=0,k+=e+"/",k+=f.substring(l+1),f=k}if(g.imageName=f,j&&j.styles&&j.styles[a.level]){var m=dm_Tools.prop2obj(j.styles[a.level],c);g.inlineSrc||(g.inlineSrc=m.inlineSrc),g.width||(g.width=m.width),g.height||(g.height=m.height),g.scaleFactor||(g.scaleFactor=m.scaleFactor),g.panelMaxHeight||(g.panelMaxHeight=m.panelMaxHeight),g.textX||(g.textX=m.textX),g.x||(g.x=m.x),g.y||(g.y=m.y)}}return g},dm_Tools.countNodes=function(a,b,c,d){var e=0,d=d||0;if(a&&(!c||a.children)&&(e=1,(!b||b>d)&&a.children))for(var f,g=a.children.length,h=0;g>h;h++)f=a.children[h],e+=dm_Tools.countNodes(f,b,c,d+1);return e},dm_Tools.random=function(a,b,c,d){var e=function(a){return Math.floor(Math.random()*Math.pow(10,a))},f=function(a,b){var c=e(a);if(b){for(var d=0;c>b&&d++<200;)c=e(a);c>b&&(c=b)}return c},g=(d||0)+f(a,c-(d||0));if(b)for(g=""+g;b&&g.length<a;)g="0"+g;return g},dm_Tools.trash,dm_Tools.randomString=function(a,b){for(var c="",d=b||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=0;a>e;e++)c+=d.charAt(Math.floor(Math.random()*d.length));return c},dm_Tools.distinct=function(a,b){var c;dm_Tools.trash||(dm_Tools.trash={}),dm_Tools.trash[b]||(dm_Tools.trash[b]={});for(var d=0;d++<1e3&&dm_Tools.trash[b][c=a()];);return d>=1e3&&console.log("Impossible to randomize a value for '"+b+"' different from : '"+c+"'"),dm_Tools.trash[b][c]=1,c},dm_Tools.getFirstLeaves=function(a,b,c){var d;if(a&&!a.children&&b>0&&c&&a.rawNode&&a.rawNode[c])d=[a];else if(a&&a.children&&b>0)for(var e,f=a.children.length,g=0;f>g;g++){e=a.children[g];var h=dm_Tools.getFirstLeaves(e,b,c);h&&(b-=h.length,d=d?d.concat(h):h)}return d},dm_Tools.hasParentWithName=function(a,b){return a&&a.name==b?a:a.parent?dm_Tools.hasParentWithName(a.parent,b):void 0},dm_Tools.html2rtf=function(a){if(!a)return a;a=a.replace(/[&]nbsp[;]/gi," ");var b=dm_Tools.html2dom(a),c=[!0],d=function(a){var b="",c=a.indexOf('style="text-align:');if(c>=0){var d=a.indexOf('"',c+7),e=a.substring(c+7,d);e.indexOf("center")>=0?b="\\qc ":e.indexOf("left")>=0?b="\\ql ":e.indexOf("right")>=0?b="\\qr ":e.indexOf("justify")>=0&&(b="\\qj ")}return b},e=function(){var a="\\par "+(c[0]?"\\pard ":"");return c[0]=!1,a},f=function(a){var b="",g="",h="";if(a)if("string"==typeof a)b+=a;else{if("u"==a.name)g+="{\\ul ",h+="}";else if("b"==a.name)g+="{\\b ",h+="}";else if("i"==a.name)g+="{\\i ",h+="}";else if("font"==a.name){var i=a.props.indexOf("size");if(i>=0){var j=a.props.indexOf('"',i),k=a.props.indexOf('"',j+1),l=a.props.substring(j+1,k);g+="{\\fs"+dm_Tools.rtfFontSize(l)+" ",h+="}"}}else if("ul"==a.name)g+="{\\ls1",h+="}";else if("li"==a.name){var m=d(a.props);""!=m&&(g+=m,c[0]=!0);for(var n=0,o=a.parent;o&&"ul"==o.name;)n++,o=o.parent;n-=1;var p=dm_Rtf.rtfBulletStyles[n];g+="\\ls1 "+(n>0?"\\ilvl"+n+" ":"")+p+" ",h+=e()}else if("div"==a.name||"p"==a.name){g+=e();var m=d(a.props);""!=m&&(g+=m,c[0]=!0)}if(b+=g,a.children)for(var q,r=a.children.length,s=0;r>s;s++)q=a.children[s],b+=f(q);b+=h}return b};return f(b)},dm_Tools.removeAndReplaceDiv=function(a,b,c){var d,e=d3.select("#"+b);return e&&(d=e.style("height"),e.remove()),e=d3.select("#"+a).append("div").attr("id",b).attr("height","100%").style("height",d).style("max-height",d),c&&e.attr("class","modal-body"),e},dm_Tools.loadFromUrl=function(a,b){var c="xmlhttp";if("xmlhttp"==c){var d;d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),d.onreadystatechange=function(){4==d.readyState&&200==d.status&&b&&b(d.responseText)},d.open("GET",a,!0),d.setRequestHeader("Access-Control-Allow-Origin","*"),d.setRequestHeader("Access-Control-Allow-Headers","Cache-Control, Pragma, Origin, Authorization, Content-Type, X-Requested-With"),d.setRequestHeader("Access-Control-Allow-Methods","GET, PUT, POST"),d.send()}else if("iframe"==c){$("#fake_iframe_to_load_url_content_and_avoid_cross_domain_check").off("load");var e=d3.selectAll("body").append("iframe").attr("src",a).attr("id","fake_iframe_to_load_url_content_and_avoid_cross_domain_check").style("display","none").style("visibility","hidden").style("position","absolute").style("left","0px").style("top","0px").style("z-index","-1000").attr("height","0px").style("height","0px").on("load",function(){var a=e[0][0],b=a.contentWindow||a.contentDocument;b.document.body,console.log(d3.selectAll("#fake_iframe_to_load_url_content_and_avoid_cross_domain_check"))})}else"yql"==c&&jQuery.get(a,function(a){a&&a.responseText&&console.log(a.responseText)})},dm_Tools.defaultConfig=function(a,b){var c=90,d=0,e=0,f={root:null,styles:[{name:"root",level:d++,arrow:!0,arc:!1,rNod:10,link:c,color:dm_Tools.colors[e=0],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:10,link:c,color:dm_Tools.colors[e=0],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:9,link:c,color:dm_Tools.colors[++e],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:9,link:c,color:dm_Tools.colors[++e],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:9,link:c,color:dm_Tools.colors[++e],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:8,link:c,color:dm_Tools.colors[++e],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:8,link:c,color:dm_Tools.colors[e+=3],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:7,link:c,color:dm_Tools.colors[e+=3],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:7,link:c,color:dm_Tools.colors[++e],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:6,link:c,color:dm_Tools.colors[e+=3],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:6,link:c,color:dm_Tools.colors[e=0],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:5,link:c,color:dm_Tools.colors[++e],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:5,link:c,color:dm_Tools.colors[++e],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:5,link:c,color:dm_Tools.colors[++e],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:5,link:c,color:dm_Tools.colors[++e],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:4,link:c,color:dm_Tools.colors[e+=3],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:4,link:c,color:dm_Tools.colors[e+=3],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:4,link:c,color:dm_Tools.colors[++e],attrPaneCol:dm_Tools.colors[++e]},{name:"level "+d,level:d++,arrow:!0,arc:!1,rNod:4,link:c,color:dm_Tools.colors[e+=3],attrPaneCol:dm_Tools.colors[++e]},{name:"leaf",level:d++,arrow:!1,arc:!0,rNod:3,link:c/2,color:"#c7c7c7",attrPaneCol:"#c7c7c7",txtCol:"#7f7f7f"}],center:null,depth:6,setColumns2node:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],aggregate:null,displayProps:[{name:"root",children:[]},{name:"level "+(d=0),children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"level "+ ++d,children:[],edit:a,visible:b},{name:"leaf",children:[]}]};return f},dm_Tools.removePxAndParseInt=function(a){var b=null,a=a;if(a){var c=a.indexOf("px");c>=0&&(a=a.substring(0,c));try{b=parseInt(a)}catch(d){b=null}isNaN(b)&&(b=null)}return b},dm_Tools.loadLocalFile=function(a,b,c,d){var e=new XMLHttpRequest;e.open("GET",a,!0),e.overrideMimeType&&e.overrideMimeType("text/plain; charset=x-user-defined"),e.onreadystatechange=function(){4==this.readyState&&200==this.status&&(c&&dm_Tools.saveFile(this.response,a,d?d:"text/plain","x-user-defined"),null!=b&&b(this))},e.send()},dm_Tools.positiveHex=function(a){if(0>a){for(var b=a.toString(16),c="",d=0;d<b.length-1;d++)c+="f";a=parseInt(c,16)+a+1}return a},dm_Tools.hex2str=function(a){return dm_Tools.positiveHex(a).toString(16)},dm_Tools.distBetween2points=function(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))},dm_Tools.arcCenter=function(a,b,c,d,e,f){var e=e||dm_Tools.distBetween2points(a,b,c,d),g=c-a>0?-1:1,h=2*Math.PI/3*(0==f?-1:1),i=Math.atan((d-b)/(c-a)),j=i+h;return{x:a+g*e*Math.cos(j),y:b+g*e*Math.sin(j)}},dm_Tools.circleIntersect=function(a,b,c,d,e,f){var g=d-a,h=e-b,i=Math.sqrt(g*g+h*h),j=(i*i+c*c-f*f)/(2*i),k=a+g*j/i+h/i*Math.sqrt(c*c-j*j),l=a+g*j/i-h/i*Math.sqrt(c*c-j*j),m=b+h*j/i-g/i*Math.sqrt(c*c-j*j),n=b+h*j/i+g/i*Math.sqrt(c*c-j*j);return{x1:k,y1:m,x2:l,y2:n}},dm_Tools.formatDuration=function(a,b,c,d){var e=function(a){var b="";return 10>a&&(b+="0"),b+=a},f=1e3,g=60*f,h=60*g,i=24*h,j=7*i,k=365*i,l=a,m=Math.floor(l/k);l-=m*k;var n=Math.floor(l/j);l-=n*j;var o=Math.floor(l/i);l-=o*i;var p=Math.floor(l/h);l-=p*h;var q=Math.floor(l/g);l-=q*g;var r=Math.floor(l/f);l-=r*f;var s=l,b=b||":",c=c||"-",t="";return t+=m>0?m+(d?"y ":c):"",t+=m>0?n+(d?"w ":c):n>0?n+(d?"w ":c):"",t+=m>0||n>0?o+(d?"d ":" "):o>0?o+(d?"d ":" "):"",t+=p>0?p+(d?"h ":b):"",t+=p>0?e(q)+(d?"mn ":b):q>0?q+(d?"mn ":b):"",t+=p>0||q>0?e(r)+(d&&0==s?"s":""):r>0||s>0?r+(d&&0==s?"s":""):"",s>0&&(t+="."+s+(d?"s":"")),t},dm_Tools.parseDuration=function(a,b){for(var c,d,e,f,g,h,i,b=b||":",j=(""+a).split(b),k=!1,l=1e3,m=60*l,n=60*m,o=24*n,p=7*o,q=365*o,r=j.length-1;r>=0;r--){var s;try{s=parseInt(j[r])}catch(t){}null!=s&&(k=!0,null==c?c=s:null==d?d=s:null==e?e=s:null==f?f=s:null==g?g=s:null==h&&(h=s))}return k&&(h=null!=h?h:0,g=null!=g?g:0,f=null!=f?f:0,e=null!=e?e:0,d=null!=d?d:0,c=null!=c?c:0,i=h*q+g*p+f*o+e*n+d*m+c*l),i},dm_Tools.getAllNodesFromNode=function(a){for(var b=a;b.parent;)b=b.parent;var c=[],d=function(a){if(c.push(a),a&&a.children)for(var b,e=a.children.length,f=0;e>f;f++)b=a.children[f],d(b)};return d(b),c},dm_Tools.testFileExist=function(a,b,c,d){var e,d=null!=d?d:!0;a.indexOf(".")>0&&(e=a.substring(a.lastIndexOf(".")+1)),$.ajax({type:"GET",url:a,success:function(){b&&b()},error:function(a){200==a.status&&"OK"==a.statusText&&"json"==e?b&&b():c&&c()},async:d})},dm_Tools.concat=function(a,b){if(a&&b)for(var c,d=b.length,e=0;d>e;e++)c=b[e],a.push(c);return a},dm_Tools.getSearchList=function(a,b,c,d){var b=b||dm_Tools.getParentNode4Config(a),e=dm_Tools.getConfig(a),f=e.props4globalSearch,c=c||" | ",d=d||{},g=function(a,b){var d;if(a&&(a.name&&(d||(d=""),d+=a.name),a.rawNode&&b))for(var e,f=b.length,g=0;f>g;g++)e=b[g],a.rawNode[e]&&(d?d+=c:d="",d+=a.rawNode[e]);return d&&(d=d.trim()),d},h=g(b,f);if(h&&(d[h]=b),b.children)for(var i,j=b.children.length,k=0;j>k;k++)i=b.children[k],dm_Tools.getSearchList(i,i,c,d);return d},dm_Tools.getConfigProp=function(a,b,c){if(b&&a){var d,e=dm_Tools.getParentNode4Config(b);e&&(d=e[dm_Tools_dm_config_name]);var f;return d&&(f=d[a]),null==f&&(f=dm_Tools.getConfigProp(a,e.parent||c)),null==f&&(f=dm_Tools.defaultConfig()[a]),f}},dm_Tools.getConfigPropInCascad=function(a,b){for(var c,d=a;d&&!c;)d=dm_Tools.getParentNode4Config(d),c=d[dm_Tools_dm_config_name][b],d=d.parent;return c||(c=dm_Tools.defaultConfig()[b]),c},dm_Tools.getGaugeFromNode=function(a,b){var c;if(a&&a.rawNode){var d="gauge_"+b;if(c=a.rawNode[d+".dm_props"],!c)for(var e in a.rawNode)if(e.indexOf(d)>=0){var f=e.substring(d.length+1);f&&""!=f&&(c||(c={}),c[f]=a.rawNode[e])}}return c&&(c=dm_Tools.deepCopy(c),c.scale||(c.scale=1),c.width||(c.width=30),c.height||(c.height=8),c.stroke||(c.stroke="#000000"),c["stroke-width"]||(c["stroke-width"]=1),c.backgrdOpacity||(c.backgrdOpacity=.8),c.x||(c.x=0),c.y=c.y?-c.y:0,c.colorMin||(c.colorMin="#FF4040"),c.colorMax||(c.colorMax="#98C237"),(!c.max||c.max<=0)&&(c.max=100),c.value&&(c.value<0&&(c.value=0),c.value>c.max&&(c.value=c.max))),c},dm_Tools.parseNumbersOfTree=function(a){var b=function(a){if(a.rawNode)for(prop in a.rawNode){var c=a.rawNode[prop];if(c=(""+c).replace(/,/g,"."),1==c&&(a.rawNode[prop]=1),0==c&&(a.rawNode[prop]=0),1!=c&&0!=c&&!isNaN(c)){try{value=parseFloat(c)}catch(d){try{value=parseInt(c)}catch(e){value=null}}null!=value&&(a.rawNode[prop]=value)}}if(a.children)for(var f,g=a.children.length,h=0;g>h;h++)f=a.children[h],f&&b(f)};a&&b(a)},dm_Tools.getDepth=function(a){for(var b=0,c=a;c.parent;)b++,c=c.parent;return b},dm_Tools.isParentOfEachOther=function(a,b){for(var c=!1,d=a,e=b;d&&!c;)c=d==b,d=d.parent;for(;e&&!c;)c=e==a,e=e.parent;return c},dm_Tools.isAlreadyConnected=function(a,b,c,d,e){var f=a==b,g=e?dm_Tools_aggregatedConnected:dm_Tools_connected;if(!f&&a&&a.rawNode[g+d])for(var h,i,j=a.rawNode[g+d],k=j.length-1;k>=0&&!f;k--)h=j[k],i=dm_Tools.getNodeFromPath(h.nodePath).node,f=i==b,h.name&&c&&(f=f&&h.name==c);return f},dm_Tools.flatClone=function(a){var b;if(a){b={};for(var c in a)b[c]=a[c]}return b},dm_Tools.completeBothSidesOfConnection=function(a,b){var c=a.rawNode[dm_Tools_connected+b];if(c)for(var d,e=c.length-1;e>=0;e--)if(d=c[e]){var f=dm_Tools.getNodeFromPath(d.nodePath).node;if(f){var g="From"==b?"To":"From";if(!dm_Tools.isAlreadyConnected(f,a,d.name,g,!1)){f.rawNode[dm_Tools_connected+g]||(f.rawNode[dm_Tools_connected+g]=[]);var h=dm_Tools.flatClone(d);h.nodePath=dm_Tools.getNodeUrl(a,!0,"noDatamapNameInURL",!0),f.rawNode[dm_Tools_connected+g].push(h)}f.rawNode[dm_Tools_connected+g+".dm_props"]||(f.rawNode[dm_Tools_connected+g+".dm_props"]={name:dm_Tools_connected+g,label:dm_Tools_connected+g,type:"transverse link",source:"user"})}}},dm_Tools.completeBothSidesOfConnections=function(a){if(a){if(a.children)for(var b,c=a.children.length-1;c>=0;c--)b=a.children[c],dm_Tools.completeBothSidesOfConnections(b);dm_Tools.completeBothSidesOfConnection(a,"To"),dm_Tools.completeBothSidesOfConnection(a,"From")}},dm_Tools.doAggregatedConnection=function(a,b,c,d,e){var f;return dm_Tools.isAlreadyConnected(a,b,c.name,d,!0)||(a.rawNode[dm_Tools_aggregatedConnected+d]||(a.rawNode[dm_Tools_aggregatedConnected+d]=[]),f=dm_Tools.flatClone(c),f.nodePath=dm_Tools.getNodeUrl(b,!0),e&&(f.originalConnection=e),a.rawNode[dm_Tools_aggregatedConnected+d].push(f)),f},dm_Tools.aggregateConnectionsBetweenParents=function(a,b,c,d){for(var e,f,g=a,h=b,i=dm_Tools.getDepth(g),j=dm_Tools.getDepth(h),k=function(){f=dm_Tools.doAggregatedConnection(g,h,c,d,e),e={source:"To"==d?g:h,target:"To"==d?h:g,connectionObj:f}};g&&i>j;)e||(e={source:"To"==d?g:h,target:"To"==d?h:g,connectionObj:c}),g=g.parent,i--,k();for(;h&&j>i;)e||(e={source:"To"==d?g:h,target:"To"==d?h:g,connectionObj:c}),h=h.parent,j--,k();for(;g&&h&&g!=h;)e||(e={source:"To"==d?g:h,target:"To"==d?h:g,connectionObj:c}),g=g.parent,i--,h=h.parent,j--,k()},dm_Tools.aggregateConnection=function(a,b){if(a&&a.rawNode){var c=a.rawNode[dm_Tools_connected+b];if(c)for(var d,e=c.length-1,f="From"==b?"To":"From";e>=0;e--)if(d=c[e]){var g=dm_Tools.getNodeFromPath(d.nodePath).node;g?(dm_Tools.aggregateConnectionsBetweenParents(a,g,d,b),dm_Tools.aggregateConnectionsBetweenParents(g,a,d,f)):"To"==b?console.log('Failed to connect "'+dm_Tools.getNodeUrl(a,!0)+'" to "'+d.nodePath+'" : target not found'):console.log('Failed to connect "'+d.nodePath+'" to "'+dm_Tools.getNodeUrl(a,!0)+'" : source not found')}}},dm_Tools.aggregateConnections=function(a){if(a){if(a.children)for(var b,c=a.children.length-1;c>=0;c--)b=a.children[c],dm_Tools.aggregateConnections(b);dm_Tools.aggregateConnection(a,"To"),dm_Tools.aggregateConnection(a,"From")}},dm_Tools.numberOfParents=function(a){var b=0;if(a)for(var c=a.parent;c;)b++,c=c.parent;return b},dm_Tools.defaultDiacriticsRemovalap=[{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],dm_Tools.diacriticsMap={},dm_Tools.createDiacriticsMap=function(){for(var a=0;a<dm_Tools.defaultDiacriticsRemovalap.length;a++)for(var b=dm_Tools.defaultDiacriticsRemovalap[a].letters.split(""),c=0;c<b.length;c++)dm_Tools.diacriticsMap[b[c]]=dm_Tools.defaultDiacriticsRemovalap[a].base},dm_Tools.createDiacriticsMap(),dm_Tools.removeDiacritics=function(a){function b(a){return dm_Tools.diacriticsMap[a]||a}if(a)return a.replace(/[^\u0000-\u007E]/g,b)},dm_Tools.formatJSVarName=function(a){if(!a)return console.log("Warning : giving null to dm_Tools.formatJSVarName"),void 0;var a=dm_Tools.removeDiacritics(a);return a=a.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,"_"),a=a.replace(/\ /g,"_")},dm_Tools.removeSpecialChars=function(a){var a=a.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,"");return a},dm_Tools.writeHTMLCanvasTxt=function(a,b,c,d,e,f,g,h){f&&(a.strokeStyle=f,a.shadowColor=f,a.shadowBlur=h,a.lineWidth=g||3,a.strokeText(b,c,d)),a.fillStyle=e,a.fillText(b,c,d),a.shadowColor=null,a.shadowBlur=0},dm_Tools.getDefaultFontSize=function(a){var b=document.body,c=document.createElement("div");c.style.cssText="display:inline-block; padding:0; line-height:1; position:absolute; visibility:hidden; font-size:1em",c.appendChild(document.createTextNode(a)),b.appendChild(c);var d={w:c.offsetWidth,h:c.offsetHeight};return b.removeChild(c),d},dm_Tools.parseDate=function(a){var b=/(\d{2})\/(\d{2})\/(\d{4}) (\d{2}):(\d{2}):(\d{2})/,c=b.exec(a),d=new Date(+c[3],+c[2]-1,+c[1],+c[4],+c[5],+c[6]);return d},dm_Tools.removeCommentsCLike=function(a){return a.replace(/\/\*.+?\*\/|\/\/.*(?=[\n\r])/g,"")},dm_Tools.removeCommentsHash=function(a){return a.replace(/#.*(?=[\n\r])/g,"")},dm_Tools.decodeValue=function(a,b){if(output=a,"string"==typeof a&&b)try{output=decodeURIComponent(a)}catch(c){output=a}return output},dm_Tools.convertImgToBase64=function(a,b,c){var d=document.createElement("CANVAS"),e=d.getContext("2d"),f=new Image;f.crossOrigin="Anonymous",f.onload=function(){var a;d.height=f.height,d.width=f.width,e.drawImage(f,0,0),a=d.toDataURL(c),b.call(this,a),d=null},f.src=a},dm_Tools.arrayFromObj=function(a){var b=[];for(prop in a)b.push(prop);return b},dm_Tools.removeProps4nodes=function(a,b){for(var c,a=a,d=[a];d.length>0;)if(a=d.pop()){if("string"==typeof b)delete a[b];else for(c=b.length-1;c>=0;c--)delete a[b[c]];if(a.children)for(c=a.children.length-1;c>=0;c--)d.push(a.children[c])}},dm_Tools.setProps4nodes=function(a,b,c){for(var d,a=a,e=[a];e.length>0;)if(a=e.pop()){if("string"==typeof b)a[b]=c;else for(d=b.length-1;d>=0;d--)a[b[d]]=c[d];if(a.children)for(d=a.children.length-1;d>=0;d--)e.push(a.children[d])}},dm_Tools.updateLevels=function(a){for(var b,a=a,c=[a];c.length>0;)if(a=c.pop(),a&&(dm_Tools.bestEffortLevel(a),a.children))for(b=a.children.length-1;b>=0;b--)c.push(a.children[b])},dm_Tools.mergeAttributes=function(a,b){for(var c in b)("undefined"===a[c]||null===a[c])&&(a[c]=b[c])},dm_Tools.isChild=function(a,b){if(a&&a.children)for(var c,d=a.children.length-1;d>=0;d--)if(c=a.children[d],c.name==b)return c},dm_Tools.merge=function(a,b,c,d){var e=null;if(a&&b&&(c||a.name==b.name)){if(e=a,b.children){var f,g,h=b.children.length-1;for(a.children||(a.children=[]);h>=0;h--)f=b.children[h],g=dm_Tools.isChild(a,f.name),g?dm_Tools.merge(g,f):(f.parent=a,a.children.push(f),f[dm_Tools_dm_config_name]=d)}a.rawNode&&dm_Tools.mergeAttributes(a.rawNode,b.rawNode),dm_Tools.mergeAttributes(a,b)}return e},dm_Tools.noShow=function(){var a=d3.select("#temporary_and_hidden");return a[0][0]||(a=d3.select("body").append("noshow").attr("id","temporary_and_hidden").style("position","absolute").style("top","-100000px").style("left","-100000px").style("z-index",-1e3)),a},dm_Tools.resetNoShow=function(){dm_Tools.noShow().html("")},dm_Tools.getParentWithClass=function(a,b){return a?a.getAttribute("class")==b?a:dm_Tools.getParentWithClass(a.parentNode):void 0},dm_Tools.isInModal=function(a){return $(a[0][0]).parents(".modal")[0]},dm_Tools.isInTooltip=function(a){return $(a[0][0]).parents(".popover")[0]},dm_Tools.tintImage=function(a,b,c,d){var e=dm_Tools.color2rgb(b),f=dm_Tools.noShow();f.selectAll("#dm_Tools_tintImage").remove();var g=f.append("canvas").attr("id","dm_Tools_tintImage")[0][0];g.width=a.offsetWidth||a.width,g.height=a.offsetHeight||a.height,(g.width<=0||g.height<=0)&&console.log("Warning: "+d+" has 0 width:"+g.width+" or height:"+g.height);var h=g.getContext("2d");h.drawImage(a,0,0);for(var i,j,k,l,m=h.getImageData(0,0,g.width,g.height),n=m.data,o=0,p=n.length;p>o;o+=4)i=n[o],j=n[o+1],k=n[o+2],l=Math.floor((i+j+k)/3),i=l+(e.r-127.5)*c/100,j=l+(e.g-127.5)*c/100,k=l+(e.b-127.5)*c/100,n[o]=Math.min(255,Math.max(i,0)),n[o+1]=Math.min(255,Math.max(j,0)),n[o+2]=Math.min(255,Math.max(k,0));return h.putImageData(m,0,0),h.globalCompositeOperation="lighter",h.globalAlpha=0,h.fillRect(0,0,g.width,g.height),a.src=g.toDataURL(),a},dm_Tools.tintImageSrc=function(a,b,c,d){var e=dm_Tools.noShow();e.selectAll("#dm_Tools_tintImageSrc").remove();var f=dm_Tools.noShow().append("img").attr("id","dm_Tools_tintImageSrc").attr("src",a);f.on("load",null),f.on("load",function(){d3.select(this).on("load",null);var e=dm_Tools.tintImage(this,b,c,a);d&&d(e.src,e)})},dm_Tools.getImageSize=function(a,b,c,d){var e=dm_Tools.noShow();e.selectAll("#dm_Tools_getImageSizeImg").remove();var f=dm_Tools.noShow().append("img").attr("id","dm_Tools_getImageSizeImg").attr("src",a);f.on("load",null).on("error",null),f.on("load",function(){d3.select(this).on("load",null);var e=this.offsetWidth||this.width,f=this.offsetHeight||this.height;if(!c){var g=dm_Tools.noShow();g.selectAll("#dm_Tools_getImageSizeCanvas").remove();var h=g.append("canvas").attr("id","dm_Tools_getImageSizeCanvas")[0][0],i=1;d&&(i=e-d>f-d?d/e:d/f),h.width=e*i,h.height=f*i,(0==h.width||0==h.height)&&console.log("Warning: "+a+" has 0 width:"+h.width+" or height:"+h.height);
var j=h.getContext("2d");j.drawImage(this,0,0),this.src=h.toDataURL()}b&&b(e,f,this)}).on("error",function(){b&&b(-1,-1,null)})},dm_Tools.inlineAndUpdateSizeOfAllImages=function(a,b,c){var d=[];dm_Tools.scanAllProps(a,function(a,b){if("icon"==b||"image"==b||a[b+".dm_props"]&&"image"==a[b+".dm_props"].type){var c=(a[b+".dm_props"]?a[b+".dm_props"].inlineSrc:null)||a[b]||(a[b+".dm_props"]?a[b+".dm_props"].imageName:null);d.push({parentObj:a,prop:b,imgSrc:c})}});var e=function(){var a=d.pop();if(a){var f=a.imgSrc;dm_Tools.getImageSize("data/images/"+f,function(c,d,g){if(g){a.parentObj[a.prop+".dm_props"]||(a.parentObj[a.prop+".dm_props"]={});var h=a.parentObj[a.prop+".dm_props"];h.type="image",h.imageName=f,h.width=c,h.height=d,b||(h.inlineSrc=g.src)}e()},b,c)}else console.log("after dm_Tools.inlineAndUpdateSizeOfAllImages",dm_Tools.getDelay("inlineAndUpdateSizeOfAllImages"))};e()},dm_Tools.getStyleSheets=function(){for(var a=[],b=0;b<document.styleSheets.length;b++){var c=document.styleSheets[b].href;c&&a.indexOf(c)<0&&a.push(c)}return a},dm_Tools.getIFrame=function(a,b,c,d,e){var f=a.append("iframe").attr("width",c?c+"px":"100%").attr("height",d?d+"px":"100%").style("border","none").style("scrolling","no").style("allowTransparency","true");return setTimeout(function(){for(var a=f[0][0].contentWindow||f[0][0].contentDocument,c=a.document,d=c.body,g=c.getElementsByTagName("head")[0],h=document.getElementsByTagName("style"),i=0;i<h.length;i++)g.appendChild(h[i].cloneNode(!0));var j=dm_Tools.getStyleSheets();if(j.forEach(function(a){var b=c.createElement("link");b.rel="stylesheet",b.type="text/css",b.href=a,d.appendChild(b)}),d3.select(d).style("background-color","transparent"),b){var k=d3.select(d).append("div").attr("align","center").append("table").attr("height","100%").append("tr").append("td").style("vertical-align","middle");k[0][0].appendChild(b[0][0])}e&&e(a)},10),f},dm_Tools.is3DgraphInAttributes=function(a){if(a.rawNode)for(var b in a.rawNode){var c=a.rawNode[b+".dm_props"];if(c&&"graph"==c.type&&c["3D"])return!0;var d=b.lastIndexOf(".3D");if(d>0&&a.rawNode[b]){var e=b.substring(0,d);if("graph"==a.rawNode[e+".type"])return!0}}},dm_Tools.getMinimumPath=function(a,b){var c=dm_Tools.getParentNode4Config(a),d=dm_Tools.getParentNode4Config(b),e=dm_Tools.getNodeUrl(c,!0,"noDatamapNameInURL"),f=dm_Tools.getNodeUrl(d,!0,"noDatamapNameInURL"),g=dm_Tools.getNodeUrl(b,!0,"noDatamapNameInURL");if(0==f.indexOf(e)){var h=e.lastIndexOf("|");h>=0&&(g=g.substring(h+1))}return g},dm_Tools.areNodePathEqual=function(a,b){var c=dm_Tools.getNodeUrl(b,!0,"noDatamapNameInURL",!0);return a==c?!0:(c=dm_Tools.getNodeUrl(b,!0,"noDatamapNameInURL"),a==c?!0:(c=dm_Tools.getNodeUrl(b,!0),a==c?!0:!1))},dm_Tools.getAllNodes=function(a,b){var b=b||[];if(b.push(a),a.children)for(var c,d=a.children.length-1;d>=0;d--)c=a.children[d],dm_Tools.getAllNodes(c,b);return b},dm_Tools.validateNodeWithStickerAndGauge=function(a,b,c){var d=[],c=c||1,e=function(a){a.rawNode["icon_"+c]="../../images/success_stamp.png",a.rawNode["icon_"+c+".dm_props"]={width:152,height:148,scaleFactor:7,imageName:"../../images/success_stamp.png"}},f=function(a){var g=function(a){if(a&&a.rawNode){var b=0,d=dm_Tools.getAllNodes(a),e=d.length;if(a.children?d.forEach(function(a){a&&a.rawNode&&a.rawNode["icon_"+c]&&b++}):a.rawNode["icon_"+c]&&(b=1),a.rawNode.nbOfValidatedNodes=b,b>0)a.rawNode["gauge_"+c+".dm_props"]={value:b,max:e,y:-21};else for(var f in a.rawNode)0==f.indexOf("gauge_"+c)&&delete a.rawNode[f]}a.parent&&!a.dm_config&&g(a.parent)};if(a&&a.rawNode){var h=!1;if(a.children){h=!0;for(var i,j=dm_Tools.getAllNodes(a),k=0;k<j.length&&h;k++)i=j[k],i.rawNode&&!i.rawNode["icon_"+c]&&(h=!1)}else h=!0;if(g(a),h){e(a);var l=function(a){var b=!1;return d.forEach(function(c){b||a!=c||(b=!0)}),b};d.push(a),a.rawNode&&a.rawNode.copyOf&&b.forEach(function(b){b&&b.rawNode&&b.rawNode.uid==a.rawNode.copyOf&&(l(b)||f(b))}),b.forEach(function(b){b&&b.rawNode&&b.rawNode.copyOf&&b.rawNode.copyOf==a.rawNode.uid&&(l(b)||f(b))}),f(a.parent)}}};e(a),f(a),dm_Datamap.currentDatamap.graph.init(null,"dont change node coords")},dm_Tools.iterOverObjProps=function(a,b,c){var d=dm_Tools.isArray(a),e=d?[]:{},f=0,c=c||{stopLoop:!1};if(d)for(f=0;f<a.length&&(e.push(b(a[f],f,f,a,c)),!c.stopLoop);f++);else for(var g in a)if(e[g]=b(a[g],g,f++,a,c),c.stopLoop)break;return e},dm_Tools.iterOverTable=function(a,b){return dm_Tools.iterOverObjProps(a,function(a,c,d,e,f){return dm_Tools.iterOverObjProps(a,b,f)})},dm_Tools.visitTree=function(a,b){if(a&&a.rawNode&&dm_Tools.iterOverObjProps(a.rawNode,b),a.children)for(var c=0;c<a.children.length;c++)dm_Tools.visitTree(a.children[c],b)},dm_Tools.iterOverColumn=function(a,b,c){return dm_Tools.iterOverObjProps(a,function(a,d,e,f,g){return c(a[b],e,a,g)})},dm_Tools.convertColumnsTreeIntoArray=function(a){var b=a;if(null!=a)if(dm_Tools.isArray(a)){b=[];for(var c=0;c<a.length;c++)b.push(dm_Tools.convertColumnsTreeIntoArray(a[c]))}else a&&a.name?b=a.name:a&&a.children&&(b=dm_Tools.convertColumnsTreeIntoArray(a.children));else b=Number(null);return b},dm_Tools.areObjEqual=function(a,b){var c=dm_Tools.deepCopy(a,"__dm_uniqueId"),d=dm_Tools.deepCopy(b,"__dm_uniqueId"),e=JSON.stringify(c),f=JSON.stringify(d);return e==f},dm_Tools.removeNodeProps=function(a,b,c){if(a){if(b.indexOf(a.name)>=0)for(var d in a)c.indexOf(d)<0&&delete a[d];if(a.children)for(var e,f=0;f<a.children.length;f++)e=a.children[f],dm_Tools.removeNodeProps(e,b,c)}},dm_Tools.equalsOrRexgexpMatch=function(a,b){var c=a==b;if(!c){var d=new RegExp(a);c=d.test(b)}return c},dm_Tools.sortChildrenByPos=function(a){if(a&&a.children&&a.children.length>0){for(var b,c,d,e,f=a.x,g=a.y,h=a.children.length-1,i=[];h>=0;h--)b=a.children[h],c=b.x-f,d=-(b.y-g),e=Math.PI/2-Math.atan(d/c)+(0>c?Math.PI:0),i.push({elt:b,ang:e});i.sort(function(a,b){return a.ang==b.ang?0:a.ang>b.ang?1:-1}),a.children=[];for(var j=0;j<i.length;j++)b=i[j].elt,b.rawNode&&b.rawNode.hasOwnProperty("array index")&&(b.rawNode["array index"]=j),a.children.push(b)}},dm_Tools.isEltEqualsSelector=function(a,b){return"#"==b[0]?$(a).attr("id")==b.substring(1):"."==b[0]?$(a).hasClass(b.substring(1).toLowerCase()):a.nodeName.toUpperCase()==b.toUpperCase()},dm_Tools.isEqualOrParents=function(a,b){var c=dm_Tools.isEltEqualsSelector(a,b),d=$(a).parent()[0];return!c&&d&&(c=dm_Tools.isEqualOrParents(d,b)),c},dm_Tools.isEventCoordsIn=function(a,b){var c=!1;if(b){var d=b.getBoundingClientRect();c=a.pageX>=d.left&&a.pageX<=d.left+d.width&&a.pageY>=d.top&&a.pageY<=d.top+d.height}return c},dm_ToolsUI.dm_debug=!1,dm_ToolsUI.dm_debug&&(dm_ToolsUI.dm_debugPanel,dm_ToolsUI.dm_debugPanel||(dm_ToolsUI.dm_debugPanel=document.createElement("div"),dm_ToolsUI.dm_debugPanel.setAttribute("class","well"),dm_ToolsUI.dm_debugPanel.setAttribute("id","debugPanel"),document.getElementById("datamapNavbar").appendChild(dm_ToolsUI.dm_debugPanel)),console.log=function(a){var b=document.createElement("label");b.appendChild(document.createTextNode(a)),document.getElementById("debugPanel").appendChild(b)},console.debug=console.log,console.info=console.log,console.warn=console.log,console.error=console.log),dm_ToolsUI.cloneAndChangeAttr=function(a,b,c,d,e){var d=d||d3.select(a).node(),f=d?d.cloneNode(!0):null;return b&&("string"==typeof b?f.setAttribute(b,c):b.forEach(function(a){f.setAttribute(a.name,a.value)})),null!=e&&($($(f).children()[0]).contents().filter(function(){return 3==this.nodeType})[1].nodeValue=e),f},dm_ToolsUI.dom2html=function(a){var b=document.createElement("div");return b.appendChild(a),b.innerHTML},dm_ToolsUI.browserZoom=function(a){$.browser.mozilla?$("body").css("MozTransform","scale("+100*a+")"):$("body").css("zoom"," "+a+"%")},dm_Json2tree.reservedProps=["id","name","parent","children","style","rawNode","children","dm_children","dm_DatamapName","level","x","y","px","py","weight","index","fixed","selected","dm_config","__dm_uniqueId","dm_uniqueId","$circularRefs"],dm_Json2tree.dontExportProps=["style","dm_children","x","y","px","py","weight","index","fixed","selected","repulseX","repulseY"],dm_Json2tree.obj2tree=function(a,b,c,d,e){var f,g=function(a){return!(dm_Tools.isArray(a)||"number"==typeof a||"string"==typeof a||"boolean"==typeof a)},h=function(a,d,e,f){if(a||(a={parent:null}),dm_Tools.isArray(e)){a.children||(a.children=[]);var i=a;d&&"children"!=d&&(i={name:d,parent:a,children:[]},a.children.push(i));for(var j=0;j<e.length;j++)if(arrayElt=e[j],null!=arrayElt){var k;g(arrayElt)?k=i:(k={parent:i},i.children.push(k)),h(k,null,arrayElt,j)}}else if(null==e||"number"==typeof e||"string"==typeof e||"boolean"==typeof e)d?(a.rawNode||(a.rawNode={}),a.rawNode[d]=e,b&&(a.rawNode[d+".dm_props"]||(a.rawNode[d+".dm_props"]={}),a.rawNode[d+".dm_props"].visible=!0),c&&(a.rawNode[d+".dm_props"]||(a.rawNode[d+".dm_props"]={}),a.rawNode[d+".dm_props"].editable=!0)):a.name=e;else if(d&&d.indexOf(".dm_props")>=0)a[d]=e;else{a.children||(a.children=[]);var i={name:d,parent:a};isNaN(f)||(i.rawNode||(i.rawNode={}),i.rawNode["array index"]=f),a.children.push(i),e.children&&(i.children=e.children),e.rawNode&&(i.rawNode=e.rawNode);for(var l in e)"name"==l?d||(i.name=e[l]):"parent"!=l&&"children"!=l&&"rawNode"!=l&&h(i,l,e[l],f)}return a};return d?f=h(d,e,a):(f=h(null,a.name,a),g(a)&&(f=f.children[0],f.parent=null)),f},dm_Json2tree.tree2obj=function(a,b){var c,d,e=function(a,b){var c;return a.children&&a.children.length>0&&a.children.forEach(function(a){var d=dm_Json2tree.tree2obj(a,b);c||(c=[]),c.push(d)}),c};if(a.rawNode){var f=!1;for(var g in a.rawNode)0==g.indexOf("dm_hoTable_level_")?delete a.rawNode[g]:"dm_uniqueId"!=g&&(f=!0);f||delete a.rawNode}if(!a.rawNode&&a.name&&b)d=e(a,c),d?b[a.name]=d:a.name&&(c||(c={}),c.name=a.name);else{a.name&&(c||(c={}),c.name=a.name);for(var h in a.rawNode)c||(c={}),c[h]=a.rawNode[h];d=e(a,c),d&&(c||(c={}),c.children=d)}return c},dm_Json2tree.tree2realObjNotChildren=function(a){var b={};if(a.name&&(b.name=a.name,a.rawNode||a.children||(b=dm_BeforeAll.parseAtomic(a.name))),a.rawNode)for(var c in a.rawNode)b[c]=a.rawNode[c];if(a.children){var d,e;a.children.forEach(function(c){!c.rawNode&&c.children?(e=dm_Json2tree.tree2realObjNotChildren(c),e&&(b[c.name]=e[c.name]?e[c.name]:[])):(d||(d=b[a.name||"children"]=[]),e=dm_Json2tree.tree2realObjNotChildren(c),d.push(e))})}return b},dm_Json2tree.node2json=function(a,b,c,d,e,f,g,h,i){var j=[];i||(j=dm_Json2tree.dontExportProps),c&&c.length>0&&(j=j.concat(c));var k=dm_Tools.cloneAndFixCircularRefs(a,j);h(33);var l=JSON.stringify(k);return h(99),l=dm_Tools.changeNewLinesFromJSONStrings(l,"re-set new-lines!")},dm_Datamap_loadWithAjaxByDefault=!1,dm_Datamap.createNewDatamap=function(a,b,c,d,e,f,g,h,i,j){return new dm_Datamap(a,b,c,d,e,f,g,h,i,j)},dm_Datamap.currentDatamap=null,dm_Datamap.maps={},dm_Datamap.getRootDm=function(a){var b,c=a;for(c||(c=dm_Datamap.currentDatamap.root);c.parent;)c=c.parent;return dmName=c.dm_DatamapName,dmName&&(b=dm_Datamap.maps[dmName]),b},dm_Datamap.getDmFromGotoTarget=function(a,b){var c;if(a){var d;b&&b.rawNode&&(d=b.rawNode.dm_goto_config);var e=d||a.name;"dm_currentDatamap"==a.name?c=dm_Datamap.currentDatamap:"dm_rootDatamap"==a.name&&(c=dm_Datamap.getRootDm(b)),c||(c=dm_Datamap.maps[e])}return c},dm_Datamap.getNodeAndDmFromFullPath=function(a){var b=dm_Tools.getDatamapNameAndPathFromFullPath(a),c=dm_Datamap.getDmFromGotoTarget(b),d=dm_Tools.getNodeFromPath(b.path,null,c).node;return{datamap:c,node:d}},dm_Datamap.afterAggregateAndRootCopyInParentDm=function(a){dm_Tools.completeBothSidesOfConnections(a),dm_Tools.aggregateConnections(a)},dm_Datamap.gotoDatamap=function(a,b,c,d){var e=dm_Tools.getGotoTarget(a);if(e){var f,g=function(){var g=dm_Datamap.getDmFromGotoTarget(e,a),h=function(){var a;return e.path&&(a=dm_Tools.getNodeFromPath(e.path,null,g).node),a=a||g.root},i=function(a,b){var c=b.indexOf(".");return c>0&&(b=b.substring(0,c)),a[b+".discardAfterGoto"]&&(1==a[b+".discardAfterGoto"]||"true"==a[b+".discardAfterGoto"])||a[b+".dm_props"]&&(1==a[b+".dm_props"].discardAfterGoto||"true"==a[b+".dm_props"].discardAfterGoto)?(console.log("discard "+b),!0):void 0},j=function(a,b){for(var c in a)i(a,c)||(b[c]=a[c])},k=function(a){for(var b in a)i(a,b)&&delete a[b]},l=function(){var b=h(),c=b;if(k(c.rawNode),a.level=c.level,a.rawNode&&j(a.rawNode,c.rawNode),a.rawNode=c.rawNode,a.children=c.children,a[dm_Tools_dm_config_name]=c[dm_Tools_dm_config_name],a.rawNode&&a.rawNode.dm_goto&&delete a.rawNode.dm_goto,a.dm_children=b.dm_children,b.dm_DatamapName&&(a.dm_DatamapName=b.dm_DatamapName),a.children)for(var d,e=a.children.length-1;e>=0;e--)d=a.children[e],d.parent=a;if(a.dm_children)for(var d,e=a.dm_children.length-1;e>=0;e--)d=a.dm_children[e],d.parent=a;dm_Datamap.setNodeToParent(a,a.parent),b.parent||(b.parent=a.parent),dm_Tools.getNodesFromRoot(a,dm_Datamap.currentDatamap.nodes)},m=function(b){c||dm_UI.closeWorkInProgress(),l(b),c||(dm_Datamap.currentDatamap&&dm_Datamap.currentDatamap.graph&&(dm_Datamap.currentDatamap.graph.center=a),dm_UI.resetMouseOverSelection(a),dm_UI.autoResize()),dm_Datamap.afterAggregateAndRootCopyInParentDm(a),null!=d&&d(b)};return g?c?null!=m&&m(g):g.select(e.path,m,!0):(c||dm_UI.openWorkInProgress(),g=new dm_Datamap(e.name,dm_Datamap_loadWithAjaxByDefault,f,e.path,m,!0,!0,b?b.graph:dm_Datamap.currentDatamap.graph,null,a)),g};return a.rawNode.dm_goto_config&&""!=a.rawNode.dm_goto_config?(d3.text("data/"+a.rawNode.dm_goto_config,"text/plain;charset=ISO-8859-15",function(b){return f=dm_Tools.parseStringified(b).config,f.dm_DatamapName=f.dm_DatamapName||a.rawNode.dm_goto_config,g()}),void 0):g()}},dm_Datamap.getAllGoto2load=function(a,b){if(a.rawNode&&a.rawNode.dm_goto&&b.push(a),a.children)for(var c,d=a.children.length-1;d>=0;d--)c=a.children[d],c&&dm_Datamap.getAllGoto2load(c,b)},dm_Datamap.loadAll=function(a,b,c){b||(b=dm_Datamap.currentDatamap),a||(a=b.graph.center);var d=[];dm_Datamap.getAllGoto2load(a,d);var e=function(){if(d.length>0){var f=d.pop();dm_Datamap.gotoDatamap(f,b,!0,e)}else null!=c&&(dm_Datamap.currentDatamap=b,dm_Datamap.currentDatamap.graph.center=a,c())};e()},dm_Datamap.gotoNodeAndLoadNeededDatamaps=function(a){var b=dm_Tools.getNodeFromPath(a),c=b.node||b.lastFoundNode;c&&(c.rawNode&&c.rawNode.dm_goto?dm_Datamap.gotoDatamap(c,null,!0,function(){dm_Datamap.gotoNodeAndLoadNeededDatamaps(a)}):dm_Datamap.currentDatamap.graph.init(c),dm_UI.resetMouseOverSelection(c))},dm_Datamap.getDatamapFromNode=function(a){var b=dm_Datamap.currentDatamap,c=dm_Tools.getParentNode4Config(a);if(c){var d=c.dm_DatamapName;d&&(b=dm_Datamap.maps[d]||b)}return b},dm_Datamap.loadCsvAndJsonConfig=function(a,b){d3.text("data/"+b,"text/plain;charset=ISO-8859-15",function(b){var c=dm_Tools.parseStringified(b).config;dm=new dm_Datamap(a,!1,c,null,null,null,null,dm_Datamap.currentDatamap.graph)})},dm_Datamap.isInAdminConfigTree=function(a){var b=null;for(a=a||dm_Datamap.currentDatamap.graph.center;a&&!dm_Tools.isAdminConfigTreeNode(a);)a=a.parent;return b=dm_Tools.isAdminConfigTreeNode(a)},dm_Datamap.isInAdminMode=function(){return null!=dm_Datamap.currentDatamap.adminConfigTree},dm_Datamap.getCurrentDmFromNode=function(a){var b=dm_Datamap.currentDatamap,c=dm_Tools.getParentNode4Config(a);return dm_Datamap.maps[c.dm_DatamapName]||b},dm_Datamap.admin=function(){var a=dm_Datamap.currentDatamap,b=dm_Tools.getParentNode4Config(a.graph.center),c=dm_Datamap.isInAdminConfigTree(a.graph.center)||a.adminConfigTree;if(c){var d=dm_Json2tree.tree2obj(c);delete d.name,delete d.dm_goto,a.config=d,dm_Datamap.removeNode(c,!0),a.adminConfigTree=null}else{var e=a.name+dm_Tools_constantDmConfigTreeRootName;a.config||(a.config=dm_Tools.getConfig(dm_Datamap.currentDatamap.graph.center)),a.adminConfigTree=dm_Json2tree.obj2tree(a.config),dm_Datamap.setNodeToParent(a.adminConfigTree,b,!0),a.adminConfigTree.name=e;var f=new dm_Datamap(a.adminConfigTree,!1,dm_Datamap.defaultConfig4configTree,null,null,null,!0,a.graph);f.graph=a.graph,console.log("datamap maps :"),console.log(dm_Datamap.maps),console.log("dmConfigDatamap :"),console.log(f),a.adminConfigTree[dm_Tools_dm_config_name]=dm_Datamap.defaultConfig4configTree,a.graph.center=a.adminConfigTree,dm_UI.autoResize()}},dm_Datamap.refresh=function(){dm_Datamap.alignLevels2tree(dm_Datamap.currentDatamap.root),dm_Datamap.alignNodeProperties2tree(dm_Datamap.currentDatamap.root);var a=!1,b=function(c,d){if(d||(d=[]),c.dm_DatamapName){var e=dm_Datamap.maps[c.dm_DatamapName];e==dm_Datamap.currentDatamap&&(a=!0),d.push({dm:e,rootNode:c})}if(c.children)for(var f,g=c.children.length-1;g>=0;g--)f=c.children[g],d=b(f,d);return d},c=dm_Tools.getParentNode4Config(dm_Datamap.currentDatamap.graph.center),d=b(c),e=function(a,b){if(a&&b){var f=c;if(c==b&&(f=a),dm_Datamap.currentDatamap.graph.center=f,dm_UI.resetMouseOverSelection(f),b.parent){var g=b.parent.children.indexOf(b);b.parent.children[g]=a,a.parent=b.parent}dm_Datamap.afterAggregateAndRootCopyInParentDm(a)}var h=d.pop();h&&h.dm?h.dm.aggregate(e,h.rootNode):(dm_UI.resetMouseOverSelection(null),dm_UI.autoResize())};if(a)e();else{var f=dm_Datamap.currentDatamap;f.aggregate(e)}},dm_Datamap.defaultStyles,dm_Datamap.createDefaultStyles=function(a){dm_Datamap.defaultStyles=[];var b,c,d=0,e=0,f=110;for(d=0;a>d;d++)b="level "+d,0==d?b="root":d==a-1&&(b="leaf"),c={name:b,level:d,arrow:d==a-1?!1:!0,arc:d==a-1?!0:!1,rNod:d==a-1?8:10,link:d==a-1?f/2:f,color:dm_Tools.colors[e],attrPaneCol:dm_Tools.colors[e+1]},dm_Datamap.defaultStyles.push(c),e+=2,e>=dm_Tools.colors.length&&(e-=dm_Tools.colors.length)},dm_Datamap.defaultConfig,dm_Datamap.defaultConfig4configTree,dm_Datamap.createDefaultConfig=function(){var a=9;dm_Datamap.createDefaultStyles(a),dm_Datamap.defaultConfig={root:null,columns:null,styles:dm_Datamap.defaultStyles,center:null,depth:2,setColumns2node:null,aggregate:null,sort:"array index",sortDescendant:!0,displayProps:null,adminProps:null},dm_Datamap.defaultConfig4configTree=dm_Tools.deepCopy(dm_Datamap.defaultConfig),dm_Datamap.defaultConfig.displayProps=[],dm_Datamap.defaultConfig.adminProps=[];var b,c,d=0;for(d=0;a>d;d++)b="level "+d,0==d?b="root":d==a-1&&(b="leaf"),c={name:b},dm_Datamap.defaultConfig.displayProps.push(c),dm_Datamap.defaultConfig.adminProps.push(c)}(),dm_Datamap.feedSearchQuery=function(a,b,c){d3.selectAll("#"+a+"_dropdown-menu").remove();var d=dm_ToolsUI.cloneAndChangeAttr("#"+a),e=$("#"+a),f=e.parent();e.remove(),f.append(d);var g=d3.select("#"+a),h=document.getElementById(a);if(g&&h){var i=function(b){if(!dm_UI.testIfIsolateFromEvents()){dm_UI.delayBetweenEvents("dm_Datamap.feedSearchQuery / onQueryDone on #"+a);var d,e=$("#"+a+"_dropdown-menu"),f=null;e&&(d=e.find("li.active"),d&&(f=d.data("value"))),f||(f=h.value),(f||""==f)&&(h.value=f,c&&c(f,b))}};$("#"+a).off("keyup"),$("#"+a).off("change"),$("#"+a).off("blur"),g.attr("data-source",dm_Tools.stringify(b)),g.on("keyup",function(){13==event.keyCode&&i(!0)}),g.on("change",function(){i(!0)}),g.on("blur",function(){i(!0)})}},dm_Datamap.nodeInBuffer,dm_Datamap.nodeCopy=function(a,b){a||(a=dm_UI.lastMouseOverNode);var c=dm_Tools.deepCopy(a,"__dm_uniqueId");return b||(dm_Datamap.nodeInBuffer=c),c},dm_Datamap.setNodeToParent=function(a,b,c){if(b){if(a.parent=b,c){var d=b.dm_children||(b.dm_children=[]);d.indexOf(a)<0&&d.push(a)}else{var e=b.children||(b.children=[]);e.indexOf(a)<0&&e.push(a)}dm_Datamap.alignLevels2tree(b),dm_Datamap.alignNodeProperties2tree(b)}},dm_Datamap.nodePaste=function(a,b){var b=b;b||(b=dm_Datamap.nodeInBuffer),b=dm_Tools.deepCopy(b,"__dm_uniqueId");var c,d=dm_Tools.getConfig(b);a&&(c=dm_Tools.getConfig(a)),c==d&&(b[dm_Tools_dm_config_name]=null,d=null,delete b[dm_Tools_dm_config_name]);var e=dm_Tools.merge(a,b);e||b.rawNode&&b.rawNode.discardNodeAfterPaste&&(e=dm_Tools.merge(a,b,!0,d)),e||dm_Datamap.setNodeToParent(b,a),dm_Datamap.refresh()},dm_Datamap.createNode=function(a,b,c,d){var e={};e.name=b?b:"...",a&&(e.parent=a),dm_Tools.bestEffortLevel(e);var f=dm_Tools.getConfig(e).displayProps[e.level];if(e.rawNode={},!c&&f&&f.children)for(var g,h=f.children.length-1;h>=0;h--)g=f.children[h],e.rawNode[g]=null;if(dm_Datamap.onCreateNode(e),dm_Datamap.currentDatamap.nodes||(dm_Datamap.currentDatamap.nodes=new dm_tools_NameIdList),dm_Datamap.currentDatamap.nodes.addObject(e),a){var i;i=d?a.dm_children||(a.dm_children=[]):a.children||(a.children=[]),i.push(e)}return e},dm_Datamap.addChildNode=function(a){dm_Attributes.avoidExpand=!0,a||(a=dm_UI.lastMouseOverNode),dm_Datamap.createNode(a),dm_UI.autoResize()},dm_Datamap.removeNode=function(a,b,c){dm_Attributes.avoidExpand=!0,a||(a=dm_UI.lastMouseOverNode);var d=!1;a==dm_Datamap.currentDatamap.graph.center&&(d=!0);var e=a.parent;if(e){var f;f=b?e.dm_children.indexOf(a):e.children.indexOf(a),f>=0&&(b?e.dm_children.splice(f,1):e.children.splice(f,1))}else e=dm_Datamap.createNode();dm_Datamap.currentDatamap.nodes.removeObject(a),c||(d&&(dm_Datamap.currentDatamap.graph.center=e),dm_UI.resetMouseOverSelection(dm_Datamap.currentDatamap.graph.center),dm_UI.autoResize())},dm_Datamap.getTreeColumnNames=function(a){var b,c;a||(a=dm_Datamap.currentDatamap);var d=dm_Tools.getConfig(a.root);if(b=d.columnNames,d.columns)for(var e,f=0;f<d.columns.length;f++){e=d.columns[f],"number"==typeof e&&b&&b.length>e&&(e=b[e]);var g=!0;if(d.setColumns2node&&(g=!1,f<d.setColumns2node.length-1)){var h=d.setColumns2node[f+1];if(h)if(0==h.length)g=!0;else for(var i=0;!g&&i<h.length;i++){var j=h[i];"number"==typeof j&&b&&b.length>j&&(j=b[j]),j==e&&(g=!0)}}g&&"string"==typeof e&&(c||(c=[]),c.push(e))}return c},dm_Datamap.alignNodeProperties2tree=function(a,b,c){if(c||(c=dm_Datamap.getTreeColumnNames(b)),c){if(a.rawNode)for(var d,e=c.length-1;e>=0;e--)d=c[e],a.rawNode[d]&&(a.rawNode[d]="");for(var f,g,h=a;h;)a.rawNode||(a.rawNode={}),g=h.level-1,g>=0&&g<c.length&&(f=c[g],a.rawNode[f]=h.name),h=h.parent;if(a.children)for(var i,e=a.children.length-1;e>=0;e--)i=a.children[e],dm_Datamap.alignNodeProperties2tree(i,b,c)}},dm_Datamap.alignLevels2tree=function(a){if(dm_Tools.bestEffortLevel(a),a.style){console.log("found node style !!! "+a.name+"  level="+a.level+"  style_level="+a.style.level);var b=dm_Tools.getConfig(a).styles[a.level];a.style.level=a.level,a.style.arrow=b.arrow,a.style.arc=b.arc,a.style.rNod=b.rNod,a.style.link=b.link,a.style.color=b.color,a.style.attrPaneCol=b.attrPaneCol}if(a.children)for(var c,d=a.children.length-1;d>=0;d--)c=a.children[d],dm_Datamap.alignLevels2tree(c)},dm_Datamap.changeNodeName=function(a,b,c,d){var d=d||dm_Datamap.getDatamapFromNode(a);d.nodes.removeObject(a),a.name=b,a.rawNode&&a.rawNode.displayName&&(a.rawNode.displayName=b),d.nodes.addObject(a),c||(d3.select("#graph").selectAll("#node_text_shadow_id_"+a.id).text(a.name),d3.select("#graph").selectAll("#node_text_id_"+a.id).text(a.name),a==d.graph.center&&dm_UI.setTopSearchQuery(d.graph.center.name))},dm_Datamap.focusNode=function(a){var a=a;"string"==typeof a&&(a=dm_Tools.getNodeFromPath(a).node),dm_UI.closeAllModals();var b=dm_Datamap.currentDatamap.graph.isNodeDisplayed(a);if(b)dm_UI.resetMouseOverSelection(a);else{var c=a;a.parent&&(c=a.parent),c!=dm_Datamap.currentDatamap.graph.center&&dm_Datamap.currentDatamap.graph.init(c),dm_UI.resetMouseOverSelection(a)}},dm_Datamap.refreshGraph=function(a){dm_Datamap.currentDatamap.graph.init(a)},dm_Datamap.onCreateNode=function(a){if(dm_Datamap.isInAdminConfigTree(a)&&(a.parent&&a.parent.parent&&"displayProps"==a.parent.parent.name&&(a.rawNode||(a.rawNode={}),a.rawNode["array index"]=a.parent.children?a.parent.children.length:0,a.rawNode.label=a.name,a.rawNode.edit=!0,a.rawNode.graph="",a.rawNode.input="",a.rawNode.title=""),a.parent&&"aggregate"==a.parent.name&&(a.rawNode||(a.rawNode={}),a.rawNode.execAfterChildrenVisit=!0,a.rawNode.value=""),a.parent&&"styles"==a.parent.name)){a.rawNode||(a.rawNode={});var b=a.parent.children?a.parent.children.length:0;a.rawNode["array index"]=b,a.rawNode.level=b,a.rawNode.arrow=!0,a.rawNode.arc=!1,a.rawNode.rNod=10,a.rawNode.link=110,a.rawNode.color=dm_Tools.colors[2*b],a.rawNode.attrPaneCol=dm_Tools.colors[2*b+1]}},dm_Datamap.updatePropsAfterLevelChange=function(a,b,c){var d=dm_Tools.getConfig(a);if(d.columns&&d.columnNames){var e=d.columnNames[d.columns[b-1]],f=d.columnNames[d.columns[c-1]];a.rawNode[f]=a.rawNode[e],a.rawNode[e]=null,a.rawNode[f]||(a.rawNode[f]=a.rawNode.originalName||a.name)}if(a.children)for(var g,h=a.children.length-1;h>=0;h--)g=a.children[h],dm_Datamap.updatePropsAfterLevelChange(g,b,c)},dm_Datamap.nodeMoveUp=function(a){a||(a=dm_UI.lastMouseOverNode);var b=dm_UI.disabledMoveDownNode(a);a.level=a.level-1,dm_graph_Force.updateNodeStyle(a),dm_Datamap.updatePropsAfterLevelChange(a,a.level+1,a.level),dm_Attributes.updateAttributesPanel(a),dm_UI.activateNodeContextualActions(),b&&dm_UI.autoResize()},dm_Datamap.nodeMoveDown=function(a){a||(a=dm_UI.lastMouseOverNode),a.level=a.level+1;var b=dm_UI.disabledMoveDownNode(a);dm_graph_Force.updateNodeStyle(a),dm_Datamap.updatePropsAfterLevelChange(a,a.level-1,a.level),dm_Attributes.updateAttributesPanel(a),dm_UI.activateNodeContextualActions(),b&&dm_UI.autoResize()},dm_Datamap.navigationList=[],dm_Datamap.navigationListIdx=-1,dm_Datamap.updateBrowserURL=function(a){try{window.history.pushState("www.freedatamap.com","www.freedatamap.com","?load="+a)}catch(b){}},dm_Datamap.addNodeToNavigationList=function(a){dm_Datamap.navigationList||(dm_Datamap.navigationList=[]);var b=dm_Tools.getNodeUrl(a,!0);(0==dm_Datamap.navigationList.length||b!=dm_Datamap.navigationList[dm_Datamap.navigationListIdx])&&(dm_Datamap.navigationListIdx<dm_Datamap.navigationList.length-1&&dm_Datamap.navigationList.splice(dm_Datamap.navigationListIdx+1,dm_Datamap.navigationList.length-1-dm_Datamap.navigationListIdx),dm_Datamap.updateBrowserURL(b),dm_Datamap.navigationList.push(b),dm_Datamap.navigationListIdx++)},dm_Datamap.gotoNavigationIndex=function(){if(dm_Datamap.navigationListIdx>=0&&dm_Datamap.navigationListIdx<dm_Datamap.navigationList.length){var a=dm_Datamap.navigationList[dm_Datamap.navigationListIdx],b=dm_Datamap.getNodeAndDmFromFullPath(a);b&&(dm_Datamap.updateBrowserURL(a),dm_Datamap.currentDatamap=b.datamap,dm_Datamap.currentDatamap.graph.center=b.node,dm_UI.resetMouseOverSelection(b.node),dm_UI.autoResize())}},dm_Datamap.goBack=function(){dm_Datamap.navigationListIdx>0&&(dm_Datamap.navigationListIdx--,dm_Datamap.navigationList.splice(dm_Datamap.navigationListIdx+1),dm_Datamap.gotoNavigationIndex())},dm_Datamap.goForward=function(){dm_Datamap.navigationListIdx<dm_Datamap.navigationList.length-1&&(dm_Datamap.navigationListIdx++,dm_Datamap.gotoNavigationIndex())},dm_Datamap.goHome=function(){dm_Datamap.navigationList.length>0&&(dm_Datamap.navigationListIdx=0,dm_Datamap.gotoNavigationIndex())},dm_Datamap.goRoot=function(){if(dm_Datamap.navigationList.length>0){var a=dm_Datamap.navigationList[0],b=dm_Datamap.getNodeAndDmFromFullPath(a);b&&(dm_Datamap.currentDatamap=b.datamap,dm_Datamap.currentDatamap.graph.center=b.node,dm_UI.autoResize())}},dm_Datamap.nodeEditing=!1,dm_Datamap.defaultNewBlankAttributeName="dm_newAttribute",dm_Datamap.attributesEditMode_allNodesOfSameLevel="Level's nodes",dm_Datamap.attributesEditMode_onlyThisNode="This node",dm_Datamap.drawNodeEditPane=function(a){a||(a=dm_UI.lastMouseOverNode),d3.selectAll("#attributesEditTitle").remove(),d3.selectAll("#attributesEditTitleDivContainer").append("h2").attr("id","attributesEditTitle").text(a.name),dm_Tools.removeAndReplaceDiv("attributesEdit-modal","attributesEdit-modal-body","modal-body",!0),$("#attributesEdit-validateAndExit").off("click"),d3.selectAll("#attributesEdit-validateAndExit").on("click",function(){dm_UI.testIfIsolateFromEvents()||(dm_UI.delayBetweenEvents("dm_Datamap.drawNodeEditPane on #attributesEdit-validateAndExit"),dm_UI.autoResize())}),$("#attributesEditMode").off("change"),d3.selectAll("#attributesEditMode").on("change",function(){dm_Datamap.drawNodeEditPane(a),dm_UI.resizeAttributesEditModal()});var b=d3.selectAll("#attributesEdit-modal-body");b.style("margin","0px"),dm_Attributes.setBackground(a,b),attributesFieldContent=b.append("div").attr("id","attributesEditPanelContent");var c=attributesFieldContent.append("ul").attr("id","attributesList").attr("class","nav nav-tabs nav-stacked"),d=a.level;dm_Datamap.nodeEditing=!1;var e=dm_Tools.getConfig(a),f=a[dm_Tools_dm_config_name];dm_Datamap.propEdit(a,c,e,!0,d,dm_Datamap.defaultNewBlankAttributeName);var g=d3.selectAll("#attributesEditMode").property("value")==dm_Datamap.attributesEditMode_allNodesOfSameLevel,h=function(a){var b=null;if(e.columnNames)if(e.setColumns2node&&e.setColumns2node[d])for(var c=0;null==b&&c<e.setColumns2node[d].length;c++){var f;c<e.columnNames.length&&(f=e.columnNames[c]),f==a&&(b=c)}else b=e.columnNames.indexOf(a),0>b&&(b=null);return b},i=function(a){var b=null;if(e.aggregate)for(var c=0;null==b&&c<e.aggregate.length;c++){var d=e.aggregate[c];d.name==a&&(b=d)}return b},j={},k=function(a,b,c){var e=h(a.name),f=i(a.name),g={};j[a.name]?g=j[a.name]:j[a.name]=g,g.level=d,g.label=a.label,g.edit=0==a.edit||"false"==a.edit?!1:null!=f?!1:c||a.edit,g.visible=0==a.visible||"false"==a.visible?!1:b||a.visible,g.type=a.type?a.type:a.graph?"graph":"text",g.source=null!=e?"CSV column":null!=f?"aggregation":a.source,g.prop||(g.prop=a);for(var k in g)"level"!=k&&"prop"!=k&&(g.prop[k]=g[k]||g.prop[k])};if(e){var l=function(a,b,c,e,f,g){var h=function(a,b){var c=!0;return a&&(c=!1,dm_Tools.isArray(a)&&a.indexOf(k)>=0?c=!0:b==a&&(c=!0)),c};if(a){var i=!0;for(var k in a)if(!(k.indexOf(".")>0)&&(b?(i=!1,dm_Tools.isArray(b)&&b.indexOf(k)>=0?i=!0:k==b&&(i=!0)):c&&(i=!0,dm_Tools.isArray(c)&&c.indexOf(k)>=0?i=!1:k==c&&(i=!1)),i&&!j[k])){var l={};j[k]=l;var m=dm_Tools.prop2obj(a,k);l.level=d,l.label=m.label||a[k+".label"]||k,l.edit=m.edit||a[k+".edit"]||!1,l.dontDisplayEdit=!h(e,k),l.visible=m.visible||a[k+".visible"]||!1,l.dontDisplayVisible=!h(f,k),m.type||a[k+".type"]||"icon"!=k&&"image"!=k||(m.type="image"),l.type=m.type||a[k+".type"]||"text",l.source="config";var n="config.styles["+d+"]";g&&(n="config",l.isRootConfigNotStyle=!0),l.parentObj={rawNode:a,name:n},a[k+".dm_props"]=m;for(var o in l)("label"==o||!l.dontDisplayEdit&&"edit"==o||!l.dontDisplayVisible&&"visible"==o||"type"==o)&&(m[o]=l[o]);l.prop=m}}};l(e.styles[d],["icon","image"]),e.setColumns2node&&e.setColumns2node[d]&&e.setColumns2node[d].forEach(function(a){var b;if(a<e.columnNames.length&&(b=e.columnNames[a]),!j[b]){var c={};j[b]=c,c.level=d,c.label=b,c.edit=!1,c.visible=!1,c.type="text",c.source="CSV column"}}),e.aggregate&&e.aggregate.forEach(function(a){if(!j[a.name]){var b={};j[a.name]=b,b.level=d,b.label=a.label||a.name,b.edit=a.edit||!1,b.visible=a.visible||!1,b.type=a.type||"text",b.source="aggregation";for(var c in b)"level"!=c&&(a[c]=b[c]||a[c]);b.prop=a}}),e.displayProps&&e.displayProps[d]&&e.displayProps[d].children&&e.displayProps[d].children.forEach(function(a){k(a,!0,e.displayProps[d].edit)}),l(e.styles[d],null,["name","level","icon","image"],!0,["backgroundImage"]),e&&f&&l(e,null,["aggregate","displayProps","setColumns2node","styles"],!0,["backgroundImage"],f)}var m=function(b,c){var c=c;if(c.indexOf(".level")>0?c=c.substring(0,c.indexOf(".level")):c.indexOf(".edit")>0?c=c.substring(0,c.indexOf(".edit")):c.indexOf(".visible")>0?c=c.substring(0,c.indexOf(".visible")):c.indexOf(".label")>0?c=c.substring(0,c.indexOf(".label")):c.indexOf(".type")>0?c=c.substring(0,c.indexOf(".type")):c.indexOf(".source")>0?c=c.substring(0,c.indexOf(".source")):c.indexOf(".dm_props")>0&&(c=c.substring(0,c.indexOf(".dm_props"))),!j[c]){var e=a.rawNode[c+".dm_props"];return e||(e={}),j[c]=e,e.name=e.name||c,e.level=e.level||a.rawNode[c+".level"]||d,j[c+".level"]=e.level,e.label=e.label||a.rawNode[c+".label"]||c,j[c+".label"]=e.label,e.edit=e.edit||a.rawNode[c+".edit"],j[c+".edit"]=e.edit,e.visible=e.visible||a.rawNode[c+".visible"],j[c+".visible"]=e.visible,e.type=e.type||a.rawNode[c+".type"]||"text",j[c+".type"]=e.type,e.source=e.source||a.rawNode[c+".source"]||"user",j[c+".source"]=e.source,e
}};if(g){var n;for(var o in j)n=j[o],"__dm_uniqueId"!=o&&dm_Datamap.propEdit(n.parentObj||a,c,e,!1,n.level,o,n.label,n.edit,n.visible,n.type,n.source,n.prop||n,n.dontDisplayEdit,n.dontDisplayVisible,n.isRootConfigNotStyle)}else if(a.rawNode){var n;for(var p in a.rawNode)if(!j[p]&&"_dm_uniqueId"!=p){var q=!1,r=p.indexOf("."),s=p;r>0&&(s=p.substring(0,r),a.rawNode[s]&&(q=!0)),q||(n=m(a.rawNode,p),n&&dm_Datamap.propEdit(a,c,e,!1,n.level,n.name,n.label,n.edit,n.visible,n.type,n.source,null,n.dontDisplayEdit,n.dontDisplayVisible))}}dm_Datamap.nodeEditing=!0},dm_Datamap.propEdit=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var b=b,d=d||!1,e=e,f=f,p=dm_Tools.formatJSVarName(f),g=g,h=h||!1,i=i||!1,j=j||"text",k=k||"user",l=l||dm_Tools.prop2obj(a,f),q=a?a.rawNode?a.rawNode[f]:a[f]:null,r="dontRemoveNodeValue";("icon"==f||"image"==f)&&(j="image"),"connectedTo"==f&&(j="transverse link"),"dm_sourceFile"==f&&(j="file");var s,t,u,v,w,x,y,z,A=b.append("div").attr("id","attributeEditParams-"+p).style("margin-bottom","25px").style("padding","4px").style("border-width","1.5px").style("border-color","white").style("border-style","solid").style("border-radius","6px").style("background","rgba(255,255,255,0.4)").style("box-shadow","5px 5px 5px #888888"),B=function(a,b){for(var d=null,e=0;!d&&e<a.length;e++){var f,g=a[e];g<c.columnNames.length&&c.columnNames[g],b==f&&(d=e)}return d},C=function(){d||(g=t.property("value"),h=u?u.property("checked"):!1,i=v?v.property("checked"):!1,j=w.property("value"),k=null,x&&(k=x.property("value")),"image"==j&&(q=l.imageName||q))},D=function(){var b,g;if(displayPropIdx=null,aggregateIdx=null,!d){if(C(),x&&(selectedSource=x.property("value")),selectedSource&&c.setColumns2node){var h=c.setColumns2node[e];h&&(b=B(h,selectedSource),null!=b&&h.splice(b,1))}if(c.styles){var i=c.styles[e];if(i){b=null,delete i[f];for(var j in i)0==j.indexOf(f+".")&&delete i[j]}}if(c.displayProps){var k=c.displayProps[e];if(k&&(k=k.children),k){b=null;for(var g=0;!b&&g<k.length;g++)f==k[g].name&&(b=g);null!=b&&(displayPropIdx=b,k.splice(b,1))}}if(c.aggregate){b=null;for(var g=0;null==b&&g<c.aggregate.length;g++){var l=c.aggregate[g];l.name==f&&(b=g)}null!=b&&(c.aggregate.splice(b,1),aggregateIdx=b)}if(a.rawNode){!r&&a.rawNode[f]&&delete a.rawNode[f],a.rawNode[f+".dm_props"]&&delete a.rawNode[f+".dm_props"];for(var m in a.rawNode)0==m.indexOf(f+".")&&delete a.rawNode[m]}return{displayPropIdx:displayPropIdx,aggregateIdx:aggregateIdx}}},E=function(a){a&&(C(),console.log("dm_Datamap setAttrObj on : "+a.name),a.name=f,a.label=g,a.edit=h,a.visible=i,a.type=j,a.source=k)},F=function(b,d){C();var g=function(a){return{name:0==a?"root":"level "+a,children:[]}},h={};if("config"==k)if(o)c[f]=q,c[f+".dm_props"]=l,a.rawNode=c,h=c[f+".dm_props"];else{var i=null;c.styles||(c.styles=[]);for(var j=c.styles.length;e>=j;j++)c.styles[j]={};i=c.styles[e],i[f]=q,i[f+".dm_props"]=l,a.rawNode=i,h=i[f+".dm_props"]}if("aggregation"==k){var m=null;c.aggregate||(c.aggregate=[]);for(var j=0;null==m&&j<c.aggregate.length;j++){var n=c.aggregate[j];n.name==f&&(m=n)}m?h=m:d>=0?c.aggregate.splice(d,0,h):c.aggregate.push(h)}var p=d3.selectAll("#attributesEditMode").property("value")==dm_Datamap.attributesEditMode_allNodesOfSameLevel;if(p&&"user"!=k&&"config"!=k){var r,s=c.displayProps||(c.displayProps=[]);if(s.length<e)for(var j=s.length;e>=j;j++)s.push(g(j));s[e]||(s[e]=g(e)),s[e].children||(s[e].children=[]);var t=dm_Tools.getChild(s[e],f);if(t)"aggregation"==k?r=t:h=t;else{var u=h;"aggregation"==k&&(r={},u=r),b>=0?s[e].children.splice(b,0,u):s[e].children.push(u)}}if("user"==k){a.rawNode||(a.rawNode={}),a.rawNode[f]||(a.rawNode[f]=q);var t=a.rawNode[f+".dm_props"];t?h=t:a.rawNode[f+".dm_props"]=h}for(var v in l)h[v]=l[v];if(E(h),delete h.level,"aggregation"==k&&(delete h.edit,delete h.visible,delete h.source),"config"==k&&delete h.source,r&&E(r),"CSV column"==k){var w;if(x&&(w=x.property("value")),w){c.setColumns2node||(c.setColumns2node=[]);for(var j=c.setColumns2node.length;e>=j;j++)c.setColumns2node.push([]);var y=c.setColumns2node[e];if(y){for(var z=B(y,w),A=null,j=0;j<c.columnNames.length;j++)c.columnNames[j]==w&&(A=j);null==z&&null!=A&&y.push(A)}}}},G=function(){if(dm_Datamap.nodeEditing&&!d){console.log("update");var a=D();F(a.displayPropIdx,a.aggregateIdx)}},H=function(){s.property("value",""),d||(g="",t.property("value",g),h=!1,u&&(u.property("disabled",!1),u.property("checked",h)),i=!1,v&&(v.property("disabled",!1),v.property("checked",h)),j="text",w.property("value",j),y&&y.remove(),z&&z.remove(),k="user",x=null,P())},I=function(a,b){var b=dm_Tools.formatJSVarName(b);p=b;var c=function(a,b,c){var d=d3.select("#"+a+"-"+b);d[0][0]&&d.attr("id",a+"-"+c)};b!=a&&(c("attributeEditParams",a,b),c("attributeAdd",a,b),c("attributeRemove",a,b),c("attributeName",a,b),c("attributeLabel",a,b),c("attributeEditable",a,b),c("attributeVisible",a,b),c("attributeType",a,b),c("attributeSourceContainer",a,b),c("attributeSource",a,b),c("attributeSourceSelectContainer",a,b),c("attributeSourceSelect",a,b))},J=function(){for(var b=1;a.rawNode.hasOwnProperty("new_attribute_"+b);)b++;return"new_attribute_"+b},K=function(){var a=s.property("value");if(a!=f){a&&""!=a||(a=J());var b=D();I(f,a),f=a,F(b?b.displayPropIdx:null,b?b.aggregateIdx:null)}};d?(A.append("button").attr("id","attributeAdd").attr("class","btn btn-large btn-primary").style("padding-top","4px").style("padding-bottom","4px").style("margin-bottom","0px").append("img").attr("src","images/plus_neg.png").attr("width",24).attr("height",24).style("margin","0px").style("min-width","16px"),dm_UI_eventCallbacks.attributeAdd=function(){K(),F();var b=f,d=g,l=h,m=i,n=j,q=k;I(p,dm_Datamap.defaultNewBlankAttributeName),H(),dm_Datamap.propEdit(a,d3.select("#attributesList"),c,!1,e,b,d,l,m,n,q,null,null,null,o)}):(A.append("button").attr("id","attributeRemove-"+p).attr("class","btn btn-danger btn-large").style("padding-top","4px").style("padding-bottom","4px").style("margin-bottom","0px").append("img").attr("src","images/KO.png").attr("width",24).attr("height",24).style("margin","0px").style("min-width","16px"),dm_UI_eventCallbacks["attributeRemove-"+p]=function(){D(),d3.selectAll("#attributeEditParams-"+p).remove()});var L=A.append("form").style("display","inline").attr("class","form-inline").attr("onsubmit","return false;");if($("#attributeName-"+p).off("change"),s=L.append("input").attr("id","attributeName-"+p).style("margin-left","20px").style("width","140px").attr("type","text").attr("placeholder","name").attr("value",function(){return d?void 0:f}).on("change",function(){dm_UI_eventCallbacks.attributeAdd()}),!d){$("#attributeLabel-"+p).off("change");var t=L.append("input").attr("id","attributeLabel-"+p).style("margin-left","10px").style("width","140px").attr("type","text").attr("placeholder","label").attr("value",g).on("change",function(){G()}),M=function(){var a=w.property("value"),b=x&&"aggregation"==x.property("value");u&&v&&("graph"==a||b?(u.property("checked",!1),u.property("disabled",!0),v.property("disabled",!1)):(u.property("disabled",!1),u.property("checked")?(v.property("checked",!0),v.property("disabled",!0)):v.property("disabled",!1))),G()};m||(u=dm_Attributes.drawBoolean({name:"edit"},a,L,{parentObj:l,onChange:M})),n||(v=dm_Attributes.drawBoolean({name:"visible"},a,L,{parentObj:l,propName:f,onChange:G}));var N,O,P=function(){x||(d3.selectAll("#attributeSourceContainer-"+p).remove(),y&&y.remove(),y=L.insert("label","#attributeValue-"+p).attr("class","checkbox").style("margin-left","10px").attr("id","attributeSourceContainer-"+p).append("table").append("tr"),y.append("td").html("source:"),$("#attributeSource-"+p).off("change"),x=y.append("td").append("select").attr("id","attributeSource-"+p).style("width","100px").on("change",function(){W()}),V(x,"user",k),V(x,"CSV column",k),V(x,"aggregation",k),V(x,"config",k))},Q=function(){var b=d3.selectAll("#attributeValueDivContainer-"+p);if(b[0][0]){b.remove();var c=d3.selectAll("#attributeValueTdContainer-"+p);b=c.append("div").attr("id","attributeValueDivContainer-"+p),l.visible=i||l.visible,l.label=g||l.label,l.type=j||l.type;var d={edit:!0,noLabel:!0,propName:f,inputWidth:250};if("image"==j&&(l.imageName=l.imageName||q,l.width&&l.height||(d.leaveRawSize=!0),a.rawNode[f+".dm_props"]=l),dm_Attributes.drawAttribute(l,a,b,null,null,d,!0),"aggregation"==k){var e=S();dm_Attributes.drawJS(l,a,e,{value:l.value,edit:!0,obj4value:l,prop4value:"value"})}else if("graph"==j){var e=S();dm_Attributes.drawJS(l,a,e,{value:l.input,edit:!0,obj4value:l,prop4value:"input"})}}},R=function(){N&&N[0][0].remove(),N=L.append("label").attr("class","checkbox").attr("id","attributeValue-"+p).style("padding-top","0px").style("margin-left","10px");var a=N.append("table").append("tr");a.append("td").append("div").html("Value:"),a.append("td").attr("id","attributeValueTdContainer-"+p).append("div").attr("id","attributeValueDivContainer-"+p),Q()},S=function(){O&&O[0][0].remove(),O=L.append("label").attr("class","checkbox").attr("id","attributeAggreg-"+p).style("padding-top","0px").style("margin-left","10px").style("margin-right","10px").style("width","100%");var a=O.append("table").style("width","100%").append("tr"),b=a.append("td").attr("id","attributeAggregTdContainer-"+p).append("div").attr("id","attributeAggregDivContainer-"+p).style("margin-right","10px");return b},T=function(){var a=w.property("value");"graph"==a?(y&&y.remove(),z&&z.remove(),x=null):x||P(),M(),R()},U=L.append("label").attr("class","checkbox").style("margin-left","10px").append("table").append("tr");U.append("td").html("type:"),$("#attributeType-"+p).off("change"),w=U.append("td").append("select").attr("id","attributeType-"+p).style("width","100px").on("change",function(){T()});var V=function(a,b,c){var d=a.append("option");d.html(b),c==b&&d.attr("selected","true")};V(w,"action",j),V(w,"boolean",j),V(w,"dropdown",j),V(w,"file",j),V(w,"graph",j),V(w,"image",j),V(w,"javascript",j),V(w,"music",j),V(w,"rich text",j),V(w,"text",j),V(w,"transverse link",j),T();var W=function(){d3.selectAll("#attributeSourceSelectContainer-"+p).remove(),z&&z.remove();var a=x.property("value");if("CSV column"==a){z=L.insert("label","#attributeValue-"+p).attr("id","attributeSourceSelectContainer-"+p).attr("class","checkbox").style("margin-left","10px").append("table").append("tr"),z.append("td").html("source select:");var b=z.append("td").append("select").attr("id","attributeSourceSelect-"+p).style("width","160px");c.columnNames&&c.columnNames.forEach(function(a){var c=b.append("option");c.html(a),f==a&&c.attr("selected","true")})}k!=a&&(r=null),M(),r="dontRemoveNodeValue"};"graph"!=j?(P(),W()):M()}},dm_3D.currentRunning3Dobjs=[],dm_3D.freeze=function(a){a?a.freeze():dm_3D.currentRunning3Dobjs.forEach(function(a){a.freeze()})},dm_3D.unfreeze=function(a){a?a.unfreeze():dm_3D.currentRunning3Dobjs.forEach(function(a){a.unfreeze()})},dm_3D.reset=function(a){if(a){a.reset();var b=dm_3D.currentRunning3Dobjs.indexOf(a);b>=0&&dm_3D.currentRunning3Dobjs.splice(b,1)}else dm_3D.currentRunning3Dobjs.forEach(function(a){a.reset()}),dm_3D.currentRunning3Dobjs=[]},dm_3D.draw=function(a,b,c){var d=new dm_3D;return d.draw(a,b,c),d},dm_3D.reScale=function(a,b,c){if(c){var d=Math.min(a,b);c.obj=dm_3D.transformPoints(c.obj,function(a){return dm_3D.mat4xVec3(dm_3D.scale(d/c.scaleValue),a)}),c.scaleValue=d,c.refreshDraw()}},dm_3D.toRadian=function(a){return a*Math.PI/180},dm_3D.toDegree=function(a){return 180*a/Math.PI},dm_3D.mat4xVec3=function(a,b){var c=b[0],d=b[1],e=b[2],f=[0,0,0,0];return f[0]=a[0]*c+a[1]*d+a[2]*e+a[3],f[1]=a[4]*c+a[5]*d+a[6]*e+a[7],f[2]=a[8]*c+a[9]*d+a[10]*e+a[11],f},dm_3D.cloneVec3=function(a){var b=[0,0,0];return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},dm_3D.mat4xMat4=function(a,b){var c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=a[0],u=a[1],v=a[2],w=a[3];return c[0]=t*d+u*h+v*l+w*p,c[1]=t*e+u*i+v*m+w*q,c[2]=t*f+u*j+v*n+w*r,c[3]=t*g+u*k+v*o+w*s,t=a[4],u=a[5],v=a[6],w=a[7],c[4]=t*d+u*h+v*l+w*p,c[5]=t*e+u*i+v*m+w*q,c[6]=t*f+u*j+v*n+w*r,c[7]=t*g+u*k+v*o+w*s,t=a[8],u=a[9],v=a[10],w=a[11],c[8]=t*d+u*h+v*l+w*p,c[9]=t*e+u*i+v*m+w*q,c[10]=t*f+u*j+v*n+w*r,c[11]=t*g+u*k+v*o+w*s,t=a[12],u=a[13],v=a[14],w=a[15],c[12]=t*d+u*h+v*l+w*p,c[13]=t*e+u*i+v*m+w*q,c[14]=t*f+u*j+v*n+w*r,c[15]=t*g+u*k+v*o+w*s,c},dm_3D.identity=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},dm_3D.isSamePoints=function(a,b){return!(a[0]!=b[0]&&(a[0]&&!isNaN(a[0])||b[0]&&!isNaN(b[0]))&&0!=Math.abs(Math.round(a[0]-b[0]))||a[1]!=b[1]&&(a[1]&&!isNaN(a[1])||b[1]&&!isNaN(b[1]))&&0!=Math.abs(Math.round(a[1]-b[1]))||a[2]!=b[2]&&(a[2]&&!isNaN(a[2])||b[2]&&!isNaN(b[2]))&&0!=Math.abs(Math.round(a[2]-b[2])))},dm_3D.rotateEuler=function(a,b,c){var d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=dm_3D.toRadian(a),b=dm_3D.toRadian(b),c=dm_3D.toRadian(c),e=Math.cos(a),f=Math.sin(a),g=Math.cos(b),h=Math.sin(b),i=Math.cos(c),j=Math.sin(c),k=e*h,l=f*h;return d[0]=g*i,d[1]=-g*j,d[2]=h,d[3]=0,d[4]=l*i+e*j,d[5]=-l*j+e*i,d[6]=-f*g,d[7]=0,d[8]=-k*i+f*j,d[9]=k*j+f*i,d[10]=e*g,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d},dm_3D.scalarAddVector=function(a,b){return[b[0]+a,b[1]+a,b[2]+a]},dm_3D.vectorAdd=function(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]},dm_3D.vectorSubstract=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]},dm_3D.vectorInverse=function(a){return[1/a[0],1/a[1],1/a[2]]},dm_3D.scalarXVector=function(a,b){return[a*b[0],a*b[1],a*b[2]]},dm_3D.vectorLength=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])},dm_3D.normalizeVector=function(a){var b=dm_3D.vectorLength(a);return[a[0]/b,a[1]/b,a[2]/b]},dm_3D.angle2vectors=function(a,b){var c=dm_3D.vectorLength(a),d=dm_3D.vectorLength(b),e=a[0]*b[0]+a[1]*b[1]+a[2]*b[2];return Math.acos(e/(c*d))},dm_3D.crossVector=function(a,b){var c=a[1]*b[2]-a[2]*b[1],d=a[2]*b[0]-a[0]*b[2],e=a[0]*b[1]-a[1]*b[0];return[c,d,e]},dm_3D.dotVector=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},dm_3D.normalOfTriangle=function(a){var b=a[0],c=a[1],d=a[2],e=[c[0]-b[0],c[1]-b[1],c[2]-b[2]],f=[d[0]-b[0],d[1]-b[1],d[2]-b[2]],g=dm_3D.crossVector(e,f);return dm_3D.normalizeVector(g)},dm_3D.triangleAngle=function(a){var b=dm_3D.normalOfTriangle(a),c=dm_3D.angle2vectors(b,[0,0,-1]);return c},dm_3D.scale=function(a){return[a,0,0,0,0,a,0,0,0,0,a,0,0,0,0,1]},dm_3D.translate=function(a,b,c){return[1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1]},dm_3D.insideTriangle=function(a,b){var c=b[2]-b[0],d=b[1]-b[0],e=a-b[0],f=dm_3D.dotVector(c,c),g=dm_3D.dotVector(c,d),h=dm_3D.dotVector(c,e),i=dm_3D.dotVector(d,d),j=dm_3D.dotVector(d,e),k=1/(f*i-g*g),l=(i*h-g*j)*k,m=(f*j-g*h)*k;return l>=0&&m>=0&&1>l+m},dm_3D.centerObj=function(a,b){for(var c,d=Number.MAX_VALUE,e=Number.MAX_VALUE,f=Number.MAX_VALUE,g=-Number.MAX_VALUE,h=-Number.MAX_VALUE,i=-Number.MAX_VALUE,j=a.length-1;j>=0;j--){c=a[j];for(var k,l=c.length,m=0;l>m;m++)k=c[m],3>m&&(k[0]<d&&(d=k[0]),k[0]>g&&(g=k[0]),k[1]<e&&(e=k[1]),k[1]>h&&(h=k[1]),k[2]<f&&(f=k[2]),k[2]>i&&(i=k[2]))}var n=g-d,o=h-e,p=i-f;return b&&(b[0]=n,b[1]=o,b[2]=p),dm_3D.translate(-(d+n/2),-(e+o/2),-(f+p/2))},dm_3D.centerAndNormalizeObj=function(a){var b=[],c=dm_3D.centerObj(a,b),d=Math.max(Math.max(b[0],b[1]),b[2]);return dm_3D.mat4xMat4(dm_3D.scale(1/d),c)},dm_3D.intersectDroites2D=function(a,b,c,d){var e=(d[1]*(c[0]-a[0])+d[0]*(a[1]-c[1]))/(b[0]*d[1]-d[0]*b[1]);return[a[0]+e*b[0],a[1]+e*b[1]]},dm_3D.type_triangle=1,dm_3D.type_point=2,dm_3D.triangle=function(a,b,c,d){a.push([b,c,d,null,"#808080",dm_3D.type_triangle])},dm_3D.isTriangle=function(a){return a[a.length-1]==dm_3D.type_triangle},dm_3D.point=function(a,b,c,d){a.push([b,c,d,dm_3D.type_point])},dm_3D.isPoint=function(a){return a[a.length-1]==dm_3D.type_point},dm_3D.pie=function(a){var b=9*Math.PI/180,c=0*Math.PI/180,d=.2,e=1.3;8*Math.PI/180;for(var f,g,h,i,j,k,l,m,n=0,o=0,p=0,q=[],r=a.length,s=0;r>s;s++)m=a[s],n+=m;for(var t=function(a,b,f,k,l){var f=f||[];return g=Math.sin(a),h=Math.cos(a),"end"!=l&&(b+=c),i=Math.sin(b),j=Math.cos(b),f.push([[0,0,0],[g,h,0],[i,j,0]]),f.push([[g,h,0],[g,h,d],[i,j,d]]),f.push([[i,j,d],[i,j,0],[g,h,0]]),f.push([[0,0,d],[i,j,d],[g,h,d]]),e>1&&("start"==k&&(f.push([[0,0,0],[0,0,d],[g,h,d]]),f.push([[g,h,d],[g,h,0],[0,0,0]])),"end"==l&&(f.push([[0,0,d],[0,0,0],[i,j,0]]),f.push([[i,j,0],[i,j,d],[0,0,d]]))),f},u=0;r>u;u++){m=a[u],k=[],f=o+m*2*Math.PI/n,p=o,start="start";for(var v=o+b;f-b/2>v;v+=b)t(p,v,k,start),start=null,p=v;t(p,f,k,start,"end"),dm_3D.colorize(k,dm_Tools.colors[u]),l=(o+f)/2,k=dm_3D.transformPoints(k,function(a){return dm_3D.mat4xVec3(dm_3D.translate((e-1)*Math.sin(l),(e-1)*Math.cos(l),0),a)}),dm_3D.concateObj(q,k),o=f}return q},dm_3D.donut=function(a){for(var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=a.values,r=9*Math.PI/180,s=.2,t=4*Math.PI/180,u=.3,v=2*Math.PI/180,w=0,x=0,y=0,z=[],A=q.length,B=0;A>B;B++)w+=q[B];var C=function(a,b,c,d,e,f){var c=c||[],g=a,p=b;return"start"!=d||f||(g+=t/2),h=Math.sin(g),i=Math.cos(g),j=u*Math.sin(g),k=u*Math.cos(g),"end"!=e||f||(p-=t/2),l=Math.sin(p),m=Math.cos(p),n=u*Math.sin(p),o=u*Math.cos(p),dm_3D.triangle(c,[j,k,0],[h,i,0],[l,m,0]),dm_3D.triangle(c,[n,o,0],[j,k,0],[l,m,0]),dm_3D.triangle(c,[j,k,s],[l,m,s],[h,i,s]),dm_3D.triangle(c,[n,o,s],[l,m,s],[j,k,s]),dm_3D.triangle(c,[h,i,0],[h,i,s],[l,m,s]),dm_3D.triangle(c,[l,m,s],[l,m,0],[h,i,0]),dm_3D.triangle(c,[j,k,s],[j,k,0],[n,o,0]),dm_3D.triangle(c,[n,o,0],[n,o,s],[j,k,s]),t>0&&!f&&("start"==d&&(dm_3D.triangle(c,[j,k,0],[h,i,s],[h,i,0]),dm_3D.triangle(c,[j,k,0],[j,k,s],[h,i,s])),"end"==e&&(dm_3D.triangle(c,[n,o,0],[l,m,s],[n,o,s]),dm_3D.triangle(c,[n,o,0],[l,m,0],[l,m,s]))),c},D=[],E=[],F=0,G=function(){for(var a,c=q.length,d=0;c>d;d++)b=q[d],a=b*2*Math.PI/w,e=a,v+t>a&&(e=v+t),E.push(e),F+=e;c=E.length;for(var e,d=0;c>d;d++)e=E[d],a=e*2*Math.PI/F,D.push(a)};G();for(var H,I,A=a.elts.length,J=0;A>J;J++){H=a.elts[J],b=H.value,p=[],g=x+D[J],y=x,start="start";for(var K=x+r;g-r/2>K;K+=r)C(y,K,p,start,null,1==q.length),start=null,y=K;C(y,g,p,start,"end",1==q.length),I=H.color||dm_Tools.colors[J],dm_3D.colorize(p,I);var L=(x+g)/2,c=H.valueStr||dm_Tools.convertNumber(b);a.displayNames&&a.displayUnits?(d=H.name,e=c,f=H.unit):a.displayNames?(d=H.name,e=c):a.displayUnits?(e=c,f=H.unit):e=c,dm_3D.point(z,[Math.sin(L),Math.cos(L),s/2],[Math.sin(L),Math.cos(L),0],{color:I,valueIdx:J,value:b,label:d,valueStr:e,unit:f}),dm_3D.concateObj(z,p),x=g}return z},dm_3D.strMat4=function(a){for(var b="\n",c=0;4>c;c++){for(var d=0;4>d;d++)b+=a[4*c+d],3>d&&(b+=" ");3>c&&(b+="\n")}return b},dm_3D.projPoint=function(a){var b=a[0],c=a[1],d=a[2],e=-180,f=-500,g=[b*(e-f)/(d-f),c*(e-f)/(d-f),e];return g},dm_3D.transformPoints=function(a,b){for(var c,d=[],e=a.length,f=0;e>f;f++){c=a[f];var g=[];if(dm_3D.isTriangle(c))for(var h,i=c.length,j=0;i>j;j++)h=c[j],3>j?g.push(b(h)):g.push(h);else if(dm_3D.isPoint(c))for(var h,i=c.length,j=0;i>j;j++)h=c[j],2>j?g.push(b(h)):g.push(h);d.push(g)}return d},dm_3D.concateObj=function(a,b){for(var c,a=a||[],d=b.length,e=0;d>e;e++)c=b[e],a.push(c);return a},dm_3D.colorize=function(a,b){for(var c,d=a.length-1;d>=0;d--){c=a[d];for(var e=c.length;4>=e;e++)c.push(null);c[4]=b}},dm_3D.compareZ=function(a,b){var c=0,d=function(a){var b;return dm_3D.isTriangle(a)?b=Math.min(Math.min(a[0][2],a[1][2]),a[2][2]):dm_3D.isPoint(a)&&(b=a[0][2]),b},e=d(a),f=d(b);if(c=e==f?0:f>e?1:-1,0==c){var g=function(a){var b;return dm_3D.isTriangle(a)?b=a[3]:dm_3D.isPoint(a)&&(b=a[1]?dm_3D.angle2vectors(dm_3D.normalizeVector(a[1]),[0,0,-1]):Math.PI),b},h=g(a),i=g(b);c=h==i?0:i>h?1:-1}return c},dm_3D.cube=[[[0,0,0],[1,1,0],[1,0,0]],[[0,0,0],[0,1,0],[1,1,0]],[[0,0,0],[0,1,1],[0,1,0]],[[0,0,0],[0,0,1],[0,1,1]],[[1,0,0],[1,1,0],[1,1,1]],[[1,0,0],[1,1,1],[1,0,1]],[[0,0,1],[1,0,1],[1,1,1]],[[0,0,1],[1,1,1],[0,1,1]],[[0,1,0],[0,1,1],[1,1,1]],[[0,1,0],[1,1,1],[1,1,0]],[[0,0,0],[1,0,1],[0,0,1]],[[0,0,0],[1,0,0],[1,0,1]]],dm_3D.drawObj=function(a,b,c,d,e,f){for(var g,h,i,j,k,l,m,n,o=!1,p=10,q=1,a=a,r=parseInt(b.attr("width")),s=parseInt(b.attr("height")),t=[],u=a.length,v=0;u>v;v++)n=a[v],dm_3D.isTriangle(n)?n[3]=dm_3D.triangleAngle(n):dm_3D.isPoint(n)&&t.push(n);a.sort(dm_3D.compareZ),a=dm_3D.transformPoints(a,function(a){return dm_3D.projPoint(a)});var w,x,g;if("svg"==d){b.selectAll("#"+c).remove();var y=b.append("g").attr("id",c)}else e.clearRect(0,0,r,s);var g,z,A,B,C,D,E=function(a,b){return Math.round(r/2+a[b][0])},F=function(a,b){return Math.round(s/2-a[b][1])},G=.6,H={x:0,y:0},I={x:0,y:0},J={x:0,y:0},K={x:0,y:0},L=[],M=[];t.sort(function(a,b){return a[2].valueIdx<b[2].valueIdx?-1:1});for(var N,O,P,Q,R,S,u=t.length,v=0;u>v;v++){S=t[v];var T;S[0][0]>.1?(S[2].isRight=!0,S[2].isLeft=!1,T="right"):S[0][0]<-.1?(S[2].isRight=!1,S[2].isLeft=!0,T="left"):T=S[2].isLeft?"left":"right",R&&T!=R&&("left"==R&&(O=v-1),"right"==R&&(Q=v-1),"left"==T&&(N=v),"right"==T&&(P=v)),v==t.length-1&&(null==O&&null==P&&(O=v,P=0),null==Q&&null==N&&(Q=v,N=0)),R=T}var U=function(a,b,c,d){var b=b;if(b>c)for(var e=b;e<d.length;e++)a.push(d[e]),b=0;for(var e=b;c>=e;e++)a.push(d[e])};U(L,N,O,t),U(M,P,Q,t);var V=function(a){a&&a.length>0&&a[0][0][1]<a[a.length-1][0][1]&&a.reverse()};V(L),V(M);for(var S,W=function(a,b,c){var d=s/c;a[2].destY=d/2+b*d},u=L.length,v=0;u>v;v++)S=L[v],W(S,v,u);u=M.length;for(var v=0;u>v;v++)S=M[v],W(S,v,u);u=a.length;for(var n,v=0;u>v;v++)n=a[v],dm_3D.isTriangle(n)?(A=n,g=A[4]||"#808080",z=Math.min(100,-5+100*A[3]/Math.PI),w=dm_Tools.getColorInGradient(g,"#000000",z),x=dm_Tools.getColorInGradient(g,"#000000",Math.max(0,z-1)),"svg"==d?y.append("polygon").attr("fill",w).attr("stroke",o?"black":x).attr("stroke-width","1.5").attr("stroke-linejoin","bevel").attr("points",function(){for(var a="",b=0;3>b;b++)a+=E(A,b)+","+F(A,b),2>b&&(a+=" ");return a}):(e.beginPath(),e.fillStyle=w,e.moveTo(E(A,0),F(A,0)),e.lineTo(E(A,1),F(A,1)),e.lineTo(E(A,2),F(A,2)),e.fill(),e.lineWidth=1.8,e.lineJoin="bevel",e.strokeStyle=o?"black":w,e.stroke(),e.closePath())):dm_3D.isPoint(n)&&"canvas"==d&&(B=n,q=B[2].isLeft?-1:1,J.x=r/2+.9*q*f/2,J.y=B[2].destY,K.x=J.x+10*q,K.y=J.y,e.beginPath(),e.moveTo(E(B,0),F(B,0)),D=Math.abs(B[0][1]/f),C=[[B[0][0]+G*D*B[1][0],B[0][1]+G*D*B[1][1],B[0][2]]],H.x=E(C,0),H.y=F(C,0),I.x=(E(C,0)+J.x)/2,I.y=(J.y+F(C,0))/2,e.quadraticCurveTo(H.x,H.y,I.x,I.y),e.quadraticCurveTo(J.x,J.y,K.x,K.y),g=B[2].color,g=dm_Tools.getColorInGradient(g,"#000000",20),e.lineWidth=2,e.strokeStyle=g,e.stroke(),e.closePath(),e.font=""+p+"pt Calibri",e.fillStyle=g,h=K.x+2*q,i=K.y+p/2-2,j=0,m=0>q?B[2].unit:B[2].label,m&&(j=e.measureText(m).width,0>q&&(h+=q*j),dm_Tools.writeHTMLCanvasTxt(e,m,h,i,g,"rgba(255, 255, 255, 0.7)",null,5)),k=e.measureText(B[2].valueStr).width,e.beginPath(),q>0&&(h+=q*j),h+=10*q,l=p+6,e.arc(h,K.y-1,l/2,0,2*Math.PI,!1),e.arc(h+q*k,K.y-1,l/2,0,2*Math.PI,!1),e.fillStyle=g,e.fill(),e.closePath(),e.beginPath(),e.moveTo(h,K.y-1),e.lineTo(h+q*k,K.y-1),e.lineWidth=l,e.strokeStyle=g,e.stroke(),e.lineJoin="round",e.closePath(),0>q&&(h+=q*k),dm_Tools.writeHTMLCanvasTxt(e,B[2].valueStr,h,i,"white","rgba(0, 0, 0, 0.5)",null,5),q>0&&(h+=q*k),h+=10*q,m=0>q?B[2].label:B[2].unit,m&&(j=e.measureText(m).width,0>q&&(h+=q*j),dm_Tools.writeHTMLCanvasTxt(e,m,h,i,g,"white",null,5)))},dm_3D.import3ds=function(a,b){dm_3D_3dsLoader.parse(a,function(a){b&&b(a)})},dm_Physics.constants={canvasZIndexStart:10,UIContainerSelector:null,UIContainer:null,UIContainerW:0,UIContainerH:0,disableClearAll:!1,states:[],statesPerLabel:{},playing:!1,wDesignTime:1280,hDesignTime:640},dm_Physics.currentState=null,dm_Physics.defaultSystemState={label:null,points:null,previousPoints:null,objects:null,destinations:null,accelerations:null,drag:.05,relaxationNumbOfIter:1,accelFactor:5,deltaTime:20,delay:40,duration:3,sleepBefore:0,sleepAfter:0,fork:null,killAfter:null,stopLoop:null,canvas:null,canvasContext:null,savedCanvas:null,iter:0,iter2:0,raf:!0,lastDrawTime:null},dm_Physics.rotatingTargetConstants={delay:50,UIContainer:null,canvas:null,ctx:null,loop:!0,node:null,radius:null,startDrawTime:null,lastDrawTime:null,timeout:3e4,rotating:!0,finishIt:!1},dm_Physics.tick=function(a){dm_Physics.verlet(a)},dm_Physics.force=function(a,b,c,d){var e,f;return c&&(f=dm_3D.vectorSubstract(c,b),d&&(f=dm_3D.vectorAdd(dm_3D.scalarXVector(.01,f),dm_3D.vectorSubstract(b,d))),e=dm_3D.scalarXVector(a.accelFactor,f)),e},dm_Physics.verlet=function(a){var b=a.points;if(b){var c=a.destinations,d=a.objects,e=a.origs,f=a.previousPoints;f||(f=dm_Tools.deepCopy(b),a.previousPoints=f);var g=a.drag,h=a.deltaTime/1e3,i=(new Date).getTime(),j=1*(i-a.lastDrawTime),k=a.drag+.0015*j;g=a.lastDrawTime?k:a.drag;for(var l,m,n,o,p,q,r,s=.2,h=(a.lastDrawTime?(1-s)*a.deltaTime+2*s*j:a.deltaTime)/1e3,t=b.length-1;t>=0;t--)l=b[t],m=c[t],previousPoint=f[t],q=d[t],e&&(r=e[t]),q&&q.delay>0?q.delay-=a.delay:q.stopOnDest&&dm_3D.isSamePoints(l,m)||(o=dm_Physics.force(a,l,m,r),p=dm_3D.scalarXVector(h*h,o),n=dm_3D.vectorAdd(dm_3D.vectorSubstract(dm_3D.scalarXVector(2-g,l),dm_3D.scalarXVector(1-g,previousPoint)),p),b[t]=n,f[t]=l)}},dm_Physics.constraints=function(){dm_Physics.points;for(var a=0;a<dm_Physics.relaxationNumbOfIter;a++);},dm_Physics.equiPlacePoints=function(a,b,c,d){for(var e=b-a,d=d||0,f=c.length,g=e/(f-1),h=0;f>h;h++)c[h][d]=a+h*g},dm_Physics.placeChars=function(a,b,c,d,e){var f,g,h=document.createElement("canvas"),i=h.getContext("2d"),j=d-c,k=a.length;i.font=b;for(var l=0,m=0;k>m;m++)f=a[m],g=i.measureText(f).width,l+=g;for(var n=(j-l)/(k-1),o=c,m=0;k>m;m++)f=a[m],g=i.measureText(f).width,e[m][0]=o+g/2,o+=g+n},dm_Physics.text2centerLetterPoints=function(a,b,c){for(var d=dm_Physics.constants.UIContainerW,c=c||70,e=[],f=0;f<a.length;f++)e.push([0,0,0]);return dm_Physics.placeChars(a,b,-(d*c/100)/2,d*c/100/2,e),e},dm_Physics.getX=function(a,b){return Math.round(dm_Physics.constants.UIContainerW/2+b.points[a][0])},dm_Physics.getY=function(a,b){return Math.round(dm_Physics.constants.UIContainerH/2+b.points[a][1])},dm_Physics.clearAll=function(a){if(!dm_Physics.constants.disableClearAll){var a=a||dm_Physics.constants.UIContainerSelector;dm_Physics.constants.playing=!1,dm_Physics.constants.states=[],dm_Physics.constants.statesPerLabel={},$(a).children().remove(),dm_UI.resizeBodyCanvas(a)}},dm_Physics.clearCanvas=function(a){a.canvasContext&&a.canvasContext.clearRect(0,0,dm_Physics.constants.UIContainerW,dm_Physics.constants.UIContainerH)},dm_Physics.addState=function(a){var b=dm_Tools.deepCopy(dm_Physics.defaultSystemState);return b.label=a,dm_Physics.constants.states.push(b),a&&(dm_Physics.constants.statesPerLabel[a]=b),b},dm_Physics.addCanvas=function(a){var b=document.createElement("canvas"),c="bodyCanvas_layer_"+dm_Physics.constants.states.length;a&&(c=a),b.setAttribute("id",c),b.width=dm_Physics.constants.UIContainerW,b.height=dm_Physics.constants.UIContainerH,b.setAttribute("style","position:absolute; z-index:"+(dm_Physics.constants.canvasZIndexStart+dm_Physics.constants.states.length)+"; pointer-events: none;");var d=dm_Physics.addState(a);return d.canvas=b,d.canvasContext=b.getContext("2d"),dm_Physics.constants.UIContainer.appendChild(b),dm_Physics.currentState=d,d},dm_Physics.resize=function(){var a=dm_Physics.constants.UIContainerW,b=dm_Physics.constants.UIContainerH,c=parseInt(d3.selectAll(dm_Physics.constants.UIContainerSelector).attr("width")),d=parseInt(d3.selectAll(dm_Physics.constants.UIContainerSelector).attr("height"));if(c!=a||d!=b){dm_Physics.constants.UIContainerW=c,dm_Physics.constants.UIContainerH=d;for(var e,f=dm_Physics.constants.states.length-1;f>=0;f--)e=dm_Physics.constants.states[f],e.canvas&&(e.canvas.width=c,e.canvas.height=d)}},dm_Physics.loop=function(a,b,c,d){if(c&&!(dm_Physics.constants.states.indexOf(c)<0)){var e=function(){a&&a(),dm_Datamap.currentDatamap.graph.freeze=!1,c.killAfter&&setTimeout(function(){c.canvas.remove()},100)};if(c.stopLoop)return e(),void 0;if(dm_Physics.resize(),c.sleepBefore){var f=c.sleepBefore;return c.sleepBefore=0,setTimeout(function(){dm_Physics.loop(a,b,c,d)},f),void 0}var d=d;null==d&&(d=!0),d&&(c.previousPoints=null,c.iter=0),-1==c.duration&&(c.duration=-2,c.fork=!0),c.fork&&(c.fork=null,a&&a());var g=1e3*c.duration/c.delay;if(c.duration<0||c.iter<g)c.iter+1>=g&&(c.isLastIter=!0),b&&b(c),c.iter++,c.iter2++,1==c.raf?(c.lastDrawTime=(new Date).getTime(),requestAnimationFrame(function(){dm_Physics.loop(a,b,c,!1)})):(c.lastDrawTime=(new Date).getTime(),setTimeout(function(){requestAnimationFrame(function(){dm_Physics.loop(a,b,c,!1)})},c.delay));else if(c.sleepAfter){var f=c.sleepAfter;c.sleepAfter=0,c.lastDrawTime=(new Date).getTime(),setTimeout(function(){e()},f)}else e()}},dm_Physics.drawObjects=function(a){var b=a.canvasContext;if(a.objects)for(var c,d,e,f,g=a.points.length-1;g>=0;g--)if(c=dm_Physics.getX(g,a),d=dm_Physics.getY(g,a),f=a.objects[g],d+=f.yOffset||0,c+=f.xOffset||0,f.text&&(e=f.text,b.font=f.font,c-=b.measureText(f.text).width/2,dm_Tools.writeHTMLCanvasTxt(b,e,c,d,f.color,f.shadowColor,f.shadowLineWidth,f.blurDistance)),f.image||f.imgData){var i=function(){w=f.width||f.imgData.width,h=f.height||f.imgData.height,w-=f.clipX||0,f.clipW&&(w=f.clipW),h-=f.clipY||0,f.clipH&&(h=f.clipH),w*=f.scaleW||1,h*=f.scaleH||1,c-=w/2,d-=h/2,f.width||f.height||f.scaleW||f.scaleH?f.clipX||f.clipY||f.clipW||f.clipH?b.drawImage(f.imgData,f.clipX,f.clipY,f.clipW,f.clipH,c,d,w,h):b.drawImage(f.imgData,c,d,w,h):b.drawImage(f.imgData,c,d)};f.imgData?i():(f.imgData=new Image,f.imgData.src=f.image,f.imgData.onload=function(){i()})}},dm_Physics.setEngineParams=function(a,b){if(a)for(var c in dm_Physics.defaultSystemState)a[c]&&(b[c]=a[c])},dm_Physics.getStateFromArgs=function(a){var b;return a&&(a.canvasIdx?b=dm_Physics.constants.states[a.canvasIdx]:a.stateLabel&&(b=dm_Physics.constants.statesPerLabel[a.stateLabel])),b},dm_Physics.getStateFromLabel=function(a){return dm_Physics.constants.statesPerLabel[a]},dm_Physics.saveCanvas=function(a,b){var c=dm_Physics.getStateFromLabel(a),d=c;if(b&&(d=dm_Physics.getStateFromLabel(b)),d){var e=document.createElement("canvas");e.width=c.canvas.width,e.height=c.canvas.height;var f=e.getContext("2d");f.drawImage(c.canvas,0,0),d.savedCanvas||(d.savedCanvas={}),d.savedCanvas[a]=e}},dm_Physics.restoreCanvas=function(a,b){if(a.savedCanvas){var c=dm_Physics.getStateFromLabel(b)||a;dm_Physics.clearCanvas(c),c.canvasContext.drawImage(a.savedCanvas[b],0,0)}},dm_Physics.fade=function(a,b){b||(b={});var c=b.opacity||.6,d=b.r||0,e=b.g||0,f=b.b||0,g=b.sens||"in",h=dm_Physics.getStateFromArgs(b);h||(h=dm_Physics.addCanvas(b.stateLabel)),h.delay=20,h.raf=!1,h.duration=.6,dm_Physics.setEngineParams(b,h);var i=function(a){dm_Physics.clearCanvas(a),a.canvasContext.beginPath(),a.canvasContext.rect(0,0,dm_Physics.constants.UIContainerW,dm_Physics.constants.UIContainerH);var b=c*(a.iter+1)*a.delay/(1e3*a.duration);"out"==g&&(b=c-c*(a.iter+1)*a.delay/(1e3*a.duration));var h=a.canvasContext.createLinearGradient(0,dm_Physics.constants.UIContainerH,dm_Physics.constants.UIContainerW,0);h.addColorStop(0,"rgba("+d+", "+e+", "+f+", "+Math.max(0,Math.min(1,b+.3))+")"),h.addColorStop(1,"rgba("+d+", "+e+", "+f+", "+Math.max(0,Math.min(1,b-.3))+")"),a.canvasContext.fillStyle=h,a.canvasContext.fill(),a.canvasContext.closePath()};dm_Physics.loop(a,i,h)},dm_Physics.textEntrance1=function(a,b){var c=dm_Physics.addCanvas(b.stateLabel);c.drag=.15,c.relaxationNumbOfIter=1,c.accelFactor=5,c.delay=25,c.deltaTime=50,c.duration=2,c.points=[],c.objects=[];var d,e=b.txt2display.length,f=2*Math.PI/e,g=900,h=b.fontSize||80,i=Math.min(dm_UI_getWidth()/dm_Physics.constants.wDesignTime,dm_UI_getBodyHeight()/dm_Physics.constants.hDesignTime);h*=i;for(var j,k,l=b.fontName||"Palatino",m=""+h+"pt "+l,n=b.textColor||"#9467bd",o=b.charColors,p=n,q=0;e>q;q++)k=b.txt2display[q],j=h/3,0==q?d=f/2:d+=f,c.points.push([g*Math.cos(d-Math.PI),g*Math.sin(d-Math.PI),0]),o&&(p=o[q]),c.objects.push({text:k,font:m,shadowColor:"rgba(255, 255, 255, 0.8)",shadowLineWidth:Math.max(3,5*i),color:p,yOffset:j,blurDistance:20});c.destinations=dm_Physics.text2centerLetterPoints(b.txt2display,m,null,c.objects),dm_Physics.setEngineParams(b,c);
var r=function(a){dm_Physics.tick(a),dm_Physics.clearCanvas(a),dm_Physics.drawObjects(a)};dm_Physics.loop(a,r,c)},dm_Physics.randomTxtBlur=function(a,b){var c=dm_Physics.getStateFromArgs(b)||dm_Physics.currentState;c.delay=80,c.duration=-1,dm_Physics.setEngineParams(b,c);var d=function(a){if(a){if(dm_Physics.clearCanvas(a),a.objects)for(var b,c,d=a.points.length-1;d>=0;d--)b=a.objects[d],b.text&&(b.blurMax||(b.blurMax=3*b.blurDistance),b.blurMin||(b.blurMin=b.blurDistance/3),c=(Math.random()-.5)*b.blurMin,b.blurDistance=Math.max(b.blurMin,Math.min(b.blurMax,b.blurDistance+c)));dm_Physics.drawObjects(a)}};dm_Physics.loop(a,d,c)},dm_Physics.translate=function(a,b){var c=dm_Physics.getStateFromArgs(b)||dm_Physics.currentState;c.delay=25,c.duration=1,c.destinations=[];for(var d,e,f,g,h=0;h<c.points.length;h++)d=c.points[h],f=d[0],g=d[1],b.xPercent&&(f=dm_Physics.constants.UIContainerW*b.xPercent/100-dm_Physics.constants.UIContainerW/2),b.yPercent&&(g=dm_Physics.constants.UIContainerH*b.yPercent/100-dm_Physics.constants.UIContainerH/2),c.destinations.push([f,g]),b.delayPerSlice&&(c.objects||(c.objects=new Array(c.points.length)),e=c.objects[h],e||(e={},c.objects[h]=e),e.delay=h*b.delayPerSlice);b.smooth&&(c.origs=dm_Tools.deepCopy(c.points)),dm_Physics.setEngineParams(b,c);var i=function(a){dm_Physics.tick(a),dm_Physics.clearCanvas(a),dm_Physics.drawObjects(a)};c.iter=0,dm_Physics.loop(a,i,c)},dm_Physics.cutImage=function(a,b){var b=b||{},c=b.cutNb||10,d=b.from||[b.splitX?-2*dm_Physics.constants.UIContainerW:0,b.splitY?-2*dm_Physics.constants.UIContainerH:0],e=b.to||[0,-.1*dm_Physics.constants.UIContainerH],f=new Image;f.src=b.image||"images/freeDatamapLogo.png",f.onload=function(){var g=dm_Physics.addCanvas(b.stateLabel);g.drag=.2,g.relaxationNumbOfIter=1,g.accelFactor=5,g.delay=25,g.deltaTime=50,g.duration=4,g.points=[],g.objects=[],g.destinations=[];var h=b.scaleW||1,i=b.scaleH||1,j=dm_Physics.constants.wDesignTime-f.width*h,k=dm_Physics.constants.hDesignTime-f.height*i,l=dm_UI_getWidth()/dm_Physics.constants.wDesignTime*j,m=dm_UI_getBodyHeight()/dm_Physics.constants.hDesignTime*k,n=(dm_UI_getWidth()-l)/(f.width*h),o=(dm_UI_getBodyHeight()-m)/(f.height*i),p=(n+o)/2;h*=p,i*=p;for(var q,r,s,t,u,v=b.delayPerSlice||180,w=0;c>w;w++)g.points.push([b.splitX?d[0]-100*(c-w-1):d[0],b.splitY?d[1]-100*(c-w-1):d[1]]),q=0,b.splitX&&(q=w*f.width/c,q>0&&(q-=1/h)),s=f.width,b.splitX&&(s=f.width/c,s<f.width&&(s+=1/h)),r=0,b.splitY&&(r=w*f.height/c,r>0&&(r-=1/i)),t=f.height,b.splitY&&(t=f.height/c,t<f.height&&(t+=1/i)),u="out"==b.sens?v*w:v*(c-1-w),g.objects.push({imgData:f,scaleW:h,scaleH:i,clipX:q,clipW:s,clipY:r,clipH:t,delay:u}),g.destinations.push([b.splitX?e[0]-h*f.width/2+(w+.5)*(h*f.width/c):e[0],b.splitY?e[1]-i*f.height/2+(w+.5)*(i*f.height/c):e[1]]);if("out"==b.sens){var x=g.destinations;g.destinations=g.points,g.points=x,g.origs=dm_Tools.deepCopy(g.points)}dm_Physics.setEngineParams(b,g);var y=function(a){dm_Physics.tick(a),dm_Physics.clearCanvas(a),a.isLastIter&&"out"!=b.sens&&(a.points=[e],a.objects=[{imgData:f,scaleW:h,scaleH:i}]),dm_Physics.drawObjects(a)};dm_Physics.loop(a,y,g)}},dm_Physics.sun=function(a,b){var b=b||{},c=dm_Physics.getStateFromLabel(b.compositeOnState),d=dm_Physics.getStateFromArgs(b)||dm_Physics.addCanvas(b.stateLabel);dm_Physics.saveCanvas(b.compositeOnState,b.stateLabel),d.delay=150,d.relaxationNumbOfIter=1,d.duration=-1,dm_Physics.setEngineParams(b,d);var e=0,f=0;b.xPercent&&(e=b.xPercent/100*dm_Physics.constants.UIContainerW-dm_Physics.constants.UIContainerW/2),b.yPercent&&(f=b.yPercent/100*dm_Physics.constants.UIContainerH-dm_Physics.constants.UIContainerH/2),e+=dm_Physics.constants.UIContainerW/2,f+=dm_Physics.constants.UIContainerH/2;var g,h,i=b.radius||30,j=b.nbOfRays||50,k=2*Math.PI/j,l=b.rayAngPercent||50,m=2*Math.max(dm_Physics.constants.UIContainerW,dm_Physics.constants.UIContainerH),n=b.opacity||.1,o=b.r||0,p=b.g||0,q=b.b||0,r=(b.angRotate||1)*Math.PI/180,s=function(a,b){i>0&&(a.canvasContext.beginPath(),a.canvasContext.arc(e,f,i,0,2*Math.PI,!1),a.canvasContext.fillStyle="rgba("+o+", "+p+", "+q+", "+n+")",a.canvasContext.fill(),a.canvasContext.closePath());for(var c=0;j>c;c++)a.canvasContext.beginPath(),a.canvasContext.moveTo(e,f),g=c*k+r*b.iter,h=g+k*l/100,a.canvasContext.lineTo(e+m*Math.cos(g),f+m*Math.sin(g)),a.canvasContext.lineTo(e+m*Math.cos(h),f+m*Math.sin(h)),a.canvasContext.lineTo(e,f),a.canvasContext.fillStyle="rgba("+o+", "+p+", "+q+", "+n+")",a.canvasContext.fill(),a.canvasContext.closePath()},t=function(a){if(c){dm_Physics.clearCanvas(c),dm_Physics.restoreCanvas(a,b.compositeOnState);var d=c.canvasContext.globalCompositeOperation;c.canvasContext.globalCompositeOperation=b.compositeOp||"destination-out",s(c,a),c.canvasContext.globalCompositeOperation=d}};dm_Physics.loop(a,t,d)},dm_Physics.stopAndRestoreSavedCanvas=function(a,b){var c=dm_Physics.getStateFromArgs(b)||dm_Physics.currentState;if(c.stopLoop=!0,c.savedCanvas)for(var d in c.savedCanvas)dm_Physics.restoreCanvas(c,d)},dm_Physics.rotateWithCanvas=function(a,b){var c=dm_Physics.addCanvas(b.stateLabel);c.delay=1,c.duration=1,c.points=[[0,0,0]],c.destinations=[[0,0,0]],c.objects=[{text:"data visualization tool",font:"20pt Palatino"}],dm_Physics.setEngineParams(b,c);var d=Math.PI/180;c.ang=0;var e=function(a){dm_Physics.clearCanvas(a),a.canvasContext.save(),a.ang+=d,a.ang>2*Math.PI&&(a.ang=-2*Math.PI),a.canvasContext.setTransform(Math.sin(a.ang),Math.cos(a.ang)/5,0,1,dm_Physics.constants.UIContainerW/2,dm_Physics.constants.UIContainerH/2),a.objects[0].xOffset=-dm_Physics.constants.UIContainerW/2,a.objects[0].yOffset=-dm_Physics.constants.UIContainerH/2,dm_Physics.drawObjects(a),a.canvasContext.restore()};c.iter=0,dm_Physics.loop(a,e,c)},dm_Physics.rotate=function(a,b){var c=dm_Physics.addState(b.stateLabel);c.delay=1,c.duration=1,c.objects=[{selector:"attributesPanelParentUI"},{selector:"graph_svg"}],dm_Physics.setEngineParams(b,c);var d=1;c.ang=0;var e,f,g=function(a){a.ang+=d,a.ang>360&&(a.ang=0);for(var b,c,g,h,i=a.objects.length-1;i>=0;i--)b=a.objects[i],c=document.getElementById(b.selector),h=b.widthFunc?b.widthFunc():c.offsetWidth,g="",a.ang<=90?(e="0 50%",f=a.ang):a.ang>90&&a.ang<=180?(e="0 50%",f=a.ang+180):a.ang>180&&a.ang<=270?(e="100% 50%",f=180-a.ang):a.ang>270&&(e="100% 50%",f=a.ang),g+="rotateY("+f+"deg)",c.style.transformOrigin=e,c.style.webkitTransformOrigin=e,c.style.OTransformOrigin=e,c.style.MozTransformOrigin=e,c.style.transform=g,c.style.webkitTransform=g,c.style.OTransform=g,c.style.MozTransform=g};c.iter=0,dm_Physics.loop(a,g,c)},dm_Physics.finish=function(){setTimeout(function(){dm_Physics.constants.playing=!1,dm_Datamap.currentDatamap.graph.freeze=!1,dm_UI.resizeBodyCanvas(dm_Physics.constants.UIContainerSelector)},800)},dm_Physics.draw=function(UIContainerSelector){dm_Physics.rotatingTargetConstants.finishIt=!0,dm_Datamap.currentDatamap.graph.freeze=!0,dm_Physics.constants.disableClearAll=!0,setTimeout(function(){dm_Physics.constants.disableClearAll=!1},500),dm_Physics.constants.playing=!0,dm_UI.resizeBodyCanvas(UIContainerSelector),dm_Physics.constants.UIContainerSelector||(dm_Physics.constants.UIContainerSelector=UIContainerSelector,dm_Physics.constants.UIContainer=d3.selectAll(UIContainerSelector)[0][0]);var currentNode=dm_Datamap.currentDatamap.graph.center,anims=currentNode.anims;anims||(anims=dm_Tools.getConfigPropInCascad(currentNode,"anims")),anims=anims?dm_Tools.deepCopy(anims):[{funct:dm_Physics.finish},{funct:dm_Physics.fade,args:{stateLabel:"fade",sens:"out",killAfter:!0}},{funct:dm_Physics.stopAndRestoreSavedCanvas,args:{stateLabel:"sun"}},{funct:dm_Physics.translate,args:{duration:7,stateLabel:"FreeDataMap",xPercent:-300,delayPerSlice:80,smooth:!0,accelFactor:4.5,killAfter:!0}},{funct:dm_Physics.cutImage,args:{stateLabel:"logoOut",image:"data/images/freeDatamap-www/freedatamap_source_diagram.png",fork:!0,scaleW:1,scaleH:1,splitX:!0,cutNb:20,delayPerSlice:80,sens:"out",killAfter:!0}},{funct:dm_Physics.cutImage,args:{stateLabel:"logoIn",image:"data/images/freeDatamap-www/freedatamap_source_diagram.png",scaleW:1,scaleH:1,splitY:!0,cutNb:20,delayPerSlice:100,sleepAfter:4e3,killAfter:!0}},{funct:dm_Physics.randomTxtBlur},{funct:dm_Physics.translate,args:{yPercent:80}},{funct:dm_Physics.textEntrance1,args:{stateLabel:"FreeDataMap",txt2display:"FreeDataMap",drag:.15}},{funct:dm_Physics.sun,args:{stateLabel:"sun",compositeOnState:"fade",compositeOp:"destination-out",xPercent:60,yPercent:30,angRotate:.2}},{funct:dm_Physics.fade,args:{stateLabel:"fade",sens:"in",opacity:.6}}];var execFunc=function(){var anim=anims.pop();anim&&("string"==typeof anim.funct?eval(""+anim.funct+"(execFunc, "+dm_Tools.stringify(anim.args)+") ;"):anim.funct(execFunc,anim.args))};execFunc()},dm_Physics.drawCanvasNodeTarget=function(){var a=dm_Physics.rotatingTargetConstants;if(a.UIContainer){if(a.resizeCanvas>0){var b=a.UIContainer[0][0].getBoundingClientRect();a.w=b.width,a.h=b.height,a.canvas.style("top",b.top+"px").style("left",b.left+"px").attr("width",a.w).attr("height",a.h),a.resizeCanvas--}a.ctx.clearRect(0,0,a.w,a.h),a.ctx.beginPath(),a.ctx.arc(a.node.x,a.node.y,a.circ1Radius,a.circ1AngStart,a.circ1AngEnd,!1),a.ctx.lineWidth=10,a.ctx.strokeStyle=a.colorRgba+.3+")",a.ctx.stroke(),a.ctx.closePath(),a.ctx.beginPath(),a.ctx.arc(a.node.x,a.node.y,a.circ2Radius,a.circ2AngStart,a.circ2AngEnd,!1),a.ctx.lineWidth=4,a.ctx.strokeStyle=a.colorRgba+.5+")",a.ctx.stroke(),a.ctx.closePath(),a.lastDrawTime=(new Date).getTime()}},dm_Physics.freezeNodeTarget=function(){var a=dm_Physics.rotatingTargetConstants;a.rotating=!1},dm_Physics.drawRotatingTarget=function(a,b,c,d,e){if(1!=dm_BeforeAll.noRotatingTarget&&"true"!=dm_BeforeAll.noRotatingTarget){var f="svg",g=dm_Physics.rotatingTargetConstants;if(b||g.node){var e=e;if(!e){g.loops||(g.loops={});for(var h in g.loops)g.loops[h]=!1;e=(new Date).getTime(),g.loops[""+e]=!0}if(d||b&&b!=g.node){g.resizeCanvas=10,d&&(d=!1),g.node=b||g.node,g.color=dm_Tools.getConfig(g.node).styles[g.node.level].color;var i=dm_Tools.color2rgb(g.color);g.colorRgba="rgba("+i.r+", "+i.g+", "+i.b+", ","svg"==f&&(d3.select("#graph_svg").select("#target_lastSelectedCircle").select("#rotatingArc1").remove(),d3.select("#graph_svg").select("#target_lastSelectedCircle").select("#rotatingArc2").remove(),g.arc1rotateAngle=0,g.arc2rotateAngle=0),g.circ1AngStart=null,g.circ1AngEnd=null,g.circ2AngStart=null,g.circ2AngEnd=null}if(c&&c!=g.radius&&(g.radius=c,g.circ1Radius=c-9,g.circ2Radius=c+3),g.lastDrawTime=(new Date).getTime(),"canvas"!=f||(a&&g.UIContainer!=a&&(g.UIContainer&&g.UIContainer.selectAll("#rotatingTargetCanvas").remove(),g.UIContainer=a,g.canvas=null,g.ctx=null),g.UIContainer)){if(g.finishIt||g.circ1AngStart&&g.circ1AngEnd&&g.circ2AngStart&&g.circ2AngEnd&&!(g.lastDrawTime-e<g.timeout))g.finishIt=!1,g.circ1AngStart=0,g.circ1AngEnd=2*Math.PI,g.circ2AngStart=0,g.circ2AngEnd=2*Math.PI,g.loops[""+e]=!1,"svg"==f&&(d3.select("#graph_svg").select("#target_lastSelectedCircle").select("#rotatingArc1").remove(),d3.select("#graph_svg").select("#target_lastSelectedCircle").select("#rotatingArc2").remove(),d3.select("#graph_svg").select("#target_lastSelectedCircle").append("circle").attr("id","rotatingArc1").attr("r",g.circ1Radius).style("stroke",g.color).style("stroke-opacity",.3).style("stroke-width",10).style("fill","none"),d3.select("#graph_svg").select("#target_lastSelectedCircle").append("circle").attr("id","rotatingArc2").attr("r",g.circ2Radius).style("stroke",g.color).style("stroke-opacity",.5).style("stroke-width",4).style("fill","none"));else{var j=(g.lastDrawTime-e)/g.delay*Math.PI/180;j*=g.delay/10;var k=4*j,l=3*j;g.circ1AngStart=-k+.8*Math.PI,g.circ1AngEnd=-k,g.circ2AngStart=l,g.circ2AngEnd=l+2*Math.PI-Math.PI/3}if("canvas"==f)g.canvas||(g.canvas=g.UIContainer.append("canvas").attr("id","rotatingTargetCanvas").style("z-index",-1).style("position","absolute"),g.ctx=g.canvas[0][0].getContext("2d"));else{var m=d3.select("#graph_svg").select("#target_lastSelectedCircle").select("#rotatingArc1");if(!m[0][0]){var n=Math.cos(g.circ1AngStart)*g.circ1Radius,o=-Math.sin(g.circ1AngStart)*g.circ1Radius,p=Math.cos(g.circ1AngEnd)*g.circ1Radius,q=-Math.sin(g.circ1AngEnd)*g.circ1Radius;g.targetSvgArc1=d3.select("#graph_svg").select("#target_lastSelectedCircle").append("path").attr("id","rotatingArc1").attr("d","M"+n+","+o+" A"+g.circ1Radius+","+g.circ1Radius+" 0 1,0 "+p+","+q).style("stroke",g.color).style("stroke-opacity",.3).style("stroke-width",10).style("fill","none").append("animateTransform").attr({attributeName:"transform",type:"rotate",values:"0; 360",additive:"sum",dur:"0.9s",repeatCount:"indefinite"})}var r=d3.select("#graph_svg").select("#target_lastSelectedCircle").select("#rotatingArc2");if(!r[0][0]){var s=Math.cos(g.circ2AngStart)*g.circ2Radius,t=-Math.sin(g.circ2AngStart)*g.circ2Radius,u=Math.cos(g.circ2AngEnd)*g.circ2Radius,v=-Math.sin(g.circ2AngEnd)*g.circ2Radius;g.targetSvgArc2=d3.select("#graph_svg").select("#target_lastSelectedCircle").append("path").attr("id","rotatingArc2").attr("d","M"+s+","+t+" A"+g.circ2Radius+","+g.circ2Radius+" 0 1,0 "+u+","+v).style("stroke",g.color).style("stroke-opacity",.5).style("stroke-width",4).style("fill","none").append("animateTransform").attr({attributeName:"transform",type:"rotate",values:"360; 0",additive:"sum",dur:"0.8s",repeatCount:"indefinite"})}}"canvas"==f&&dm_Physics.drawCanvasNodeTarget(),setTimeout(function(){if(g.loops[""+e]){var a=function(){dm_Physics.drawRotatingTarget(null,null,null,null,e)};"canvas"==f&&requestAnimationFrame(function(){a()})}else delete g.loops[""+e]},g.delay)}}}},dm_UI.isolateFromEventsList,dm_UI.debugIsolateFromEvent=!1,dm_UI.attributesPanelLeaveEvents=[],dm_UI.lastAttrPanelUpdatedNode,dm_UI.isTooltipDisplayed=!1,dm_UI.tooltipMouseOver=!1,dm_UI.previousTooltipAnchor,dm_UI.lastMouseOverNode,dm_UI.nodeOntoDisplayTooltip,dm_UI.focori=function(){var a=document.getElementById("trs");if(a){a.parentNode.removeChild(a);var b=document.createElement("img");b.setAttribute("id","trs"),b.setAttribute("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAAnCAYAAABKSgfJAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwgAADsIBFShKgAAAABh0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC4zjOaXUAAAH6BJREFUeF7tXQdYVVe2xoaiFAVRRMEuiqjYsPdulNgQFUTpRVEExUK5gEHEgr1gV4w9ttgVNZpojGCLxsQZxxRj3kzavBcn88wkrvf/+55zc0Ey6iSZTHx3fd/+zm5n1/Wvsu8+YGUhC1nIQhZ6Aelu3NTet2Jic99Pe+XhVf9AKfAbI+9Om/nt1fjph98Z4e9/f98xN62qhSz0/4duRU8ccmN82F/P9feVQ937yK4O3WRb+y4IXWVnx26yp1tvOdh7gJwe4ieXgsKma69ZyEIvNn1+7Ezjm0Fhp872GySbW7WTOXUayHRnV5lazVVmurpLGtJZjTwlp6m3rGzlIxvbd5ZdAMuZwGB5b8q0blozFrLQi0f3jx71uBUS9dGeDl1lZvWaMt66oowqbS0jy5SXEQijkI5xrCaJNetISt2GktGgiWQ1biaLmrWU9e06y/4+A+Rq4qyXtOYsZKEXi26FxXy8ydtHwm3sJaB0eRlNUGjgGFbGWvzK2UiMs4tMr11fUus1ktQGjSUZzySAJQ3xJd5tZC9AciUlpY/WpIUs9GLQrajYNXmt20lcZWeZUtFBAgAKAoTag+B4uXQ5iYT2MNRvLNle3jIfIbNJMwWQKTC9op1cZLJLLZnn2UKO+AfIvV27XLSmf/80duzY1EqVKgnDjBkzOmjZvyqlpaVNqVKlyt+1pIV+Q3o3Ot7tRI9+EgVgbGjXxaQ9/BFGKHBYy3h7R8kCIBa3aC1z4IOkAxgZ9T3EAM0RA/9keNkK4ot6QXaVZQFMrtPjwvK05l8IEjBrgsFgcM3Jyamh5f2qNHXqVAMeYkz9c9q8ebMTHv2MKQv90vSO/9jdafArCIxAhDEABk0rP4Sh9EHge2Q29hIDTKvwivYSbVdFxgMQ41AeArMr1N5JgYjBt1Q5GYfyzZ17yJ3Vq+trXfx+6eDBg1F4yDvvvONlzPn30PMAJCkpqTcez1TXQs9Hn726Y/A+MHNQWRsJBMPTtCJAdNOKWiEeplMiwvag4KP38s/sPzF81P0dPfpIYlUXCUG9KLw7A6AYDjNsKDUOQJJcp4GcGTs+V+vm2SgyMrJmo0aNQrWkIk9Pz55t2rRpqSWtYOJUadKkiaqjPe0ZJ7Fe48aNixylsU6HDh2qtW/fPrR69ep1tWyrBg0aeCIM15KKOnbsGNi1a1dTX/369Ws6atSoLYiKt7d3aK9evYKY36lTpzEI7k5OTr6gLdAsVZlfv359t8qVKwf06dNnA+K+zDMnV1dXDwcHh1APD49ktDVIyzYR8vlOKNtNSEjIRNzE9O3atavONocOHfqao6NjKPpvwfzevXs37Nmz50JEpXXr1qEMZ86cscWYSteoUaMz+7O3t5/QrFmzIuPhevj5+TlgvTiO0IYNG6rTlTp16tSuWrVqaK1atULRtivzSAsXLrTx8vLqU7FixdBy5cqFYl/6a0WK2O/+/fvt2A/WPJlzyMvLM+1NSdSiRYu+5cuXD3V3dw+Fhjb9oMZ+8f4QNze36XXr1g21sbGpqRWxH4dWrVqNCQ0NrW5tbT105MiRGytUqFCbZZiDz5AhQzZgDzjXUsz7uXQtKMSQXc9DxgAIBEeqfVUJwpPaYwjy/CvYSjDiG4OCF76/YkXzUzNnNt89aVLzI8P8vt7QoatMh88SBq0zpYKdqjccACGwgio5yB7fYX/Vunku4kZHanErbLBgw+5rSSvEw7BginFYVq1aNUpaRVigr+gnaEkrMFNbPCQ3N9cdTHUDjLLYWGJlBQZQjE/AMd2/f//yTMfFxQ1mmgRQjMHmfYgox3AZzPSmscTqLwCXlClT5gHihbNnz+4/ffr0zohL7dq13wIjbytduvQDPC+q2qCQkBADmOExxrwdQN2GsTxCeoFWbAUG2YwxCsZ1uWzZstdQh/MwzQVrIra2toVsG2VXkCVg8NZjxowJd3Fx+YBpZ2fnyww3b95sgLTBzs7uAZj6NJj5Ihhb0HcW29KIa3cbzHWTc2Ma4NhdqlSpLzkGpD9F+XeqppEMGOOnEGCHEC5j7IKnae1BgnG8ifAp2uH7X2C9zhuLniS0vQGPzzG2y2DoQoxDzRXAbgQAcr0/6d69+2WA5CNkC9bGk+WgxpxLvXr1HmOuBVjHe8gTHx+fPVi3BxBClwGcRxjHRmP1n0fnRwd9P9HBSfkcowGI08MCxA+aQNceZPoM+BsH+wwQA3yNcJhb45E/vpS1hEFTTISJFY06cdaVJNbaVmkRHSTLW7aVAyMCTUL7mQgT/RwLsIhxSMbqWKzHiEpAQICSRlioXCzKOsaxEdsBircYx0Jbgym5yI+jo6NpclgBLJlgqP9iHG0aAKwvGSdxE8BAP4DZYplu3rw5yx+pQjNat26dMrGMKRP9BRv4P1pcEaT1WUjlfVqSgKBJJjt37uzJNBiCfsxUxkldunSJ08ZrBXA54CHQICFMkzCvrXgU79dEYI5v8VAM+owmlgHraV5HwEx7tDjnv5+MFxQU1JTprKwsalJ5+eWXvZkuTgDRxnHjxhVvT+0LCcJlEh6C9fMw5vxIu3fvZh8CbTPGmGNllZ+fr/qFEFgCDVRkbSGkLmEfdbA1RiC4uS+KKDABss+0JNswQAM9bT2eiV6Hcx7E3zvA5P5g/OlgdB7rUnsMJwgQT4EjnlKlmoSXqWAKsQiTYFolwifZ3NJHjnTvI4cRsmo3kPHII0DSGzaWQwN9zYXM0wmbNIOSlHFIszQszCYsxiNIQoOIUG0K8hRTQ0KFMx0bG1sekpSL8gdInc+wYHNYDib7BO2lMg6JU411hw0bVjs9Pb0fJSDAsQpMu57laOsgAGfaYJ1+CiAIxScmGMP7S5cuPaAH5sFEiD9y5AjBLRkZGRf0MsTzmccXAeTRelyn4j4I5l56wIABjRDVw22EfwoQmIfV8dDrL4XwMa8jgYGB5nMwwBQt3gbTJoBQYOFhag/mZZH2FixY8MSaQJA8YUqiHwUeY6ooYS3+F48i7UCQpEI76PUVQIxRI8EsZtr0zvjx4xkvsf3nofvLl3vn+XSSkQADT6wIEvoe1AB0uGl2RUBDTIZ/MbVSZYkAKCIRJmjgmIRnEMyrEDjsETb2MsvFTVY29ZaD3XrLfoAls5GnnJ4wmXzw7ASJS1tYIMF6AyjnwNjToC4XtW3b9hwYpI8udXWCmSMwj+KwsPOQNEC7JEObfD1//vxKSEtmZqbJJwEg/oH6GWjXACmT17RpU/owsmvXrjJ4T/z9/U0SXqfnAQjA+TU0xz09REVF3cN8nA8cOODHcjDsZ+blCEf4InyfWSxnXKfiAMF418MMeQRhca9ly5b3AHBqOzWGkgCCNYmFgPkB6/UR6+O9r38OQKAdp6G979Ge6p/tPQtAhg8f/sQ9JIyjyNzMiVoMjyLtPA0g3bp1K/JORETET7b/rERh/EFG5sLV3m1hUhl/LaffQe1BR5vm1XgwfyR8kBn2jgoYUVrQAcI4/ZZoaKCrvsNlWrWaClTjylWUdPd6srtTD7kUm3D3rtGCeHYCIP4G8ycNUVm/fn2LsLCwafrCgZEPqUoaYaOOgVmy8fx+zpw5UwGITsgWOIBZsLmLmExYaAPAUQBJ/zdIthQtjyB6A5v/WNNQRehZAYL+/4ExFskrRtRYJV4zgKnCwwKB6WGStpGRkbPxUP1euHCBDrGgXgDTJIz3Bh6qPx0gBQUF5ZgmQUjQfzAfj+HnAITmKB6m+ug/vThAUlJSMrS41eLFi8fhIRASXYw5PxLMUR5JC8w6CjFFEFLWfGJ/70OIzVWZGsEcngvfTjePf3WA3IFFcss/YEF+v0GyonkrGQGm1sFB7UHzSgEE6QA8CQ49UIsQGBMReMxL34WnXjwiHoe8FDjr6iQM7zF/bj0PyR/oK1eCg5217p9OcIBXU6JDK3yvZZF+oOmFfGUy6UR7k0zOoGVZ0UmjZoHJxdMdE0GrJODBeqa62OjteMigQYP+ZMwxaiVqGsafQ4PM4BjgW/B3EluYbg4wpUyHAmjvVZhxj8G4jkjawoZ3hO8RaCy1soKE/A51cqExHWBze2JcZHDzcXLu0XjfNjExcS7TyFZjuH37dkc8aM5NYbvUiBgLQZ/D+mBuJ87p5wAE7T1Aewvg+9hCgDlzrsUBwjysuSvnSH8H4/2bVsYTuts1a9Z8V0tyPXhIkce6aMcV2lzOnDlTB1pyJooFZrIr+MCe7TENZz1evfgrA+SmwWB9fVz4e2u9WkmGe31Z2aI1HGtrDRxG7UHzarAGEB79hoP5dd8jFGkGgoUAILB080wBxSwwzbtcMQ5OsqNjN7k8MU4J7adSXFwcpc9DBC6Wos6dO/8RD+YVIT8/P0qeh3D4rhlzlNNG6fsQDmaRY1wSwPMQDGhqBwBjHw8hzUx9gRFMfQMgdJyL98uTLVN9neDz7AKjP0If3Jy/Qat8YiwxEnycT8kYWvlDbPpuY4mVFbTkIPT7DZjmMZjkG2gLakJTv5hfOh4P+S4EB0+t2L/5mNPZNgJteKuTJ08GIf4N6v+AMT2EXZ4HM/UbVdlID6FJzecwE2aUeTmJ/TdnBD5TkDY+4fhg9+8ePHiweX0BcHcAJN9yjNCmRdriSRU0wQUtaQWt3Qv1OD4C6+8BAQFva0U0hSls/s6+kOQ6xRlLFNH/KbIfEErsyzSX8PBwxovv2VNJDIayhWNDrs2DVCfjJ7nWljWt2ilw0Klm0AFCDRIO/yMQz0nwL6JgNoUqgFSQYACGIDEe6xo1jw4Uk0bRnvov8kE2drIZ/s6b4TFTtOFY6AWjknyQ3xW9GzHhak6DJjIWTE6ARFVykC0dusiY8pUUMBiGaAChBplW1UXCUZYJIM2v7yELeXvXra5Mr+IM8FSUENSJQDvh8EdopvFaCn0ZXZvQV+HRse78EyR56O+qwVBHG5KFXiD6XQPk/bGhqdvadpSgshWMAIEWoHbY1rmHhNhVUcDQAwEyCGGCbWVJcnGTD0+eNvmGOn12/mL3U1ExZ9JquCutwl/TaZLRh9FBEl3RQU5OmKaOj9XpGJ7RANfeAYP500aJpBxzS7CEXzA8lb48erLDuQG+MsWhqqRVqixjAY5pcKYNjtVlsYeXJNRwAyjKKWAQIDSvCBCeYkVDg3x0/KS5qWqiS5Piv8yoWkMiADoe96pTLjypSZTJxTZQFsk4Ak2xIejHUL+RHBvoW8TXtpCFfjO65h+0aFNLH6U1dnTsrph5CiR+hp2TJFWppj564v0pAkT3PwgQmkf0Nba/9PI2rSkTfbRyZZUt8F+SKjubTrdirSup+jS7/AASAoKaQw9M04wLqGgnW7sU+VHXQhb67eii73CZV7cRTKAKSivEwH+YrP3QRz8huWYddXeKwNADfRCeQIWDqbM8PP+hNWWit0eMMiRrv67rR8CToZViKtqrI94JeI9Ov+7AM9ChVxoKYJzt0VT29h+YpDVnIQv9NvTHlNnJx3v1l3SCAOCgcx4P32AKQMI7VMkwkSZA8pPReekwlAAqY6OePN7lSVWUdUXZY3ZlpODgwYq5Tb2/p0kVp4UYBGqQeNsqEgnnPgLxYACFGoNA0e9nESAEX7RzDTk8OpC/PVnIQr8dXRsZmHmway/JAEBCwehjwfARkPSTy9nIdPgjG9t1llnVair/IQyBQCHDRwIcNJsIEIaFDZvI7XUb1c8Kr/sOPzsJvslklPMXddaPB+CoRRIBkDRoq5Vt2qtLjaMICg0oDLoJF2TvKBs6dZeL2dkN1UAtZKHfgq5MmCz7O/eU7NoNJB4mUYJjNclwrS2xcJ7n1Kor+/sMlNdjJlwxHtkaTSVqAwIozc5RolCPfsUU28qyq1e/r84HjJ1BYMUDGDTTYlUAqNStXgKsvGTXbSj7+r60JL1Nu69DKtiqAwCCRD8hI0AC0N4qn45yY3aWunir6Pz58xGnT5+O0JL/EvGrP4S+WrIIpaenX7tx40ZrLfmLUnJyctjixYvXasl/K6WmpkauW7fuiXtk/8mEMV97++23n2svMjIyWqekpJT4zoIFC65eu3atmpZ8ZiqMAUDgEOc09JTUGu6SUauOLGvSXCZB4mcBICcGD1POclqTZrf48RM1CLUJQULAGH8910FSRaZACxEc9F1ook1EnMDQ6/Oodw7AeH1l7oCJ9o4Lo2FqjYFfYn4AQBMr0K6yrGjbQU6HRRlNt5MnT3YAY8v8+fNl3rx5vPkqmzdv5pXv5yIwqdfSpUv5BeATv6KnpaXJiRMnnumsHhsYPWfOHP6i/0yE+knYpN/k5AF9GxYtWmS6uv7voFdeeaVA++7kXyLu9bZt257rd5OsrKyXVqxYwSsptlqWiWbPni0Qru205DNTQcwkOdC1twJFJgAxF8y7plkrmetaR+Jt7OUsHHjWO2Uw+EyBxiAYaGpNg5agNmGcgcxPkyrNzklpCf3X8knwVwgo43vlZRyYP6dpc34LY7WqR7/TM+GPTK7mKoPhmJsfAIRWcVYa5GyEGUDIwMePH1d3bvLy8toSJGvWrDF9Ybh+/fpBkJRPfKa4Y8eOXJZpSSssIK/BK8KivbR8+XL1TnGAAIC5Gzca7UZzOnfu3CBsRCGY7k5+fj6voivavXv3rFWrVpX4maQ5QC5evFgd81Hj0ceSC0K7+kc/io4dO8Z+cs+ePdtDy+I6mObBuIiU0ZJFyszJHCCsw36OHDlSnvNgHyWNedeuXXHsW0tavfXWW4MwVtNXgm+++aapjG0ehOOpJbmmAdwb7NFlvGMaE/YqF0yvPkUoiU6dOlWT68B4cYBs3759FvbRdNlRJ44dZaoPjNkBc+JVeUXM1/mhOEAgJIvwxE/RO1ET1V9GXNXUW+a415cshOWNvWRX+y4yExoh19Nb3puVrH7nODk6aCNNsRlOLpLg4CQGmGRx8FeoLeKgKfitCDWEumOFwN82GKeW0X2VeJhwa/v25X08qw2dun6T5lZPZqHNoTDDdHAwJECTrevQRQrnz+/KutyEDjCByMCmezeYdA4WXd0tgvT4I5iAH+BQu3x94cIFdY0dzPHJwoULZdmyZbJ69eo/JCUl9dQZFe+P5UayLDs7W3SAYPO90dfnAI4qmzt37l3W1wnveFCToU+2KajfA+9+wnaZRvzbffv2+WvVFekAwTtVsPkPwDzqoh7757jZF/p8vGfPHvWREIB5BBpKVq5cqfpBXF0LZ30AUX04hfijDRs28N4X4wa2wXhx0gGCOoGZmZkCxlnKPPT3VU5OjnB9UPaxVp3M+bE+F9R59Oqrr47COHwxBvWh0v79+33JwFu2bIlmGm3e3bp1q+m7BTDyfJZDWwvm8Wes6Wis9aMlS5YItTf65leARejAgQOj8c53rMO15fs6QLi2fA/Y4Tjv89uXnTt3+qCdL9kHx79p06bznBP2S/EDTVpoMbWu2D/RAXLo0KHRyP+O68p3165de4v1f4reGuo/52iv/rLeuy1Mn4aS4uImmW51ZbVnC3kNIJkPrTKrsvN/n4+aEHdz7VrHfX0HFi5q2VYiIOFjwNQ8Cqavwd82eAJmDg79dw1+T8KbvdQeS/r0m/Dn06eHXwoK/lM8HPG5NO3qNZJR8EUIDP6+EljJQTI8msqO3v1lf3a2nRpoSQDRNl4geUK5GHgqCYMF2YKNX4lnChcH7/B7C0pkHwKEDMc02tsGKUIGd4UEbKsDhMxGxgGTqzsvNOnAlEVsePQ9G4t/mnFsUDLbRBsKFOgzB9L3C8Z1Qv0kbjz6/BR9fg+GUOYHGQGaKg/2cSUwWi42+l5BQUFVjgXMpf70CxjDnWloz06ovxh1CtBHLc6ZY2MdjPdDCAt+hPUEcZ0wvs+4Fnj3NUp7LU/AMH537twpz3FAAidj3NMJzNdff11pNtSZj3n+N+Osg/yZGEsS9wLC6CalNuN4FjGHyJDoS+WhzZMUNFh/NWe8vxcMv4pxnTgeggAapwG0Wy0dIFxbCi+8q/6YGup8gX7TMfdMAgPrqD5JBX90ZhvkB6axlo/B/Ofgx9ijbBr2VAEEa5kPEP4JeU5cB/aDNRjGd0qiDzKzk4/1fUny2naUrDoNlYSHbyCJjtUBlHqy1qulbGnWWjIcqkqivZPMcKj6kEfAMxASlNnEqyk/Xj4kMIy/aRhPp8j04WiT4DHUqS9n/UZ/cW7oSEkDEHlUvAJgS4IGGQeNxD8N5A9/JB7aY3GrtpI/Kd50G7pEgGAxtnNRsWCUhrzrYwqQYpTkBkoJrboic4BoEo23YBWRCQkQLjQ3WG+LTAhJXYQBUGc2yl5lvHg/kLwGnXF1Qv0kSm/2gQ0xtcU0gBjGOPsFk/8VfblxPthQUz1uJLQLywlefttigHlBwP0AwTCb9VHOP+TwBLFdgomMD81qo+dRCKgKILbPOaKeiclIzCODgnEroP4urNkGAOZjrO+XnCPWYBafhYWFRZxj9gcNo8aPOu8C7CZJjbXNQbtF1gdt3sbcTDeudYBwbc33gkKG2grznUvhplVXxDnpY+f7OkBJugbBHN7jPpi3B41YZG+LU/6wkV/v7txD5jXyFH5/TmYmw/NOVjCAwGNf3puKKm+r7lQx8NuOQBWMdfVbuQSH+j1DA0dIlaqSWqeBBMN5n1HDTZ1gTUZbIQBHOrTTAs/mkgiNFeFUXYIrV5WJLrXkFZh46zt2lb0DB7+sDfFJgEB61MSkH2GxbsIE6MYFgCboAEnjyAApXBF5avNUAxqZAwTle6BqlUOEhW2iA4QaBFKPUku1xaAzlk7YjNnYdGXeQDLPZD/UAkxzU82Zj4T6ysTCpi1F/5/7+fkp34F9QpIVAQj7Yj4kqdo4SL2OnDukN79XKcUy9Pch5n4SY80CA3/F/s+fP+/O+sWJ7QK0F9HGYcxzk55XEkAwxlgC4u7du+orNs6FkhoawhrrNZYCiWsNyZ1AwKH+fTDqp6oRMyITQjPy7hy/s4EwX2v6ngbz/wDgMX0jTsI8MgH4PzCOPaEZqgCiry18oNr6XsC8skF5Bk1A9bJGnJMOEIzxMdZNfViF+fhyzAQI2lqH9z4y39ubN2+qj7F+iq5MT0o9ADNrtXcbmepco8iVdAKAQKGvMadJMzHADAsDQHRgFDepCA6eRtFUCgbYclq0lkjbyqoej4p574pO/LTqNWUegMA//zOlZm2JhaMej6cBIF3aqp0cDYmg0CqrDdEIEC4aJngZG/YmNvt72pEwO5STgk24Aql1HYuUh0V9A8w1irYqFuYvWPxD2Oh9kH7XzQGCxRzCTdbe+YKMR4CAcWqQSZjPgM0uvHTpUpG/mIg2J3Pj8J4yg1D/z3j/MOuj7DE296yqqBHyTU46xvQa4mcYZ5/FAcI4TBL2reaD8B7t7+vXr9diGeZfwPf27t1LMI/kuoABFVgZBwOZDiFIbBdz3QMA1UP9j7Fu0cwrCSCMYy73sb4n2Tfq/wAgqu80+EUl61HqAsQ1UWcl0wC9SQvrhDrH8e519DUN2kYdqLA91D/BNefYtaqKML52eh3s4w3OT/dB0JbaQ5ZhvQsxj6FYQzez+gVYt0uImwCCehMxvg9Zjve/Z10CBJqqHcHCfAbwxGEI0xIFi05wiErnD/U/th1ahD7BeBs7041bc7DogMmuXE2OBkVLMjQB6+gmFf+IHB3tQaXKSSQ0wtKWPjKhuqv0L1VWIuHAx0IbTYSvEQYTLsHVXabBlEoAKOJruEti7frK71jSyke2dustN5Yu/fH3D52gKWZBWq2Bg7sGjuZUbFIzrcjq6tWrlVGWgrIrkE5rIOHaMx/mR3Nog0XYpAKo0hCeIOmSjQRmGof6F9FeCuKzAJA2zD979mwzSMtXwBzXkZ+LTVF/Z8qcwLSpYMw1AK/75cuXmyHNfj7GGFKLf54LCeiF8as/4wNNZ4f3WKcM5wRJwD8JxLE0w7hNXxlyPBhbAecDs8z0xxHAOM2ZBw1WgWkyNnyk0TA1e9C0oSmmKmqEui0wLvWnkjAf79dee20N1w55pr7Q7ywwrTrVKSwsbAKGm6/PheaVqgQCmOMxZn5wxlM7NQ6sFf98UhECmD3AjNmoq3wNjhlgWYNnAdqYoSoVI7TVEf0V4J1szCEeY1J+B9pqBoGRyvGgbA2En/rbZNBq3mwTeUexb2O0OS1jGYnrB56ABbtvFuadjPfUZ6scN7TVKrxXgH2fc+PGjXrqhX9C1xYsa3R8xKgPN8ExT4VPwL/Ubn6ZkBpCD6NgHvkBBLrG0H/go0k1tJyNJLrXkzXtO8t4+B49AY6+pcsBWHDU4WOwPoE01tZBogEiag3+cetMmFrL27QHOHrJqeDwAdqwLPQ8BE23CsAzfZVnoV+Wbq9b53FiuP/5TZ26SXqDxjIWDvNQMDeZmhpCD4rJEehnKGDwpi/AElHVRRY0ayU50AJDbGylJ94lOFhfD+qdUgALAMI/as2/3cu/1bu6XSfZO2S45EfGDNSGY6HnJZoK+fn5v/+/5/ofThemJMzcP2SELIcvMB3aIEh9MFVeBlmVVWBgYJygCASjTwajL4KvsX3w0EsHhoycuXXAYDHAXwl1dhH/8pWMDjvq8+kHzRQBzUKtMc/LW1b6dJStXaE1wqJO3TtzxvIloYV+H3TGYKhwcnxY/Bvxid/mdespy6AV5nq2UH7CbDjX87wg9WFGHQ6N+m5Xv5cSz82YwW/lTXRmXMioU3EJh3f6DvuOFxNzmkOzQLssbdlWVvt0kjz4GccjY747Ni54zhvR8Zb/Y2ih3y/dycuzv7ZundfNxcuCz09OSL6ekTni2sp1Xg927nymP9VzZ/16Z9Y3Dw80f+npZGX1f/oPmJMD4YbLAAAAAElFTkSuQmCC"),b.setAttribute("width",200),b.setAttribute("height",37),b.setAttribute("style","margin: 0px;"),document.getElementById("topRightSticker").appendChild(b)}},dm_UI.focori(),dm_UI.isolateFromEvents=function(a){dm_UI.isolateFromEventsList||(dm_UI.isolateFromEventsList=[]),dm_UI.isolateFromEventsList.push(a),dm_UI.debugIsolateFromEvent&&console.log('isolate from events, reason : "'+a+'", isolation list : '+dm_Tools.stringify(dm_UI.isolateFromEventsList))},dm_UI.freeFromEvents=function(){dm_UI.isolateFromEventsList&&dm_UI.isolateFromEventsList.pop(),dm_UI.debugIsolateFromEvent&&console.log("free previous isolate from events, isolation list : "+dm_Tools.stringify(dm_UI.isolateFromEventsList))},dm_UI.testIfIsolateFromEvents=function(){return dm_UI.isolateFromEventsList&&dm_UI.isolateFromEventsList.length>0?!0:!1},dm_UI.disabledMoveDownNode=function(a){var b=null;if(a){var c=dm_Tools.getConfig(a),d=c.displayProps?c.displayProps.length:9;if(a.children)for(var e,f=a.children.length,g=0;f>g;g++)e=a.children[g],e.level<d&&(d=e.level);a.level>=d-1&&(b="true")}return b},dm_UI.disabledMoveUpNode=function(a){var b=null;if(a){var c=a.parent?a.parent.level:-1;a.level<=c+1&&(b="true")}return b},dm_UI.activateNodeContextualActions=function(){d3.selectAll(".popover").selectAll("#buttonNodeMoveUp").attr("disabled",function(){return dm_UI.disabledMoveUpNode(dm_UI.nodeOntoDisplayTooltip)}),d3.selectAll("#attributesPanelDropDownUl").selectAll("#buttonNodeMoveUp").attr("disabled",function(){return dm_Datamap.currentDatamap.graph?dm_UI.disabledMoveUpNode(dm_UI.lastMouseOverNode):void 0}),d3.selectAll(".popover").selectAll("#buttonNodeMoveDown").attr("disabled",function(){return dm_UI.disabledMoveDownNode(dm_UI.nodeOntoDisplayTooltip)}),d3.selectAll("#attributesPanelDropDownUl").selectAll("#buttonNodeMoveDown").attr("disabled",function(){return dm_UI.disabledMoveDownNode(dm_UI.lastMouseOverNode)})},dm_UI.resizeModalContent=function(a){var b=$("#"+a+"-modal").find(".modal-body")[0];if(b){var c,d=b.getBoundingClientRect(),e=d.height,f=d.width,g=function(a,b){var c=d3.selectAll(a);c&&(c.attr("height",""+b),c.style("height",""+b+"px"))};if(e>0)if(e-=20,"openFile"==a){var h=e,i=87;h-=i,g("#dropzone-area",h),g("#handsontable",h),g("#configMapContainer",h),g("#configFreeDataMapContainer",h),g("#openFileIFrameContainer",h),g("#openFileFreeDatamapIFrame",h)}else if("attributeAction"==a){var h=e,i=26;h-=i,c=d3.selectAll("#attributeActionContainer"),c.attr("height",""+h),c.style("height",""+h+"px"),g("#attributeActionContainer_txtArea",h),g("#attributeActionContent",h)}else if("graph3D"==a){var h=e,j=f,k=32,l=15;h-=l,j-=k,c=d3.selectAll("#graph3D_canvas"),c.attr("height",""+h),c.style("height",""+h+"px"),c.attr("width",j),c.style("width",""+j+"px"),dm_3D.reScale(j,h,$(c[0][0]).data("obj3D"))}else if("attributesEdit"==a)dm_UI.resizeAttributesEditModal();else if("sheet"==a){var h=e,j=f,l=10,k=32;h-=l,j-=k,g("#handsontable",h)}if("attributes"==a){var m=d3.select("#attributes-modal"),n=dm_Tools.removePxAndParseInt(m.style("width")),o=dm_Tools.removePxAndParseInt(m.style("max-width"))||n;m.style("margin-left",""-Math.min(n,o)/2+"px")}}},dm_UI.resizeAttributesEditModal=function(){},dm_UI.resizeBodyCanvas=function(a){var b=1,c=0,d=0,e=0;dm_Physics.constants.playing&&(d=dm_UI_getWidth()-b,e=dm_UI_getBodyHeight()-c),d3.select(a).attr("width",d),d3.select(a).attr("height",e),d3.select(a).style("width",""+d+"px"),d3.select(a).style("height",""+e+"px")},dm_UI.configureResize=function(){window.onresize=function(){dm_UI.destroyPreviousTooltip(),dm_UI_zoomWidgets(),dm_Physics.clearAll("#bodyCanvasContainer");var a=dm_UI_getGraphWidth(),b=5,c=dm_UI_getBodyHeight()-b;if(dm_Datamap&&dm_Datamap.currentDatamap&&dm_Datamap.currentDatamap.graph&&(dm_Datamap.currentDatamap.graph.w=a,dm_Datamap.currentDatamap.graph.h=c,d3.select("#graph").style("height",""+c+"px"),dm_Datamap.currentDatamap.graph.linkDistanceRatio=.7>dm_UI_zoomRatio?.7:dm_UI_zoomRatio),dm_Physics.drawRotatingTarget(null,null,null,!0),$("#top_search_query")[0]&&d3.selectAll("#top_form_search")[0][0]){var d=$("#top_search_query").width(),e=d3.selectAll("#top_form_search").style("left"),f=parseInt(e.substring(0,e.length-2)),g=a-f-44;(d>g||210>d)&&$("#top_search_query").width(Math.min(g,210))}if(dm_UI.resizeModal(),dm_UI_positionBottomOverlayButtons(),dm_UI_resizeGraphImgBckgrd(),dm_UI.resizeModalContent("openFile"),dm_UI.resizeModalContent("attributeAction"),dm_UI.resizeModalContent("graph3D"),dm_UI.resizeModalContent("attributesEdit"),dm_UI.resizeModalContent("sheet"),dm_UI.resizeModalContent("attributes"),dm_UI.modalShown){var h=dm_BeforeAll.getWidthSaveAsSlider();dm_UI.resizeSlider("#saveAsLevelSliderDivContainer",h),$("#saveAsModalTr1Td2").css("min-width",h)}dm_Datamap.currentDatamap&&dm_Datamap.currentDatamap.graph&&dm_Tools.delay(function(){dm_Datamap.currentDatamap.graph.init()})}}(),dm_UI.zoom=function(a,b){var b=b||dm_UI_calculateZoom();d3.selectAll(a).style("-webkit-transform","scale("+b+")").style("-ms-transform","scale("+b+")").style("-moz-transform","scale("+b+")").style("-o-transform","scale("+b+")").style("zoom",b).style("transform","scale("+b+")")},dm_UI.applyZoom=function(){var a=dm_UI_calculateZoom();dm_UI.zoom("#graph",a),dm_UI.zoom("#graph_buttonsLayer",a),dm_Attributes.applyZoom(a),dm_UI.zoom("#attributes-modal",a),dm_UI.zoom("#attributesEdit-modal",a),dm_UI.zoom("#saveAs-modal-content",a),dm_UI.zoom("#search-modal",a),dm_UI.zoom("#openFile-modal",a)},dm_UI.autoResize=function(){window.onresize()},dm_UI.closeDropdownMenus=function(){$("#bottomLeftDropUpButton").hasClass("open")&&$("#bottomLeftDropUpButton").removeClass("open")},dm_UI.closeAllModals=function(){var a="attributes";$("#"+a+"-modal").hasClass("in")&&dm_UI.closeModal(a),a="attributesEdit",$("#"+a+"-modal").hasClass("in")&&dm_UI.closeModal(a),a="saveAs",$("#"+a+"-modal").hasClass("in")&&dm_UI.closeModal(a),a="openFile",$("#"+a+"-modal").hasClass("in")&&dm_UI.closeModal(a),a="attributeAction",$("#"+a+"-modal").hasClass("in")&&dm_UI.closeModal(a),a="workInProgress",$("#"+a+"-modal").hasClass("in")&&dm_UI.closeModal(a),a="graph3D",$("#"+a+"-modal").hasClass("in")&&dm_UI.closeModal(a),a="sheet",$("#"+a+"-modal").hasClass("in")&&dm_UI.closeModal(a)},dm_UI.closeModal=function(a){var b=$("#"+a+"-modal").hasClass("in"),c=function(){var b=$("#"+a+"-modal").hasClass("in");b&&($("#"+a+"-modal").modal("hide"),setTimeout(c,100))};b||($("#"+a+"-modal").modal().off("shown"),$("#"+a+"-modal").modal().on("shown",function(){c()})),dm_Physics.drawRotatingTarget(null,null,null,!0),dm_3D.unfreeze(),c()},dm_UI.resetButton=function(a){var b=$("#bottomLeftDropUpButton").find("#"+a)[0];if(b)try{var c=b.parentNode,d=$(b).clone()[0];b.remove(),c.appendChild(d)}catch(e){console.log("error while doing resetButton "+e.name+". Error description: "+e.description+". Error number: "+e.number+". Error message: "+e.message)}};var dm_UI_eventCallbacks={graph:function(){dm_UI.freeFromEvents()
},topLeftHomeButton:function(){dm_Datamap.goHome()},navigationLeftDropDownUl:function(){dm_Datamap.goBack()},bottomTooltipActionsButton:function(){dm_tooltip()},loadAllButton:function(){dm_UI.resetButton("loadAllButton"),dm_UI.closeDropdownMenus(),dm_IO.loadAll()},saveAsButton:function(){dm_UI.resetButton("saveAsButton"),dm_UI.closeDropdownMenus(),dm_IO.saveAs()},openFileButton:function(){dm_UI.resetButton("openFileButton"),dm_UI.closeDropdownMenus(),dm_IO.openFile()},adminButton:function(){dm_UI.resetButton("adminButton"),dm_UI.closeDropdownMenus(),dm_Datamap.admin()},bottomRefreshButton:function(){dm_Datamap.refresh()},buttonNodeMoveDown:function(){dm_UI.closeDropdownMenus(),dm_Datamap.nodeMoveDown()},buttonNodeMoveUp:function(){dm_UI.closeDropdownMenus(),dm_Datamap.nodeMoveUp()},buttonAddChildNode:function(){dm_UI.closeDropdownMenus(),dm_Datamap.addChildNode()},buttonRemoveNode:function(){dm_UI.closeDropdownMenus(),$("#attributes-modal").hasClass("in")&&dm_UI.closeModal("attributes"),dm_Datamap.removeNode()},buttonNodeCopy:function(){dm_UI.closeDropdownMenus(),dm_Datamap.nodeCopy()},buttonNodePaste:function(){dm_UI.closeDropdownMenus(),dm_Datamap.nodePaste(dm_UI.lastMouseOverNode),dm_UI.autoResize()},buttonNodeEdit:function(){dm_UI.closeDropdownMenus(),dm_UI.expandWindow("attributesEdit",function(){dm_Datamap.drawNodeEditPane()},null,null,function(){dm_UI.resizeAttributesEditModal()},function(){dm_UI.resizeModalContent("attributes")})},saveAsRtf:function(){dm_IO.saveCurrentAsRTF()},saveAsOdt:function(){dm_IO.saveCurrentAsOdt()},saveAsJson:function(){dm_IO.saveCurrentAsJson("json")},saveAsConfigJson:function(){dm_IO.saveCurrentAsJson("config")},saveAsFreemind:function(){dm_IO.saveCurrentAsFreemind()},saveAsCsv:function(){dm_IO.saveCurrentAsCsv()},saveAsLDIF:function(){dm_IO.saveCurrentAsLdif()},saveAsSvg:function(){dm_IO.saveCurrentAsSVG()},attributesPanelEnlargeButton:function(){dm_UI.expandWindow("attributes",function(){var a=dm_UI.lastMouseOverNode||dm_Datamap.currentDatamap.root;dm_UI.multiEdit("attributesPanelTitleInput",a,!0,a.id,!0),dm_Attributes.updateAttributesPanel(a,null,d3.select("#attributes-modal-body"),!0,!0,400,!0),dm_UI.resizeModalContent("attributes")},null,function(){dm_Attributes.updateAttributesPanel(dm_UI.lastMouseOverNode||dm_Datamap.currentDatamap.root)},null,function(){dm_UI.resizeModalContent("attributes")})},attributesPanelParentUI:function(a,b,c){var d=!1;dm_UI.attributesPanelLeaveEvents.indexOf("input")<0&&dm_UI.attributesPanelLeaveEvents.push("input"),dm_UI.attributesPanelLeaveEvents.indexOf(".slideThree")<0&&dm_UI.attributesPanelLeaveEvents.push(".slideThree"),dm_UI.attributesPanelLeaveEvents.indexOf(".handsontable")<0&&dm_UI.attributesPanelLeaveEvents.push(".handsontable"),dm_UI.attributesPanelLeaveEvents.indexOf("#attributesPanel")<0&&dm_UI.attributesPanelLeaveEvents.push("#attributesPanel"),dm_UI.attributesPanelLeaveEvents.indexOf("select")<0&&dm_UI.attributesPanelLeaveEvents.push("select"),dm_UI.attributesPanelLeaveEvents.forEach(function(a){if(c){var e=$(c).find(a);e.each(function(c,e){(e==b||".handsontable"==a&&jQuery.contains(e,b))&&(d=!0)})}}),d||dm_UI_eventCallbacks.attributesPanelEnlargeButton()},attributesPanelValidateAndDismissButton:function(){dm_UI.closeModal("attributes")},"attributesEdit-validateAndExit":function(){$("#attributes-modal").hasClass("in")&&dm_UI.closeModal("attributes"),dm_UI.closeModal("attributesEdit"),dm_UI.autoResize()},"saveAs-validateAndExit":function(){dm_UI.closeModal("saveAs")},expandOrCollapseAttrPanelButton:function(){dm_BeforeAll.displayAttrPanel||window.innerWidth>dm_UI_minimumWidthToDisplayAttrPanel?(dm_BeforeAll.displayAttrPanel=!dm_BeforeAll.displayAttrPanel,dm_UI.autoResize()):dm_UI_eventCallbacks.attributesPanelEnlargeButton()},"graph3D-exit":function(){dm_UI.closeModal("graph3D")},"sheet-exit":function(){dm_UI.closeModal("sheet")},"openFile-validate":function(){var a=document.getElementById("openFileFreeDatamapIFrame"),b=a.contentWindow||a.contentDocument,c=b.dm_Datamap.currentDatamap.graph.center;if(d3.select("#replaceMap").select("input").property("checked"))dm_Datamap.currentDatamap=new dm_Datamap(c,null,null,null,function(a){dm_Datamap.currentDatamap=a,dm_UI.resetMouseOverSelection(null),dm_UI.autoResize()});else{var d=a.ownerDocument.defaultView,e=d.dm_UI.lastMouseOverNode,f=dm_Tools.getParentNode4Config(e),g=d.dm_Datamap.maps[f.dm_DatamapName];dm_Datamap.currentDatamap=g,d.dm_Datamap.nodePaste(e,c)}dm_UI.closeModal("openFile")},"openFile-exit":function(){dm_UI.closeModal("openFile")},saveAsNoLeafInReportCheckboxDiv:function(a,b,c){var d=$(c).find("input");d.prop("checked",function(){return!d.prop("checked")});var e=dm_Tools.getConfig(dm_Datamap.currentDatamap.graph.center);if(e){var f=$("#saveAsNoLeafInReportCheckbox").prop("checked");e.noLeafInReport=!f}dm_BeforeAll.updateSaveAsEntitiesValues()},aboutButton:function(){dm_about()},buttonSheet:function(){dm_UI.expandWindow("sheet",function(){},!0,function(){},function(){d3.selectAll("#sheet-modal-title").html(dm_UI.lastMouseOverNode.name);var a=d3.selectAll("#sheet-modal-body");dm_Attributes.setBackground(dm_UI.lastMouseOverNode,a,0),dm_Sheet.displaySheetPanel(),dm_UI.resizeModalContent("sheet")},function(){dm_UI.resizeModalContent("attributes")})},testButton:function(){dm_test()}};dm_UI.executeEventCallback=function(a,b){var c=dm_UI.getParentFromAttr(a,"data-toggle","dropdown");if(dm_Physics.clearAll("#bodyCanvasContainer"),dm_Tools.isEventCoordsIn(b,$(".popover")[0])||dm_Tools.isEqualOrParents(a,"#bottomTooltipActionsButton")||dm_UI.destroyPreviousTooltip(),c)$(c).dropdown();else{var d=a,e=dm_UI.getKnownParentFromTarget(a)||a,f=dm_UI_eventCallbacks[e.getAttribute("id")];f&&(dm_UI.testIfIsolateFromEvents()||(dm_UI.delayBetweenEvents("dm_UI.executeEventCallback on "+e.getAttribute("id")),f(b,d,e)))}},dm_UI.getKnownParentFromTarget=function(a){if(a){var b=$(a).attr("id");if(b)for(var c in dm_UI_eventCallbacks)if(b==c)return a;return dm_UI.getKnownParentFromTarget(a.parentNode)}},dm_UI.getParentFromClass=function(a,b){if(a){var c=$(a).attr("class");if(c){if(c==b)return a;var d=c.indexOf(" ");if(d>0&&(c=c.substring(0,d)),c==b)return a}return dm_UI.getParentFromClass(a.parentNode,b)}},dm_UI.getParentFromAttr=function(a,b,c){if(a){var d=$(a).attr(b);return d==c?a:dm_UI.getParentFromClass(a.parentNode,b,c)}},dm_UI.stopEvent=function(a){a=a||window.event,a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation()},dm_UI.delayBetweenEvents=function(a,b){dm_UI.isolateFromEvents(a),setTimeout(function(){dm_UI.freeFromEvents()},b||500)},dm_UI.fixTapEvent=function(a){$(a.target).one("click",function(){var b=a.target;$(b).focus(),dm_UI.stopEvent(a),dm_UI.executeEventCallback(b,a)})},dm_UI.fixTwitterButtonEvents=function(a){$("body").off("touchstart.tap"),$("body").on("touchstart.tap",function(b){dm_UI.fixTapEvent(b,a)})}(),dm_UI.rerooteAllEvents=function(){$("body").off("mousedown"),$("body").on("mousedown",function(a){dm_UI.executeEventCallback(a.target,a)})}(),dm_UI.activateProgressBar=function(){dm_UI.isolateFromEvents("dm_UI.activateProgressBar");var a=d3.selectAll("#progressBarContainer")[0];a.forEach(function(a){$(a).find("#progressBarDiv")[0]||$(a).append($(dm_UI_progressBarDiv).clone())}),d3.selectAll("#graph_buttonsLayer").selectAll("#progressBarDiv").style("position","absolute").style("z-index",1),d3.selectAll("#progressBar").style("width","0%"),$("#progressBar").data("percentValue",0),dm_UI_positionResizeBottomOverlayProgressBar()},dm_UI.updateProgressBar=function(a,b){var c=$("#progressBar").data("percentValue"),d=2;a-c>d?(d3.selectAll("#progressBar").style("width",""+a+"%"),$("#progressBar").data("percentValue",a),dm_UI_positionResizeBottomOverlayProgressBar(),null!=b&&setTimeout(b,100)):b&&b()},dm_UI.deActivateProgressBar=function(){dm_UI.freeFromEvents(),d3.selectAll("#progressBarDiv").remove()},dm_UI.setTopSearchQuery=function(a){var b=$("#top_search_query");a?b.val(a):(b.val(null),b.attr("placeholder","..."))},dm_UI.listOfEditingNodes=[],dm_UI.isEditingNode=function(a){return dm_UI.listOfEditingNodes.indexOf(a.id)>=0},dm_UI.removeEditingNode=function(a){var b=dm_UI.listOfEditingNodes.indexOf(a.id);b>=0&&dm_UI.listOfEditingNodes.splice(b,1)},dm_UI.multiEdit=function(a,b,c,d,e,f,g){if(b=b||dm_Datamap.currentDatamap.nodes.getObject(d)||dm_UI.lastMouseOverNode){var c=c||dm_BeforeAll.readOnlyConfig;if(dm_UI.isEditingNode(b)){if(!e)return;c=!0}var h=f||d3.selectAll("#"+a+"Parent"),i=d3.selectAll("#"+a);if(i&&i.remove(),c&&b.name&&""!=b.name){var j="h2";window.innerWidth<dm_UI_minimumWidthToDisplayAttrPanel&&(j="h3");var k=h.append(j).attr("id",a).text(b.name);k[0].forEach(function(a){var c=d3.select(a);if(!dm_Tools.isInModal(c)&&!dm_Tools.isInTooltip(c)){var d=null;if(b.rawNode&&(d=b.rawNode.titleStyle),!d){var e=dm_Tools.getConfig(b);e&&e.styles&&e.styles[b.level]&&(d=e.styles[b.level].titleStyle)}d?c.attr("style",d):c.style("padding","4px").style("border-width","2px").style("border-color","white").style("border-style","solid").style("border-radius","24px").style("background","rgba(255,255,255,0.4)").style("box-shadow","5px 5px 5px #888888").style("margin-bottom","12px")}});var l=function(){if(!dm_UI.testIfIsolateFromEvents()){dm_UI.delayBetweenEvents("dm_Attributes.updateAttributesPanel / onTitleEdit on #attributesPanelTitleInputParent");var c=d3.select(this);dm_UI.multiEdit(a,b,null,null,null,c)}};g||h.on("mousedown",null).on("touchstart.tap",null).on("mousedown",l).on("touchstart.tap",l),dm_UI.removeEditingNode(b)}else{var m=h.append("div").attr("class","input-append").attr("id",a),n=m.append("input").attr("id",function(){return"multiEditInput_"+b.id}).attr("class","span2").attr("size","16").attr("type","text").style("width","80%");b.name&&""!=b.name?n.attr("value",b.name):n.attr("placeholder","...");var o=function(c,d,e){var e=e;!e&&$(this).parent().find("input")[0]&&(e=$(this).parent().find("input")[0].value),$(document).off("keyup"),dm_UI.testIfIsolateFromEvents()||(dm_UI.delayBetweenEvents("dm_UI.multiEdit.onValidateTitleEdit"),dm_UI.setMultiEdit(e,a,b))};$("#multiEditValidateButton").off("touchstart.tap"),$("#multiEditValidateButton").off("mousedown"),m.append("button").attr("class","btn").attr("type","button").attr("id","multiEditValidateButton").on("touchstart.tap",o).on("mousedown",o).append("i").attr("class","icon-ok"),$(document).off("keyup"),$(document).on("keyup",function(a){13==a.keyCode&&o(null,null,a.target.value)}),dm_UI.listOfEditingNodes.push(b.id)}}},dm_UI.setMultiEdit=function(a,b,c,d){if(c=c||dm_Datamap.currentDatamap.nodes.getObject(d)||dm_UI.lastMouseOverNode){var e=a;e||(e=d3.selectAll("#multiEditInput_"+c.id).property("value")),""==e.trim()&&(e="..."),e=e.replace(/\|/g," "),dm_Datamap.changeNodeName(c,e),dm_UI.stopEvent(),dm_UI.removeEditingNode(c),dm_UI.multiEdit(b,c,!0)}},dm_UI.resetMouseOverSelection=function(a){dm_UI.lastMouseOverNode=a,dm_UI.nodeOntoDisplayTooltip=a,a&&(console.log('=====> set lastMouseOverNode to "'+a.name+'"'),console.log('=====> set nodeOntoDisplayTooltip to "'+a.name+'"')),dm_Physics.drawRotatingTarget(d3.select("#graph"),a,40)},dm_UI.popoverTemplate=function(a){return'<div class="popover" id="nodePopover_'+a+'">'+'	<div class="arrow"></div>'+'	<div id="tooltipPopoverAnchor" class="popover-inner" style="min-width: 274px; width: 274px;">'+'  	    <div id="tooltipTitleInputParent" class="popover-title" onmousedown="dm_UI.multiEdit(\'tooltipTitleInput\', null, true, '+a+', null, null, true)"></div>'+'		<div class="popover-content">'+"			<p></p>"+"       </div>"+"	</div>"+"</div>"},dm_UI.getOrCreateAnchor=function(a,b){b||(b=dm_UI.nodeOntoDisplayTooltip);var c=$("#popoverAnchor_"+b.id);return a&&(c.remove(),c=null),c&&c[0]||(d3.select("body").append("div").attr("id","popoverAnchor_"+b.id).attr("class","dm_popoverAnchor"),c=$("#popoverAnchor_"+b.id)),c},dm_UI.resizePopoverAnchor=function(){var a=dm_UI_zoomLevel>=1?0:dm_UI_zoomLevel>.5?48:64,b=dm_UI_zoomLevel>=1?0:dm_UI_zoomLevel>.5?6:8;d3.selectAll("#tooltipPopoverAnchor").style("min-width",""+(274-a-2*b)+"px"),d3.selectAll("#tooltipPopoverAnchor").style("width",""+(274-a-2*b)+"px"),d3.selectAll(".popover-content").style("padding",""+(14-b)+"px")},dm_UI.getPopoverPlacement=function(a){var b=dm_UI_getGraphWidth(),c=dm_UI_getBodyHeight(),d=25,e="right",f=0,g=0,h=a.x,i=a.y;return a.y>c-c*d/100?(e="top",f=dm_UI_zoomLevel>=1?1:dm_UI_zoomLevel>.5?31:41,g=dm_UI_zoomLevel>=1?2:dm_UI_zoomLevel>.5?14:18):a.x<b*d/100?(e="right",g=dm_UI_zoomLevel>=1?0:dm_UI_zoomLevel>.5?7:9):a.y<c*d/100?(e="bottom",f=dm_UI_zoomLevel>=1?0:dm_UI_zoomLevel>.5?31:41):a.x>b-b*(d/(dm_BeforeAll.displayAttrPanel?2:1))/100?(e="left",f=dm_UI_zoomLevel>=1?2:dm_UI_zoomLevel>.5?62:82,g=dm_UI_zoomLevel>=1?0:dm_UI_zoomLevel>.5?7:8):g=dm_UI_zoomLevel>=1?0:dm_UI_zoomLevel>.5?7:9,d3.select("#popoverAnchor_"+a.id).style("position","absolute").style("left",""+(h+f)+"px").style("top",""+(i+g)+"px"),e},dm_UI.displayTooltip=function(){if(dm_UI.destroyPreviousTooltip(),!dm_graph_Force.draggingNode&&dm_UI.nodeOntoDisplayTooltip){dm_UI.nodeOntoDisplayTooltip.px=dm_UI.nodeOntoDisplayTooltip.x,dm_UI.nodeOntoDisplayTooltip.py=dm_UI.nodeOntoDisplayTooltip.y,dm_UI.nodeOntoDisplayTooltip.fixed=!0;var a=dm_UI.getOrCreateAnchor(!0);dm_UI.previousTooltipAnchor=a,a.popover({title:"<h3 id='tooltipTitleInput'>"+dm_UI.nodeOntoDisplayTooltip.name+"</h3>",placement:dm_UI.getPopoverPlacement(dm_UI.nodeOntoDisplayTooltip),content:dm_ToolsUI.dom2html(dm_ToolsUI.cloneAndChangeAttr("#buttonNodeMoveDown",[{name:"style",value:""}]))+dm_ToolsUI.dom2html(dm_ToolsUI.cloneAndChangeAttr("#buttonNodeMoveUp",[{name:"style",value:"margin-left: 10px;"}]))+dm_ToolsUI.dom2html(dm_ToolsUI.cloneAndChangeAttr("#buttonAddChildNode",[{name:"style",value:"margin-left: 10px;"}]))+dm_ToolsUI.dom2html(dm_ToolsUI.cloneAndChangeAttr("#buttonRemoveNode",[{name:"style",value:"margin-left: 10px;"}]))+"<br/>"+dm_ToolsUI.dom2html(dm_ToolsUI.cloneAndChangeAttr("#buttonNodeCopy",[{name:"style",value:"margin-top: 10px;"}]))+dm_ToolsUI.dom2html(dm_ToolsUI.cloneAndChangeAttr("#buttonNodePaste",[{name:"style",value:"margin-left: 10px; margin-top: 10px;"}]))+dm_ToolsUI.dom2html(dm_ToolsUI.cloneAndChangeAttr("#openFileButton",[{name:"style",value:"margin-left: 10px; margin-top: 10px;"}],null,null,""))+dm_ToolsUI.dom2html(dm_ToolsUI.cloneAndChangeAttr("#buttonNodeEdit",[{name:"style",value:"margin-left: 10px; margin-top: 10px;"}])),template:dm_UI.popoverTemplate(dm_UI.nodeOntoDisplayTooltip.id)}),a.popover("show"),d3.selectAll(".popover-content").style("padding","10px"),dm_UI.isTooltipDisplayed=!0,dm_UI.resizePopoverAnchor(dm_UI.nodeOntoDisplayTooltip),dm_UI.removeEditingNode(dm_UI.nodeOntoDisplayTooltip),dm_UI.multiEdit("tooltipTitleInput",dm_UI.nodeOntoDisplayTooltip,!0,null,!0,null,!0),dm_UI.activateNodeContextualActions()}},dm_UI.destroyPreviousTooltip=function(a){d3.selectAll(".dm_popoverAnchor").remove();var b;dm_UI.nodeOntoDisplayTooltip&&(b=dm_UI.getOrCreateAnchor()),b!=dm_UI.previousTooltipAnchor&&dm_UI.destroyTooltip(dm_UI.previousTooltipAnchor,!0,a),dm_UI.previousTooltipAnchor=b},dm_UI.destroyTooltip=function(a,b,c){dm_UI.tooltipMouseOver||!a&&dm_UI.nodeOntoDisplayTooltip&&(a=dm_UI.getOrCreateAnchor()),a&&(a.popover("destroy"),c||dm_UI.isTooltipDisplayed&&dm_UI.nodeOntoDisplayTooltip&&dm_UI.nodeOntoDisplayTooltip.fixed&&(dm_UI.nodeOntoDisplayTooltip.x=dm_UI.nodeOntoDisplayTooltip.px,dm_UI.nodeOntoDisplayTooltip.y=dm_UI.nodeOntoDisplayTooltip.py,dm_UI.nodeOntoDisplayTooltip.fixed=!1),dm_UI.isTooltipDisplayed=!1,b||(dm_UI.nodeOntoDisplayTooltip=null))},dm_UI.enableButton=function(a,b){var c=!0;null!=b&&(c=b),$(a).attr("disabled",!c)},dm_UI.playZik=function(a){try{if(window.HTMLAudioElement){var b=new Audio("");b.canPlayType("audio/mp3")&&(b=new Audio("data/"+a)),console.log("play zik : data/"+a),setTimeout(function(){b.play()},1)}}catch(c){console.log("cannot play associated song : 'data/"+a+"'"),console.log(c.message)}},dm_UI.createIFrame=function(a,b,c,d,e,f,g,h,i){var j=d3.selectAll("#"+a);if(f){j.append("textarea").attr("id",a+"_txtArea").style("width","100%").style("height","120px");var k=function(){var b=d3.select("#"+a).select(".wysihtml5-sandbox")[0][0],c=b.contentWindow||b.contentDocument;return c};$("#"+a+"_txtArea").wysihtml5({"font-styles":!1,emphasis:!1,lists:!1,html:!1,link:!1,image:!1,color:!1,events:{load:function(){setTimeout(function(){$("#"+a).find(".wysihtml5-sandbox").attr("id",b);var f=k(),h=f.document.body;h.setAttribute("contenteditable","false"),h.setAttribute("spellcheck","false"),h.innerHTML=c?c:"",d&&$("#"+b).attr("src",d),dm_UI.resizeModalContent(i),g&&d3.select("#"+b).style("height",""+d3.selectAll("#"+a).attr("height")),d3.select("#"+b).style("background-color","transparent").style("border-color","rgb(255, 255, 255)").style("border-width","2px");var j=$("#"+b).contents().find("body");j.css("background-color","rgba(255,255,255,0)"),j.css("color","rgb(0,0,0)"),e&&e()},h)}}}),$("#"+a).find("wysihtml5-toolbar").css("width","100%")}else{var k=function(){var a=d3.select("#"+b)[0][0],c=a.contentWindow||a.contentDocument;return c},l=function(){var d=k(),f=d.document.body;c&&(f.innerHTML=c?c:""),dm_UI.resizeModalContent(i),g&&d3.select("#"+b).style("height",""+d3.selectAll("#"+a).attr("height")),e&&e()};$("#"+b).off("load"),j.append("iframe").attr("id",b).attr("src",d?d:"").attr("seamless","seamless").attr("frameborder","0").attr("scrolling","no").attr("scroll","no").style("background-color","transparent").attr("width","100%").on("load",function(){setTimeout(function(){l()},h)})}},dm_UI.modalShown=[],dm_UI.expandWindow=function(a,b,c,d,e,f){dm_UI.destroyPreviousTooltip(),dm_Physics.freezeNodeTarget(),dm_3D.freeze(),dm_UI.modalShown.push(a),$("#"+a+"-modal").off("hide"),$("#"+a+"-modal").on("hide",function(){dm_UI.modalShown.pop(),c||dm_Tools.removeAndReplaceDiv(a+"-modal",a+"-modal-body","modal-body")}),$("#"+a+"-modal").off("hidden"),$("#"+a+"-modal").on("hidden",function(){d&&d()}),c||dm_Tools.removeAndReplaceDiv(a+"-modal",a+"-modal-body","modal-body"),b&&b(),$("#"+a+"-modal").off("fading"),$("#"+a+"-modal").on("fading",function(){f&&f()}),$("#"+a+"-modal").off("shown"),$("#"+a+"-modal").on("shown",function(){e&&e(),$("#"+a+"-modal").off("shown")}),$("#"+a+"-modal").on("hide",function(){$("iframe")&&$("iframe").attr("src")&&$("iframe").attr("src","")}),dm_UI.resizeModal()},dm_UI.resizeModal=function(){dm_UI.modalShown&&(dm_UI_zoomWidgets(),dm_UI.modalShown.forEach(function(a){var b=$("#"+a+"-modal").attr("borderMarginPercent");b||(b=10);var c=window.innerWidth*b/100,d=window.innerHeight*b/100,e=$("#"+a+"-modal").modal();e.css({width:function(){return window.innerWidth-c},height:function(){return window.innerHeight-(d-4)},"margin-left":function(){return-(window.innerWidth-c)/2},"margin-top":function(){return-(window.innerHeight-(d-4))/2}}),$("#"+a+"-modal-body").css({height:function(){var a=dm_UI_zoomLevel>=1?0:dm_UI_zoomLevel>.5?11:16;return window.innerHeight-d-94+a},"max-height":function(){var a=dm_UI_zoomLevel>=1?0:dm_UI_zoomLevel>.5?11:16;return window.innerHeight-d-94+a}})}))},dm_UI.expandWorkInProgressWindowTime,dm_UI.openWorkInProgress=function(a,b){dm_UI.expandWorkInProgressWindowTime=(new Date).getTime(),dm_UI.expandWindow("workInProgress",null,!0,null,b),dm_Attributes.setBackgroundGradient("#AEBED4","#FFFFFF",d3.selectAll("#workInProgress-modal-body")),a&&dm_UI.activateProgressBar()},dm_UI.closeWorkInProgress=function(){dm_UI.closeModal("workInProgress")},dm_UI.resizeSlider=function(a,b){if(a){var c=$(a)[0];if(c){var d=jQuery.data(c,"data");d&&(d.width=b,dm_UI.createSlider(a,d.min,d.max,d.unit,d.currentValue,b,d.onlyRoundedTicks,d.callback))}}},dm_UI.createSlider=function(a,b,c,d,e,f,g,h){function i(){d3.event.sourceEvent?(q=r.invert(d3.mouse(this)[0]),j()):(n=s.extent()[0],w.attr("cx",r(n)))}function j(){return k?!1:(k=!0,d3.timer(function(){if(n=Math.abs(n-q)<.001?q:q*o+n*(1-o),u.call(s.extent([n,n])).call(s.event),k=n!==q,!k){var b=Math.round(n);n!=b?(q=b,j()):h&&(jQuery.data($(a)[0],"data").currentValue=n,h(n))}return!k}),void 0)}if(a){var k,l={top:10,right:20,bottom:20,left:20},f=f||$(a).width(),m=40,n=0,o=.5,p=14,q=e;jQuery.data($(a)[0],"data",{min:b,max:c,width:f,height:m,unit:d,currentValue:e,onlyRoundedTicks:g,callback:h}),dm_UI_calculateZoom(),p=10>p*dm_UI_zoomRatio?10:p*dm_UI_zoomRatio;var r=d3.scale.linear().domain([b,c]).range([0,f]).clamp(!0),s=d3.svg.brush().x(r).on("brush",i);d3.selectAll(a).selectAll("svg").remove();var t=d3.selectAll(a).append("svg").attr("id","svgSlider").attr("width",f+l.left+l.right).attr("height",m+l.top+l.bottom).append("g").attr("transform","translate("+l.left+","+l.top+")");t.append("g").attr("class","x axis").attr("id","gXaxisSlider").attr("transform","translate(0,"+m/2+")").call(d3.svg.axis().scale(r).orient("bottom").ticks(c-b).tickFormat(function(a){return a+(d?d:"")}).tickSize(0).tickPadding(p+6)).select(".domain").select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","halo"),$(a+" .axis").css("font","10px sans-serif").css("-webkit-user-select","none").css("-moz-user-select","none").css("user-select","none"),$(a+" .axis .domain").css("fill","none").css("stroke","#000").css("stroke-opacity",".3").css("stroke-width","10px").css("stroke-linecap","round"),$(a+" .axis .halo").css("fill","none").css("stroke","#ddd").css("stroke-width","8px").css("stroke-linecap","round"),$(a+" .slider .handle").css("fill","#fff").css("stroke","#000").css("stroke-opacity",".5").css("stroke-width","1.25px").css("pointer-events","none");var u=t.append("g").attr("id","slider").attr("class","slider").call(s);u.selectAll(".extent,.resize").remove(),u.select(".background").attr("height",m);var v=u.append("defs").append("linearGradient").attr("id","gradButtonSlider").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");v.append("stop").attr("offset","0%").attr("style","stop-color:rgb(252,255,244);stop-opacity:1"),v.append("stop").attr("offset","100%").attr("style","stop-color:rgb(179,190,173);stop-opacity:1");var w=u.append("circle").attr("class","handle").attr("transform","translate(0,"+m/2+")").attr("r",p).style("fill","url(#gradButtonSlider)").style("stroke","#333").style("stroke-width","1.5px");u.call(s.extent([q,q])).call(s.event)}},dm_UI.moveSlider=function(a,b){d3.selectAll(a).selectAll("#svgSlider");var c=jQuery.data($(a)[0],"data"),d=d3.selectAll(a).selectAll(".handle"),e=d3.scale.linear().domain([c.min,c.max]).range([0,c.width]).clamp(!0);c.currentValue=b,d.attr("cx",e(b))},dm_UI.fixRequestAnimationFrame=function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),dm_Attributes.aggregate=function(a,b){var c,d=[],e="function console() {} ; console.log = function(str) { self.postMessage({'console.log': str }) ; } ; var node ;\n",f=function(a){for(var b,c=a.length,d=0;c>d;d++){b=a[d],b.toExecute="function "+dm_Tools.formatJSVarName(b.name)+"_aggregateFunc(node, nodes) { \n"+dm_Tools.indent(1)+"if(!node.rawNode) { node.rawNode = {} ; } \n";for(var f in b)"name"!=f&&"execAfterChildrenVisit"!=f&&"value"!=f&&"toExecute"!=f&&(b.toExecute+=dm_Tools.indent(1)+"node.rawNode['"+b.name+"."+f+"'] = '"+b[f]+"' ;\n");b.toExecute+=dm_Tools.indent(1)+b.value+"\n"+"}\n",e+=b.toExecute}},g=function(a,b,c){var e;d.indexOf(c)<0&&(d.push(c),f(c));for(var e,i=c.length,j=0;i>j;j++)e=c[j],e.execAfterChildrenVisit||(a=h(a,b,e));if(b.children){i=b.children.length;for(var k,j=0;i>j;j++)k=b.children[j],a=g(a,k,c)}i=c.length;for(var j=0;i>j;j++)e=c[j],e.execAfterChildrenVisit&&(a=h(a,b,e));return a},h=function(a,b,d){a+="\n",b.rawNode||(b.rawNode={});var e="node = nodes.listById["+b.id+"] ; // node name: "+b.name+"\n"+"node.rawNode['"+d.name+"'] = "+dm_Tools.formatJSVarName(d.name)+"_aggregateFunc(node, nodes) ; // node name: "+b.name+"\n";return c.push(e),a+=e},i=function(){console.log("pre aggregation processing"),dm_Tools.parseNumbersOfTree(a)};i();var j=function(a,c){console.log("post aggregation processing"),null!=b&&b(a,c)},k=dm_Tools.getConfig(a).aggregate;if(!k)return j(),void 0;var l="";c=[],l=g(l,a,k),l=e+l,dm_UI.activateProgressBar();var m=function(b){var c=b.data.percent;if(dm_UI.updateProgressBar(c),c>=100){dm_UI.deActivateProgressBar(),dm_BeforeAll.dm_AggregationWorker.removeEventListener("message",m,!1);var d=b.data.root,e=dm_Tools.parseStringified(d);dm_Tools.restoreParentsInTree(e),j(e,a)}};dm_BeforeAll.dm_AggregationWorker.addEventListener("message",m,!1);var n=a.parent;dm_Tools.removeProps4nodes(a,"parent");var o=dm_Tools.stringify(a);a.parent=n;var p=dm_Tools.stringify(c);dm_BeforeAll.dm_AggregationWorker.postMessage({cmd:"addListener"}),dm_BeforeAll.dm_AggregationWorker.postMessage({cmd:"aggregate",root:o,aggregDeclaration:e,aggregCodeParts:p})},dm_Attributes.setBackgroundGradient=function(a,b,c){c.style("margin","0px").style("background-color",a).style("*background-color",b).style("background-image","-ms-linear-gradient(top, "+a+", "+b+")").style("background-image","-webkit-gradient(linear, 0 0, 0 100%, from("+a+"), to("+b+"))").style("background-image","-webkit-linear-gradient(top, "+a+", "+b+")").style("background-image","-o-linear-gradient(top, "+a+", "+b+")").style("background-image","-moz-linear-gradient(top, "+a+", "+b+")").style("background-image","linear-gradient(top, "+a+", "+b+")")},dm_Attributes.setBackground=function(a,b,c){dm_Tools.bestEffortLevel(a);var d,e=dm_Tools.getConfig(a).styles[a.level];d=e.attrPaneCol?e.attrPaneCol:dm_Tools.colors[2*a.level+1],d=dm_Tools.getColorInGradient(d,"#888888",25),c&&(d=dm_Tools.getColorInGradient(d,"#FFFFFF",c));var f=dm_Tools.getColorInGradient(d,"#FFFFFF",80);dm_Attributes.setBackgroundGradient(d,f,b)},dm_Attributes.drawGraphLegend=function(a,b){var c=a.append("td").append("div").attr("class","table table-bordered table-striped table-condensed").attr("id","attrGraphicTable").append("tbody"),d=0,e=function(a,b){var b=b||20,c=a;return a.length>b&&(c=a.substring(0,b)+"..."),c};c.selectAll("tr").data(b.elts).enter().append("tr").selectAll("td").data(function(a){var c=a.valueStr||dm_Tools.convertNumber(a.value);return b.displayNames&&b.displayUnits?[e(a.name),c,a.unit]:b.displayNames?[e(a.name),c]:b.displayUnits?[c,a.unit]:[c]}).enter().append("td").style("text-align",function(a,c){var d="left";return b.displayNames&&b.displayUnits?0==c?d="center":1==c?d="right":2==c&&(d="left"):b.displayNames?0==c?d="center":1==c&&(d="right"):b.displayUnits?0==c?d="right":1==c&&(d="left"):d="center",d}).style("padding","1px 3px").append("div").attr("class",function(a,c){var d="forgetit";return(c==b.displayNames?1:0)&&(d="badge"),d}).style("background-color",function(a,c){var e="";return c==(b.displayNames?1:0)&&(e=b.elts[d].color||dm_Tools.colors[d]),c==(b.displayNames&&b.displayUnits?2:b.displayNames||b.displayUnits?1:0)&&d++,e}).html(function(a){return a})},dm_Attributes.isEditable=function(a,b){return b&&b.edit||1==a.edit||"true"==a.edit},dm_Attributes.getId=function(a,b,c,d){var e=a||"";return d&&d.id&&(e+="_"+d.id),c&&c.name&&(e+="_"+c.name),b&&b.name&&(e+="_"+b.name),b&&(e+="_"+b.dm_uniqueId),e=dm_Tools.formatJSVarName(e)},dm_Attributes.drawAttributeText=function(a,b,c,d){var d=d||{},e=dm_Datamap.getCurrentDmFromNode(b),f=f||e.props2query,g=dm_Attributes.getId("attribute_text_",a,b,d),h=b.rawNode?b.rawNode[a.name]:null;null===h&&(h=""),h=dm_Tools.convertNumber(h);var i;if(null!=h&&""!=h||!a.dontDisplayNull){var j,k,l,m=60,n=dm_Tools.removePxAndParseInt(c.style("width"))||90*dm_UI_getWidth()/100;n=Math.min(n,500),j=c.append("div").attr("class","control-group attributes"),d.nestedAttr?j.style("display","inline-block"):j.style("width","100%").style("-webkit-box-sizing","border-box").style("-moz-box-sizing","border-box").style("box-sizing","border-box");var o=0;d.noLabel?j.style("margin-bottom","0px"):(k=j.append("label").attr("class","control-label").text((a.label||a.name)+":"),d.nestedAttr?k.style("margin-left","10px"):k.style("width","50%").style("display","inline-block").style("-webkit-box-sizing","border-box").style("-moz-box-sizing","border-box").style("box-sizing","border-box").style("margin","0px auto").style("border","0px auto").style("padding","0px auto").style("padding-right","4px"),o=10+(n-m)/2),l=j.append("div").attr("class","controls"),d.nestedAttr?l.style("display","inline-block"):l.style("width","50%").style("display","inline-block").style("-webkit-box-sizing","border-box").style("-moz-box-sizing","border-box").style("box-sizing","border-box").style("margin","0px auto").style("border","0px auto").style("padding","0px auto"),i=dm_Attributes.isEditable(a,d)?l.append("input").attr("id",g).attr("type","text").attr("class","attribute-search-query").attr("data-provide","typeahead").attr("data-items","8").attr("value",h):l.append("div").attr("id",g).attr("class","well uneditableAttributeValue").html(h),d.inputWidth?i.style("width",""+d.inputWidth+"px").style("max-width",""+d.inputWidth+"px"):(i.style("width","100%").style("-webkit-box-sizing","border-box").style("-moz-box-sizing","border-box").style("box-sizing","border-box").style("margin","0px auto").style("border","0px auto").style("padding","0px auto"),dm_Attributes.isEditable(a,d)&&i.style("height","27px")),dm_Datamap.feedSearchQuery(g,f[a.name],function(c,e){if(d.onChange&&e)d.onChange(c);else{var f=b.rawNode[a.name];""==c&&!f||f==c||(console.log("setting : "+c+' to "'+b.name+'"['+a.name+"]"),b.rawNode[a.name]=c),d.onPostChange&&e&&d.onPostChange(c)}})}return i},dm_Attributes.drawGraph=function(a,b,c,d){var e,f,g,h,i=dm_Attributes.computeGraphValues(a,b);if(i){var j=dm_Attributes.getId("attribute_graph_",a,b,d),k="canvas";if(a["3D"]){var l=dm_Tools.isInModal(c),m=.9*c[0][0].offsetWidth;(l||0==m)&&(m=.7*window.innerWidth);var n=c.append("div").attr("id",j+(l?"_inModal":"")).append(k).attr("id",j+"_3D_canvas"+(l?"_inModal":"")).attr("width",m).attr("height",.3*m);dm_3D.draw(n,k,dm_3D.donut(i))}else{e=c.append("div").attr("class","well attributesGraphic").style("margin-left",""+(1>dm_UI_zoomRatio?5:10)+"px").style("margin-right",""+(1>dm_UI_zoomRatio?5:10)+"px").style("padding",""+(1>dm_UI_zoomRatio?5:15)+"px").append("table").attr("id",j).attr("align","center"),e.attr("dm_graph_values",dm_Tools.stringify(i));var o,p=function(){var a=dm_Tools.parseStringified($("#"+j).attr("dm_graph_values"));dm_UI.expandWindow("graph3D",function(){d3.selectAll("#graph3D-modal-title").html(""+a.title),dm_Attributes.setBackground(dm_UI.lastMouseOverNode,d3.selectAll("#graph3D-modal-body"),30)},!0,function(){dm_3D.reset(o)},function(){var b=a.title;b=b?b:"",d3.selectAll("#graph3D-modal-title").html(""+b),dm_Attributes.setBackground(dm_UI.lastMouseOverNode,d3.selectAll("#graph3D-modal-body"),30),d3.selectAll("#graph3D_canvas").remove();var c=d3.selectAll("#graph3DContainer").append(k).attr("id","graph3D_canvas");dm_UI.resizeModalContent("graph3D"),o=dm_3D.draw(c,k,dm_3D.donut(i)),$(c[0][0]).data("obj3D",o)})};dm_UI_eventCallbacks[j]=p,f=e.append("tr"),a.label&&(f.append("td").attr("colspan","2").append("label").html(a.label),f=e.append("tr")),g=f.append("td").style("padding-right","10px"),h=new dm_chart_Pie(g,i,150*(.5>dm_UI_zoomRatio?.5:dm_UI_zoomRatio),a.doTransition,a.textInPie,a.namesInPie,.5>dm_UI_zoomRatio?.5:dm_UI_zoomRatio),dm_Attributes.drawGraphLegend(f,i),i.elts.length>1&&h.createChart()}}},dm_Attributes.drawRTF=function(a,b,c,d){var e=dm_Attributes.getId("attribute_rtf_",a,b,d);d3.selectAll("#"+e).remove(),c.append("div").attr({id:e,align:"center"}).style("width","100%");var f=b.rawNode[a.name];
if(c.selectAll("#"+e).style("margin-bottom","10px").style("margin-top","10px").html(f),dm_Attributes.isEditable(a,d)){var g=dm_Tools.getStyleSheets(),h=function(a){var b=a.indexOf("<body>");0>b?b=0:b+="<body>".length;var c=a.indexOf("</body>");return 0>c&&(c=a.length),a.substring(b,c)};CKEDITOR.replace(e,{fullPage:!0,allowedContent:!0,extraPlugins:"codemirror",on:{instanceReady:function(){var a=this.document;g.forEach(function(b){a.appendStyleSheet(b)})},change:function(){console.log('updating rich text in "'+b.name+'"['+a.name+"]"),b.rawNode[a.name]=h(CKEDITOR.instances[e].getData())}}})}},dm_Attributes.drawJS=function(a,b,c,d){var e=dm_Attributes.getId("attribute_js_",a,b,d),f=e+"_editor";d3.selectAll("#"+e).remove(),c.attr("width","100%");var g=$(c[0][0]).parent();g.css("width","100%");var h=c.append("div").attr("id",e).append("table").style("width","100%").append("tr");d&&d.label&&h.append("td").append("label").style("margin-left","10px").style("margin-right","5px").html(d.label);var g=h.append("td").style("width","100%"),i=g.append("form").style("position","relative").style("margin-top",".5em").style("margin-bottom","6px").style("margin-right","5px").style("min-width",d&&d.minWidth?d.minWidth+"px":"300px").attr("align","left");d&&d.nestedAttr||i.attr("class","javascriptEditorResizableWidth");var j=i.append("textarea").attr("id",f).style("margin-bottom","10px").style("margin-right","10px"),k=b.rawNode[a.name];"string"!=typeof k&&(k=dm_Tools.stringify(k)),d&&d.value&&(k=d.value);var l=function(c){d&&d.obj4value&&d.prop4value?d.obj4value[d.prop4value]=c:b.rawNode[a.name]=c};d3.selectAll("#"+f).style("margin-bottom","0px").html(k);var m=ace.edit(f);m.setOptions({highlightActiveLine:!0,highlightSelectedWord:!0,readOnly:!dm_Attributes.isEditable(a,d),autoScrollEditorIntoView:!0,maxLines:1/0,theme:"ace/theme/monokai",mode:"ace/mode/javascript",tabSize:4,vScrollBarAlwaysVisible:!1}),m.width="100%",m.on("blur",function(){l(m.getValue())}),m.on("change",function(){l(m.getValue())}),m.on("blur",function(){d.onPostChange&&d.onPostChange(m.getValue())}),i.style("height","250px;"),j.style("height","250px;"),m.resize(!0)},dm_Attributes.drawImage=function(a,b,c,d){var e,d=d||{},f=function(){var b={width:null,height:null};if(!d.leaveRawSize){b.width=a.width,b.height=a.height;var c=1,e=1,f=dm_UI_calculateZoom(),g=$("#attributesPanelContent").width()/f,h=$("#attributesPanelContent").height()/f,i=""!=$.trim($("#attributes-modal-body").html()),j=30;if(i){var k=77;g=$("#attributes-modal").width(),h=$("#attributes-modal").height(),h-=k}g-=j,h-=j;var l=Math.min(a.panelMaxWidth||a.width,g);l-=15;var m=a.panelMaxHeight||a.height;i&&(m=Math.min(a.panelMaxHeight||a.height,h)),m-=15,l&&a.width>l&&(c=l/a.width),m&&a.height>m&&(e=m/a.height),e>c?(b.width=a.width*c,b.height=a.height*c):(b.width=a.width*e,b.height=a.height*e)}return b},g=function(){if(d.propName){for(var c in a)b.rawNode[d.propName+".dm_props"][c]=a[c];console.log("resync image to "+b.name+".rawNode["+d.propName+".dm_props]")}};if(a){var h,i=dm_Attributes.getId("attribute_image_",prop,b,d),j=i+"_img";h=a.inlineSrc?a.inlineSrc:"data/images/"+a.imageName;var k=c.append("div").attr("id",i);e=a.borderRadius?dm_Tools.noShow().append("img").attr("id",j).attr("src",h):k.append("img").attr("id",j).attr("src",h),d.noMargin||e.style("margin","10px");var l=d.width||f().width;l&&e.attr("width",""+l+"px");var m=d.height||f().height;m&&e.attr("height",""+m+"px");var n=function(){var f=a.borderRadius;if(f&&(e.remove(),e=k.append("div").attr("id",j).style("border-radius",""+f+"px").style("-moz-border-radius",""+f+"px").style("-khtml-border-radius",""+f+"px").style("-webkit-border-radius",""+f+"px").style("width",""+l+"px").style("height",""+m+"px").style("background","url('"+h+"')").style("background-size",""+l+"px"+" "+m+"px"),d.noMargin||e.style("margin","10px"),d.edit||k.attr("align","center")),d.edit){e.style("float","left");var n=k.append("div").style("display","inline"),o=function(){d3.selectAll("#"+i).remove(),dm_Attributes.drawImage(a,b,c,d),g()},p=function(a,b){if(a.name&&0==a.name.indexOf("config.styles")){var c=a.rawNode;dm_graph_Force.tintIcon(null,b,null,c.color)}else dm_graph_Force.tintIcon(a,b)},q=function(e){b.rawNode[d.propName]!=e&&(d.leaveRawSize=!0,a.inlineSrc=null,d3.selectAll("#"+i).remove(),dm_Attributes.drawImage(a,b,c,d),g(),console.log("setting : "+e+' to "'+b.name+'"['+d.propName+"]"),b.rawNode[d.propName]=e,p(b,a))},r=function(e){d.leaveRawSize=!0,a.imageName=a.inlineSrc,d3.selectAll("#"+i).remove(),dm_Attributes.drawImage(a,b,c,d),console.log("setting : "+e+' to "'+b.name+'"['+d.propName+"]"),b.rawNode[d.propName]=e,p(b,a)},s=function(e){b.rawNode[d.propName+".dm_props"].borderRadius=e,d3.selectAll("#"+i).remove(),dm_Attributes.drawImage(a,b,c,d)},t={imageName:{inputWidth:300,onPostChange:q},width:{inputWidth:40,onPostChange:o},height:{inputWidth:40,onPostChange:o},panelMaxHeight:{inputWidth:40,onPostChange:o},scaleFactor:{inputWidth:30,onPostChange:o},textX:{inputWidth:40,onPostChange:o},x:{inputWidth:40,onPostChange:o},y:{inputWidth:40,onPostChange:o},inlineSrc:{inputWidth:300,onPostChange:r},borderRadius:{inputWidth:40,onPostChange:s}};for(var u in t)dm_Attributes.drawAttributeText({name:u},{rawNode:a,name:b.name},n,{edit:!0,nestedAttr:!0,inputWidth:t[u].inputWidth,onPostChange:t[u].onPostChange})}};e.on("load",function(){l||(l=e[0][0].width),m||(m=e[0][0].height),d.leaveRawSize&&(a.width=l,a.height=m,a.panelMaxHeight=a.panelMaxHeight||m,a.scaleFactor=1,d.leaveRawSize=!1),a.panelMaxHeight!=m&&(d.leaveRawSize=!1,e.attr("width",""+f().width+"px"),e.attr("height",""+f().height+"px")),g(),n()}),a.inlineSrc||dm_Tools.testFileExist("data/images/"+a.imageName,null,function(){console.log('image "data/images/'+a.imageName+'" not found...'),n()})}return e},dm_Attributes.drawAction=function(prop,node,parentUI,args){var actionContainerId=dm_Attributes.getId("attribute_action_",prop,node,args),actionButtonId=actionContainerId+"_btn",nodes=dm_Datamap.currentDatamap.nodes.getAll();parentUI.select("#"+actionContainerId).remove();var actionContainer=parentUI.append("div").attr("id",actionContainerId).style("width","100%"),actionButton=actionContainer.append("div").attr("id",actionButtonId).attr("class","btn "+(prop.class?prop.class:"")+" btn-small").style("margin-top","10px").style("margin-bottom","5px").style("text-align","left").style("text-shadow","none");prop.image&&(prop.imageName=prop.image,dm_Attributes.drawImage(prop,node,actionButton,{noMargin:!0,width:32,height:32}));var actionButtonImgHtml=actionButton.html(),idxCloseDiv=actionButtonImgHtml.lastIndexOf("</div>");idxCloseDiv&&(actionButtonImgHtml=actionButtonImgHtml.substring(0,idxCloseDiv)),node.rawNode&&node.rawNode[prop.name]&&actionButton.html("<h4>"+actionButtonImgHtml+"&nbsp;&nbsp;<span id='actionButtonText'>"+node.rawNode[prop.name]+"</span></h4>"+(idxCloseDiv>0?"</div>":""));try{eval(prop.execBefore)}catch(error){console.log("ERROR while executing "+prop.name+".execBefore",error.message)}if(dm_UI_eventCallbacks[actionButtonId]=function(){d3.selectAll("#attributeAction-modal-title").html(actionButton.html().replace(/<h[456789]>/g,"<h3>").replace(/<\/h[456789]>/g,"</h3>")),prop.music&&dm_UI.playZik(prop.music);try{eval(prop["content.exec"])}catch(error){console.log("ERROR while executing "+prop.name+".content.exec",error.message)}if("iframe"==prop["content.type"]){dm_Tools.removeAndReplaceDiv("attributeAction-modal-body","attributeActionContainer"),d3.selectAll("#attributeActionContainer").style("margin-right","10px");var innerHTML=prop.content,src=prop["content.url"],evalOutput;try{eval('evalOutput = "" + '+src+" ;"),src=evalOutput}catch(error){}dm_UI.createIFrame("attributeActionContainer","attributeActionContent",innerHTML,src,function(){d3.selectAll("#attributeActionContent").attr("frameborder","1").attr("scrolling","yes").attr("scroll","yes")},!1,!0,400,"attributeAction"),dm_UI.expandWindow("attributeAction",null,!0)}else if("window url"==prop["content.type"]){var src=prop.content;src||(src=prop["content.url"]),window.open(src)}else if("href"==prop["content.type"]){var src=prop.content;src||(src=prop["content.url"]),window.location.href=src}else if("goto"==prop["content.type"]){var target=prop["content.target"],evalOutput;try{eval('evalOutput = "" + '+target+" ;"),target=evalOutput}catch(error){}var targetNode=dm_Datamap.getNodeAndDmFromFullPath(target).node;dm_Datamap.currentDatamap.graph.init(targetNode,null,!0),dm_Datamap.focusNode(targetNode),dm_UI.resetMouseOverSelection(targetNode),dm_UI.autoResize()}},dm_Attributes.isEditable(prop,args)){var onChange=function(){dm_Attributes.drawAction(prop,node,parentUI,args)};dm_Attributes.drawAttributeText(prop,node,actionContainer,{edit:!0,nestedAttr:!0,inputWidth:300,onPostChange:onChange,id:actionContainerId}),dm_Attributes.drawAttributeText({name:"image"},{name:prop.name,rawNode:prop},actionContainer,{edit:!0,nestedAttr:!0,inputWidth:250,onPostChange:onChange,id:actionContainerId}),dm_Attributes.drawAttributeText({name:"class"},{name:prop.name,rawNode:prop},actionContainer,{edit:!0,nestedAttr:!0,inputWidth:100,onPostChange:onChange,id:actionContainerId}),dm_Attributes.drawJS({name:"execBefore"},{name:prop.name,rawNode:prop},actionContainer,{edit:!0,nestedAttr:!0,label:"execBefore:",id:actionContainerId}),dm_Attributes.drawJS({name:"content.exec"},{name:prop.name,rawNode:prop},actionContainer,{edit:!0,nestedAttr:!0,label:"content.exec:",id:actionContainerId});var type=prop["content.type"],form=actionContainer.append("form"),typeField=form.append("label").attr("class","checkbox").style("margin-left","10px").style("display","inline-block").append("table").append("tr");typeField.append("td").html("type:");var actionButtonTypeId=actionContainerId+"_type";$("#"+actionButtonTypeId).off("change");var typeSelect=typeField.append("td").append("select").attr("id",actionButtonTypeId).style("width","100px").on("change",function(){prop["content.type"]=typeSelect.property("value"),dm_Attributes.drawAction(prop,node,parentUI,args)}),createOption=function(a,b,c){var d=a.append("option");d.html(b),c==b&&d.attr("selected","true")};createOption(typeSelect,"other",type),createOption(typeSelect,"iframe",type),createOption(typeSelect,"window url",type),createOption(typeSelect,"href",type),createOption(typeSelect,"goto",type);var drawEditableActionButton=function(){var a=actionContainerId+"_props";actionContainer.select("#"+a).remove();var b=form.append("div").attr("id",a).style("display","inline-block");"iframe"==type?(prop.content,prop["content.url"]):"window url"==type?(dm_Attributes.drawAttributeText({name:"content"},{rawNode:prop},b,{edit:!0,nestedAttr:!0,inputWidth:400,onPostChange:onChange,id:actionContainerId}),dm_Attributes.drawAttributeText({name:"content.url"},{rawNode:prop},b,{edit:!0,nestedAttr:!0,inputWidth:400,onPostChange:onChange,id:actionContainerId})):"goto"==type&&dm_Attributes.drawAttributeText({name:"content.target"},{rawNode:prop},b,{edit:!0,nestedAttr:!0,inputWidth:400,onPostChange:onChange,id:actionContainerId})};drawEditableActionButton()}},dm_Attributes.drawDropdown=function(prop,node,parentUI,args){var dropdownContainerId=dm_Attributes.getId("attribute_dropdown_",prop,node,args),dropdownWidgetId=dropdownContainerId+"_widget",nodes=dm_Datamap.currentDatamap.nodes.getAll();parentUI.select("#"+dropdownContainerId).remove();var dropdownContainer=parentUI.append("div").attr("id",dropdownContainerId).style("width","100%"),dropdownForm=dropdownContainer.append("form").style("margin","0px"),dropdownField=dropdownForm.append("label").attr("class","checkbox").style("display","inline-block"),dropdownSelect=dropdownField.append("select").attr("id",dropdownWidgetId).style("width","200px").on("change",function(){node.rawNode[prop.name]=dropdownSelect.property("value")}),feedDropDownList=function(){var insertValue=function(a,b,c){var d=a.append("option");d.html(b),c==b&&d.attr("selected","true")},currentValue=node.rawNode[prop.name];$(dropdownSelect[0][0]).empty();var dropdownList=null;try{dropdownList=eval(prop.dropdownList)}catch(error){console.log("ERROR while executing "+prop.name+".dropdownList",error.message)}if(dropdownList)for(var i=0;i<dropdownList.length;i++)currentValue||0!=i||(currentValue=node.rawNode[prop.name]=dropdownList[i]),insertValue(dropdownSelect,dropdownList[i],currentValue)};feedDropDownList(),dm_Attributes.isEditable(prop,args)&&dm_Attributes.drawJS({name:"dropdownList"},{name:prop.name,rawNode:prop},dropdownContainer,{edit:!0,nestedAttr:!0,label:"dropdownList:",id:dropdownContainerId,onPostChange:feedDropDownList})},dm_Attributes.playZik=function(a,b){a.ifCenter||dm_UI.playZik(b.rawNode[a.name])},dm_Attributes.drawBoolean=function(a,b,c,d){var d=d||{},e=dm_Attributes.getId("attribute_boolean_",a,b,d),f=e+"_label",g=e+"_checkbox",h=e+"_input",i=10;d.noLabel&&(i=0);var j=c.append("label").attr("id",f).attr("class","checkbox").style("margin-left",""+i+"px"),k=j.append("table").attr("align","center").append("tr");d.noLabel||k.append("td").append("div").html(d.label||a.label||a.name),k.append("td").append("div").style("min-width","5px");var l=k.append("td").append("div").attr("class","slideThree").attr("id",g).style("margin","0px"),m=!1,n=b.rawNode,o="node.rawNode['"+a.name+"']";"dm_newAttribute"==a.name?(n=null,o="dm_newAttribute"):d.parentObj&&(n=d.parentObj,o="node.rawNode['"+d.parentObj.name+"'.dm_props]['"+a.name+"']"),d.value?m=d.value:!n||1!=n[a.name]&&"true"!=n[a.name]||(m=!0),$("#"+h).off("change");var p=l.append("input").attr("id",h).attr("type","checkbox").property("checked",m).on("change",function(){if(d.onChange)d.onChange();else{var b=p.property("checked");n&&(n[a.name]=b,console.log('WARNING setting "'+b+'" to '+o))}});return l.append("label").attr("for","slideThree"),p},dm_Attributes.drawTable=function(a,b,c,d){if(b.children){var d=d||{},e=dm_Attributes.getId("attribute_table_",a,b,d),f=c.append("div").attr({id:e,width:"100%"}).style({overflow:"scroll","margin-top":"10px"}),g=[],h=[],i=[]||i;i.splice(0,0,"displayName");for(var j=0;j<i.length;j++)for(var k=i[j],l=0;l<b.children.length&&h.indexOf(k)<0;l++)b.children[l].rawNode[k]&&h.push(k);for(var m,n,l=0;l<b.children.length;l++){m={},n=b.children[l],m.name=n.name;for(var j=0;j<h.length;j++)m[h[j]]=n.rawNode[h[j]];g.push(m)}h.splice(0,0,"name");var o=dm_Tools.deepCopy(h);o.splice(0,1,"sub elements"),"displayName"==o[1]&&o.splice(1,1,"display name");for(var p=[],l=0;l<h.length;l++)p.push({data:h[l]});console.log("table",g),console.log("columns",h),console.log("colHeaders",o);var q=new Handsontable(f[0][0],{data:g,colHeaders:o,columns:p,rowHeaders:!0,contextMenu:!0,stretchH:"all",contextMenu:!0,maxRows:1/0,currentRowClassName:"currentRow",currentColClassName:"currentCol",columnSorting:!0,manualColumnMove:!0,manualColumnResize:!0,className:"htMiddle",minSpareRows:0});return q}},dm_Attributes.drawConnectedTo=function(a,b,c,d){var e,d=d||{},f=dm_Attributes.getId("attribute_connectedTo_",a,b,d),g=450,h=300,i=c.append("div").attr("id",f).attr("class","carousel slide").attr("align","center").style("width",g+"px").style("height",h+"px"),j=i.append("ol").attr("class","carousel-indicators").attr("hidden",""),k=function(){j.selectAll("li").remove()},l=function(){e&&e.remove(),e=i.append("div").attr("class","carousel-inner")},m=b.rawNode[a.name],n="node.rawNode['"+a.name+"']";m||(m=[],b.rawNode[a.name]=m);var o,p,q=function(a){var a=a||0==m.length,b=j.append("li").attr("data-slide-to",m.length).attr("data-target","#"+f);a&&b.attr("class","active");var c=e.append("div").attr("class","item"+(a?" active":"")),d=document.createElement("button");d=d3.select(d),d.attr("class","btn btn-primary").style("width","280px").on("click",function(){m.push({nodePath:dm_Tools.getNodeUrl(dm_Datamap.currentDatamap.root,!0)}),console.log("Warning: "+n+" set to : "+JSON.stringify(m)),v(m.length-1)}),d.append("img").style("float","left").attr("src","images/plus_neg.png").attr("width",24).attr("height",24).style("margin","0px").style("min-width","16px").style("padding-top","2px"),d.append("label").style("color","white").style("padding-top","5px").html("&nbsp;&nbsp;Add a transverse link to another node"),dm_Tools.getIFrame(c,d,null,h).attr("id","connectedToInner_nextButton")},r=function(){for(var a=e.selectAll(".item")[0],b=0;b<a.length;b++)if($(a[b]).hasClass("active"))return b},s=function(a){for(var b,c=e.selectAll("iframe")[0],d=-1,f=0;f<c.length;f++)if(b=c[f],"connectedToInner_freeDatamapIFrame"==b.id&&d++,b==a[0][0])return d},t=function(a,c){var a=a;void 0==a&&(a=m.length-1);var d=m[a].nodePath,g=j.append("li").attr("data-slide-to",a).attr("data-target","#"+f);c&&g.attr("class","active");var i=e.append("div").attr("class","item"+(c?" active":"")),k=dm_Tools.getNodeFromPath(d).node,l=dm_Tools.getNodeUrl(k,!0);console.log("iframe connect to :",l);var o=dm_Tools.getIFrame(i,null,null,h).attr("src","?loadFromFileStream=true&noBckgrnd=true&onlyGraph=true&noAggreg=true").attr("id","connectedToInner_freeDatamapIFrame").style("border-radius","12px");console.log("jump to iframe and load="+l+"&noBckgrnd=true&onlyGraph=true&noAggreg=true");var p=o[0][0].contentWindow||o[0][0].contentDocument;o[0][0].onload=function(){console.log("iframe loaded");var a={$schema:"http://www.freedatamap.com/jsonSchema/schema#",root:dm_Tools.deepCopyDmNode(dm_Datamap.currentDatamap.root)};try{p.dm_Datamap.createNewDatamap(dm_Datamap.currentDatamap.root.dm_DatamapName,!1,null,l,null,null,null,null,a)}catch(c){console.log(c),console.log("openFile iFrame closed")}p.dm_BeforeAll.onNodeSelect=function(){var a=s(o),c=p.dm_Datamap.currentDatamap.graph.center,d=dm_Tools.getMinimumPath(b,c);m[a].nodePath=d,console.log("Warning: "+n+" set to : "+JSON.stringify(m))}};var q=i.append("div").attr("class","carousel-caption"),t=document.createElement("button");t=d3.select(t),t.attr("class","btn btn-danger").on("click",function(){m.splice(r(),1),console.log("Warning: "+n+" set to : "+JSON.stringify(m)),v(0)}),t.append("img").attr("src","images/KO.png").style("width","24px").style("height","24px").style("margin","0px").style("min-width","16px"),dm_Tools.getIFrame(q,t,49,37).attr("id","connectedToInner_removeButton").style("float","right"),q.append("p").style("text-align","center").style("font-size","16px").style("line-height","20px").html("Select and center the node you want to connect<br>(or remove the link)")},u=function(){o=i.append("a").attr("class","left carousel-control").attr("data-slide","prev").attr("href","#"+f).style("z-index",10).html("&lsaquo;"),p=i.append("a").attr("class","right carousel-control").attr("data-slide","next").attr("href","#"+f).style("z-index",10).html("&rsaquo;")};u();var v=function(a){k(),l();for(var b=0;b<m.length;b++)t(b,b==a);q()};return v(0),$(i[0]).carousel({interval:null}),i},dm_Attributes.drawAttribute=function(prop,node,parentUI,eltLabel,eltValue,args,dontExcludeBackground){var output;return prop.leaveEventsOn&&(dm_Tools.isArray(prop.leaveEventsOn)?dm_UI.attributesPanelLeaveEvents.concat(prop.leaveEventsOn):dm_UI.attributesPanelLeaveEvents.push(prop.leaveEventsOn)),"__dm_uniqueId"==prop.name||!dontExcludeBackground&&"backgroundImage"==prop.name||(output=prop.graph||"graph"==prop.type?dm_Attributes.drawGraph(prop,node,parentUI,args):"rich text"==prop.type?dm_Attributes.drawRTF(prop,node,parentUI,args):"javascript"==prop.type?dm_Attributes.drawJS(prop,node,parentUI,args):"image"==prop.type?dm_Attributes.drawImage(prop,node,parentUI,args):"action"==prop.type?dm_Attributes.drawAction(prop,node,parentUI,args):"dropdown"==prop.type?dm_Attributes.drawDropdown(prop,node,parentUI,args):"music"==prop.type?dm_Attributes.playZik(prop,node,parentUI,args):"boolean"==prop.type?dm_Attributes.drawBoolean(prop,node,parentUI,args):"transverse link"==prop.type?dm_Attributes.drawConnectedTo(prop,node,parentUI,args):dm_Attributes.drawAttributeText(prop,node,parentUI,args)),prop.onload&&eval(prop.onload),output},dm_Attributes.drawAttributesOrGraphs=function(a,b,c,d,e,f){f||(f="");var g=f;return $("#graph3D-modal").hasClass("in")||dm_3D.reset(),a.name!=dm_Tools_dm_config_name&&(g=dm_Tools.onDisplayableRawNodeProps(a,d,g,e)),g},dm_Attributes.updateAttributesPanel=function(a,b,c,d,e,f,g){var h=$("#attributes-modal").hasClass("in");if(!h||c&&dm_Tools.isInModal(c)){d3.selectAll("#attributesPanelParentUI").style("width",""+dm_UI_getAttributesPanelWidth()+"px");var a=a||dm_UI.lastMouseOverNode;dm_UI.lastAttrPanelUpdatedNode=a;var i=dm_Datamap.getCurrentDmFromNode(a),b=b||i.props2query;console.log("update attributes panel onto node :"),console.log(a),console.log("current datamap :"),console.log(dm_Datamap.currentDatamap),console.log("current datamap nodes length : "+(dm_Datamap.currentDatamap.nodes&&dm_Datamap.currentDatamap.nodes.getAll()?dm_Datamap.currentDatamap.nodes.getAll().length:0)),dm_UI.attributesPanelLeaveEvents=[];var j,k,l,m=dm_Tools.getConfig(a),n=m.displayProps,o=m.adminProps;dm_Attributes.editingTitle=!1;var p=function(){for(var a in dm_UI_eventCallbacks)0==a.indexOf("attribute_action_btn_")&&delete dm_UI_eventCallbacks[a]};if(!c){var q=d3.select("#attributesPanelParentUI").selectAll("#attributesPanel");q&&q.remove();var r=d3.select("#attributesPanelParentUI");c=r}if(!dm_BeforeAll.displayAttrPanel&&!g)return;if(d)q=c;else{var s=13;s+=10,s+=4,q=c.append("div").attr("id","attributesPanel").style("height",window.innerHeight-s+"px").style("border","0px")}if(!a)return;m.styles[a.level],dm_Attributes.setBackground(a,q),q.style("overflow","auto"),j=q.append("div").attr("id","attributesPanelContent").style("height","100%");var t=!1;if(t&&dm_Tools.isInModal(c)&&dm_UI_getWidth()>600&&!dm_Tools.is3DgraphInAttributes(a)&&j.style("padding","1em").style("-moz-column-count","2").style("-moz-column-gap","1em").style("-webkit-column-count","2").style("-webkit-column-gap","1em").style("column-count","2").style("column-gap","1em").style("overflow","auto"),!e){var u=j.append("table").attr("align","center").style("width","100%").append("tr");if(dm_BeforeAll.displayAttributePanelButtons){var v=u.append("td").attr("align","left").style("min-width","54px").attr("id","attributesPanelEnlargeButtonTd");v.append("button").attr("class","btn btn-large").attr("id","attributesPanelEnlargeButton").append("img").attr("src","images/expand2.png").attr("width",24).attr("height",24).style("margin","0px")}if(u.append("td").attr("id","attributesPanelTitleInputParent").attr("align","center").style("width","100%"),dm_UI.multiEdit("attributesPanelTitleInput",a,!0,a.id,!0),dm_BeforeAll.displayAttributePanelButtons)if(dm_BeforeAll.readOnlyConfig){var v=u.append("td").attr("align","left").style("min-width","54px").attr("id","attributesPanelSheetButtonTd");v.append("button").attr("class","btn btn-large").attr("id","bottomSheetButton").append("img").attr("src","images/table.png").attr("width",24).attr("height",24).style("margin","0px")}else u.append("td").attr("id","attributesPanelDropDownButtonTools").attr("align","right"),dm_Attributes.makeDropdownTools("#attributesPanelDropDownButtonTools")}dm_Tools.getImageFromNode(a,!1);var w=!1,x=function(b){(w||b)&&j.append("br"),k=j.append("form").attr("class","form-horizontal").attr("id","attributesPanel_form"),l=k.append("fieldset").attr("id","attributesPanel_fieldset"),dm_UI.activateNodeContextualActions(),p(),dm_Attributes.drawAttributesOrGraphs(a,n,o,dm_Attributes.drawAttribute,l),dm_UI_zoomWidgets()};x()}},dm_Attributes.applyZoom=function(a){dm_UI.zoom("#attributesPanelContent",a)},dm_Attributes.computeGraphValues=function(displayProp,node){var elts=eval("try {\nvar graphicValues = function() { "+displayProp.input+"}\n"+"graphicValues(node) ;\n} catch(error) { "+"console.log(error.stack) ; "+"}"),values=[],displayNames=!1,displayUnits=!1,eltsWithoutNullValue=[];if(elts){0!=displayProp.doSort&&elts.sort(function(a,b){return a.value==b.value?0:a.value<b.value?1:-1});for(var len=elts.length,elt,maxLength=displayProp.maxLength||20,othersElt,i=0;len>i;i++)elt=elts[i],elt.value&&0!=elt.value&&(maxLength>i?(eltsWithoutNullValue.push(elt),elt.name&&(displayNames=!0),elt.unit&&(displayUnits=!0),values.push(elt.value)):(othersElt||(othersElt={},othersElt.name=displayProp.othersName||"...others",othersElt.value=0,othersElt.unit=elt.unit,eltsWithoutNullValue.push(othersElt)),othersElt.value+=elt.value));if(othersElt&&values.push(othersElt.value),0!=eltsWithoutNullValue.length)return elts=eltsWithoutNullValue,{elts:elts,values:values,displayNames:displayNames,displayUnits:displayUnits,title:displayProp.label}}},dm_Attributes.makeDropdownTools=function(a){var b=$("#attributesDropdownToolsButtonGroup").clone();$(a).append(b)},dm_Csv.removeEmptyColumns=function(a){for(var b,c=a.length-1;c>=0;c--)b=a[c],b&&""!=b||a.splice(c,1)},dm_Csv.extension="csv",dm_Csv.nodeI=0,dm_Csv.nodeJ=0,dm_Csv.dontExportProps=["__dm_uniqueId","dm_uniqueId","icon","order","dm_goto","dm_goto_config","dm_sourceFile","connectedTo","connectedFrom","aggregatedConnectedTo","aggregatedConnectedFrom"],dm_Csv.isPropExportable=function(a,b){if(!b||""==b)return!1;for(var c=!0,d=dm_Csv.dontExportProps.length-1;d>=0&&c;d--)dm_Csv.dontExportProps[d]==b&&(c=!1);c&&(b.indexOf(".dm_props")>=0||b.indexOf(".")>=0)&&(c=!1);var e;return c&&a[b]&&(e=a[""+b+".dm_props"],e&&null!=e.dontExport?c=e.dontExport:null!=a[""+b+".dontExport"]&&(c=a[""+b+".dontExport"])),c&&e&&"boolean"!=e.type&&"image"!=e.type&&"javascript"!=e.type&&"rich text"!=e.type&&"text"!=e.type&&(c=!1),c},dm_Csv.getValue=function(a,b){if(a&&dm_Csv.isPropExportable(a,b)){var c=a[b];return c}},dm_Csv.enrichColumnsOnTheFly=function(a,b){for(var c in a)dm_Csv.isPropExportable(a,c)&&!b[c]&&(b[c]=null)},dm_Csv.node2csv=function(a,b,c,d,e,f,g,h,i){var j="",k=h?[]:{},l={};dm_Csv.node2csvValues(a,b,c,null,e,f,g,k,l,null,h,i);var m="",n=0==c.csvSepIsSemicolon?",":";",c=c||dm_Tools.getConfig(a),o=null,p=!1,q=null;for(var r in l)m+=0==r.indexOf("dm_hoTable_level_")?"level "+r.substring("dm_hoTable_level_".length)+n:r+n;j=m+"\n"+j;var s=function(){p=!0;for(var a in l)p||(j+=n),p=!1,q=o[a],j+=q?q:"";j+="\n"};if(h)for(var t=0;t<k.length;t++)o=k[t],s();else for(var u in k)o=k[u],s();return j},dm_Csv.node2table=function(a,b,c){var d=b?[]:{};return console.time("node2csv"),dm_Csv.node2csvValues(a,null,null,null,null,null,null,d,c,null,b,!0),console.timeEnd("node2csv"),d},dm_Csv.cloneAndConvertRichText2flatText=function(a){var b=dm_Tools.getConfig(a),a=dm_Tools.deepCopy(a,"parent");return dm_Tools.restoreParentsInTree(a),dm_Tools.visitTree(a,function(a,c,d,e){"string"==typeof a&&((e[c+".dm_props"]&&"rich text"==e[c+".dm_props"].type||"rich text"==e[c+".type"])&&(a=jQuery(a).text()),a=0==b.csvSepIsSemicolon?a.replace(/,/g,";"):a.replace(/;/g,","),a=a.replace(/\n/g," "),a=a.replace(/\r/g,""),e[c]=a)}),a},dm_Csv.node2csvValues=function(a,b,c,d,e,f,g,h,i,j,k,l){dm_Csv.nodeI++,dm_Csv.nodeJ++,dm_Csv.nodeJ>f&&(dm_Csv.nodeJ=0,null!=g&&g(dm_Csv.nodeI));var e=e||0;c=c||dm_Tools.getConfig(a),b||0===b||(b=dm_Tools.getMaxDepth(a));var m=c.columnNames;j=j||!m;var h=h||(k?[]:{});if(b>=e){if(m){i||(i={});for(var n=0;n<m.length;n++)i[""+m[n]]=null}if((!i||0==Object.keys(i).length)&&(i||(i={}),l))for(var n=0;b>=n;n++)i["dm_hoTable_level_"+n]=null;if(dm_Csv.enrichColumnsOnTheFly(a.rawNode,i),a.rawNode||(a.rawNode={}),k?h.push(a.rawNode):h[""+Object.keys(h).length]=a.rawNode,l)for(var o=dm_Tools.getNodePathNames(a),n=0;b>=n;n++)n<o.length&&(a.rawNode["dm_hoTable_level_"+n]=o[n]);if(a.children)for(var p,q=a.children.length,n=0;q>n;n++)p=a.children[n],dm_Csv.node2csvValues(p,b,c,d,e+1,f,g,h,i,j,k,l)}},dm_Csv.getColumnValuesFromTable=function(a,b){for(var c,d,e,f={},g=0;g<a.length;g++)if(c=a[g])if(dm_Tools.isArray(b))for(var h=0;h<b.length;h++)e=b[h],f[e]||(f[e]=[]),dm_Tools.isArray(c)?(d=c[h],d&&f[e].indexOf(d)<0&&f[e].push(d)):(d=c[e],d&&f[e].indexOf(d)<0&&f[e].push(d));else for(var i in b)if(f[i]||(f[i]=[]),dm_Tools.isArray(c)){var h=Object.keys(b).indexOf(i);d=c[h],d&&f[i].indexOf(d)<0&&f[i].push(d)}else d=c[i],d&&f[i].indexOf(d)<0&&f[i].push(d);return f},dm_LDIF.extension="ldif",dm_LDIF.parse=function(a,b){this.nodes=new dm_tools_NameIdList,this.root=b.parentNode||{name:b.name,id:dm_Tools.getId(),rawNode:{discardNodeAfterPaste:!0}},this.columnNames={};var c=this,d=function(){b.data=[];for(var c,d,e,f,g,h,i,j,k,l,m=a.split(/\r?\n\r?\n/g),n=function(){h&&(d||(d={},k={}),l=k[h],k[h]=null!=l?++l:0,d[h+(l>0?"."+l:"")]=j)},o=0;o<m.length;o++){if(c=m[o],e=c.split(/\r?\n/g),e.length>0){h=null,j="",d=null,k=null;for(var p=0;p<e.length;p++)f=e[p],f.trim().indexOf("#")<0&&(f=dm_Tools.removeCommentsHash(f)," "!=f[0]&&"	"!=f[0]?(h&&(n(),j=null),g=f.indexOf(":"),g>0&&(h=f.substring(0,g),h=h.trim())):g=-1,i=f.substring(g+1),i&&(j||(j=""),j+=i.trim()));n()}d&&b.data.push(d)}},e=function(a,b){if(a&&a.children)for(var c,d=0;d<a.children.length;d++)if(c=a.children[d],c.name==b)return c},f=function(a,b,d){if(!a)return console.log("found an object without 'dn:' field."),console.log(dm_Tools.stringify(b)),void 0;for(var f,h,i=a.length-1,k=c.root;i>=0;i--)f=a[i],h=e(k,f),d[i-1],h?0==i&&g(h,b,d[i-1]):(h=j(k,f,0==i?b:null,d[i-1]),k.children||(k.children=[]),k.children.push(h)),k=h;return k},g=function(a,d,e){"l"==e?a.level=b.config.styles.length-2:"st"==e&&(a.level=b.config.styles.length-3);var f;for(var g in d)f=d[g],f&&0==f.indexOf(": ")&&(f=f.substring(2)),a.rawNode[g]=f,"uid"==g&&f&&b.config&&b.config.styles&&(a.level=b.config.styles.length-1),h(a,g),c.columnNames[g]||(c.columnNames[g]=1),a.rawNode[g+".visible"]=!0,a.rawNode[g+".edit"]=!0},h=function(a,c){var d=!0;if(b.config.props2query&&b.config.props2query.length>0&&(d=!1,b.config.props2query.indexOf(c)>=0&&(d=!0)),b.config.notProps2query&&b.config.notProps2query.length>0&&b.config.notProps2query.indexOf(c)>=0&&(d=!1),d){b.props2query||(b.props2query={}),b.props2query[c]||(b.props2query[c]={});var e=a.rawNode[c];e&&!b.props2query[c][e]&&(b.props2query[c][e]=1)}},i=function(){var a;for(a in b.props2query)b.props2query[a]=dm_Tools.arrayFromObj(b.props2query[a])},j=function(a,b,d,e){var f={parent:a,name:b,rawNode:{}};return g(f,d,e),c.nodes.addObject(f),f},k=function(a){for(var b,c,d=a.split(","),e=0;e<d.length;e++){c=d[e];var f=c.split("=")[1];f&&(f=f.trim(),b||(b=[]),b.push(f))}return b},l=function(){for(var a,c,d,e,g,h=0;h<b.data.length;h++){if(g={},a=b.data[h],d=[],a.dn&&(d=k(a.dn)),g=[],b.config.attributes2tree)for(var i,j=0;j<b.config.attributes2tree.length;j++)i=b.config.attributes2tree[j],e=a[i],e&&(g.splice(0,0,i),d&&d.splice(1,0,e));c=f(d,a,g)}};console.log("start generating the tree "+dm_Tools.getDelay()),d(),l(),b.root=c.root,b.setNodes(c.nodes),i(),b.config.columnNames=dm_Tools.arrayFromObj(c.columnNames),console.log("finished doing the tree "+dm_Tools.getDelay())},dm_LDIF.node2ldif=function(a,b,c,d,e,f,g){var h="",i={},j={};dm_Csv.node2csvValues(a,b,c,null,e,f,g,i,j,null,null,!0);var k,l=null,m=null,n=function(){for(var a in j)k=a,0==a.indexOf("dm_hoTable_level_")&&(k=""+a.substring("dm_hoTable_".length)),m=l[a],m&&(h+=dm_Tools.formatJSVarName(k)+": "+m+"\n");h+="\n"};for(var o in i)l=i[o],n(),h+="\n\n";return h};var dm_Rtf=function(a,b,c){var d=this;this.previousDraw=null,this.maxDepth=99;var e=!0;this.generateRtf=function(){var b=dm_Rtf.rtfHeader1+"\n";return b+=dm_Rtf.rtfHeader2+"\n",b+=dm_Rtf.rtfHeader3+"\n",b+=dm_Rtf.rtfListTable+"\n",b+=dm_Rtf.rtfListOverride+"\n",b+=n(a),b+=dm_Rtf.rtfEnd};var f=function(f,g,h){var i,j="";if(d.previousDraw=null,e||f.children){if(0==g)j+=s("\\fs40\\b "+(c?c:a.name),0,f.style,"\\qc"),j+=dm_Rtf.rtfNewLineKeepWithPrev;else if(g>=1){i="";for(var k=0;g>k;k++)i+=h[k],g-1>k&&(i+=".");j+=s("\\s"+g+dm_Rtf.rtfTitles[g]+" "+i+"   "+f.name,g,f.style),j+=2>g?dm_Rtf.rtfNewLineKeepWithPrev:dm_Rtf.rtfLittleNewLineKeepWithPrev}}else j+="{\\keepn "+r(f.name)+"\\~:\\par}",j+=dm_Rtf.rtfLittleNewLineKeepWithPrev;return j+=dm_Attributes.drawAttributesOrGraphs(f,b,null,l),j+=dm_Rtf.rtfNewLine},g=function(a){return Math.round(142*4*a)},h=function(a,b,c,d){var e,f,h="",i=0,j="",k="",l=[],m=0;
d||(d=0),a=g(a),e=a,b.forEach(function(a){var b=g(a.w);l.push(b),m+=b});var n="\\ltrrow\\trowd \\irow"+d+"\\irowband"+d+"\\ts16\\trgaph108\\ltrrow\\trleft"+(c?5:e)+"\n"+"\\trftsWidth"+(c?"1":"3\\trwWidth"+m)+"\\trftsWidthB3\\trftsWidthA3\\trautofit1\\trpaddl108\\trpaddr108\n"+"\\trpaddfl3\\trpaddft3\\trpaddfb3\\trpaddfr3\\tbllkhdrrows\\tbllklastrow\\tbllkhdrcols\\tbllklastcol\\tblind"+(c?0:107+e)+"\\tblindtype3\n";c||(h+=n);for(var o=0;o<b.length;o++)i=l[o],j+="\\clvertalc\n",b[o].border&&(j+="\\clbrdrb\\brdrs\\brdrw10 \\clbrdrt\\brdrs\\brdrw10 \\clbrdrl\\brdrs\\brdrw10 \\clbrdrr\\brdrs\\brdrw10\n"),j+="\\cltxlrtb\\clftsWidth3\\clwWidth"+i+"\\clshdrawnil\n",b[o].bckgrdCol&&(j+="\\clcbpat\\clcbpatraw"+b[o].bckgrdCol),e+=i,j+="\\cellx"+e+"\n";c||(h+=j);for(var o=0;o<b.length;o++)f="qc",b[o].align&&(f=b[o].align),c?k+="\\ltrpar \\"+f+"{\\rtlch\\fcs1 \\af1 \\ltrch\\fcs0 "+r(b[o].txt)+"\\nestcell{\\nonesttables \\par }}\n":b[o].nestCell?(k+="\\pard\\ltrpar\\ql \\intbl {\\rtlch\\fcs1 \\af1 \\ltrch\\fcs0 \\fs8 \\par }\\pard \\ltrpar\\ql\\itap2 "+b[o].txt,k+=n+j+"\\pard \\ltrpar\\ql\n"+"{\\rtlch\\fcs1 \\af1 \\ltrch\\fcs0 \\fs4 \\par\n"+"\\cell }\n"):k+="\\pard\\ltrpar \\"+f+" {\\rtlch\\fcs1 \\af1 \\ltrch\\fcs0 "+r(b[o].txt)+"}\n"+"{\\rtlch\\fcs1 \\af1 \\ltrch\\fcs0 \\cell}\n";return h+=k,h+="\\pard\\plain \\ltrpar\\ql\n",h+=c?"\\itap2 {\\rtlch\\fcs1 \\af0 \\ltrch\\fcs0 {\\*\\nesttableprops\n"+n+j+"\\nestrow}{\\nonesttables \\par }\n"+"\\ltrrow}\n":"{\\rtlch\\fcs1 \\af1 \\ltrch\\fcs0\n"+n+j+"\\row\\ltrrow}\n"},i=function(a,b){var c="";return value=b.rawNode[a.name],value=dm_Tools.convertNumber(value),d.previousDraw&&"graph"==d.previousDraw&&(c+=dm_Rtf.rtfNewLine),value&&(c+=h(1,[{txt:a.label||a.name,w:7.25,border:!0},{txt:value,w:7.25,align:"ql",border:!0}])),d.previousDraw="attribute",c},j=function(a,b){var c="",e=dm_Attributes.computeGraphValues(a,b);if(!e)return c;if(e.values.length>1){d.previousDraw&&(c+=dm_Rtf.rtfNewLine),a.label&&(c+="{\\pard \\qj \\keepn"+dm_Rtf.rtfNormal+"\\ul "+a.label+"\\~:\\par}"+"{\\pard \\qj \\keepn \\par}");for(var f,g,i,j,k,l,n=4,o=14.5-(n+1),p=m(n,n,e.values),q="",r=n+1,s=0;s<e.elts.length;s++)f=e.elts[s],g=[],i=100,e.displayNames&&(j=e.displayUnits?65:70,l=o*j/100,r+=l,g.push({w:l,txt:f.name,border:!0}),i-=j),j=e.displayUnits?i/2:i,k=o*j/100,g.push({w:k,txt:"\\cf2\\b "+f.value,bckgrdCol:s+3,border:!0}),i-=j,e.displayUnits&&g.push({w:o*i/100,txt:f.unit,align:"ql",border:!0}),q+=h(n+1,g,!0);c+=h(1,[{txt:p,w:n+1},{txt:q,w:o,align:"qc",nestCell:!0}]),d.previousDraw="graph"}return c},k=function(a,b){var c;if(a.name&&b.rawNode&&b.rawNode[a.name]){var d=dm_Tools.html2rtf(b.rawNode[a.name]);console.log(d),c="\\pard \\keepn "+dm_Rtf.rtfNormal+d+"\\par "}return c},l=function(a,b){var c;return c=a.graph?j(a,b):"rich text"==a.type?k(a,b):i(a,b)},m=function(a,b,c){a=g(a),b=g(b);var d="";return d+="{\\field\\fldedit\\fldlock{\\*\\fldinst {\\rtlch\\fcs1 \\af1 \\ltrch\\fcs0  SHAPE  \\\\* MERGEFORMAT }}{\\fldrslt {\\rtlch\\fcs1 \\af0 \\ltrch\\fcs0 ",d+="{\\shpgrp",d+="{\\*\\shpinst\\shpleft0\\shptop0\\shpright"+a+"\\shpbottom"+b+"\\shpfhdr0\\shpbxcolumn\\shpbxignore\\shpbypara\\shpbyignore\\shpwr3\\shpwrk0\\shpfblwtxt0\\shpz0\\shplockanchor",d+="{\\sp{\\sn posh}{\\sv 0}}{\\sp{\\sn posrelh}{\\sv 3}}{\\sp{\\sn posv}{\\sv 0}}{\\sp{\\sn posrelv}{\\sv 3}}",d+=dm_Tools.pie(a,b,142,142,(b>a?a/2:b/2)-142,c,dm_Tools.colorsRGB,0,o,q,null,!1,!0),d+="}",d+="{\\pict{\\*\\picprop\\defshp{\\sp{\\sn shapeType}{\\sv 75}}}\\picwgoal"+a+"\\pichgoal"+b+"\\wmetafile8}",d+="}",d+="}}}"},n=function(a,b,c){var g,h,i,j,k="";if(b||(b=0),a.style&&a.style.level>d.maxDepth||a.level>d.maxDepth||b>d.maxDepth)return k;if(g=f(a,b,c),g&&(k+=g,k+="\n"),a.children)for(c||(c=[]),j=!0,h=0;h<a.children.length;h++)i=a.children[h],(e||i.children)&&(j?(++b,c.push(1),j=!1):++c[c.length-1]),k+=n(i,b,dm_Tools.deepCopy(c));return k},o=function(a,b){return"("+Math.round(a)+","+Math.round(b)+") ;"},p=function(a){return a||console.log("AIE"),65536*a.b+256*a.g+a.r},q=function(a,b,c,d,e,f){var g="";return d=""+(2+c[0])+";"+d,g+="{\\shp{\\*\\shpinst",g+="{\\sp{\\sn shapeType}{\\sv 0}}{\\sp{\\sn geoRight}{\\sv "+a+"}}{\\sp{\\sn geoBottom}{\\sv "+b+"}}"+"{\\sp{\\sn shapePath}{\\sv 1}}"+"{\\sp{\\sn pVerticies}{\\sv 8;"+d+"}}"+"{\\sp{\\sn fillColor}{\\sv "+p(f)+"}}{\\sp{\\sn fRecolorFillAsPicture}{\\sv 0}}{\\sp{\\sn fUseShapeAnchor}"+"{\\sv 0}}{\\sp{\\sn fLayoutInCell}{\\sv 0}}{\\sp{\\sn fLayoutInCell}{\\sv 0}}",g+="}}"},r=function(a,b){var c="";return b||(b=0),0==b&&(c+=dm_Rtf.rtfNormal+" "),c+=a},s=function(a,b,c,d,e,f,h,i){var j="";return b||(b=0),d||(d=""),f?f:f=16.5,h?h:h=.75,e?e:e=0,f=g(f),h=g(h),e=g(e),c&&(i=c&&c.attrPaneCol?dm_Tools.color2rgb(c.attrPaneCol):dm_Tools.colorsRGB[2*b+1]),j+="{\\field\\fldedit\\fldlock{\\*\\fldinst {\\rtlch\\fcs1 \\af1 \\ltrch\\fcs0  SHAPE  \\\\* MERGEFORMAT }}{\\fldrslt {\\rtlch\\fcs1 \\af0 \\ltrch\\fcs0 {\\shpgrp{\\*\\shpinst\\shpleft"+e+"\\shptop0\\shpright"+f+"\\shpbottom"+h+"\\shpfhdr0\\shpbxcolumn\\shpbxignore\\shpbypara\\shpbyignore\\shpwr3\\shpwrk0\\shpfblwtxt0\\shpz0\\shplockanchor"+"{\\sp{\\sn posh}{\\sv 0}}{\\sp{\\sn posrelh}{\\sv 3}}{\\sp{\\sn posv}{\\sv 0}}{\\sp{\\sn posrelv}{\\sv 3}}",j+="{\\shp{\\*\\shpinst{\\sp{\\sn fFitShapeToText}{\\sv 1}}{\\sp{\\sn fillColor}{\\sv "+p(i)+"}}{\\sp{\\sn fRecolorFillAsPicture}{\\sv 0}}"+"{\\sp{\\sn fFilled}{\\sv 1}}{\\sp{\\sn fLine}{\\sv 0}}"+"{\\sp{\\sn fAllowOverlap}{\\sv 1}}{\\sp{\\sn fBehindDocument}{\\sv 0}}{\\sp{\\sn fPseudoInline}{\\sv 1}}"+"{\\sp{\\sn shapeType}{\\sv 2}}"+"{\\shptxt \\ltrpar \\pard\\plain \\ltrpar\\s"+b+d+" \\li0\\ri0\\nowidctlpar\\wrapdefault\\faauto\\outlinelevel0\\rin0\\lin0\\itap0 "+"\\rtlch\\fcs1 \\af0\\afs24\\alang1025 \\ltrch\\fcs0"+"{\\rtlch\\fcs1 \\af0 \\ltrch\\fcs0"+a+"}}"+"}}",j+="}{\\pict{\\*\\picprop\\defshp{\\sp{\\sn shapeType}{\\sv 75}}}\\picwgoal"+f+"\\pichgoal"+(h+g(.25))+"\\wmetafile8}"+"}}}}",j+="{\\pard\\sf8\\keepn \\par}"}};dm_Rtf.rtfHeader1="{\\rtf1\\ansi\\ansicpg1252\\deff0\\deflang1036{\\fonttbl{\\f0\\fswiss\\fprq2\\fcharset0 Arial;}}",dm_Rtf.rtfColorsDef=function(){for(var a="",b=0;b<dm_Tools.colorsRGB.length;b++)a+="\\red"+dm_Tools.colorsRGB[b].r+"\\green"+dm_Tools.colorsRGB[b].g+"\\blue"+dm_Tools.colorsRGB[b].b+";";return a},dm_Rtf.rtfHeader2="{\\colortbl;\\red0\\green0\\blue0;\\red255\\green255\\blue255;"+dm_Rtf.rtfColorsDef()+"}",dm_Rtf.rtfNormalWithoutSize="\\ulnone\\i0\\b0\\li0\\ri0\\lin0\\rin0\\cf1\\sb20",dm_Rtf.rtfNormal=dm_Rtf.rtfNormalWithoutSize+"\\fs20",dm_Rtf.rtfTitles=["\\qj \\keepn\\ul\\b\\cf1\\fs36","\\qj \\keepn\\ul\\b\\cf1\\fs32","\\qj \\keepn\\ul\\b\\cf1\\fs28","\\qj \\keepn\\ul\\b\\cf1\\fs24","\\qj \\keepn\\ul\\b\\cf1\\fs22","\\qj \\keepn\\ul\\b\\cf1\\fs20","\\qj \\keepn\\ul\\i\\cf1\\fs20","\\qj \\keepn\\ul\\cf1\\fs20"],dm_Rtf.rtfTitleStyles=function(a){for(var b="",c=1;a>c;c++)b+="{\\s"+c+dm_Rtf.rtfTitles[c<dm_Rtf.rtfTitles.length?c:dm_Rtf.rtfTitles.length-1]+" \\snext0 heading "+c+";}";return b},dm_Rtf.rtfHeader3="{\\stylesheet{"+dm_Rtf.rtfNormal+"\\qj \\snext0 Normal;}"+dm_Rtf.rtfTitleStyles(16)+"}",dm_Rtf.rtfBulletStyles=["\\fi-360\\li720\\tx720\\lin720","\\fi-360\\li1440\\tx1440\\lin1440","\\fi-360\\li2160\\tx2160\\lin2160","\\fi-360\\li2880\\tx2880\\lin2880","\\fi-360\\li3600\\tx3600\\lin3600","\\fi-360\\li4320\\tx4320\\lin4320","\\fi-360\\li5040\\tx5040\\lin5040","\\fi-360\\li5760\\tx5760\\lin5760","\\fi-360\\li6480\\tx6480\\lin6480"],dm_Rtf.rtfListBullets={def:"\\list\\listtemplateid-842078920\\listhybrid{\\listlevel\\levelnfc23\\levelnfcn23\\leveljc0\\leveljcn0\\levelfollow0\\levelstartat1\\levelspace360\\levelindent0{\\leveltext\\leveltemplateid67698689 \\'01\\u-3913 ?;}{\\levelnumbers;}\\f3\\fbias0 \\jclisttab"+dm_Rtf.rtfBulletStyles[0]+" }"+"{\\listlevel\\levelnfc23\\levelnfcn23\\leveljc0\\leveljcn0\\levelfollow0\\levelstartat1\\lvltentative\\levelspace360\\levelindent0"+"{\\leveltext\\leveltemplateid67698691 \\'01o;}{\\levelnumbers;}\\f2\\fbias0 \\jclisttab"+dm_Rtf.rtfBulletStyles[1]+" }"+"{\\listlevel\\levelnfc23\\levelnfcn23\\leveljc0\\leveljcn0\\levelfollow0\\levelstartat1\\lvltentative\\levelspace360\\levelindent0"+"{\\leveltext\\leveltemplateid67698693 \\'01\\u-3929 ?;}{\\levelnumbers;}\\f10\\fbias0 \\jclisttab"+dm_Rtf.rtfBulletStyles[2]+" }"+"{\\listlevel\\levelnfc23\\levelnfcn23\\leveljc0\\leveljcn0\\levelfollow0\\levelstartat1\\lvltentative\\levelspace360\\levelindent0"+"{\\leveltext\\leveltemplateid67698689 \\'01\\u-3913 ?;}{\\levelnumbers;}\\f3\\fbias0 \\jclisttab"+dm_Rtf.rtfBulletStyles[3]+" }"+"{\\listlevel\\levelnfc23\\levelnfcn23\\leveljc0\\leveljcn0\\levelfollow0\\levelstartat1\\lvltentative\\levelspace360\\levelindent0"+"{\\leveltext\\leveltemplateid67698691 \\'01o;}{\\levelnumbers;}\\f2\\fbias0 \\jclisttab"+dm_Rtf.rtfBulletStyles[4]+" }"+"{\\listlevel\\levelnfc23\\levelnfcn23\\leveljc0\\leveljcn0\\levelfollow0\\levelstartat1\\lvltentative\\levelspace360\\levelindent0"+"{\\leveltext\\leveltemplateid67698693 \\'01\\u-3929 ?;}{\\levelnumbers;}\\f10\\fbias0 \\jclisttab"+dm_Rtf.rtfBulletStyles[5]+" }"+"{\\listlevel\\levelnfc23\\levelnfcn23\\leveljc0\\leveljcn0\\levelfollow0\\levelstartat1\\lvltentative\\levelspace360\\levelindent0"+"{\\leveltext\\leveltemplateid67698689 \\'01\\u-3913 ?;}{\\levelnumbers;}\\f3\\fbias0 \\jclisttab"+dm_Rtf.rtfBulletStyles[6]+" }"+"{\\listlevel\\levelnfc23\\levelnfcn23\\leveljc0\\leveljcn0\\levelfollow0\\levelstartat1\\lvltentative\\levelspace360\\levelindent0"+"{\\leveltext\\leveltemplateid67698691 \\'01o;}{\\levelnumbers;}\\f2\\fbias0 \\jclisttab"+dm_Rtf.rtfBulletStyles[7]+" }"+"{\\listlevel\\levelnfc23\\levelnfcn23\\leveljc0\\leveljcn0\\levelfollow0\\levelstartat1\\lvltentative\\levelspace360\\levelindent0"+"{\\leveltext\\leveltemplateid67698693 \\'01\\u-3929 ?;}{\\levelnumbers;}\\f10\\fbias0 \\jclisttab"+dm_Rtf.rtfBulletStyles[8]+" }"+"{\\listname ;}"+"\\listid861550954",listId:"\\listid861550954"},dm_Rtf.rtfListTable="{\\*\\listtable{"+dm_Rtf.rtfListBullets.def+"}}",dm_Rtf.rtfListOverride="{\\*\\listoverridetable{\\listoverride"+dm_Rtf.rtfListBullets.listId+"\\listoverridecount0\\ls1}}",dm_Rtf.rtfNewLine="{\\pard "+dm_Rtf.rtfNormal+"\\par}",dm_Rtf.rtfNewLineKeepWithPrev="{\\pard\\keepn "+dm_Rtf.rtfNormal+"\\par}",dm_Rtf.rtfLittleNewLine="{\\pard "+dm_Rtf.rtfNormalWithoutSize+"\\fs8\\par}",dm_Rtf.rtfLittleNewLineKeepWithPrev="{\\pard\\keepn "+dm_Rtf.rtfNormalWithoutSize+"\\fs8\\par}",dm_Rtf.rtfEnd="}",dm_Rtf.rtfShapeAlignWithText="\\shpfhdr0\\shpbxcolumn\\shpbxignore\\shpbypara",dm_Table2graph.init=function(a,b){var c=function(){console.log("start generating the tree "+dm_Tools.getDelay());var a=b.config,c=new dm_Csv(b.data,a,b.props2query);b.root=c.root,b.setNodes(c.nodes),console.log("finished doing the tree "+dm_Tools.getDelay())},d=function(){if(b.config.displayProps)for(var a,c,d=b.config.displayProps.length,e=0;d>e;e++){if(c=b.config.displayProps[e],!c.children)return;for(var f,g=c.children.length,h=0;g>h;h++){if(f=c.children[h],a=null,f.column){var i=b.data[0];a=i[f.column],f.prop=a}else f.name&&(a=f.name);a&&(b.props2query[a]=[])}}};b.data=dm_Table2graph.prepareDataset(a,b.config),d(),c()},dm_Table2graph.prepareDataset=function(a,b){var c;a=a.replace(/�/g,"'");var d=!0;null!=b.csvSepIsSemicolon&&(d=b.csvSepIsSemicolon);var e=d?";":",";return d3.csv=d3.dsv(e,"text/csv"),c=d3.csv.parseRows(a),c=dm_Table2graph.removeEmptyRows(c),b.filter&&(console.log("start table filtering "+dm_Tools.getDelay()+"    table length = "+c.length),c=dm_Table2graph.filter(c,b.filter),console.log("finished table filtering "+dm_Tools.getDelay()+"    table length = "+c.length)),c},dm_Table2graph.removeEmptyRows=function(a){for(var b,c=[],d=a.length,e=0;d>e;e++){b=a[e];for(var f=!0,g=0;g<b.length&&f;g++)elt=b[g],f=!(elt&&""!=elt);f||c.push(b)}return c},dm_Table2graph.filter=function(table,condition){var output=[],code="var len = table.length, row ; for(var i=1; i<len; i++) { row = table[i] ; if("+condition+") { output.push(row) ; } }";return output.push(table[0]),eval(code),output},dm_Table2graph.createHtmlTableArrayOfArrays4dataTable=function(a,b,c){var d="";d+="<thead><tr>";for(var e=0;e<a[0].length;e++)d+="<th>"+a[0][e]+"</th>";d+="</tr></thead>",d+="<tbody>";for(var f=1;f<a.length;f++){d+="<tr>";for(var e=0;e<a[f].length;e++)d+="<td>"+a[f][e]+"</td>";d+="</tr>"}return d+="</tbody>",b.append("table").attr("id",c).attr("class","display").attr("cellspacing",0).attr("width","100%").html(d)},dm_Table2graph.createHtmlTableArrayOfArrays=function(a,b){return b.append("table").style("border-collapse","collapse").style("border","2px black solid").selectAll("tr").data(a).enter().append("tr").selectAll("td").data(function(a){return a}).enter().append("td").style("border","1px black solid").style("padding","5px").on("mouseover",function(){d3.select(this).style("background-color","lightgreen")}).on("mouseout",function(){d3.select(this).style("background-color","white")}).text(function(a){return a}).style("font-size","12px")},dm_Table2graph.createHtmlTableObjects4dataTable=function(a,b,c){var d="";d+="<thead><tr>";var e="";for(var f in a[""+(Object.keys(a).length-1)])e+="<th>"+f+"</th>";return d+=e,d+="</tr></thead>",d+="<tfoot><tr>",d+=e,d+="</tr></tfoot>",d+="<tbody>",d+="<tr>",dm_Tools.iterOverTable(a,function(a){d+="<td>"+a+"</td>"}),d+="</tr>",d+="</tbody>",b.append("table").attr("id",c).attr("class","display").attr("cellspacing",0).attr("width","100%").html(d)},dm_Table2graph.createHtmlTableObjects=function(a,b,c){var d,e=b.append("table").attr("id",c).style("border-collapse","collapse").style("border","2px black solid"),f=0;d=e.append("tr"),dm_Tools.iterOverObjProps(a[""+(Object.keys(a).length-1)],function(a,b){d.append("td").style("border","2px black solid").style("padding","5px").style("font-size","12px").style("font-weight","bolder").style("color","white").style("background-color","rgba(85, 85, 85, 0.8)").text(b)}),dm_Tools.iterOverObjProps(a,function(a){d=e.append("tr"),dm_Tools.iterOverObjProps(a,function(a){(""+a).length>255&&(a=(""+a).substring(0,128)+"..."),d.append("td").style("border","1px black solid").style("padding","5px").on("mouseover",function(){d3.select(this).style("background-color","white")}).on("mouseout",function(){d3.select(this).style("background-color","rgba(0,0,0,0)")}).style("font-size","12px").text(a)}),f++})},dm_graph_Force.draggingNode=!1,dm_graph_Force.anotherImageRep=null,dm_graph_Force.getLinkDistance=function(a){var b=dm_Tools.getConfig(a);return b.styles[a.level].link||b.link},dm_graph_Force.updateNodeStyle=function(a){var b=dm_Tools.getConfig(a);if(b.styles){a.style=b.styles[a.level],d3.selectAll("#circle_"+a.id).style("fill",function(){return dm_Datamap.currentDatamap.graph.circleColor(a)}).attr("r",function(){return b.styles[a.level].rNod});var c;if(dm_Datamap.currentDatamap.graph.links)for(var d,e,d=0;!c&&d<dm_Datamap.currentDatamap.graph.links.length;d++)e=dm_Datamap.currentDatamap.graph.links[d],e.target==a&&(c=e);c&&(c.style=a.style),dm_Datamap.currentDatamap.graph.force.links(dm_Datamap.currentDatamap.graph.links),d3.selectAll("#link_"+a.id).style("stroke",dm_Datamap.currentDatamap.graph.circleColor(a)).attr("marker-end",function(){return dm_Datamap.currentDatamap.graph.markerEnd(a)}),d3.selectAll("#node_text_id_"+a.id).style("fill",dm_Datamap.currentDatamap.graph.circleColor(a)),dm_Datamap.currentDatamap.graph.tick()}},dm_graph_Force.syncIcon=function(a,b){if(a){var c=dm_Tools.getImageSrc(b),d=d3.select("#graph_svg").select("#image_"+a.id+"_0");return $(d[0][0]).data("origSrc",c),$(d[0][0]).data("tintedSrc",b.tintedSrc),d}},dm_graph_Force.tintIcon=function(a,b,c,d){var e=d||dm_Tools.getConfig(a).styles[a.level].color;e=dm_Tools.getColorInGradient(e,"#000000",20);var f,g;a?(f=dm_graph_Force.syncIcon(a,b),g=$(f[0][0]).data("origSrc")):g=dm_Tools.getImageSrc(b),dm_Tools.tintImageSrc(g,e,60,function(d){f&&f.attr("xlink:href",d),b.tintedSrc=d,dm_graph_Force.syncIcon(a,b),c&&c(d)})};var dm_Odt=function(a,b,c,d){var e=this;this.maxDepth=c,this.noLeafInReport=d,this.odt=dm_Odt.defaultOdt?dm_Odt.defaultOdt.odt:{},this.workingOdtSection,this.listOfImages2save;var f="_dm-colon_";this.load=function(a){var b=d3.select("#dm_odtContainer");d3.select("#dm_odt").remove(),b.append("div").attr("id","dm_odt"),d3.text(a,"text/plain; charset=x-user-defined",function(a){var b=new JSZip;b.load(a,{base64:!1});var c=function(a,c){var d=a.lastIndexOf("."),g=a;d>=0&&(g=a.substring(0,d));var h=b.file(a).asText(),i="raw";"decodeXml"==c&&(h=h.replace(/<([^: ]*):/g,"<$1"+f),h=h.replace(/<\/([^: ]*):/g,"</$1"+f),h=dm_Tools.finishXmlTags(h),d3.select("#dm_odt").append("div").attr("id","dm_odt_"+g).html(h),i="xml"),"convert2Json"==c&&(h=xml2json(h),h=dm_Tools.parseStringified(h),i="json"),e.odt[g]=h,e.odt[g+"_format"]=i};c("styles.xml","decodeXml"),c("meta.xml"),c("settings.xml"),c("content.xml","decodeXml"),c("META-INF/manifest.xml"),c("mimetype")})};var g=function(a){for(var b,c,d=d3.select("#dm_odt_styles").select("office"+f+"document-styles").select("office"+f+"styles").selectAll("style"+f+"style"),e=d[0].length,g=0;e>g;g++){c=d[0][g];for(var h=c.attributes.length,i=0;h>i;i++){var j=c.attributes[i];j.value=="Titre"+a&&(b=c)}}return b},h=function(a){for(var b,c=dm_Tools.getConfig(a),d=1;d<c.styles.length;d++)if(b=g(d)){var e=dm_Tools.searchFirstDomNodeFromPath(b,"style"+f+"paragraph-properties",!0);e||(e=document.createElement("style"+f+"paragraph-properties"),b.insertBefore(e,b.firstChild)),dm_Tools.setDomNodeAttribute(e,"fo:background-color",c.styles[d].attrPaneCol)}for(var h,i=d3.select("#dm_odt_styles").select("office"+f+"document-styles").select("office"+f+"styles"),j=dm_Tools.colors.length,d=0;j>d;d++)h=dm_Tools.colors[d],i.append("style"+f+"style").attr("style"+f+"family","graphic").attr("style"+f+"name","chartPart"+d).append("style"+f+"graphic-properties").attr("draw"+f+"fill","solid").attr("draw"+f+"fill-color",h).attr("draw"+f+"opacity","100%").attr("draw"+f+"stroke","solid").attr("svg"+f+"stroke-width","0.01042in").attr("svg"+f+"stroke-color","#000000").attr("svg"+f+"stroke-opacity","100%").attr("draw"+f+"stroke-linejoin","round"),i.append("style"+f+"style").attr("style"+f+"family","table-cell").attr("style"+f+"parent-style-name","TableCellAttribute").attr("style"+f+"name","LegendTableCellValue"+d).append("style"+f+"table-cell-properties").attr("fo"+f+"background-color",h)},i=[],j=function(a,b,c,d){if(a){var g=function(){i.indexOf("data/images/"+a.imageName)<0&&i.push("data/images/"+a.imageName);var b=100,c=a.imageName,d=a.width,g=a.height,h=1/b,j=Math.max(d,g),k=k||256;j>k&&(h=k/j*h),d*=h,g*=h;var l=e.workingOdtSection.append("text"+f+"p").attr("text"+f+"style-name","NormalCenteredKeepTogether").append("draw"+f+"frame").attr("draw"+f+"name",""+c).attr("text"+f+"anchor-type","as-char").attr("svg"+f+"x","0in").attr("svg"+f+"y","0in").attr("svg"+f+"width",""+d+"in").attr("svg"+f+"height",""+g+"in").attr("style"+f+"rel-width","scale").attr("style"+f+"rel-height","scale");l.append("draw"+f+"image").attr("xlink"+f+"href","media/"+c).attr("xlink"+f+"type","simple").attr("xlink"+f+"show","embed").attr("xlink"+f+"actuate","onLoad"),l.append("svg"+f+"title"),e.workingOdtSection.append("text"+f+"p").attr("text"+f+"style-name","NormalKeepTogether"),e.listOfImages2save||(e.listOfImages2save=[]),e.listOfImages2save.push({sourceName:a.imageName,destName:c})};i.indexOf("data/images/"+a.imageName)<0?dm_Tools.testFileExist("data/images/"+a.imageName,g,function(){console.log("Failed to load "+a.imageName+" from node "+b,d)},!1):g()}},k=function(b){var c=(b.rawNode?b.rawNode.displayName:null)||b.name,d=dm_Tools.getAbsoluteLevel(b)-dm_Tools.getAbsoluteLevel(a);e.workingOdtSection.append("text"+f+"h").attr("text"+f+"style-name","Titre"+d).attr("text"+f+"outline-level",""+d).html(c),e.workingOdtSection.append("text"+f+"p").attr("text"+f+"style-name","NormalKeepTogether");var g=dm_Tools.getImageFromNode(b);j(g,b.name,null,b)},l=function(a){var b,c,d=function(a,d,g,h,i){if(a.graph||"rich text"==a.type||"image"==a.type||"action"==a.type||"music"==a.type||(null==i||""==i)&&a.dontDisplayNull){if(a.graph)m(a,d);else if("image"==a.type){var k=dm_Tools.getImageFromNode(d,!1,a.name);j(k,d.name,590)}}else{if(!b){b=e.workingOdtSection.append("table"+f+"table").attr("table"+f+"style-name","TableAttribute");var l=b.append("table"+f+"table-columns");l.append("table"+f+"table-column").attr("table"+f+"style-name","TableColumnAttribute"),l.append("table"+f+"table-column").attr("table"+f+"style-name","TableColumnAttribute")}c=b.append("table"+f+"table-row").attr("table"+f+"style-name","TableRowAttribute"),c.append("table"+f+"table-cell").attr("table"+f+"style-name","TableCellAttribute").append("text"+f+"p").attr("text"+f+"style-name","NormalCentered").append("text"+f+"span").html(h),c.append("table"+f+"table-cell").attr("table"+f+"style-name","TableCellAttribute").append("text"+f+"p").attr("text"+f+"style-name","Normal").append("text"+f+"span").html(i)}};dm_Tools.onDisplayableRawNodeProps(a,d,null,null,!0,!0),e.workingOdtSection.append("text"+f+"p").attr("text"+f+"style-name","Normal")},m=function(a,b){var c=dm_Attributes.computeGraphValues(a,b);if(c&&c.values.length>1){e.workingOdtSection.append("text"+f+"p").attr("text"+f+"style-name","Normal"),a.label&&(e.workingOdtSection.append("text"+f+"p").attr("text"+f+"style-name","NormalUnderlinedKeepTogether").html(a.label),e.workingOdtSection.append("text"+f+"p").attr("text"+f+"style-name","NormalKeepTogether"));var d=e.workingOdtSection.append("table"+f+"table").attr("table"+f+"style-name","TableAttribute"),g=d.append("table"+f+"table-columns");g.append("table"+f+"table-column").attr("table"+f+"style-name","TableColumnChart"),g.append("table"+f+"table-column").attr("table"+f+"style-name","TableColumnLegend");var h=d.append("table"+f+"table-row").attr("table"+f+"style-name","TableRowAttribute"),i=h.append("table"+f+"table-cell").attr("table"+f+"style-name","TableCellChart").append("text"+f+"p").attr("text"+f+"style-name","Normal"),j=i.append("draw"+f+"g").attr("draw"+f+"style-name","GraphGroup").attr("text"+f+"anchor-type","as-char");j.append("svg"+f+"title"),j.append("svg"+f+"desc");var k=0,l=21600,m=21600,n=function(a,b,c,d,e,g,h,i,j){if(i){var n=e.append("draw"+f+"custom-shape").attr("svg"+f+"x","0in").attr("svg"+f+"y","0in").attr("svg"+f+"width","1.57778in").attr("svg"+f+"height","1.57778in").attr("draw"+f+"style-name","chartPart"+h);n.append("svg"+f+"title"),n.append("svg"+f+"desc");var o,p=n.append("draw"+f+"enhanced-geometry").attr("draw"+f+"type","non-primitive").attr("svg"+f+"viewBox","0 0 "+l+" "+m);return k=0,p}if(j){for(var o="",c=c[0],q=0,r=0;c+1>r;r++)0==r?(o="M ?f0 ?f1 L ",q=2):o+="?f"+q++ +" ?f"+q++ +" ";e.attr("draw"+f+"enhanced-path",o+"Z N")}},o=function(a,b,c){c.append("draw"+f+"equation").attr("draw"+f+"name","f"+k++).attr("draw"+f+"formula",""+Math.round(a)),c.append("draw"+f+"equation").attr("draw"+f+"name","f"+k++).attr("draw"+f+"formula",""+Math.round(b))};dm_Tools.pie(l,m,0,0,m>l?l/2:m/2,c.values,dm_Tools.colorsRGB,0,o,n,j,!0,!0);var p=h.append("table"+f+"table-cell").attr("table"+f+"style-name","TableCellChartLegend"),q=p.append("table"+f+"table").attr("table"+f+"style-name","TableLegend"),r=q.append("table"+f+"table-columns");c.displayNames&&c.displayUnits?(r.append("table"+f+"table-column").attr("table"+f+"style-name","TableColumnLegendName1"),r.append("table"+f+"table-column").attr("table"+f+"style-name","TableColumnLegendValue1"),r.append("table"+f+"table-column").attr("table"+f+"style-name","TableColumnLegendUnit1")):c.displayUnits?(r.append("table"+f+"table-column").attr("table"+f+"style-name","TableColumnLegendValue2"),r.append("table"+f+"table-column").attr("table"+f+"style-name","TableColumnLegendUnit2")):c.displayNames&&(r.append("table"+f+"table-column").attr("table"+f+"style-name","TableColumnLegendName3"),r.append("table"+f+"table-column").attr("table"+f+"style-name","TableColumnLegendValue3"));for(var s,t,u=c.elts.length,v=0;u>v;v++){t=c.elts[v],s=q.append("table"+f+"table-row").attr("table"+f+"style-name","TableRowAttribute"),c.displayNames&&s.append("table"+f+"table-cell").attr("table"+f+"style-name","TableCellAttribute").append("text"+f+"p").attr("text"+f+"style-name","NormalCentered").html(t.name);var w=dm_Tools.convertNumber(t.valueStr||t.value,2);s.append("table"+f+"table-cell").attr("table"+f+"style-name","LegendTableCellValue"+v).append("text"+f+"p").attr("text"+f+"style-name","TableLegendValueText").html(w),c.displayUnits&&s.append("table"+f+"table-cell").attr("table"+f+"style-name","TableCellAttribute").append("text"+f+"p").attr("text"+f+"style-name","Normal").html(t.unit)}}},n=function(a){k(a),l(a)},o=0,p=0,q=0,r=5,s=0,t=100,u=30,v=[],w=function(b,c,d){var b=b||a,d=d||0;if(!dm_Tools.isAdminConfigTreeNode(b)&&c>=d&&(b.children||!e.noLeafInReport)&&(v.push(b),++q,b.children))for(var f,g=b.children.length,h=0;g>h;h++)f=b.children[h],w(f,c,d+1)},x=function(a,b,c,d){v=[],q=0,s=0,t=100-u,w(a,b),o=0;var a,e=r*(q/t),f=function(){for(p=0;o<v.length&&e>p;)a=v[o],++o,++p,null!=c&&c(a);s+=r,console.log("---> made "+o+" nodes      "+s+" %      "+q),o==v.length?dm_UI.updateProgressBar(t,function(){null!=d&&d()}):dm_UI.updateProgressBar(s,f)};f()};this.generate=function(b){h(a);var c=d3.select("#dm_odt_content").select("office"+f+"text"),d=d3.select("#dm_odt_content").select("office"+f+"body");c.remove(),e.workingOdtSection=d.append("office"+f+"text").attr("text"+f+"use-soft-page-breaks","true"),x(a,e.maxDepth,n,b)};var y=function(a){var b;if("raw"==e.odt[a+"_format"])b=e.odt[a];else if("xml"==e.odt[a+"_format"]){b=$("#dm_odt_"+a).children()[0],b=(new XMLSerializer).serializeToString(b),b=b.replace(/></g,">\r\n<"),b=b.replace(/&nbsp;/g," ");var b=b.replace(new RegExp(f,"g"),":")}else"json"==e.odt[a+"_format"]&&(b=json2xml(e.odt[a]));return b};this.save=function(a){e.generate(function(){var b=new JSZip;b.file("styles.xml",y("styles")),b.file("meta.xml",y("meta")),b.file("settings.xml",y("settings")),b.file("content.xml",y("content")),b.file("mimetype",y("mimetype")),b.folder("META-INF").file("manifest.xml",y("META-INF/manifest"));var c=b.folder("media"),d=function(){console.log("zipping odt files");var c=b.generate({type:"blob",compression:"STORE"});console.log("finished zipping odt files"),null!=a&&a(c)};if(e.listOfImages2save){var f=0,g=[],h=function(){if(console.log("save image "+f+"  / "+e.listOfImages2save.length),e.listOfImages2save.length>f){var a=e.listOfImages2save[f],b=function(){f++,s+=u/e.listOfImages2save.length,dm_UI.updateProgressBar(s,h)};g.indexOf("data/images/"+a.sourceName)<0?dm_Tools.loadLocalFile("data/images/"+a.sourceName,function(d){console.log("zip image ",a.destName),c.file(a.destName,d.response,{base64:!1,binary:!0}),g.push("data/images/"+a.sourceName),b()}):b()}else dm_UI.deActivateProgressBar(),d()};h()}else dm_UI.deActivateProgressBar(),d()})}};dm_Odt.defaultOdt=new dm_Odt,dm_Odt.defaultOdt.load("config/odt/empty.odt"),dm_Freemind.mmOpenNode=function(a,b,c,d){return b=b||!1,c=c||!1,a=dm_Freemind.mmFormatText(a),'<node TEXT="'+a+'" FOLDED="'+b+'" '+(d?'COLOR="'+d+'" ':"")+'STYLE="'+(c?"bubble":"fork")+'">\n'},dm_Freemind.mmFormatText=function(a){return a=""+a,a=a.replace(/&/g,"+"),a=a.replace(/"/g,"'")},dm_Freemind.mmCloseNode=function(){return"</node>\n"},dm_Freemind.nodeI=0,dm_Freemind.nodeJ=0,dm_Freemind.node2mm=function(a,b,c,d,e,f,g,h){if(dm_Freemind.nodeI++,dm_Freemind.nodeJ++,dm_Freemind.nodeJ>g&&(dm_Freemind.nodeJ=0,null!=h&&h(dm_Freemind.nodeI)),dm_Tools.isAdminConfigTreeNode(a))return"";var i=function(a,b,c,d,e){var f="";return a.graph||"rich text"==a.type||"image"==a.type||"action"==a.type||"music"==a.type||(null==e||""==e)&&a.dontDisplayNull||(f+=dm_Freemind.mmOpenNode(d,!1),f+=dm_Freemind.mmOpenNode(e,!1),f+=dm_Freemind.mmCloseNode(),f+=dm_Freemind.mmCloseNode()),f},b=b||0,j="",k=b>0;if(e>=b&&(a.children||!f))if("number"==typeof a||"string"==typeof a)j+=dm_Freemind.mmOpenNode(dm_Tools.convertValue(a),k),j+=dm_Freemind.mmCloseNode();else{if(j+=dm_Freemind.mmOpenNode(a.name,k,a.children?!0:!1,d(a)),j=dm_Tools.onDisplayableRawNodeProps(a,i,j,null,!0,!0,c),a.children)for(var l=0;l<a.children.length;l++)j+=dm_Freemind.node2mm(a.children[l],b+1,c,d,e,f,g,h);j+=dm_Freemind.mmCloseNode()}return j},dm_IO.loadJson=function(a,b){$.ajaxSetup({scriptCharset:"ISO-8859-15",contentType:"application/javascript; charset=ISO-8859-15"}),$.ajax({url:"http://localhost:8025/datamap/?load="+a,type:"GET",data:{},crossDomain:!0,dataType:"jsonp",jsonp:!1,jsonpCallback:"Datamap_jsonLoad",success:function(a){var c,d=loadFileName.lastIndexOf(".");d>=0&&(c=loadFileName.substring(d)),a=a.content,a=dm_IO.convertHtml2accented(a),".json"==c&&(a=dm_Tools.parseStringified(a)),b(a)},error:function(b){console.log(b),alert('Load of "'+a+'" failed!')}})},dm_IO.saveJson=function(a,b,c){$.ajaxSetup({scriptCharset:"ISO-8859-15",contentType:"text/plain; charset=ISO-8859-15"}),$.ajax({url:"http://localhost:8025/datamap/?save="+a,type:"POST",data:{content:b},datatype:"text/plain",success:function(a){c(a)},error:function(b){console.log(b),alert('Save of "'+a+'" failed!')}})},dm_IO.getUrlPage=function(a){var b,c=a.lastIndexOf("/");0>c&&(c=0);var d=a.indexOf("?");return 0>d&&(d=a.length),b=a.substring(c+1,d)},dm_IO.convertAccentedCharsTable=[{chr:"�",hex:"À",numeric:"&#192;",html:"&Agrave;",escape:"%C0",encodeURI:"%C3%80"},{chr:"�",hex:"Á",numeric:"&#193;",html:"&Aacute;",escape:"%C1",encodeURI:"%C3%81"},{chr:"�",hex:"Â",numeric:"&#194;",html:"&Acirc;",escape:"%C2",encodeURI:"%C3%82"},{chr:"�",hex:"Ã",numeric:"&#195;",html:"&Atilde;",escape:"%C3",encodeURI:"%C3%83"},{chr:"�",hex:"Ä",numeric:"&#196;",html:"&Auml;",escape:"%C4",encodeURI:"%C3%84"},{chr:"�",hex:"Å",numeric:"&#197;",html:"&Aring;",escape:"%C5",encodeURI:"%C3%85"},{chr:"�",hex:"Æ",numeric:"&#198;",html:"&AElig;",escape:"%C6",encodeURI:"%C3%86"},{chr:"�",hex:"Ç",numeric:"&#199;",html:"&Ccedil;",escape:"%C7",encodeURI:"%C3%87"},{chr:"�",hex:"È",numeric:"&#200;",html:"&Egrave;",escape:"%C8",encodeURI:"%C3%88"},{chr:"�",hex:"É",numeric:"&#201;",html:"&Eacute;",escape:"%C9",encodeURI:"%C3%89"},{chr:"�",hex:"Ê",numeric:"&#202;",html:"&Ecirc;",escape:"%CA",encodeURI:"%C3%8A"},{chr:"�",hex:"Ë",numeric:"&#203;",html:"&Euml;",escape:"%CB",encodeURI:"%C3%8B"},{chr:"�",hex:"Ì",numeric:"&#204;",html:"&Igrave;",escape:"%CC",encodeURI:"%C3%8C"},{chr:"�",hex:"Í",numeric:"&#205;",html:"&Iacute;",escape:"%CD",encodeURI:"%C3%8D"},{chr:"�",hex:"Î",numeric:"&#206;",html:"&Icirc;",escape:"%CE",encodeURI:"%C3%8E"},{chr:"�",hex:"Ï",numeric:"&#207;",html:"&Iuml;",escape:"%CF",encodeURI:"%C3%8F"},{chr:"�",hex:"Ð",numeric:"&#208;",html:"&ETH;",escape:"%D0",encodeURI:"%C3%90"},{chr:"�",hex:"Ñ",numeric:"&#209;",html:"&Ntilde;",escape:"%D1",encodeURI:"%C3%91"},{chr:"�",hex:"Ò",numeric:"&#210;",html:"&Ograve;",escape:"%D2",encodeURI:"%C3%92"},{chr:"�",hex:"Ó",numeric:"&#211;",html:"&Oacute;",escape:"%D3",encodeURI:"%C3%93"},{chr:"�",hex:"Ô",numeric:"&#212;",html:"&Ocirc;",escape:"%D4",encodeURI:"%C3%94"},{chr:"�",hex:"Õ",numeric:"&#213;",html:"&Otilde;",escape:"%D5",encodeURI:"%C3%95"},{chr:"�",hex:"Ö",numeric:"&#214;",html:"&Ouml;",escape:"%D6",encodeURI:"%C3%96"},{chr:"�",hex:"Ø",numeric:"&#216;",html:"&Oslash;",escape:"%D8",encodeURI:"%C3%98"},{chr:"�",hex:"Ù",numeric:"&#217;",html:"&Ugrave;",escape:"%D9",encodeURI:"%C3%99"},{chr:"�",hex:"Ú",numeric:"&#218;",html:"&Uacute;",escape:"%DA",encodeURI:"%C3%9A"},{chr:"�",hex:"Û",numeric:"&#219;",html:"&Ucirc;",escape:"%DB",encodeURI:"%C3%9B"},{chr:"�",hex:"Ü",numeric:"&#220;",html:"&Uuml;",escape:"%DC",encodeURI:"%C3%9C"},{chr:"�",hex:"Ý",numeric:"&#221;",html:"&Yacute;",escape:"%DD",encodeURI:"%C3%9D"},{chr:"�",hex:"Þ",numeric:"&#222;",html:"&THORN;",escape:"%DE",encodeURI:"%C3%9E"},{chr:"�",hex:"ß",numeric:"&#223;",html:"&szlig;",escape:"%DF",encodeURI:"%C3%9F"},{chr:"�",hex:"à",numeric:"&#224;",html:"&agrave;",escape:"%E0",encodeURI:"%C3%A0"},{chr:"�",hex:"á",numeric:"&#225;",html:"&aacute;",escape:"%E1",encodeURI:"%C3%A1"},{chr:"�",hex:"â",numeric:"&#226;",html:"&acirc;",escape:"%E2",encodeURI:"%C3%A2"},{chr:"�",hex:"ã",numeric:"&#227;",html:"&atilde;",escape:"%E3",encodeURI:"%C3%A3"},{chr:"�",hex:"ä",numeric:"&#228;",html:"&auml;",escape:"%E4",encodeURI:"%C3%A4"},{chr:"�",hex:"å",numeric:"&#229;",html:"&aring;",escape:"%E5",encodeURI:"%C3%A5"},{chr:"�",hex:"æ",numeric:"&#230;",html:"&aelig;",escape:"%E6",encodeURI:"%C3%A6"},{chr:"�",hex:"ç",numeric:"&#231;",html:"&ccedil;",escape:"%E7",encodeURI:"%C3%A7"},{chr:"�",hex:"è",numeric:"&#232;",html:"&egrave;",escape:"%E8",encodeURI:"%C3%A8"},{chr:"�",hex:"é",numeric:"&#233;",html:"&eacute;",escape:"%E9",encodeURI:"%C3%A9"},{chr:"�",hex:"ê",numeric:"&#234;",html:"&ecirc;",escape:"%EA",encodeURI:"%C3%AA"},{chr:"�",hex:"ë",numeric:"&#235;",html:"&euml;",escape:"%EB",encodeURI:"%C3%AB"},{chr:"�",hex:"ì",numeric:"&#236;",html:"&igrave;",escape:"%EC",encodeURI:"%C3%AC"},{chr:"�",hex:"í",numeric:"&#237;",html:"&iacute;",escape:"%ED",encodeURI:"%C3%AD"},{chr:"�",hex:"î",numeric:"&#238;",html:"&icirc;",escape:"%EE",encodeURI:"%C3%AE"},{chr:"�",hex:"ï",numeric:"&#239;",html:"&iuml;",escape:"%EF",encodeURI:"%C3%AF"},{chr:"�",hex:"ð",numeric:"&#240;",html:"&eth;",escape:"%F0",encodeURI:"%C3%B0"},{chr:"�",hex:"ñ",numeric:"&#241;",html:"&ntilde;",escape:"%F1",encodeURI:"%C3%B1"},{chr:"�",hex:"ò",numeric:"&#242;",html:"&ograve;",escape:"%F2",encodeURI:"%C3%B2"},{chr:"�",hex:"ó",numeric:"&#243;",html:"&oacute;",escape:"%F3",encodeURI:"%C3%B3"},{chr:"�",hex:"ô",numeric:"&#244;",html:"&ocirc;",escape:"%F4",encodeURI:"%C3%B4"},{chr:"�",hex:"õ",numeric:"&#245;",html:"&otilde;",escape:"%F5",encodeURI:"%C3%B5"},{chr:"�",hex:"ö",numeric:"&#246;",html:"&ouml;",escape:"%F6",encodeURI:"%C3%B6"},{chr:"�",hex:"ø",numeric:"&#248;",html:"&oslash;",escape:"%F8",encodeURI:"%C3%B8"},{chr:"�",hex:"ù",numeric:"&#249;",html:"&ugrave;",escape:"%F9",encodeURI:"%C3%B9"},{chr:"�",hex:"ú",numeric:"&#250;",html:"&uacute;",escape:"%FA",encodeURI:"%C3%BA"},{chr:"�",hex:"û",numeric:"&#251;",html:"&ucirc;",escape:"%FB",encodeURI:"%C3%BB"},{chr:"�",hex:"ü",numeric:"&#252;",html:"&uuml;",escape:"%FC",encodeURI:"%C3%BC"},{chr:"�",hex:"ý",numeric:"&#253;",html:"&yacute;",escape:"%FD",encodeURI:"%C3%BD"},{chr:"�",hex:"þ",numeric:"&#254;",html:"&thorn;",escape:"%FE",encodeURI:"%C3%BE"},{chr:"�",hex:"ÿ",numeric:"&#255;",html:"&yuml;",escape:"%FF",encodeURI:"%C3%BF"},{chr:"�",hex:"Œ",numeric:"&#338;",html:"&OElig;",escape:"%u0152",encodeURI:"%C5%92"},{chr:"�",hex:"œ",numeric:"&#339;",html:"&oelig;",escape:"%u0153",encodeURI:"%C5%93"},{chr:"�",hex:"Š",numeric:"&#352;",html:"&Scaron;",escape:"%u0160",encodeURI:"%C5%A0"},{chr:"�",hex:"š",numeric:"&#353;",html:"&scaron;",escape:"%u0161",encodeURI:"%C5%A1"},{chr:"�",hex:"Ÿ",numeric:"&#376;",html:"&Yuml;",escape:"%u0178",encodeURI:"%C5%B8"},{chr:"�",hex:"ƒ",numeric:"&#402;",html:"&fnof;",escape:"%u0192",encodeURI:"%C6%92"},{chr:"�",hex:" AC",numeric:"&#8364;",html:"&euro;",escape:"%u20AC",encodeURI:"%E2%82%AC"}],dm_IO.convertAccented=function(a,b,c){var d=a;
return dm_IO.convertAccentedCharsTable.forEach(function(a){var e=new RegExp(a[b],"g");d=d.replace(e,a[c])}),d},dm_IO.convertAccented2numeric=function(a){return dm_IO.convertAccented(a,"hex","numeric")},dm_IO.convertNumeric2accented=function(a){return dm_IO.convertAccented(a,"numeric","hex")},dm_IO.convertAccented2html=function(a){return dm_IO.convertAccented(a,"hex","html")},dm_IO.convertHtml2accented=function(a){return dm_IO.convertAccented(a,"html","hex")},dm_IO.convertAccented2encodeURI=function(a){return dm_IO.convertAccented(a,"hex","encodeURI")},dm_IO.convertURI2accented=function(a){return dm_IO.convertAccented(a,"encodeURI","hex")},dm_IO.getFileContent=function(a,b){for(var c,d=0;c=a[d];d++){var e=new FileReader;e.onload=function(){return function(a){var c=a.target.result;c=dm_IO.convertHtml2accented(c),b&&b(c)}}(c),e.readAsBinaryString(c)}},dm_IO.loadAll=function(){dm_UI.openWorkInProgress(),dm_Datamap.loadAll(null,null,function(){dm_UI.resetMouseOverSelection(dm_Datamap.currentDatamap.graph.center),dm_UI.autoResize(),dm_UI.closeWorkInProgress()})},dm_IO.saveAsStart=function(a,b,c,d){var e=function(a){var b=a.data.percent;if(dm_UI.updateProgressBar(b),b>=100){dm_UI.deActivateProgressBar(),dm_BeforeAll.dm_AggregationWorker.removeEventListener("message",e,!1);var c=a.data.file2saveContent;null!=d&&d(c)}};dm_BeforeAll.dm_AggregationWorker.addEventListener("message",e,!1);var f=dm_Tools.deepCopyDmNode(b);dm_BeforeAll.dm_AggregationWorker.postMessage({cmd:"addListener"}),c.cmd="save",c.fileFormat=a,c.root=dm_Tools.stringify(f),dm_BeforeAll.dm_AggregationWorker.postMessage(c)},dm_IO.onSaveComplete=function(){dm_UI.closeWorkInProgress()},dm_IO.onSaveCancel=function(){dm_IO.onSaveComplete()},dm_IO.onSaveError=function(){alert("An error occurred during save..."),dm_IO.onSaveComplete()},dm_IO.saveSVGFilename=function(){return dm_Datamap.currentDatamap.graph.center.name+".svg"},dm_IO.saveSVGContent=function(){return""+d3.select("#graph_svg").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML},dm_IO.saveCurrentAsSVG=function(){dm_Tools.saveFile(dm_IO.saveSVGContent(),dm_IO.saveSVGFilename(),"image/svg+xml","utf-8",!0),dm_IO.onSaveComplete()},dm_IO.saveRTFFilename=function(){return dm_Datamap.currentDatamap.graph.center.name+".rtf"},dm_IO.saveRTFContent=function(){return new dm_Rtf(dm_Datamap.currentDatamap.graph.center,dm_Datamap.currentDatamap.config.displayProps).generateRtf()},dm_IO.saveCurrentAsRTF=function(){dm_Tools.saveFile(dm_IO.saveRTFContent(),dm_IO.saveRTFFilename(),"application/ms-word","x-user-defined",!1),dm_IO.onSaveComplete()},dm_IO.saveJsonFilename=function(a){return a&&"json"!=a&&(a+=".json"),dm_Datamap.currentDatamap.graph.center.name+"."+a},dm_IO.saveJsonContent=function(a,b){var c=jQuery.data($("#saveAsLevelSliderDivContainer")[0],"data").currentValue,d=!$("#saveAsNoLeafInReportCheckbox").prop("checked"),e=dm_Tools.getConfig(dm_Datamap.currentDatamap.graph.center);dm_IO.saveAsStart(a,dm_Datamap.currentDatamap.graph.center,{config:JSON.stringify(e),maxDepth:c,noLeafInReport:d},function(a){null!=b&&b(a)})},dm_IO.saveCurrentAsJson=function(a){var a=a||"json";dm_UI.openWorkInProgress(!0,function(){dm_IO.saveJsonContent(a,function(b){dm_Tools.saveFile(b,dm_IO.saveJsonFilename(a),"application/json, text/javascript","x-user-defined"),dm_IO.onSaveComplete()})})},dm_IO.saveFreemindFilename=function(){return dm_Datamap.currentDatamap.graph.center.name+".mm"},dm_IO.saveFreemindContent=function(a){var b=jQuery.data($("#saveAsLevelSliderDivContainer")[0],"data").currentValue,c=!$("#saveAsNoLeafInReportCheckbox").prop("checked"),d=dm_Tools.getConfig(dm_Datamap.currentDatamap.graph.center);dm_IO.saveAsStart("mm",dm_Datamap.currentDatamap.graph.center,{config:JSON.stringify(d),maxDepth:b,noLeafInReport:c},function(b){var b='<map version="0.9.0">\n'+dm_IO.convertAccented2numeric(b)+"</map>\n";null!=a&&a(b)})},dm_IO.saveCurrentAsFreemind=function(){dm_UI.openWorkInProgress(!0,function(){dm_IO.saveFreemindContent(function(a){dm_Tools.saveFile(a,dm_IO.saveFreemindFilename(),"application/mm, text/javascript","x-user-defined"),dm_IO.onSaveComplete()})})},dm_IO.saveOdtFilename=function(){return dm_Datamap.currentDatamap.graph.center.name+".odt"},dm_IO.saveOdtContent=function(a){var b=jQuery.data($("#saveAsLevelSliderDivContainer")[0],"data").currentValue,c=!$("#saveAsNoLeafInReportCheckbox").prop("checked");new dm_Odt(dm_Datamap.currentDatamap.graph.center,dm_Datamap.currentDatamap.config,b,c).save(a)},dm_IO.saveCurrentAsOdt=function(){dm_UI.openWorkInProgress(!0,function(){dm_IO.saveOdtContent(function(a){console.log("saveas operation"),saveAs(a,dm_IO.saveOdtFilename()),console.log("saveas finished"),dm_IO.onSaveComplete()})})},dm_IO.saveCsvFilename=function(){return dm_Datamap.currentDatamap.graph.center.name+".csv"},dm_IO.saveCsvContent=function(a){var b=jQuery.data($("#saveAsLevelSliderDivContainer")[0],"data").currentValue,c=!$("#saveAsNoLeafInReportCheckbox").prop("checked"),d=dm_Tools.getConfig(dm_Datamap.currentDatamap.graph.center),e=dm_Csv.cloneAndConvertRichText2flatText(dm_Datamap.currentDatamap.graph.center);dm_IO.saveAsStart("csv",e,{config:JSON.stringify(d),maxDepth:b,noLeafInReport:c},function(b){null!=a&&a(b)})},dm_IO.saveCurrentAsCsv=function(){var a=dm_Tools.getMaxDepth(dm_Datamap.currentDatamap.graph.center);dm_UI.moveSlider("#saveAsLevelSliderDivContainer",a),$("#saveAsNoLeafInReportCheckbox").prop("checked",!0),dm_Tools.getConfig(dm_Datamap.currentDatamap.graph.center).noLeafInReport=!1,dm_BeforeAll.updateSaveAsEntitiesValues(a),dm_UI.openWorkInProgress(!0,function(){dm_IO.saveCsvContent(function(a){dm_Tools.saveFile(a,dm_IO.saveCsvFilename(),"application/csv, text/plain","x-user-defined"),dm_IO.onSaveComplete()})})},dm_IO.saveLdifFilename=function(){return dm_Datamap.currentDatamap.graph.center.name+".ldif"},dm_IO.saveLdifContent=function(a){var b=dm_Tools.getMaxDepth(dm_Datamap.currentDatamap.graph.center),c=!1,d=dm_Tools.getConfig(dm_Datamap.currentDatamap.graph.center);dm_IO.saveAsStart("ldif",dm_Datamap.currentDatamap.graph.center,{config:JSON.stringify(d),maxDepth:b,noLeafInReport:c},function(b){null!=a&&a(b)})},dm_IO.saveCurrentAsLdif=function(){dm_UI.openWorkInProgress(!0,function(){dm_IO.saveLdifContent(function(a){dm_Tools.saveFile(a,dm_IO.saveLdifFilename(),"application/ldif, text/javascript","x-user-defined"),dm_IO.onSaveComplete()})})},dm_IO.saveAs=function(){dm_UI.expandWindow("saveAs",null,!0);var a=dm_Datamap.currentDatamap.graph.center,b=dm_Tools.getMaxDepth(a);dm_Attributes.setBackgroundGradient("#9ECE95","#FFFFFF",d3.selectAll("#saveAs-modal-body")),d3.selectAll("#saveAsMaxDepthDivContainer").html("<h"+dm_UI_getFontSize()+">Maximum depth : "+b+"</h"+dm_UI_getFontSize()+">"),d3.selectAll("#saveAsNbEntitiesDivContainer").html("<h"+dm_UI_getFontSize()+">Total Number of entities : "+dm_Tools.countNodes(a)+"</h"+dm_UI_getFontSize()+">");var c=function(){var a=dm_Datamap.currentDatamap.graph.center,b=dm_Tools.getConfig(a),c=dm_Tools.getMaxDepth(a),d=c;isNaN(b.maxDepthForExport)||(d=Math.min(b.maxDepthForExport,c)),dm_UI.createSlider("#saveAsLevelSliderDivContainer",0,c,null,d,dm_BeforeAll.getWidthSaveAsSlider(),!0,dm_BeforeAll.updateSaveAsEntitiesValues),dm_BeforeAll.updateSaveAsEntitiesValues(d),dm_UI_zoomSaveAs()};$("#saveAs-modal").off("shown"),$("#saveAs-modal").on("shown",function(){c()}),$("#saveAsNoLeafInReportCheckbox").prop("checked",dm_Tools.getConfig(dm_Datamap.currentDatamap.graph.center).noLeafInReport?!1:!0)},dm_IO.activeTab,dm_IO.myDropzone,dm_IO.loadedFile,dm_IO.loadedData,dm_IO.datamap,dm_IO.hoTable,dm_IO.configDatamap,dm_IO.config,dm_IO.finalDatamap,dm_IO.validable,dm_IO.resetTabs=function(){dm_IO.loadedFile=null,dm_IO.loadedData=null,dm_IO.datamap=null,dm_IO.hoTable=null,dm_IO.validable=!1,$("#dataSheetContainer").empty(),$("#configFreeDataMapContainer").remove(),$("#configMapContainer").empty(),$("#openFileFreeDatamapIFrame").remove(),$("#openFileIFrameContainer").empty()},dm_IO.openFileAfterOnFileUploadSuccess=function(a){dm_IO.resetTabs(),dm_IO.loadedFile=a,dm_IO.getFileContent([a],function(b){dm_IO.loadedData=b;var c=function(){dm_IO.hoTable||$("#dataSheetContainer").html("<font color='#555555'><h3><br/><i>... Please wait while loading ...</i></h3></font>"),"tab2"==dm_IO.activeTab&&dm_IO.feedHoTable(),dm_IO.loadConfigMap()};dm_IO.datamap=new dm_Datamap(a.name,!1,null,null,c,null,!0,null,dm_IO.loadedData)})},dm_IO.deleteReplaceHostBoolean=function(){dm_UI.enableButton("#openFile-validate",!1),$("#replaceMap").empty()},dm_IO.createReplaceHostBoolean=function(){$("#replaceMap").empty();var a;return dm_UI.enableButton("#openFile-validate",dm_IO.validable),a=dm_Attributes.drawBoolean({name:"Replace host's map?"},{name:"replaceMap",rawNode:{}},d3.select("#replaceMap"),{onChange:function(){console.log("replace map ? ",d3.select("#replaceMap").select("input").property("checked"))}})},dm_IO.openFile=function(){dm_IO.dropzone("dropzone-area","openFile-modal-title","openFileIFrameContainer",dm_IO.openFileAfterOnFileUploadSuccess),dm_UI.expandWindow("openFile",null,!0,function(){dm_IO.resetZone(),dm_IO.resetTabs(),$("#openFile-modal-body").find("#"+dm_IO.activeTab).removeClass("active"),$("#openFile-modal-body").find("li").find("[href=#"+dm_IO.activeTab+"]").parent().removeClass("active"),dm_IO.activeTab="tab1",$("#"+dm_IO.activeTab).addClass("active"),$("#openFile-modal-body").find("li").find("[href=#"+dm_IO.activeTab+"]").parent().addClass("active"),dm_UI.resizeModalContent("openFile")},function(){dm_IO.resetZone(),dm_Attributes.setBackgroundGradient("#E4B689","#ffffff",d3.selectAll("#openFile-modal-body")),dm_UI.resizeModalContent("openFile"),$("#openFile-tabs").off("click"),$("#openFile-tabs").on("click",function(a){var b=$(a.target).parents("a");b[0]||(b=$(a.target)),dm_IO.activeTab=b.attr("href").split("#")[1],dm_IO.selectOpenFileTab(dm_IO.activeTab)})})},dm_IO.feedHoTable=function(){dm_IO.datamap&&!dm_IO.hoTable&&(dm_IO.hoTable=dm_Sheet.displaySheetPanel(dm_IO.datamap.root,"dataSheetContainer",dm_IO.datamap.data),dm_UI.resizeModalContent("openFile"))},dm_IO.updateOpenFileTitle=function(){var a=d3.select("#openFile-modal-body").select(".tab-content").select(".active").attr("id");dm_IO.selectOpenFileTab(a)},dm_IO.loadConfigMap=function(){if(dm_UI.resizeModalContent("openFile"),dm_IO.datamap&&!$("#configFreeDataMapContainer")[0]){var a=document.URL,b=a.indexOf("?");b>=0&&(a=a.substring(0,b)),$("#configFreeDataMapContainer").remove(),dm_UI.createIFrame("configMapContainer","configFreeDataMapContainer",null,a+"?loadFromFileStream=true&displayAttrPanel=true",function(){d3.select("#configFreeDataMapContainer").attr("seamless",null).attr("frameborder","1");var a=d3.select("#configFreeDataMapContainer")[0][0],b=a.contentWindow||a.contentDocument,c=dm_IO.loadedFile.name;c.lastIndexOf(".")>0&&(c=c.substring(0,c.lastIndexOf("."))),c+=".config.json";var d={$schema:"http://www.freedatamap.com/jsonConfigSchema/schema#",config:dm_IO.datamap.config};try{b.dm_Datamap.createNewDatamap(c,!1,null,null,function(a){dm_IO.configDatamap=a},null,null,null,d)}catch(e){console.log(e),console.log("openFile iFrame closed")}},!1,!0,null,"openFile"),dm_UI.resizeModalContent("openFile")}},dm_IO.loadDataMap=function(a){if(dm_UI.resizeModalContent("openFile"),dm_IO.loadedData&&(!$("#openFileFreeDatamapIFrame")[0]||!dm_Tools.areObjEqual(a,dm_IO.config))){var b=document.URL,c=b.indexOf("?");c>=0&&(b=b.substring(0,c)),$("#openFileFreeDatamapIFrame").remove(),dm_UI.createIFrame("openFileIFrameContainer","openFileFreeDatamapIFrame",null,b+"?loadFromFileStream=true&displayAttrPanel=true",function(){d3.select("#openFileFreeDatamapIFrame").attr("seamless",null).attr("frameborder","1");var b=d3.select("#openFileFreeDatamapIFrame")[0][0],c=b.contentWindow||b.contentDocument;try{c.dm_Datamap.createNewDatamap(dm_IO.loadedFile.name,!1,a,null,function(a){b.ownerDocument.defaultView.dm_UI.enableButton("#openFile-validate"),b.ownerDocument.defaultView.dm_IO.validable=!0,dm_IO.finalDatamap=a},null,null,null,dm_IO.loadedData)}catch(d){console.log(d),console.log("openFile iFrame closed")}},!1,!0,null,"openFile"),dm_UI.resizeModalContent("openFile")}},dm_IO.selectOpenFileTab=function(a){if("tab1"==a)d3.selectAll("#openFile-modal-title").html("Drop files here or click in it... (*.json *.csv *.ldif)"),dm_IO.deleteReplaceHostBoolean();else if("tab2"==a)d3.selectAll("#openFile-modal-title").html("Spreadsheet view"),dm_IO.deleteReplaceHostBoolean(),dm_IO.hoTable||setTimeout(dm_IO.feedHoTable,100);else if("tab3"==a)d3.selectAll("#openFile-modal-title").html("Configure how to go from tabular data to a tree graph with charts"),dm_IO.deleteReplaceHostBoolean(),dm_IO.loadConfigMap();else if("tab4"==a){d3.selectAll("#openFile-modal-title").html("Select (center) the branch you want to import..."),dm_IO.createReplaceHostBoolean();var b=dm_IO.getConfigFromConfigMap();dm_IO.loadDataMap(b)}},dm_IO.getConfigFromConfigMap=function(){var a,b=document.getElementById("configFreeDataMapContainer");if(b){var c=b.contentWindow||b.contentDocument;dm_Tools.prop2objAll(c.dm_Datamap.currentDatamap.root);var d=dm_Tools.deepCopy(c.dm_Datamap.currentDatamap.root.children[0]);dm_Tools.removeNodeProps(d,["styles","setColumns2node","aggregate","columns","columnNames","displayProps"],["name","children"]),a=dm_Json2tree.tree2obj(d),a.columnNames=dm_Tools.convertColumnsTreeIntoArray(a.columnNames),dm_IO.turnOffConfigStylesVisible(a)}else a=dm_IO.datamap.config;return a},dm_IO.turnOffConfigStylesVisible=function(a){for(var b=0;b<a.styles.length;b++){var c=a.styles[b];for(var d in c)"backgroundImage"!=d&&(c[d+".dm_props"]&&(c[d+".dm_props"].visible=!1),c[d+".visible"]&&(c[d+".visible"]=!1),c[d+".dm_props"]&&(c[d+".dm_props"].editable=!1),c[d+".visible"]&&(c[d+".editable"]=!1))}},dm_IO.resetZone=function(){d3.selectAll("#myDropzone").style("display","inherit"),dm_IO.updateOpenFileTitle()},dm_IO.dropzone=function(a,b){var c=document.getElementById("myDropzone");c&&c.remove();var d=document.getElementById(a).appendChild(document.getElementById("myDropzoneToBeCopied").cloneNode("true"));d.setAttribute("id","myDropzone");var e=document.URL.split("?")[0],f=d.querySelector("#myDropzonePreviewTemplate");f.id="";var g=f.parentNode.innerHTML;f.parentNode.removeChild(f);var h={url:e+"uploadedFiles",dictDefaultMessage:"drop files here (or click)",thumbnailWidth:80,thumbnailHeight:80,parallelUploads:20,previewTemplate:g,autoQueue:!1,previewsContainer:"#myDropzonePreviews"};dm_IO.myDropzone&&(dm_IO.myDropzone.destroy(),dm_IO.myDropzone=null),dm_IO.myDropzone=new Dropzone("div#myDropzone",h),dm_IO.myDropzone.on("addedfile",function(a){d3.selectAll("#"+b).html("Load file or drop others..."),a.previewElement.querySelector(".start").onclick=function(){dm_IO.myDropzone.enqueueFile(a)};var c=a.name.lastIndexOf(".");if(c>=0){var d=a.name.substring(c);".json"==d?this.emit("thumbnail",a,"images/json-file.png"):".csv"==d?this.emit("thumbnail",a,"images/csv-file.png"):".ldif"==d?this.emit("thumbnail",a,"images/ldap.png"):".zip"==d&&this.emit("thumbnail",a,"images/zip-file.png")}}),dm_IO.myDropzone.on("success",function(a){setTimeout(function(){dm_IO.openFileAfterOnFileUploadSuccess(a)},1e3)})},dm_3D_3dsLoader.chunkIds={},dm_3D_3dsLoader.chunkIds.MAIN3DS=19789,dm_3D_3dsLoader.chunkIds.EDIT3DS=15677,dm_3D_3dsLoader.chunkIds.KEYF3DS=45056,dm_3D_3dsLoader.chunkIds.EDIT_MATERIAL=45055,dm_3D_3dsLoader.chunkIds.EDIT_CONFIG1=256,dm_3D_3dsLoader.chunkIds.EDIT_CONFIG2=15933,dm_3D_3dsLoader.chunkIds.EDIT_VIEW_P1=28690,dm_3D_3dsLoader.chunkIds.EDIT_VIEW_P2=28689,dm_3D_3dsLoader.chunkIds.EDIT_VIEW_P3=28704,dm_3D_3dsLoader.chunkIds.EDIT_VIEW1=28673,dm_3D_3dsLoader.chunkIds.EDIT_BACKGR=4608,dm_3D_3dsLoader.chunkIds.EDIT_AMBIENT=8448,dm_3D_3dsLoader.chunkIds.EDIT_OBJECT=16384,dm_3D_3dsLoader.chunkIds.EDIT_UNKNW01=4352,dm_3D_3dsLoader.chunkIds.EDIT_UNKNW02=4609,dm_3D_3dsLoader.chunkIds.EDIT_UNKNW03=4864,dm_3D_3dsLoader.chunkIds.EDIT_UNKNW04=5120,dm_3D_3dsLoader.chunkIds.EDIT_UNKNW05=5152,dm_3D_3dsLoader.chunkIds.EDIT_UNKNW06=5200,dm_3D_3dsLoader.chunkIds.EDIT_UNKNW07=5376,dm_3D_3dsLoader.chunkIds.EDIT_UNKNW08=8704,dm_3D_3dsLoader.chunkIds.EDIT_UNKNW09=8705,dm_3D_3dsLoader.chunkIds.EDIT_UNKNW10=8720,dm_3D_3dsLoader.chunkIds.EDIT_UNKNW11=8960,dm_3D_3dsLoader.chunkIds.EDIT_UNKNW12=8962,dm_3D_3dsLoader.chunkIds.EDIT_UNKNW13=12288,dm_3D_3dsLoader.chunkIds.EDIT_UNKNW14=45055,dm_3D_3dsLoader.chunkIds.OBJ_TRIMESH=16640,dm_3D_3dsLoader.chunkIds.OBJ_LIGHT=17920,dm_3D_3dsLoader.chunkIds.OBJ_CAMERA=18176,dm_3D_3dsLoader.chunkIds.OBJ_UNKNWN01=16400,dm_3D_3dsLoader.chunkIds.OBJ_UNKNWN02=16402,dm_3D_3dsLoader.chunkIds.CAM_UNKNWN01=18192,dm_3D_3dsLoader.chunkIds.CAM_UNKNWN02=18208,dm_3D_3dsLoader.chunkIds.LIT_OFF=17952,dm_3D_3dsLoader.chunkIds.LIT_SPOT=17936,dm_3D_3dsLoader.chunkIds.LIT_UNKNWN01=18010,dm_3D_3dsLoader.chunkIds.TRI_VERTEXL=16656,dm_3D_3dsLoader.chunkIds.TRI_FACEL2=16657,dm_3D_3dsLoader.chunkIds.TRI_FACEL1=16672,dm_3D_3dsLoader.chunkIds.TRI_SMOOTH=16720,dm_3D_3dsLoader.chunkIds.TRI_LOCAL=16736,dm_3D_3dsLoader.chunkIds.TRI_VISIBLE=16741,dm_3D_3dsLoader.chunkIds.KEYF_UNKNWN01=45065,dm_3D_3dsLoader.chunkIds.KEYF_UNKNWN02=45066,dm_3D_3dsLoader.chunkIds.KEYF_FRAMES=45064,dm_3D_3dsLoader.chunkIds.KEYF_OBJDES=45058,dm_3D_3dsLoader.chunkIds.COL_RGB=16,dm_3D_3dsLoader.chunkIds.COL_TRU=17,dm_3D_3dsLoader.chunkIds.COL_UNK=19,dm_3D_3dsLoader.chunkIds.TOP=1,dm_3D_3dsLoader.chunkIds.BOTTOM=2,dm_3D_3dsLoader.chunkIds.LEFT=3,dm_3D_3dsLoader.chunkIds.RIGHT=4,dm_3D_3dsLoader.chunkIds.FRONT=5,dm_3D_3dsLoader.chunkIds.BACK=6,dm_3D_3dsLoader.chunkIds.USER=7,dm_3D_3dsLoader.chunkIds.CAMERA=8,dm_3D_3dsLoader.chunkIds.LIGHT=9,dm_3D_3dsLoader.chunkIds.DISABLED=16,dm_3D_3dsLoader.chunkIds.BOGUS=17,dm_3D_3dsLoader.parse=function(a,b){dm_Tools.loadLocalFile(a,function(a){for(var c,d,e,f,g,h,i,j,k=!1,l=a.response.length,m=new jDataView(a.response,0,l,!0),n=0,o=function(){var a=dm_Tools.positiveHex(m.getInt16(n));return n+=2,a},p=function(){var a=m.getInt32(n);return n+=4,a},q=function(){var a=p();return n=n+a-6,a},r=function(a,b){for(var c=!1,d=0;d<b.length&&!c;d++)c=b[d]==a;return c},s=function(){for(var a="";0!=m.getInt8(n);)a+=String.fromCharCode(m.getInt8(n)),n++;return n++,a},t=function(){for(var a=[],b=0;3>b;b++)a.push(m.getFloat32(n)),n+=4;return a},u=[dm_3D_3dsLoader.chunkIds.MAIN3DS,dm_3D_3dsLoader.chunkIds.EDIT3DS,dm_3D_3dsLoader.chunkIds.EDIT_OBJECT,dm_3D_3dsLoader.chunkIds.OBJ_TRIMESH,dm_3D_3dsLoader.chunkIds.TRI_VERTEXL,dm_3D_3dsLoader.chunkIds.TRI_FACEL1],v=[];l>n;)if(c=o(),k&&console.log(n-2,c.toString(16)),r(c,u)){if(d=p(),k&&console.log("chkLen = "+d),c==dm_3D_3dsLoader.chunkIds.EDIT_OBJECT)e=s();else if(c==dm_3D_3dsLoader.chunkIds.TRI_VERTEXL){h=m.getInt16(n),n+=2,f=[],k&&console.log("nb of vertices = "+h);for(var w=0;h>w;w++)f.push(t());k&&console.log(f)}else if(c==dm_3D_3dsLoader.chunkIds.TRI_FACEL1){i=m.getInt16(n),k&&console.log("nb of triangles = "+i),n+=2;for(var w=0;i>w;w++){g=[];for(var x=0;3>x;x++)j=m.getInt16(n),n+=2,g.push(f[j]);n+=2,v.push(g)}k&&console.log(v)}}else d=q(),k&&console.log("chunk id "+c.toString(16)+" not found, jump "+d+" and goto "+n);k&&console.log("decoded 3ds object : ",v),b&&b(v)},!1,"application/octet-stream")},dm_Sheet.displaySheetPanel=function(a,b,c){var a=a||dm_UI.lastMouseOverNode,b=b||"sheetContainer",d=d3.selectAll("#"+b);$("#"+b).empty();var e=d.append("div").attr({id:"handsontable",width:"100%"}).style({overflow:"scroll"});"sheetTable_"+dm_Tools.formatJSVarName(a.name),console.time("node2table");var f={},g=!1;c&&(g=!0);var c=c||dm_Csv.node2table(a,!0,f);console.timeEnd("node2table");var h=[];g&&(h=dm_Tools.deepCopy(c[0]),c.splice(0,1),f=h);var i=dm_Csv.getColumnValuesFromTable(c,f);console.log("table",c),console.time("draw table");var j=[];if(g)for(var k=0;k<h.length;k++){var l=h[k];j.push({type:"autocomplete",strict:!1,source:i[l]})}else{var m,n;h=[];for(var o in f)n=o,0==o.indexOf("dm_hoTable_level_")&&(m=o.substring("dm_hoTable_level_".length),n="level "+m),h.push(n),j.push({data:o,type:"autocomplete",strict:!1,source:i[o]})}console.log("columns4handsonTable",j),console.log("colHeaders",h);var p=new Handsontable(e[0][0],{data:c,colHeaders:h,columns:j,rowHeaders:!0,contextMenu:!0,stretchH:"all",contextMenu:!0,maxRows:1/0,currentRowClassName:"currentRow",currentColClassName:"currentCol",columnSorting:!0,manualColumnMove:!0,manualColumnResize:!0,className:"htMiddle",minSpareRows:0});return console.timeEnd("draw table"),p},dm_Sheet.displayConfigPanel=function(){var a=dm_UI.lastMouseOverNode;d3.selectAll("#config-modal-title").html(a.name);var b=d3.selectAll("#config-modal-body");dm_Attributes.setBackground(a,b,0);var c=d3.selectAll("#configSheetContainer");$("#configSheetContainer").empty();var d=d3.selectAll("#configColumnsChoiceContainer");$("#configColumnsChoiceContainer").empty();var e=c.append("div").attr({id:"handsontableConfigSheet",width:"100%"}).style({overflow:"scroll"});dm_UI.resizeModalContent("config"),"configSheetTable_"+dm_Tools.formatJSVarName(a.name),console.time("node2table");var f={},g=dm_Csv.node2table(a,!0,f);console.timeEnd("node2table");var h=dm_Csv.getColumnValuesFromTable(g,f);console.log(g),console.log(h),console.time("draw table"),e.style({overflow:"scroll"});var i,j,k=[],l=[];for(var m in f)j=m,0==m.indexOf("dm_hoTable_level_")&&(i=m.substring("dm_hoTable_level_".length),j="level "+i),k.push(j),l.push({data:m,type:"autocomplete",strict:!1,source:h[m]});new Handsontable(e[0][0],{data:g,colHeaders:k,columns:l,rowHeaders:!0,contextMenu:!0,stretchH:"all",contextMenu:!0,maxRows:1/0,stretchH:"all",currentRowClassName:"currentRow",currentColClassName:"currentCol",columnSorting:!0,manualColumnMove:!0,manualColumnResize:!0,className:"htMiddle",minSpareRows:0}),console.timeEnd("draw table");var n=d.append("div").attr({id:"handsontableColumnsChoice"}).style({"overflow-y":"scroll"});dm_UI.resizeModalContent("config");var k=[],g=[];for(var m in f)0!=m.indexOf("dm_hoTable_level_")&&(k.push(m),g.push([m]));new Handsontable(n[0][0],{data:g,colHeaders:["Column"],columns:[{type:"autocomplete",strict:!1,source:k}],rowHeaders:!0,contextMenu:!0,stretchH:"all",contextMenu:!0,maxRows:1/0,stretchH:"all",currentRowClassName:"currentRow",currentColClassName:"currentCol",columnSorting:!0,manualColumnMove:!0,manualColumnResize:!0,className:"htMiddle",minSpareRows:1})};